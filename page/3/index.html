<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/hexo_blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/hexo_blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/hexo_blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/hexo_blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/hexo_blog/css/main.css">


<link rel="stylesheet" href="/hexo_blog/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"sallyslove.github.io","root":"/hexo_blog/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
<meta property="og:type" content="website">
<meta property="og:title" content="è·¬æ­¥">
<meta property="og:url" content="https://sallyslove.github.io/hexo_blog/page/3/index.html">
<meta property="og:site_name" content="è·¬æ­¥">
<meta property="og:description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Lynn Shen">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://sallyslove.github.io/hexo_blog/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>è·¬æ­¥</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/hexo_blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">è·¬æ­¥</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">ä¸ç§¯è·¬æ­¥ï¼Œæ— ä»¥è‡³åƒé‡Œ</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/hexo_blog/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/hexo_blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/06/25/Cassandra_Maintain/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/06/25/Cassandra_Maintain/" class="post-title-link" itemprop="url">Cassandra Maintain</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-06-25 17:01:57" itemprop="dateCreated datePublished" datetime="2019-06-25T17:01:57+08:00">2019-06-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-02-22 16:24:25" itemprop="dateModified" datetime="2021-02-22T16:24:25+08:00">2021-02-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/cassandra/" itemprop="url" rel="index"><span itemprop="name">cassandra</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/06/25/Cassandra_Maintain/" class="post-meta-item leancloud_visitors" data-flag-title="Cassandra Maintain" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/06/25/Cassandra_Maintain/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/06/25/Cassandra_Maintain/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2>
<ul>
<li><a href="https://thelastpickle.com/blog/2016/07/27/about-deletes-and-tombstones.html" target="_blank" rel="noopener">å…³äºCassandraçš„åˆ é™¤å’Œå¢“ç¢‘</a></li>
<li><a href="http://cassandra.apache.org/doc/latest/operating/compaction.html#defragmentation" target="_blank" rel="noopener">æœ€æ–°å®˜æ–¹æ–‡æ¡£ï¼Œéå¸¸æ¸…æ¥š</a></li>
<li><a href="https://zhaoyanblog.com/archives/966.html" target="_blank" rel="noopener">æœ‰ä¸Šç¯‡æ–‡ç« çš„ç¿»è¯‘</a></li>
<li><a href="https://www.cnblogs.com/didda/p/4728588.html" target="_blank" rel="noopener">Cassandra çš„å‹ç¼©ç­–ç•¥STCSï¼ŒLCS å’Œ DTCS</a></li>
</ul>
<h2 id="delete-data"><a class="header-anchor" href="#delete-data"></a>Delete Data</h2>
<ul>
<li>æ‰¾äº†ä¸€ä¸‹åšå®¢ï¼Œå‘ç°å±…ç„¶éƒ½æ²¡æœ‰ä¸€ä¸ªç« èŠ‚æ˜¯å…³äºåˆ é™¤æ•°æ®çš„</li>
<li>äº‹å®ä¸Šï¼Œ<code>Cassandra</code>é‡Œé¢çš„åˆ é™¤æ˜¯ä¸€ç§å†™æ“ä½œï¼Œä¼šæ’å…¥å¢“ç¢‘ã€‚åœ¨ä¸Šé¢çš„å‚åŠ é“¾æ¥é‡Œé¢è¯¦å°½æè¿°äº†è¿™ä¸ªè¿‡ç¨‹</li>
<li>å¯ä»¥ä½¿ç”¨<code>SSTabledump</code>å‘½ä»¤æ¥è¿›è¡ŒæŸ¥è¯¢ã€‚<strong><em>ä½†æ˜¯å¹¶æ²¡æœ‰åœ¨æˆ‘ä»¬çš„ç¯å¢ƒä¸­æ‰¾åˆ°è¿™ä¸ªå‘½ä»¤</em></strong></li>
<li>éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œè®¨è®ºçš„éƒ½æ˜¯åˆ é™¤ä¹‹åå†<code>flush</code>åˆ°<code>SSTable</code>é‡Œçš„æƒ…å†µï¼Œ<code>Memtable</code>é‡Œé¢çš„æ•°æ®åˆ é™¤ä¼šæœ‰æ‰€ä¸ç—›</li>
<li><code>gc_grace_seconds</code>ï¼šåœ¨åˆ é™¤æ•°æ®ä¹‹åä¼šä¿å­˜ä¸€æ®µæ—¶é—´çš„å¢“ç¢‘ï¼Œä»¥æ­¤æ¥ä¿è¯æ•°æ®åŒæ­¥ã€‚</li>
</ul>
<h3 id="åˆ é™¤æŸä¸€è¡Œçš„æŸä¸ªæ•°æ®"><a class="header-anchor" href="#åˆ é™¤æŸä¸€è¡Œçš„æŸä¸ªæ•°æ®"></a>åˆ é™¤æŸä¸€è¡Œçš„æŸä¸ªæ•°æ®</h3>
<ul>
<li>
<p>å¯ä»¥åªåˆ é™¤æŸä¸€è¡Œçš„æŸä¸€ä¸ªæ•°æ®ï¼Œå¦‚ä¸‹</p>
</li>
<li>
<p>å½“åˆ é™¤æ‰æŸä¸€è¡Œçš„æŸä¸ªæ•°æ®çš„æ—¶å€™ï¼Œä½¿ç”¨ä¸Šé¢çš„<code>SSTabledump</code>å‘½ä»¤ï¼Œè¿™ä¸€è¡Œæ•°æ®å°†æ²¡æœ‰<code>liveness_info</code></p>
<pre><code>DELETE crates FROM tlp_lab.tombstones WHERE fruit='apple' AND date ='20160617';
</code></pre>
</li>
</ul>
<p>é‚£ä¹ˆè¿™ä¸ªæ•°æ®ä¼šæ˜¾ç¤º<code>null</code></p>
<pre><code>  alain$ echo &quot;SELECT * FROM tlp_lab.tombstones LIMIT 100;&quot; | cqlsh
  fruit   | date     | crates
  ---------+----------+-----------------
  apple | 20160617 |            null
</code></pre>
<h3 id="åˆ é™¤ä¸€è¡Œçš„æ•°æ®"><a class="header-anchor" href="#åˆ é™¤ä¸€è¡Œçš„æ•°æ®"></a>åˆ é™¤ä¸€è¡Œçš„æ•°æ®</h3>
<ul>
<li>
<p>åˆ é™¤æ‰ä¸€è¡Œä¹‹åï¼Œè¿™ä¸€è¡Œçš„æ•°æ®çš„<code>cell</code>ä¹Ÿå°†æ²¡æœ‰ä»»ä½•æ•°æ®</p>
<pre><code>&quot;rows&quot; : [
{
  &quot;type&quot; : &quot;row&quot;,
  &quot;position&quot; : 19,
  &quot;clustering&quot; : [ &quot;20160617&quot; ],
  &quot;deletion_info&quot; : { &quot;marked_deleted&quot; : &quot;2016-06-16T19:31:41.142454Z&quot;, &quot;local_delete_time&quot; : &quot;2016-06-16T19:31:41Z&quot; },
  &quot;cells&quot; : [ ]
}

&quot;rows&quot; : [
{
  &quot;type&quot; : &quot;row&quot;,
  &quot;position&quot; : 125,
  &quot;clustering&quot; : [ &quot;20160616&quot; ],
  &quot;liveness_info&quot; : { &quot;tstamp&quot; : &quot;2016-06-16T18:52:41.903751Z&quot;, &quot;ttl&quot; : 2592000, &quot;expires_at&quot; : &quot;2016-07-16T18:52:41Z&quot;, &quot;expired&quot; : false },
  &quot;cells&quot; : [
    { &quot;name&quot; : &quot;crates&quot;, &quot;deletion_info&quot; : { &quot;marked_deleted&quot; : &quot;2016-06-16T18:52:41.903750Z&quot;, &quot;local_delete_time&quot; : &quot;2016-06-16T18:52:41Z&quot; } },
    { &quot;name&quot; : &quot;crates&quot;, &quot;path&quot; : [ &quot;6&quot; ], &quot;value&quot; : &quot;&quot; },
    { &quot;name&quot; : &quot;crates&quot;, &quot;path&quot; : [ &quot;7&quot; ], &quot;value&quot; : &quot;&quot; },
    { &quot;name&quot; : &quot;crates&quot;, &quot;path&quot; : [ &quot;8&quot; ], &quot;value&quot; : &quot;&quot; }
  ]
}
</code></pre>
</li>
</ul>
<h3 id="åˆ é™¤ä¸€ä¸ªèŒƒå›´å†…çš„æ•°æ®"><a class="header-anchor" href="#åˆ é™¤ä¸€ä¸ªèŒƒå›´å†…çš„æ•°æ®"></a>åˆ é™¤ä¸€ä¸ªèŒƒå›´å†…çš„æ•°æ®</h3>
<ul>
<li>
<p>è¿™ä¸ªå«ä¹‰å°±æ˜¯ï¼Œæ¯”å¦‚ä¸‹é¢çš„å‘½ä»¤ï¼Œè¿™æ ·å¯ä»¥ä¸€æ¬¡æ€§åˆ é™¤å¥½å‡ è¡Œæ•°æ®</p>
<pre><code>DELETE FROM tlp_lab.tombstones WHERE fruit='apple' AND date &gt; '20160615';
</code></pre>
</li>
<li>
<p>é‚£ä¹ˆå­˜ä¸‹æ¥çš„æ•°æ®ä¼šå˜ä¸ºï¼Œ<code>type</code>å˜åŒ–äº†</p>
<pre><code>&quot;rows&quot; : [
    {
      &quot;type&quot; : &quot;range_tombstone_bound&quot;,
      &quot;start&quot; : {
        &quot;type&quot; : &quot;exclusive&quot;,
        &quot;clustering&quot; : [ &quot;20160615&quot; ],
        &quot;deletion_info&quot; : { &quot;marked_deleted&quot; : &quot;2016-06-16T19:53:21.133300Z&quot;, &quot;local_delete_time&quot; : &quot;2016-06-16T19:53:21Z&quot; }
      }
    },
    {
      &quot;type&quot; : &quot;range_tombstone_bound&quot;,
      &quot;end&quot; : {
        &quot;type&quot; : &quot;inclusive&quot;,
        &quot;deletion_info&quot; : { &quot;marked_deleted&quot; : &quot;2016-06-16T19:53:21.133300Z&quot;, &quot;local_delete_time&quot; : &quot;2016-06-16T19:53:21Z&quot; }
      }
</code></pre>
</li>
</ul>
<h3 id="åˆ é™¤ä¸€ä¸ªpartitionçš„æ•°æ®"><a class="header-anchor" href="#åˆ é™¤ä¸€ä¸ªpartitionçš„æ•°æ®"></a>åˆ é™¤ä¸€ä¸ªpartitionçš„æ•°æ®</h3>
<ul>
<li>
<p>å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code>DELETE FROM tlp_lab.tombstones WHERE fruit='pickles';
</code></pre>
<p>ä¼šåœ¨<code>partition</code>çš„åœ°æ–¹åŠ å…¥<code>deletion_info</code>ï¼Œè€Œé€šå¸¸æƒ…å†µä¸‹åªæœ‰<code>key</code>å’Œ<code>position</code></p>
<pre><code>{
  &quot;partition&quot; : {
    &quot;key&quot; : [ &quot;pickles&quot; ],
    &quot;position&quot; : 0,
    &quot;deletion_info&quot; : { &quot;marked_deleted&quot; : &quot;2016-06-17T09:38:52.550841Z&quot;, &quot;local_delete_time&quot; : &quot;2016-06-17T09:38:52Z&quot; }
}
  
&quot;partition&quot; : {
   &quot;key&quot; : [ &quot;apple&quot; ],
   &quot;position&quot; : 0
},  
</code></pre>
</li>
</ul>
<h3 id="é›†åˆæ•°æ®"><a class="header-anchor" href="#é›†åˆæ•°æ®"></a>é›†åˆæ•°æ®</h3>
<ul>
<li>éœ€è¦é¢å¤–æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœä½¿ç”¨é›†åˆæ•°æ®ï¼Œæ¯”å¦‚<code>list</code>ï¼Œé‚£ä¹ˆåœ¨æ›´æ–°çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€ä¸ªæ½œåœ¨çš„åˆ é™¤æ“ä½œã€‚ä¼šå°†æ—§çš„æ•°æ®åˆ é™¤ï¼Œè¿™ä¸€ç‚¹éå¸¸æ¼äººï¼Œéœ€è¦æ³¨æ„</li>
</ul>
<h3 id="gc-grace-secondså‚æ•°"><a class="header-anchor" href="#gc-grace-secondså‚æ•°"></a>gc_grace_secondså‚æ•°</h3>
<ul>
<li><code>gc_grace_seconds</code>å‚æ•°çš„é»˜è®¤å€¼ä¸º10å¤©ï¼Œè¿™ä¸ªå‚æ•°çš„æ„æ€å°±æ˜¯è¿™ä¸ªæ•°æ®è¢«åˆ é™¤ä¹‹åï¼Œç›¸åº”çš„<code>tombstone</code>ä¹Ÿä¸ä¼šç«‹åˆ»åœ¨<code>compaction</code>ä¸­è¢«ç§»é™¤</li>
<li>è¿™ä¸ªå€¼çš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯åˆ é™¤çš„ä¸€è‡´æ€§ã€‚ä»¥é˜²æœ‰çš„èŠ‚ç‚¹ä¸Šé¢åˆ é™¤å¤±è´¥ï¼Œå‡ºç°å¹½çµæ•°æ®ã€‚åœ¨ç»´æŠ¤æ“ä½œç« èŠ‚ä¸­æœ‰è¿›ä¸€æ­¥çš„è§£é‡Šã€‚å‡è®¾æœ‰åˆ é™¤å¤±è´¥ï¼Œç„¶åå®¢æˆ·åšäº†<code>repair</code>æ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®ä¼šè¢«å¤åˆ¶åˆ°å·²ç»åˆ é™¤çš„èŠ‚ç‚¹ä¸Šé¢ã€‚é‚£ä¹ˆå°±é”™äº†ã€‚ç›¸åï¼Œå¦‚æœæ˜¯æ’å¢“ç¢‘ï¼Œå³ä½¿æœ‰èŠ‚ç‚¹æ²¡æ’ä¸Šï¼Œ<code>repair</code>çš„æ—¶å€™ä¹Ÿåªä¼šå¤åˆ¶ä¸ªå¢“ç¢‘è¿‡å»ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦éœ€è¦ç»´æŒä¸€é˜µå¢“ç¢‘</li>
</ul>
<h2 id="ç»´æŠ¤æ“ä½œ"><a class="header-anchor" href="#ç»´æŠ¤æ“ä½œ"></a>ç»´æŠ¤æ“ä½œ</h2>
<ul>
<li><code>minor compaction</code>: è¿™ä¸ªå°±æ˜¯<code>C#</code>è‡ªå·±åšçš„å‹ç¼©</li>
<li><code>major compaction</code>: è¿™ä¸ªå°±æ˜¯æ‰‹åŠ¨çš„ç”¨<code>nodetool</code>åšçš„ï¼Œä¼šå¯¹æ‰€æœ‰çš„å½“å‰<code>node</code>ä¸Šé¢çš„<code>SSTable</code>è¿›è¡Œå‹ç¼©</li>
<li><code>user defined compaction</code>ï¼š å®¢æˆ·è‡ªå®šä¹‰çš„ï¼Œå¯¹éƒ¨åˆ†<code>SSTable</code>è¿›è¡Œå‹ç¼©ã€‚ç”¨æˆ·å¯ä»¥åªé’ˆå¯¹ä¸€å¼ è¡¨æ¥åšå‹ç¼©ï¼ŒCassandraä¼šå¯¹æ•°æ®è¿›è¡Œæ ¡éªŒï¼Œä½¿ç”¨<code>unchecked_tombstone_compaction</code> å‚æ•°å¯ä»¥è·³è¿‡è¿™ä¸ªæ ¡éªŒè¿‡ç¨‹</li>
<li><code>Scrub</code>: è¿™ä¸ªæ“ä½œä¼šå°è¯•ä¿®å¤<code>SSTable</code>ï¼Œæ‰€ä»¥è¿™ä¸ªåŠ¨ä½œæœ‰å¯èƒ½ä¼šåˆ é™¤æœ‰æ•ˆä½†æ˜¯å·²ç»åæ‰çš„æ•°æ®ï¼Œå¦‚æœè¿™ä¸ªå‘ç”Ÿï¼Œå¾—ç”¨<code>repair</code>æ¥ä¿®å¤</li>
<li>åœ¨ä»¥ä¸‹çš„å‚è€ƒé“¾æ¥é‡Œé¢è¿˜æœ‰ä¸€äº›å¥‡ç‰¹çš„ç»´æŠ¤æ“ä½œï¼Œæš‚æ—¶æ²¡å­¦ä¹ </li>
<li><a href="http://cassandra.apache.org/doc/latest/operating/compaction.html" target="_blank" rel="noopener">ç»´æŠ¤æ“ä½œå’Œå‹ç¼©</a></li>
</ul>
<h2 id="compacting-sstable-data"><a class="header-anchor" href="#compacting-sstable-data"></a>Compacting SSTable Data</h2>
<p><img src="https://docs.datastax.com/en/cassandra/3.0/cassandra/images/dml_compaction.png" alt="å®˜ç½‘å‹ç¼©æ•°æ®å›¾ç‰‡"></p>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦compaction"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦compaction"></a>ä¸ºä»€ä¹ˆéœ€è¦Compaction</h3>
<ul>
<li><code>cassandra</code>å¹¶ä¸ä¼šåˆ é™¤æ•°æ®ã€‚å½“éœ€è¦<code>update</code>ä¸€ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿä¸æ˜¯åœ¨<code>SSTable</code>é‡Œé¢è¿›è¡Œè¦†ç›–ï¼Œè€Œæ˜¯ä¼šæ’å…¥ä¸€ä¸ªæ–°çš„æ•°æ®ï¼Œå¸¦ä¸Šæ–°çš„<code>version</code>ã€‚</li>
<li>è¿™æ ·åšçš„è¯ï¼Œ<code>cassandra</code>å†™å…¥æ•°æ®ä¼šéå¸¸å¿«ï¼Œå› ä¸ºä¸éœ€è¦æŸ¥è¯¢ï¼Œä½†æ˜¯å¼Šç«¯å°±æ˜¯ä¼šæœ‰è¶Šæ¥è¶Šå¤šçš„æ•°æ®ã€‚</li>
<li>è¿™ä¸ªæ—¶å€™å°±éœ€è¦è¿›è¡Œ<code>compaction</code>ã€‚</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯compaction"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯compaction"></a>ä»€ä¹ˆæ˜¯Compaction</h3>
<ul>
<li>To keep the multiple versions of the SSTables from overwhelming it, the database merges SSTables on a regular basis to get rid of the older versions of the dataã€‚ <code>cassandra</code>ä¼šåœ¨ä¸€ä¸ªåŸºç¡€ä¹‹ä¸Šå¯¹æ—§çš„ç‰ˆæœ¬çš„æ•°æ®è¿›è¡Œåˆå¹¶ï¼Œè¿™ä¸ªå°±æ˜¯<code>compaction</code></li>
<li><code>cassandra</code>é»˜è®¤ä¼šè¿›è¡Œå¾ˆå¤šæ¬¡å°çš„<code>compaction</code>ã€‚åœ¨æœ‰æ–°ç”Ÿæˆ<code>SStable</code>çš„æ—¶å€™ï¼Œæˆ–è€…é»˜è®¤5åˆ†é’Ÿä¼šè¿›è¡Œä¸€æ¬¡æ£€æŸ¥ï¼Œéœ€ä¸éœ€è¦è¿›è¡Œ<code>minor compaction</code></li>
<li>ä¼šåˆå¹¶åŒä¸€è¡Œçš„ï¼Œä¸åŒç‰ˆæœ¬çš„æ•°æ®ã€‚ä¸åŒç‰ˆæœ¬å¸¦ç€ä¸åŒçš„<code>timestamp</code></li>
</ul>
<h3 id="ä»€ä¹ˆæƒ…å†µä¸‹å¢“ç¢‘ä¼šåœ¨compactionä¸­è¢«ç§»é™¤"><a class="header-anchor" href="#ä»€ä¹ˆæƒ…å†µä¸‹å¢“ç¢‘ä¼šåœ¨compactionä¸­è¢«ç§»é™¤"></a>ä»€ä¹ˆæƒ…å†µä¸‹å¢“ç¢‘ä¼šåœ¨Compactionä¸­è¢«ç§»é™¤</h3>
<ul>
<li>è¿™ä¹Ÿæ˜¯æ¥è‡ªä¸Šç¯‡å‚è€ƒæ–‡æ¡£çš„ã€‚è¿™ç¯‡æ–‡æ¡£æ¯”è¾ƒæ¸…æ¥š</li>
<li>äº‹å®ä¸Šæœ‰å¥½å‡ ä¸ªè¦æ±‚ï¼š
<ul>
<li><code>gc_grace_seconds</code> å·²ç»è¿‡äº†ï¼Œè¿™ç‚¹å·²ç»åœ¨ä¸Šé¢è§£é‡Šè¿‡äº†</li>
<li>_If partition X contains the tombstone, the sstable containing the partition plus all sstables containing data older than the tombstone containing X must be included in the same compaction. We donâ€™t need to care if the partition is in an sstable if we can guarantee that all data in that sstable is newer than the tombstone. If the tombstone is older than the data it cannot shadow that data._è¿™å¥è¯å®åœ¨å¤ªæ‹—å£äº†ï¼Œå«ä¹‰å°±æ˜¯è¯´å¢“ç¢‘å¾—æ˜¯æœ€è€çš„ä¸€ä¸ªï¼Œå¦åˆ™åˆ é™¤ä¸æ‰ï¼Ÿ</li>
<li><code>only_purge_repaired_tombstones</code> è¿™è¿˜æœ‰ä¸€ä¸ªå‚æ•°ï¼Œå¦‚æœä¸æ˜¯repairè¿‡ç¨‹ä¸­çš„å¢“ç¢‘å°±ä¸åˆ é™¤ã€‚è¿™ä¸ªå‚æ•°ä¼°è®¡å¾ˆå°‘ç”¨å§</li>
<li>è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šæƒ…å†µï¼Œå°±æ˜¯æ•´ä¸ª<code>SSTable</code>é‡Œé¢éƒ½æ˜¯å¢“ç¢‘ï¼Œè¿™ç§æƒ…å†µåœ¨ä»¥æ—¶é—´åºåˆ—çš„è¡¨å¹¶ä¸”ä½¿ç”¨äº†<code>TTL</code>ä¹‹åå¾ˆå®¹æ˜“å‡ºç°ã€‚å¦‚æœæ²¡æœ‰è¢«æ•´è¡¨åˆ é™¤ï¼Œé‚£ä¹ˆå°±åƒä¸Šä¸€ä¸ªbulleté‡Œé¢è®²çš„ï¼Œè¯´æ˜å…¶ä»–è¡¨é‡Œé¢æœ‰æ›´è€çš„æ•°æ®ã€‚æœ‰ä¸€ä¸ªå·¥å…·<code>sstableexpiredblockers</code>å¯ä»¥è¿›è¡ŒæŸ¥è¯¢ã€‚è¿˜æœ‰ä¸€ä¸ªå‚æ•°å¯ä»¥ä½¿ç”¨<code>unsafe_aggressive_sstable_expiration</code>ï¼Œåœ¨ä½¿ç”¨æ—¶é—´å‹ç¼©ç­–ç•¥æ—¶å€™ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥ä¿è¯åˆ é™¤è¿™ç§è¡¨</li>
</ul>
</li>
</ul>
<h3 id="compactionçš„å‚æ•°å’Œå‘½ä»¤"><a class="header-anchor" href="#compactionçš„å‚æ•°å’Œå‘½ä»¤"></a>compactionçš„å‚æ•°å’Œå‘½ä»¤</h3>
<ul>
<li>åœ¨ä¸Šç¯‡é“¾æ¥ä¸­æœ‰ï¼Œåˆ—ä¸€éƒ¨åˆ†ï¼š
<ul>
<li><code>log_all</code>: å¯ä»¥è®°å½•å‹ç¼©çš„æ—¥å¿—</li>
<li><a href="http://cassandra.apache.org/doc/latest/operating/compaction.html" target="_blank" rel="noopener">ç»´æŠ¤æ“ä½œå’Œå‹ç¼©</a></li>
</ul>
</li>
<li>å‘½ä»¤åœ¨ä¸Šé¢çš„é“¾æ¥ä¸­ä¹Ÿæœ‰ï¼Œè¿™è¾¹ä¹Ÿåˆ—ä¸€éƒ¨åˆ†ï¼š
<ul>
<li><code>compactionstats</code>: çŠ¶æ€</li>
<li><code>compactionhistory</code>: å†å²</li>
</ul>
</li>
<li>å¦‚æœæ˜¯åœ¨ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç³»ç»Ÿä¸­æ”¹å˜è¡¨çš„å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨<code>ALTER TABLE</code>å‘½ä»¤æ¥è¿›è¡Œ</li>
</ul>
<h3 id="å…¶ä»–ä¸€äº›campactionç»†èŠ‚"><a class="header-anchor" href="#å…¶ä»–ä¸€äº›campactionç»†èŠ‚"></a>å…¶ä»–ä¸€äº›Campactionç»†èŠ‚</h3>
<ul>
<li>åœ¨<code>compaction</code>æœŸé—´ï¼Œ<code>cassandra</code>ä¼šåˆå¹¶<code>key</code>å’Œ<code>column</code>ï¼ŒåŒæ—¶ä¼šå°†è¿‡æœŸçš„å¢“ç¢‘åˆ é™¤ï¼Œè¿˜ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„<code>index</code>ï¼Ÿ <strong><em>è¿™ä¸ªindexæ˜¯ä»€ä¹ˆä¸œè¥¿å•Š</em></strong></li>
<li>åˆå¹¶ä¹‹åä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„<code>SSTable</code>ã€‚è€Œä¸éœ€è¦çš„æ•°æ®ç‰ˆæœ¬å’Œè¡Œå°±ä¼šç•™åœ¨æ—§çš„<code>SSTable</code>é‡Œé¢ï¼Œå½“æ­£åœ¨æ‰§è¡Œçš„è¯»æ“ä½œç»“æŸä¹‹åï¼Œå°±å¯ä»¥åˆ é™¤æ‰ã€‚</li>
<li><code>compaction</code>æœŸé—´çš„èµ„æºè€—ç”¨ä¼šä¸Šå‡ï¼Œä½†æ˜¯<code>compaction</code>ç»“æŸä¹‹ååº”è¯¥ä¼šé‡Šæ”¾ç©ºé—´ï¼Œå› ä¸ºå®ƒåˆå¹¶äº†<code>SSTable</code></li>
<li>æ—§çš„è¢«åˆå¹¶çš„<code>table</code>ä¼šè¢«åŠ ä¸Š<code>deletion</code>æ ‡ç­¾ï¼Œå¹¶ä¸”åœ¨æ•°æ®åº“é‡å¯æˆ–è€…åœ¨ä½¿ç”¨<code>reference counting mechanism</code>çš„æ—¶å€™ã€‚<strong><em>è¿™ä¸ª<code>reference counting mechanism</code>æ˜¯ä»€ä¹ˆå•Š</em></strong></li>
<li><code>compaction</code>çš„ç®—æ³•æ˜¯å¯ä»¥é…ç½®çš„ï¼Œé»˜è®¤çš„æ˜¯<code>size-tiered compaction</code>ã€‚è¿™ä¸ªç®—æ³•ä¼šåˆå¹¶å¤§å°ç›¸è¿‘çš„tableï¼Œç”Ÿæˆå¤§table</li>
</ul>
<h3 id="compactionå¯¹è¯»æ•°æ®çš„å½±å“"><a class="header-anchor" href="#compactionå¯¹è¯»æ•°æ®çš„å½±å“"></a>Compactionå¯¹è¯»æ•°æ®çš„å½±å“</h3>
<ul>
<li><code>compaction</code>æ˜¯<code>per-node</code>çš„ï¼Œæ‰€ä»¥æŸä¸ªæ•°æ®åœ¨<code>node1</code>ä¸Šé¢çš„æ—§ç‰ˆæœ¬å¯èƒ½åˆ é™¤äº†ã€‚ä½†æ˜¯åœ¨<code>node2</code>ä¸Šé¢è¿˜æœ‰ã€‚</li>
<li>è¿™æ ·è¯»çš„æ—¶å€™ä¼šè¿›è¡Œä¸€ä¸ªåˆå¹¶ï¼Œå¹¶ä¸”è¿”å›æœ€åä¸€ä¸ªå†™çš„<code>version</code>ã€‚è¿™ä¸ªåŸåˆ™æ˜¯<code>last-write-win</code></li>
<li>Cassandra can read data directly from the new SSTable even before it finishes writing, instead of waiting for the entire compaction process to finish.</li>
</ul>
<h3 id="compaction-ç­–ç•¥"><a class="header-anchor" href="#compaction-ç­–ç•¥"></a>Compaction ç­–ç•¥</h3>
<ul>
<li>ä¸åŒçš„ç­–ç•¥å†³å®šäº†å¦‚ä½•æ¥é€‰æ‹©<code>SSTable</code>ä»¥åŠå‹ç¼©åçš„è¡Œå¦‚ä½•æ’å…¥åˆ°æ–°çš„è¡¨æ ¼ä¸­</li>
<li>æˆ‘åœ¨å‹ç¼©ç­–ç•¥çš„é“è·¯ä¸Šè¶Šèµ°è¶Šè¿œäº†å•Šã€‚ğŸ˜‚</li>
</ul>
<h4 id="sizetieredcompactionstrategy-stcs"><a class="header-anchor" href="#sizetieredcompactionstrategy-stcs"></a>SizeTieredCompactionStrategy (STCS)</h4>
<h5 id="å·¥ä½œæµç¨‹"><a class="header-anchor" href="#å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h5>
<ul>
<li>å½“æœ‰4ä¸ªå¤§å°ç›¸è¿‘çš„<code>STable</code>çš„æ—¶å€™å°±å¼€å§‹åˆå¹¶ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯å®Œå…¨ç›¸åŒå¤§å°çš„</li>
<li>å°†è¿™äº›å¤§å°ç›¸è¿‘çš„<code>SSTable</code>åˆå¹¶æˆä¸€ä¸ªï¼Œå½“æœ‰4ä¸ªæ›´å¤§çš„<code>table</code>çš„æ—¶å€™ï¼Œå†åˆå¹¶æˆæ›´å¤§çš„<code>SSTable</code></li>
<li>æ‰€ä»¥ä¼šæœ‰å¾ˆå¤šå¤§å°ä¸åŒçš„<code>SSTable</code>åŒæ—¶å­˜åœ¨</li>
</ul>
<h4 id="å‚æ•°"><a class="header-anchor" href="#å‚æ•°"></a>å‚æ•°</h4>
<h5 id="ä¼˜ç¼ºç‚¹"><a class="header-anchor" href="#ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h5>
<ul>
<li>ä¼˜åŠ¿ï¼šå†™å¯†é›†çš„å·¥ä½œè‰¯å¥½ã€‚</li>
<li>é€†åŠ¿ï¼š
<ul>
<li>å¯èƒ½é™ä½è¯»çš„æ•ˆç‡ã€‚å› ä¸ºç­–ç•¥ä¸ä¿è¯åŒä¸€è¡Œçš„æ•°æ®è¢«é™åˆ¶åœ¨æœ‰é™çš„æ•°æ®æ–‡ä»¶é‡Œé¢ï¼Œè¿™æ ·åœ¨è¯»å–çš„æ—¶å€™ä¼šéœ€è¦è¯»å–æ›´å¤šçš„æ•°æ®æ–‡ä»¶ã€‚</li>
<li>å¯èƒ½é•¿æœŸä¿æŒæ—§æ•°æ®ï¼›ä¸åŒç‰ˆæœ¬çš„åŒä¸€è¡Œä¼šå¯èƒ½åˆ†å¸ƒåœ¨ä¸åŒçš„<code>SSTable</code>é‡Œé¢ã€‚å¹¶ä¸”ä¸åˆ©äºåˆ é™¤æ—§æ•°æ®</li>
<li>éœ€è¦çš„å†…å­˜å’Œç£ç›˜éƒ½ä¼šéšç€æ—¶é—´å¢åŠ ã€‚ç£ç›˜åœ¨ä¸‹é¢çš„é—®é¢˜ç« èŠ‚ä¸­å¯ä»¥çœ‹åˆ°ï¼›è€Œå†…å­˜ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå½“<code>SSTable</code>çš„å¤§å°è¾¾åˆ°ä¸€å®šçº§åˆ«ï¼Œä¸€æ¬¡å‹ç¼©éœ€è¦çš„å†…å­˜ä¼šå¾ˆå¤§ã€‚å› ä¸ºéœ€è¦<code>load SSTable</code>åˆ°å†…å­˜é‡Œé¢</li>
</ul>
</li>
</ul>
<h5 id="é—®é¢˜"><a class="header-anchor" href="#é—®é¢˜"></a>é—®é¢˜</h5>
<ul>
<li>
<p>åœ¨å®é™…çš„å·¥ä½œä¸­ç¢°åˆ°äº†ç¼ºç‚¹ä¸­çš„é—®é¢˜ï¼Œç³»ç»Ÿåœ¨å·¥ä½œ3ä¸ªæœˆçš„æ—¶å€™èƒ½å¤Ÿåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šé¢å ç”¨é 13Gçš„ç£ç›˜é‡ã€‚</p>
</li>
<li>
<p>è§‚å¯Ÿä¸‹æ¥ï¼Œå…¶å®ç­–ç•¥æ˜¯åœ¨æ­£å¸¸å·¥ä½œçš„ã€‚é‡Œé¢æ˜æ˜¾èƒ½å¤Ÿçœ‹åˆ°å¤§å°ä¸åŒçš„dataæ–‡ä»¶ã€‚</p>
</li>
<li>
<p>ç°åœ¨å®¢æˆ·çš„éœ€æ±‚æ˜¯ä¸æ‰‹åŠ¨æ“ä½œæ¥è§£å†³å ç”¨ç£ç›˜çš„é—®é¢˜ã€‚æ€»çš„æ¥è¯´ï¼Œè²Œä¼¼ä¸ç°å®ï¼Œæ¯•ç«Ÿå¤šæ•°å»ºè®®æ˜¯å…³é—­è‡ªåŠ¨SSTableå‹ç¼©ï¼Œæ”¹ç”¨æ‰‹åŠ¨åœ¨ç©ºé—²æœŸé—´è¿›è¡Œå‹ç¼©</p>
<pre><code>total 13G
 115M Jan 24  2019 la-2421-big-Data.db
 101M Jan 24  2019 la-2443-big-Data.db
 453K Jan 24  2019 la-2447-big-Data.db
 124M Feb  3 14:47 lb-5276-big-Data.db
 216M Feb  3 14:54 lb-5280-big-Data.db
 235M Feb  3 14:54 lb-5281-big-Data.db
 680M Feb  4 11:24 lb-5294-big-Data.db
 781M Feb  4 11:36 lb-5295-big-Data.db
 2.8G Feb  4 11:54 lb-5296-big-Data.db
 3.3G Feb  4 12:52 lb-5298-big-Data.db
 3.5G Feb  4 12:54 lb-5297-big-Data.db
</code></pre>
</li>
</ul>
<h4 id="leveledcompactionstrategy-lcs"><a class="header-anchor" href="#leveledcompactionstrategy-lcs"></a>LeveledCompactionStrategy (LCS)</h4>
<h5 id="å·¥ä½œæµç¨‹-v2"><a class="header-anchor" href="#å·¥ä½œæµç¨‹-v2"></a>å·¥ä½œæµç¨‹</h5>
<ul>
<li>
<p>LCSçš„å·¥ä½œæµç¨‹æ˜¯æœ€ä¸æ¸…æ™°çš„äº†ã€‚ç½‘ä¸Šå„ç±»æ–‡ç« ï¼Œæœ‰è¯´L1çš„æ•°æ®æ–‡ä»¶æ•°é‡æ˜¯L0çš„10å€çš„ï¼Œæœ‰è¯´æ•´ä½“å¤§å°çš„ã€‚æˆ‘ä¸€å£è¡€éƒ½è¦å–·æ˜¾ç¤ºå™¨ä¸Šé¢äº†,ä¸å¸¦è¿™ä¹ˆä¸ä¸¥è°¨çš„å¥½å˜› ğŸ˜¦</p>
</li>
<li>
<p>çœ‹ä»£ç å…¶å®æœ€æ¸…æ¥šäº†ã€‚åº”è¯¥æ˜¯å¤§å°ï¼Œä¸æ˜¯æ•°é‡ï¼š</p>
</li>
<li>
<p>ä»¥ä¸‹ä»£ç é‡Œé¢ï¼ŒmaxSSTableSizeInBytes= 160M * 1024<em>1024ï¼Œæ‰€ä»¥L0æœ€å¤§æ˜¯160M</em>4</p>
</li>
<li>
<p>ä»£ç åœ¨<code>org.apache.cassandra.db.compaction.LeveledCompactionStrategy</code></p>
<pre><code>public static long maxBytesForLevel(int level, int levelFanoutSize, long maxSSTableSizeInBytes) {
  if (level == 0) {
      return 4L * maxSSTableSizeInBytes;
  } else {
      double bytes = Math.pow((double)levelFanoutSize, (double)level) * (double)maxSSTableSizeInBytes; 
  }
}
</code></pre>
</li>
<li>
<p><code>LCS</code>ä¸€å¤§ç‰¹ç‚¹æ˜¯ä¼šå°½é‡ä¿è¯åœ¨åŒä¸€ä¸ªå±‚çº§é‡Œé¢ï¼ŒåŒä¸€<code>partition key</code>çš„æ•°æ®åœ¨åŒä¸€å¼ <code>SSTable</code>è¡¨é‡Œé¢ã€‚å½“ç„¶<code>L0</code>æ²¡æ³•ä¿è¯ï¼Œå› ä¸ºè¿™ä¸€å±‚çº§æ˜¯<code>flush</code>æ¥çš„</p>
</li>
<li>
<p>ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œ<code>LCS</code>åœ¨è¿›è¡Œä¸€æ¬¡å‹ç¼©çš„æ—¶å€™ä¼šåŒ…æ‹¬ä¸Šä¸€çº§ä¸­ä¹Ÿæœ‰è¿™ä¸ª<code>partition key</code>çš„æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸ªç­–ç•¥è¦è¯»è¡¨å•Šã€‚æ¯”å¦‚åœ¨<code>L1</code>çº§æ•°æ®å¤§äºä¸Šé™éœ€è¦å‹ç¼©çš„æ—¶å€™ï¼Œ<code>L2</code>çº§ä¸­åŒ…å«ç›¸åŒ<code>key</code>çš„è¡¨ä¹Ÿè¦è¢«ä¸€èµ·åˆå¹¶ï¼Œä½†æ˜¯æ¬£æ…°çš„æ˜¯ï¼Œåº”è¯¥ä¹Ÿåªæœ‰ä¸€å¼ è¡¨ã€‚æ¯•ç«Ÿæ¯ä¸€çº§éƒ½æ˜¯è¿™ä¹ˆå¹²çš„ã€‚-</p>
</li>
<li>
<p>æˆ‘ä»¬åœ¨<code>Cassandra</code>ä¸­å¯ä»¥è®¾å®šè¿›è¡Œå¹¶è¡Œçš„å‹ç¼©ï¼Œé‚£ä¹ˆåœ¨<code>LCS</code>ç­–ç•¥ä¸­éœ€è¦ä¿è¯åŒä¸€ä¸ª<code>parititon key</code>çš„æ•°æ®åªåœ¨ä¸€ä¸ªå‹ç¼©çº¿ç¨‹ä¸­ï¼Œä¸èƒ½æœ‰äº¤å‰é‡å </p>
</li>
<li>
<p>æ‰€ä»¥ï¼Œå‹ç¼©<code>L0</code>å±‚çº§çš„æ—¶å€™ï¼Œä¼šå¸¦ä¸Šæ‰€æœ‰<code>L1</code>çš„è¡¨ä¸€èµ·å‹ç¼©ã€‚å¦‚æœ<code>L0</code>å¾ˆå¤šï¼Œé‚£ä¹ˆæ²¡æ³•ä¸€æ¬¡å‹ç¼©åšå®Œæ‰€æœ‰<code>L0</code>çš„è¡¨æ ¼</p>
</li>
<li>
<p>å‹ç¼©æ—¶å€™ä¼˜å…ˆè€ƒè™‘æœ€é«˜çº§åˆ«çš„ã€‚æ‰€æœ‰<code>L0</code>æ˜¯æœ€åè€ƒè™‘çš„ä¸€ä¸ªå±‚çº§</p>
</li>
<li>
<p><code>LCS</code>æœ‰å¯èƒ½è§¦å‘<code>major compaction</code>ï¼Œè¿™ç‚¹éœ€è¦è¿›ä¸€æ­¥è€ƒå¯Ÿã€‚</p>
</li>
<li>
<p>å¦‚æœ<code>L0</code>çº§åˆ«çš„è¡¨è¶…è¿‡32ä¸ªï¼Œä¼šè¿›è¡Œ<code>STCS</code></p>
</li>
</ul>
<h5 id="ç›¸å…³å‚æ•°"><a class="header-anchor" href="#ç›¸å…³å‚æ•°"></a>ç›¸å…³å‚æ•°</h5>
<ul>
<li><code>sstable_size_in_mb</code>: å°±æ˜¯ä¸Šé¢ä»£ç é‡Œé¢é‚£ä¸ª<code>maxSSTableSizeInBytes</code>ï¼Œç¬¬ä¸€å±‚çº§çš„å¤§å°</li>
<li><code>fanout_size</code>ï¼š å„ä¸ªå±‚çº§ä¹‹é—´çš„å·®å¼‚ï¼Œä¸Šé¢ä»£ç é‡Œé¢çš„<code>levelFanoutSize</code></li>
</ul>
<h5 id="ä¼˜ç¼ºç‚¹-v2"><a class="header-anchor" href="#ä¼˜ç¼ºç‚¹-v2"></a>ä¼˜ç¼ºç‚¹</h5>
<ul>
<li>ä¼˜ç‚¹ï¼š
<ul>
<li>è¯»æ¯”è¾ƒé¢‘ç¹çš„æ›´æ¨èè¿™ä¸ªç®—æ³•ã€‚å…¶å®å†™çš„åº”è¯¥ä¹Ÿå¯ä»¥ã€‚ç›®å‰è¿™åº”è¯¥æ˜¯åº”ç”¨æœ€å¹¿æ³›çš„å‹ç¼©ç®—æ³•äº†ã€‚</li>
<li>å®¹æ˜“é¢„æµ‹å†…å­˜éœ€æ±‚å¤§å°</li>
<li>æ›´å®¹æ˜“åˆ é™¤æ—§æ•°æ®</li>
<li>éœ€è¦çš„ç£ç›˜ç©ºé—´æ›´å°</li>
</ul>
</li>
<li>ç¼ºç‚¹ï¼š
<ul>
<li>è¿›è¡Œå¾—æ›´ä¸ºé¢‘ç¹ï¼Œæ‰€ä»¥éœ€è¦çš„I/Oæ¯”è¾ƒå¤š</li>
</ul>
</li>
</ul>
<h4 id="timewindowcompactionstrategy-twcs"><a class="header-anchor" href="#timewindowcompactionstrategy-twcs"></a>TimeWindowCompactionStrategy (TWCS)</h4>
<ul>
<li>æ¥ä¸Šæ–‡ç¢°åˆ°çš„é—®é¢˜ï¼Œåˆšåˆšå¥½å‡ºé—®é¢˜çš„è¡¨çš„<code>partition key</code>æ˜¯æ—¥æœŸï¼Œæ‰€ä»¥ç ”ç©¶å¾—æœ€å¤šçš„å°±æ˜¯è¿™ä¸ªç­–ç•¥äº†ã€‚è€Œæ—¶é—´ç­–ç•¥æ˜¯å”¯ä¸€ä¸€ä¸ªå¯ä»¥å½»åº•åˆ é™¤è¿‡æœŸçš„è¡¨çš„ç­–ç•¥ã€‚å½“ç„¶ï¼Œè¦ç»“åˆä¸‹é¢çš„<code>TTL</code>ä¸€èµ·ç”¨ã€‚</li>
<li>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼š<code>TCWS</code>æ˜¯ä»<code>Cassandra 3.0.8</code>æ‰è¢«å¼•å…¥çš„ã€‚è€Œæˆ‘ä»¬äº§å“ä»æ—§åœç•™åœ¨<code>2.2.8</code>ä¸Šï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæœ€åæ²¡æ³•é‡‡ç”¨è¿™ä¸ªè§£å†³æ–¹æ¡ˆ</li>
</ul>
<h5 id="å·¥ä½œåŸç†"><a class="header-anchor" href="#å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h5>
<ul>
<li>è¿™ä¸ªç®—æ³•æŒºæœ‰æ„æ€çš„ï¼Œè€Œä¸”ç®€å•å¥½æ‡‚ã€‚å°±æ˜¯è¯´åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œæ¯”å¦‚ä¸€ä¸ªå°æ—¶å†…ï¼Œä½¿ç”¨<code>STCS</code>ç®—æ³•ï¼Œç„¶ååœ¨æ—¶é—´ç‚¹ä¸Šï¼Œä¸€ä¸ªå°æ—¶ç»“æŸçš„æ—¶å€™ï¼ŒæŠŠè¿™ä¸ªå°æ—¶å†…çš„éƒ½å‹æˆä¸€ä¸ªå¤§çš„æ•°æ®æ–‡ä»¶ã€‚</li>
<li>ç¬¬äºŒä¸ªå°æ—¶å¼€å§‹çš„æ—¶å€™ï¼Œé‡æ–°ç®—èµ·ï¼Œä¸Šä¸€ä¸ªå°æ—¶å‹å‡ºæ¥çš„å¤§è¡¨å°±æ”¾é‚£é‡Œä¸åŠ¨äº†ã€‚</li>
</ul>
<h5 id="ç›¸å…³å‚æ•°-v2"><a class="header-anchor" href="#ç›¸å…³å‚æ•°-v2"></a>ç›¸å…³å‚æ•°</h5>
<ul>
<li><code>compaction_window_unit</code>:MINUTES, HOURS, or DAYS</li>
<li><code>compaction_window_size</code>:é»˜è®¤ä¸º1</li>
<li><code>unsafe_aggressive_sstable_expiration</code>: è¿™ä¸ªå‚æ•°å¾ˆæœ‰æ„æ€ï¼Œå°±æ˜¯è¯´å½“ä¸€ä¸ªè¡¨é‡Œé¢éƒ½æ˜¯å¢“ç¢‘çš„æ—¶å€™ï¼Œç›´æ¥æŠŠè¡¨åˆ é™¤æ‰ã€‚è¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå…¨å±€å‚æ•°ï¼Œæ˜¯åœ¨å¯åŠ¨<code>JVM</code>çš„æ—¶å€™è®¾ç½®çš„ã€‚å› ä¸ºæ˜¯æœ‰é£é™©çš„ï¼Œæœ‰å¯èƒ½é€ æˆå¹½çµæ•°æ®ã€‚åŒæ—¶ï¼Œè®¾ç½®è¿™ä¸ªå‚æ•°ä¼šè¦†ç›–æ‰<code>unchecked_tombstone_compaction</code>.</li>
</ul>
<h5 id="å‚è€ƒé“¾æ¥-v2"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥-v2"></a>å‚è€ƒé“¾æ¥</h5>
<ul>
<li><a href="https://thelastpickle.com/blog/2016/12/08/TWCS-part1.html" target="_blank" rel="noopener">TWCS-part1</a></li>
<li><a href="https://thelastpickle.com/blog/2017/01/10/twcs-part2.html" target="_blank" rel="noopener">TWCS-part2</a></li>
</ul>
<h3 id="ttl"><a class="header-anchor" href="#ttl"></a>TTL</h3>
<h4 id="ttlè¢«æå‡ºçš„èƒŒæ™¯"><a class="header-anchor" href="#ttlè¢«æå‡ºçš„èƒŒæ™¯"></a>TTLè¢«æå‡ºçš„èƒŒæ™¯</h4>
<ul>
<li>è¿™æ˜¯åœ¨å¤„ç†äº§å“çš„ä¸€ä¸ªé—®é¢˜çš„æ—¶å€™è¢«æå‡ºçš„ï¼Œè¯¥é—®é¢˜å°±æ˜¯ï¼Œç”±äºæŸä¸ªç»Ÿè®¡åŠŸèƒ½ä¸€ç›´åœ¨å†™æ•°æ®ï¼Œç„¶åæ¯éš”ä¸€ä¸ªæœˆå·¦å³ä¼šåˆ é™¤æ•°æ®ã€‚</li>
<li>è¡¨æ ¼ä»¥<code>date</code>ä½œä¸º<code>partition key</code>ï¼Œæ‰€æœ‰æ•°æ®åœ¨ä¸€ä¸ªè¡¨é‡Œé¢ï¼Œæ‰€ä»¥å³ä½¿æ•°æ®è¢«åˆ é™¤äº†ä¹Ÿæ²¡æ³•ç›´æ¥<code>truncate</code>è¡¨ï¼Œåªèƒ½ä¾èµ–<code>Cassandra</code>çš„<code>compaction</code>ã€‚</li>
<li>æœ€åè¶Šæ¥è¶Šå ç£ç›˜ã€‚ä½¿ç”¨çš„ç­–ç•¥æ˜¯é»˜è®¤çš„<code>STCS</code>ã€‚ç„¶åå°±æœ‰å¤§ä½¬æäº†<code>TTL</code></li>
<li>æˆ‘åŸæœ¬åœ¨è€ƒè™‘åŠ <code>crontab job</code>ï¼Œä½†æ˜¯å…¶å®æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸º<code>Cassandra</code>æä¾›çš„å…¶å®å°±æ˜¯ç±»ä¼¼åŠŸèƒ½ã€‚</li>
</ul>
<h4 id="ä»€ä¹ˆæ˜¯ttl-time-to-live"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯ttl-time-to-live"></a>ä»€ä¹ˆæ˜¯TTL(time-to-live)</h4>
<ul>
<li><em>TTL: allows to specify an optional Time To Live (in seconds) for the inserted values. If set, the inserted values are automatically removed from the database after the specified time. Note that the TTL concerns the inserted values, not the column themselves. This means that any subsequent update of the column will also reset the TTL (to whatever TTL is specified in that update). By default, values never expire. A TTL of 0 or a negative one is equivalent to no TTL.</em></li>
<li>å…¶å®<code>Cassandra</code>é‡Œé¢<code>TTL</code>çš„æ¦‚å¿µåˆ°å¤„éƒ½æ˜¯ã€‚ä½†æ˜¯é€šå¸¸è¯´çš„<code>TTL</code>æ˜¯æŒ‡å‚æ•°<code>default_time_to_live</code>ï¼Œä¹Ÿå°±æ˜¯è¯´åˆ°äº†è¿™ä¸ªæ—¶é—´ç‚¹ï¼Œ<code>Cassandra</code>ä¼šè‡ªåŠ¨å°†æ•°æ®åˆ é™¤æ‰ã€‚</li>
<li>é»˜è®¤å€¼ä¸º0ï¼Œä¹Ÿå°±æ˜¯<code>Cassandra</code>ä¼šè®¤ä¸ºè¿™ä¸ªæ•°æ®ä¸€ç›´æœ‰æ•ˆ</li>
<li>è¿™ä¸ªå‚æ•°åœ¨<code>desc tables</code>é‡Œé¢å¯ä»¥çœ‹åˆ°ï¼Œä½†æ˜¯æˆ‘ä»¬äº§å“çš„å¼‚æ­¥æ¨¡å—é‡Œé¢å…¶å®åœ¨ä»£ç é‡Œé¢è¿›è¡Œäº†è¦†ç›–ã€‚<code>java</code>ä»£ç é‡Œé¢å¼„äº†ä¸ªç³»ç»Ÿå‚æ•°ï¼Œåœ¨æ’å…¥æ•°æ®çš„æ—¶å€™ä»£å…¥äº†è¿™ä¸ªå‚æ•°</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/06/17/%E8%BD%AF%E4%BB%B6%E8%A1%A1%E9%87%8F%E6%A0%87%E5%87%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/06/17/%E8%BD%AF%E4%BB%B6%E8%A1%A1%E9%87%8F%E6%A0%87%E5%87%86/" class="post-title-link" itemprop="url">è½¯ä»¶è¡¡é‡æ ‡å‡†</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-06-17 17:20:49" itemprop="dateCreated datePublished" datetime="2019-06-17T17:20:49+08:00">2019-06-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-08-16 10:08:22" itemprop="dateModified" datetime="2019-08-16T10:08:22+08:00">2019-08-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/Other/" itemprop="url" rel="index"><span itemprop="name">Other</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/06/17/%E8%BD%AF%E4%BB%B6%E8%A1%A1%E9%87%8F%E6%A0%87%E5%87%86/" class="post-meta-item leancloud_visitors" data-flag-title="è½¯ä»¶è¡¡é‡æ ‡å‡†" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/06/17/%E8%BD%AF%E4%BB%B6%E8%A1%A1%E9%87%8F%E6%A0%87%E5%87%86/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/06/17/%E8%BD%AF%E4%BB%B6%E8%A1%A1%E9%87%8F%E6%A0%87%E5%87%86/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>å·¥ä½œä¸­æ¥è§¦åˆ°ä¸€äº›è½¯ä»¶è¡¡é‡æ ‡å‡†çš„éœ€æ±‚ï¼Œå¿…é¡»å¯¹è¿™äº›æ¦‚å¿µæœ‰æ‰€äº†è§£å’Œç†è§£ã€‚æ‰€ä»¥è§£é‡Šå¦‚ä¸‹äº†ã€‚</p>
<h3 id="scalability"><a class="header-anchor" href="#scalability"></a>Scalability</h3>
<ul>
<li>
<blockquote>
<p>Scalability is the property of a system to handle a growing amount of work by adding resources to the system ç»´åŸºç™¾ç§‘é‡Œé¢çš„è¿™ä¸ªè§£é‡Šå®åœ¨å¾ˆåˆ°ä½å•Šã€‚é€šè¿‡åŠ èµ„æºæ¥è·å¾—æ›´å¤§çš„èƒ½åŠ›</p>
</blockquote>
</li>
<li>ä»¥ä¸‹å†…å®¹åŸºæœ¬æ˜¯ç»´åŸºç™¾ç§‘çš„ç¿»è¯‘ï¼š
<ul>
<li>ç”¨æˆ·å¯æ‰©å±•æ€§ï¼š èƒ½å¤ŸåŒæ—¶æ”¯æŒå¤šå°‘ç”¨æˆ·</li>
<li>åŠŸèƒ½å¯æ‰©å±•æ€§ï¼š èƒ½ä¸èƒ½æ‰©å±•åŠŸèƒ½ï¼Œè€Œä¸ä¼šå½±å“ç°æœ‰åŠŸèƒ½</li>
<li>åœ°ç†ä¸Šçš„å¯æ‰©å±•æ€§ï¼š å°±æ˜¯ç›´æ¥çš„å­—é¢å«ä¹‰ï¼Œç±»ä¼¼éƒ¨ç½²æ—¶å€™çš„æœºå™¨æ˜¯ä¸æ˜¯å¿…é¡»localåœ¨ä¸€èµ·ã€‚</li>
<li>è´Ÿè½½å¯æ‰©å±•æ€§ï¼š è¿™å°±æ˜¯æˆ‘ä»¬é€šå¸¸æ„ä¹‰ä¸Šé¢çŸ¥é“çš„ï¼ŒåŠ nodeæˆ–è€…åŠ cpuï¼ŒåŠ å†…å­˜ï¼Œèƒ½ä¸èƒ½å¤ŸåŠ å¯å¤„ç†çš„èƒ½åŠ›</li>
<li>ä»£æ‰©å±•æ€§ï¼š è¿™ä¸ªæœ‰ç‚¹éš¾ä»¥ç†è§£ï¼Œæˆ‘ç†è§£æˆèƒ½ä¸èƒ½æ”¯æŒä¸åŒç‰ˆæœ¬ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘åŒæ—¶å®‰è£…java8å’Œjava7ï¼Œé‚£ä¹ˆæˆ‘å¯ä»¥åœ¨mavené‡Œé¢æŒ‡å®šç”Ÿæˆçš„ä»£ç ä¹‹ç±»çš„</li>
<li>ç§ç±»çš„å¯æ‰©å±•æ€§ï¼š è¿™ä¸ªå¯ä»¥ç†è§£çš„ï¼Œå°±æ˜¯æ˜¯ä¸æ˜¯æ”¯æŒmulti-verdorã€‚å°±åƒjavaï¼Œå¯ä»¥åœ¨windowsä¸Šé¢ï¼Œä¹Ÿå¯ä»¥åœ¨linuxä¸Šé¢</li>
</ul>
</li>
<li>Scaling horizontallyï¼š å°±æ˜¯å¢å‡node</li>
<li>Scaling verticallyï¼š å¢å‡resourceï¼Œå¢å‡cpuæˆ–è€…å†…å­˜</li>
<li>æ€»çš„æ¥è¯´ï¼Œè¿˜æ˜¯æŒºå¤æ‚çš„ã€‚</li>
<li>å‚è€ƒé“¾æ¥ï¼š
<ul>
<li><a href="https://en.wikipedia.org/wiki/Scalability" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a></li>
</ul>
</li>
</ul>
<h3 id="testability"><a class="header-anchor" href="#testability"></a>Testability</h3>
<p>testabilityè·Ÿæˆ‘æƒ³è±¡çš„ç¨æœ‰ä¸åŒï¼Œå°±æ˜¯è¯´è¿™ä¸ªæ¨¡å—æˆ–è€…è½¯ä»¶çš„å¯æµ‹è¯•æ€§ã€‚å®åœ¨æœ‰ç‚¹å¤æ‚å•Š</p>
<ul>
<li>æ€»çš„æ¥è¯´ï¼Œæ„Ÿè§‰å®åœ¨æ˜¯å¤ªæŠ½è±¡äº†ã€‚ <strong><em>æ²¡çœ‹æ‡‚</em></strong>
<ul>
<li>Class I: there exists a finite complete test suite.</li>
<li>Class II: any partial distinguishing rate (i.e. any incomplete capability to distinguish correct systems from incorrect systems) can be reached with a finite test suite.</li>
<li>Class III: there exists a countable complete test suite.</li>
<li>Class IV: there exists a complete test suite.</li>
<li>Class V: all cases.</li>
</ul>
</li>
<li>å‚è€ƒé“¾æ¥ï¼š<br>
+<a href="https://en.wikipedia.org/wiki/Software_testability" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a></li>
</ul>
<h3 id="robustness-computer-science"><a class="header-anchor" href="#robustness-computer-science"></a>Robustness (computer science)</h3>
<ul>
<li>robustness is the ability of a computer system to cope with errors during execution and cope with erroneous inputã€‚è·Ÿæƒ³è±¡çš„ä¸ä¸€æ ·å•Šï¼Œæ›´å¤šfocusçš„æ˜¯handle errorçš„èƒ½åŠ›</li>
<li>å‚è€ƒé“¾æ¥ï¼š
<ul>
<li>[ç»´åŸºç™¾ç§‘](<a href="https://en.wikipedia.org/wiki/Robustness_(computer_science)" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Robustness_(computer_science)</a></li>
</ul>
</li>
</ul>
<h3 id="computer-security"><a class="header-anchor" href="#computer-security"></a>Computer Security</h3>
<ul>
<li>the protection of computer systems from theft or damage to their hardware, software or electronic data, as well as from disruption or misdirection of the services they provide.</li>
<li>å‚è€ƒé“¾æ¥
<ul>
<li><a href="https://en.wikipedia.org/wiki/Computer_security" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/06/17/Java%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B-%E4%B8%80%E4%BA%9B%E7%89%B9%E5%88%AB%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/06/17/Java%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B-%E4%B8%80%E4%BA%9B%E7%89%B9%E5%88%AB%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="post-title-link" itemprop="url">Javaæ•°æ®ç±»å‹ --- å¸¸ç”¨æ•°æ®ç±»å‹</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-06-17 13:14:34" itemprop="dateCreated datePublished" datetime="2019-06-17T13:14:34+08:00">2019-06-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-07-12 14:58:08" itemprop="dateModified" datetime="2021-07-12T14:58:08+08:00">2021-07-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/06/17/Java%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B-%E4%B8%80%E4%BA%9B%E7%89%B9%E5%88%AB%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="post-meta-item leancloud_visitors" data-flag-title="Javaæ•°æ®ç±»å‹ --- å¸¸ç”¨æ•°æ®ç±»å‹" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/06/17/Java%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B-%E4%B8%80%E4%BA%9B%E7%89%B9%E5%88%AB%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/06/17/Java%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B-%E4%B8%80%E4%BA%9B%E7%89%B9%E5%88%AB%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>ä¸€äº›ç‰¹åˆ«çš„æ•°æ®ç±»å‹<br>
author: Lynn Shen<br>
categories: Java<br>
date: 2019-06-17 13:14:34<br>
tags:</p>
<hr>
<h3 id="java-util-function-supplier"><a class="header-anchor" href="#java-util-function-supplier"></a>java.Util.Function.Supplier</h3>
<ul>
<li>è¿™ä¸ªæ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼ŒGetæ–¹æ³•ã€‚voidï¼Œè¿”å›ä¸€ä¸ªT</li>
<li>æŠŠå®ƒå½“å·¥å‚æ–¹æ³•çœ‹å°±æ˜¯äº†ã€‚</li>
<li>é¡¾åæ€ä¹‰ï¼Œæä¾›è€…ã€‚</li>
<li><a href="https://blog.csdn.net/qq_28410283/article/details/80625482" target="_blank" rel="noopener">JAVA8 Supplieræ¥å£</a></li>
<li>æ„Ÿè§‰å°±æ˜¯ä¸€æ¬¡æ€§ç”Ÿæˆã€‚åŒä¸€ä¸ªæ¥å£ï¼Œåœ¨åˆå§‹åŒ–æ—¶å€™ç»™å‡ºgetå‡½æ•°ï¼Œå¯ä»¥æœ‰ä¸åŒå®ç°</li>
<li>supplierä½œä¸ºfunction interfaceï¼Œæœ‰@FunctionalInterface annotationã€‚æ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨lamdaæ¥ä½œä¸ºå®ç°ã€‚æ¯”å¦‚ï¼š<code>()-&gt;getString()</code>å¯ä»¥ä½œä¸º<code>Supplier&lt;String&gt;</code>çš„å®ç°</li>
</ul>
<h3 id="javaå…³é”®å­—native"><a class="header-anchor" href="#javaå…³é”®å­—native"></a>javaå…³é”®å­—native</h3>
<p>æˆ‘è¦çœ‹nativeçš„å‡½æ•°ã€‚æ‰¾ä¸åˆ°ï¼ŒOMGã€‚å…¶å®ä¹‹å‰çœ‹åˆ°è¿‡nativeçš„ç”¨æ³•ï¼ŒçŸ¥é“è¿™ä¸ªç©æ„ï¼Œä½†æ˜¯è¿˜æ˜¯å†™åœ¨è¿™é‡Œå§ã€‚<br>
æ„Ÿè§‰ä¸€ç‰‡å‚è€ƒé“¾æ¥å°±èƒ½è§£é‡Šæ¸…æ¥šå•¦ã€‚</p>
<ul>
<li>å…¶å®å°±æ˜¯javaå§ï¼Œä¸åƒcå’Œc++å–„äºå¤„ç†åº•å±‚çš„ä¸œè¥¿ã€‚æ‰€ä»¥å°±ä¼šè°ƒç”¨ä¸€äº›ä¸æ˜¯javaå†™çš„å‡½æ•°ã€‚è¿™äº›å‡½æ•°å°±ç”¨nativeå…³é”®å­—æ¥ä¿®é¥°</li>
<li>nativeæ˜¯é€šè¿‡JNIï¼ˆJava Native Interfaceï¼‰æ¥å£æ¥è°ƒç”¨è¿™äº›å‡½æ•°çš„</li>
<li>å‚è€ƒé“¾æ¥
<ul>
<li><a href="https://www.cnblogs.com/b3051/p/7484501.html" target="_blank" rel="noopener">javaä¸­nativeçš„ç”¨æ³•</a></li>
</ul>
</li>
</ul>
<h3 id="ç”Ÿæˆrandomçš„æ–¹æ³•"><a class="header-anchor" href="#ç”Ÿæˆrandomçš„æ–¹æ³•"></a>ç”ŸæˆRandomçš„æ–¹æ³•</h3>
<p>æœ‰å¥½å‡ ä¸ªç›¸å…³çš„ç±»å‹ï¼Œå†™åœ¨è¿™é‡Œã€‚æ˜¯åœ¨å·¥ä½œä¸­éœ€è¦ç”Ÿæˆéšæœº<code>port</code>ç¢°åˆ°çš„</p>
<ul>
<li>å‚è€ƒé“¾æ¥
<ul>
<li><a href="https://www.jianshu.com/p/2f6acd169202#" target="_blank" rel="noopener">Java éšæœºæ•° Random VS SecureRandom</a></li>
<li><a href="https://www.bbsmax.com/A/kjdwxba6zN/" target="_blank" rel="noopener">Javaä¸­çš„éšæœºæ•°ç”Ÿæˆå™¨ï¼šRandomï¼ŒThreadLocalRandomï¼ŒSecureRandom</a></li>
<li><a href="http://ju.outofmemory.cn/entry/286621" target="_blank" rel="noopener">Javaä¸­ç”Ÿæˆéšæœºæ•°Randomã€ThreadLocalRandomã€SecureRandom</a></li>
<li><a href="https://blog.csdn.net/weixin_33738555/article/details/93434637" target="_blank" rel="noopener">SecureRandomçš„æ­£ç¡®ä½¿ç”¨</a></li>
<li><a href="https://blog.csdn.net/weixin_35703883/article/details/81138425" target="_blank" rel="noopener">SecureRandomç”Ÿæˆéšæœºæ•°</a></li>
<li><a href="https://www.cnblogs.com/deng-cc/p/8064481.html" target="_blank" rel="noopener">SecureRandom</a></li>
</ul>
</li>
</ul>
<h4 id="math-random"><a class="header-anchor" href="#math-random"></a>Math.random</h4>
<ul>
<li>äº§ç”Ÿçš„éšæœºæ•°æ˜¯0 - 1 ä¹‹é—´çš„ä¸€ä¸ª doubleï¼Œå³0 &lt;= random &lt; 1ã€‚</li>
<li>ç¬¬ä¸€æ¬¡è°ƒç”¨<code>Math.random()</code>æ–¹æ³•æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ªä¼ªéšæœºæ•°ç”Ÿæˆå™¨ï¼Œå®é™…ä¸Šç”¨çš„æ˜¯ <code>new java.util.Random()</code>ã€‚</li>
<li><code>Math.random()</code>æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>
</ul>
<h4 id="java-util-random"><a class="header-anchor" href="#java-util-random"></a>java.util.Random</h4>
<ul>
<li><code>Random</code>ç±»ä¸­å®ç°çš„éšæœºç®—æ³•æ˜¯ä¼ªéšæœºï¼Œä¹Ÿå°±æ˜¯æœ‰è§„åˆ™çš„éšæœº</li>
<li>ç§å­ä¸€æ ·çš„æƒ…å†µä¸‹ï¼Œä¸¤ä¸ª<code>Random</code>ç±»äº§ç”Ÿçš„æ˜¯ä¸€æ¨¡ä¸€æ ·çš„æ•°åˆ—</li>
<li>æ‰€ä»¥åœ¨å®‰å…¨æ€§è¦æ±‚æ¯”è¾ƒé«˜ï¼Œæˆ–è€…ä½¿ç”¨æ¯”è¾ƒé¢‘ç¹æ—¶ï¼Œä¸é€‚åˆä½¿ç”¨<code>Random</code>ï¼Œå› ä¸ºå€¼æ˜¯å¯é¢„æµ‹çš„</li>
<li>ç„¶åç”Ÿæˆçš„éšæœºæ•°æ˜¯å·¦è¾¹é—­ç¯ï¼Œå³è¾¹å¼€çš„ã€‚</li>
</ul>
<h4 id="java-security-securerandom"><a class="header-anchor" href="#java-security-securerandom"></a>java.security.SecureRandom</h4>
<ul>
<li><code>SecureRandom</code> å…¶å®å’Œ<code>Random</code>ä¸€æ ·ï¼Œç§å­ä¸€æ ·çš„æ—¶å€™ç”Ÿæˆçš„æ•°åˆ—æ˜¯å›ºå®šçš„</li>
<li>ä¹Ÿæ˜¯ç»§æ‰¿è‡³ java.util.Randomã€‚</li>
<li>ä¸ä¸€æ ·çš„æ˜¯ï¼Œ<code>SecureRandom</code>æ”¶é›†äº†ä¸€äº›éšæœºäº‹ä»¶ï¼Œæ¯”å¦‚é¼ æ ‡ç‚¹å‡»ï¼Œé”®ç›˜ç‚¹å‡»ç­‰ç­‰ï¼Œ ä½¿ç”¨è¿™äº›éšæœºäº‹ä»¶ä½œä¸ºç§å­</li>
<li>é€šè¿‡newæ¥åˆå§‹åŒ–ï¼Œåœ¨ä¸é€‚ç”¨ä»»ä½•æºçš„æƒ…å†µä¸‹ï¼Œå°±æ˜¯è¯´æ— å‚æ•°æ„é€ å‡½æ•°çš„è¯ï¼Œé»˜è®¤æ¥è¯´ä¼šä½¿ç”¨<code>NativePRNG</code>ç®—æ³•ç”Ÿæˆéšæœºæ•°</li>
<li>ä¸è¦ä½¿ç”¨äººä¸ºæŒ‡å®šçš„æºï¼Œå°½é‡ä½¿ç”¨ç³»ç»Ÿçš„éšæœºæºã€‚ç³»ç»Ÿçš„éšæœºæºåœ¨java8ä¸­æ˜¯å¯ä»¥é…ç½®çš„ï¼Œé…ç½®åœ¨<code>$JAVA_HOME/jre/lib/security/java.security</code>ä¸­çš„<code>securerandom.source</code>å±æ€§ã€‚ä¾‹å¦‚jdk1.8ä¸­è¯¥é…ç½®ä¸º:<code>securerandom.source=file:/dev/random</code></li>
<li>å®é™…ä¸ŠSHA1PRNGçš„æ€§èƒ½å°†è¿‘è¦æ¯”NativePRNGçš„æ€§èƒ½å¥½ä¸€å€ï¼Œsynchronizedçš„ä»£ç å°‘äº†ä¸€åŠï¼Œæ‰€ä»¥æ²¡æœ‰ç‰¹åˆ«é‡çš„å®‰å…¨éœ€è¦ï¼Œå°½é‡ä½¿ç”¨SHA1PRNGç®—æ³•ç”Ÿæˆéšæœºæ•°ã€‚</li>
</ul>
<h4 id="java-util-concurrent-threadlocalrandom"><a class="header-anchor" href="#java-util-concurrent-threadlocalrandom"></a>java.util.concurrent.ThreadLocalRandom</h4>
<ul>
<li>java7ä¹‹åå¼•è¿›çš„</li>
<li>ç»§æ‰¿è‡ªjava.util.Random</li>
</ul>
<h3 id="queue"><a class="header-anchor" href="#queue"></a>Queue</h3>
<h4 id="linkedblockingqueue"><a class="header-anchor" href="#linkedblockingqueue"></a>LinkedBlockingQueue</h4>
<ul>
<li>
<p><code>take</code>å‡½æ•°ä¼šä»<code>queue</code>çš„å¤´éƒ¨æ‹¿å‡ºä¸€ä¸ª<code>item</code>ã€‚æ‰€ä»¥é¦–å…ˆæ˜¯æŒ‰ç…§é¡ºåºå–å‡º<code>item</code>çš„ï¼Œå¹¶ä¸”åœ¨å–å‡ºåä¼šä»é˜Ÿåˆ—ä¸­åˆ é™¤</p>
</li>
<li>
<p>å½“é˜Ÿåˆ—ä¸­æ²¡æœ‰æ•°æ®çš„æ—¶å€™ï¼Œä¼šåœ¨<code>take</code>å‡½æ•°ä¸­ç­‰å¾…ï¼Œç›´åˆ°æœ‰æ•°æ®ä¸ºæ­¢</p>
<p>while (count.get() == 0) {<br>
notEmpty.await();<br>
}</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/05/15/Cassandra%E7%9A%84repair%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/05/15/Cassandra%E7%9A%84repair%E6%9C%BA%E5%88%B6/" class="post-title-link" itemprop="url">Cassandraçš„repairæœºåˆ¶</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-05-15 17:52:05" itemprop="dateCreated datePublished" datetime="2019-05-15T17:52:05+08:00">2019-05-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-02-22 17:04:27" itemprop="dateModified" datetime="2021-02-22T17:04:27+08:00">2021-02-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/cassandra/" itemprop="url" rel="index"><span itemprop="name">cassandra</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/05/15/Cassandra%E7%9A%84repair%E6%9C%BA%E5%88%B6/" class="post-meta-item leancloud_visitors" data-flag-title="Cassandraçš„repairæœºåˆ¶" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/05/15/Cassandra%E7%9A%84repair%E6%9C%BA%E5%88%B6/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/05/15/Cassandra%E7%9A%84repair%E6%9C%BA%E5%88%B6/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="cassandraçš„repairæœºåˆ¶"><a class="header-anchor" href="#cassandraçš„repairæœºåˆ¶"></a>Cassandraçš„repairæœºåˆ¶</h2>
<p>è¿™ç¯‡è®¨è®ºä¸€äº›<code>robustness</code>çš„ä¸œè¥¿ã€‚ä¸»è¦å°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹<code>down</code>äº†ä¼šæ€ä¹ˆæ ·ã€‚å…¶å®ç›®å‰çŸ¥é“çš„å°±æ˜¯<code>hint</code>ï¼Œä½†æ˜¯è®°å½•ä¸‹æ¥ã€‚<br>
ä»ä¸€äº›æ–‡æ¡£é‡Œé¢çœ‹ï¼Œè¿™ä¸ªå±äºå†™æµç¨‹çš„ä¸€éƒ¨åˆ†ã€‚ç¡®å®æ˜¯ï¼Œè¯»çš„è¯ï¼Œå¦‚æœ<code>node down</code>äº†åº”è¯¥ä¸ä¼šä»ä¸Šé¢è¯»å–äº†ã€‚ä¼šå†™åˆ°<code>the coordinator node</code>ä¸Šé¢ã€‚<code>version 1.0</code>æœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯è¿™ä¸ªç‰ˆæœ¬å¤ªæ—§äº†ã€‚</p>
<blockquote>
<p>By design, hinted handoff inherently allows Cassandra to continue performing the same number of writes even when the cluster is operating at reduced capacity.</p>
</blockquote>
<h3 id="hinted-handoffç®€è¿°"><a class="header-anchor" href="#hinted-handoffç®€è¿°"></a>Hinted Handoffç®€è¿°</h3>
<ul>
<li><strong><code>hinted handoff</code> å’Œ ä¸€èˆ¬è¯´çš„<code>hint</code>åº”è¯¥æ˜¯åŒä¸€ä¸ªä¸œè¥¿ã€‚</strong> å‰è€…æ˜¯ä¸€ä¸ªæœºåˆ¶ï¼Œåè€…å°±æ˜¯è¿™ä¸ªæœºåˆ¶äº§ç”Ÿçš„äº‹ä»¶æˆ–è€…è®°å½•ã€‚</li>
<li><code>hinted handoff</code>è·Ÿ<code>consistency level</code>ç›¸å…³ï¼Œæ¯•ç«Ÿè¿™ä¸ªæ˜¯å†™æœºåˆ¶çš„ä¸€éƒ¨åˆ†ã€‚</li>
<li><code>cassandra</code>çš„<code>config</code>æ–‡ä»¶é‡Œé¢éœ€è¦é…ç½®å‡ ä¸ªå‚æ•°ï¼š
<ul>
<li><code>hinted_handoff_enabled</code>ï¼šé»˜è®¤ä¸º<code>true</code>ï¼Œæ‰“å¼€è¿™ä¸ªæœºåˆ¶</li>
<li><code>max_hint_window_in_ms</code>ï¼š ä¸ºå·²ç»<code>down</code>æ‰çš„<code>node</code>è®°å½•<code>hint log</code>çš„æ—¶é—´é•¿åº¦</li>
<li><code>gc_grace_seconds</code>: Configures the time-to-live (TTL) period for a hint so that the database wonâ€™t replay the hint after this duration. Setting this parameter to 0 disables hintsã€‚ è¿™ä¸ªå‚æ•°æ²¡ç”¨è¿‡ï¼Œåé¢å¯ä»¥è¯•è¯•çœ‹</li>
<li><code>hinted_handoff_throttle_in_kb</code> å’Œ    <code>max_hints_delivery_threads</code> è¿™ä¸¤ä¸ªæ²¡å’‹ç ”ç©¶è¿‡ï¼Œå…ˆæ”¾ç€å§</li>
</ul>
</li>
<li>æŒ‰ç…§æ–‡æ¡£ï¼Œå½“å†™å…¥å‘ç”Ÿæ—¶å€™ï¼Œå¹¶ä¸”<code>a replica node for the key is down</code>ã€‚å°±å¯èƒ½ä¼šè§¦å‘<code>hinted handoff</code>çš„æœºåˆ¶</li>
</ul>
<h4 id="hint-è¯¦è¿°"><a class="header-anchor" href="#hint-è¯¦è¿°"></a>Hint è¯¦è¿°</h4>
<ul>
<li>
<blockquote>
<p>The hint consists of a target ID for the downed node, a hint ID that is a time UUID for the data, a message ID that identifies the Cassandra version, and the data itself as a blob.</p>
</blockquote>
<ul>
<li><code>hint</code>é‡Œé¢æœ‰ï¼šdown nodeçš„target IDï¼Œ æ ‡æ³¨è¿™æ¡æ•°æ®çš„hint IDï¼Œ æ ‡æ³¨<code>cassandra version</code>çš„<code>message ID</code>ä»¥åŠæ•°æ®æœ¬èº«</li>
<li>è¿™æ˜¯<code>cassandra 3.0</code>ä¹‹åçš„ã€‚ä¹‹å‰çš„å¯èƒ½ä¸ä¸€æ ·</li>
</ul>
</li>
<li>
<p>å’Œæƒ³è±¡åœ°ä¸€æ ·ï¼Œå½“<code>Gossipy</code>å‘ç°<code>downed node</code>èµ·æ¥ä¹‹åï¼Œ<code>coordinator node</code>ä¼šå°†<code>hint</code>è®°å½•çš„æ•°æ®å†™è¿‡å»ï¼Œå¹¶ä¸”åˆ é™¤æ‰<code>hint</code></p>
</li>
<li>
<blockquote>
<p>The coordinator also checks every ten minutes for hints corresponding to writes that timed out during an outage too brief for the failure detector to notice through gossip.</p>
</blockquote>
</li>
<li>
<p>è¿™å¥æœ‰ç‚¹éš¾ä»¥ç†è§£ï¼Œçœ‹äº†ä¸‹ä¸€å¥æœ‰ç‚¹æ˜ç™½ã€‚å¦‚æœæœ‰çš„èŠ‚ç‚¹å®•æœºæ—¶é—´å¾ˆçŸ­ï¼Œè€Œ<code>Gossdip</code>å¹¶æ²¡æœ‰å‘ç°ï¼Œé‚£ä¹ˆ<code>coordinator</code>ä¼šè¿”å›ä¸€ä¸ª<code>exception</code>ï¼ŒåŒæ—¶æŠŠ<code>write fail</code>äº†ï¼Œä½†æ˜¯ä¼šè®°å½•ä¸€ä¸ª<code>hint</code>ã€‚æ‰€ä»¥å¦‚æœç¬é—´æœ‰å¾ˆå¤šçŸ­æš‚çš„<code>fail</code>ï¼Œ<code>coordinator node</code>ä¼šä¸€ä¸‹å­å‹åŠ›è¿‡å¤§ï¼Œæ‰”å‡º<code>overloadexception</code></p>
</li>
</ul>
<blockquote>
<p>If a replica node is overloaded or unavailable, and the failure detector has not yet marked the node as down, then expect most or all writes to that node to fail after the timeout triggered by write_request_timeout_in_ms, (10 seconds by default). The coordinator returns a TimeOutException exception, and the write will fail but a hint will be stored.</p>
</blockquote>
<h4 id="hint-å’Œ-consistency-level"><a class="header-anchor" href="#hint-å’Œ-consistency-level"></a>Hint å’Œ consistency level</h4>
<ul>
<li>
<blockquote>
<p>å½“ä¸€è‡´æ€§ç­‰çº§è®¾å®šä¸º<code>ONE</code>ï¼Œ<code>QUORUM</code>ï¼Œæˆ–è€…<code>ALL</code>çš„æ—¶å€™ï¼Œæç¤ºçš„å†™å¹¶ä¸å‚ä¸åˆ°ä¸€è‡´æ€§çº§åˆ«çš„è®¡æ•°ä¸­ã€‚å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„èŠ‚ç‚¹æ»¡è¶³å†™çš„ä¸€è‡´æ€§çº§åˆ«éœ€è¦ï¼Œä¼šæŠ›å‡º<code>UnavailableException</code>è€Œä¸æ˜¯è§¦å‘<code>Hinted Handoff</code>ã€‚ï¼ˆè¿™æ˜¯<code>Casssandra</code>å’Œ<code>Dynamo</code>å¤åˆ¶æ¨¡å‹ä¸ä¸€æ ·çš„åœ°æ–¹ä¹‹ä¸€ï¼‰</p>
</blockquote>
</li>
<li>æ¥ä¸Šæ–‡ï¼Œå¦‚æœå°†<code>consistency level</code>è®¾ç½®æˆä¸º<code>Any</code>ï¼Œé‚£ä¹ˆ<code>hint</code>å°±ç®—äº†ã€‚æ‰€ä»¥å³ä½¿åªæ˜¯å†™äº†<code>hint</code>ï¼Œå†™æ“ä½œä¹Ÿä¼šæˆåŠŸï¼Œä½†æ˜¯è¿™æ—¶å€™è¯»æ•°æ®æ˜¯è¯»ä¸å‡ºæ¥çš„ã€‚</li>
</ul>
<h3 id="repairing-data"><a class="header-anchor" href="#repairing-data"></a>Repairing Data</h3>
<ul>
<li>Read repair: The reconciliation or correction happens when a read finds an inconsistency.</li>
<li>When data is read, a read repair can resolve any data inconsistencies. When data isnâ€™t read, you need to use either the hinted handoff or anti-entropy mechanism to resolve any data inconsistences.</li>
</ul>
<h4 id="read-repair"><a class="header-anchor" href="#read-repair"></a>Read Repair</h4>
<h4 id="anti-entropy"><a class="header-anchor" href="#anti-entropy"></a>anti-entropy</h4>
<h3 id="å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3>
<ul>
<li><a href="https://wiki.apache.org/cassandra/HintedHandoff" target="_blank" rel="noopener">wikiä¸Šé¢çš„ç®€ä»‹</a></li>
<li><a href="https://docs.datastax.com/en/cassandra/3.0/cassandra/operations/opsRepairNodesHintedHandoff.html" target="_blank" rel="noopener">å®˜æ–¹</a></li>
<li><a href="http://www.cnblogs.com/sing1ee/archive/2012/07/09/2765056.html" target="_blank" rel="noopener">æ¯”è¾ƒå¥½çš„åšå®¢ä¸€ç¯‡</a>ï¼š çœ‹èµ·æ¥å¾ˆå¤šå°±æ˜¯å®˜æ–¹æ–‡æ¡£çš„ç¿»è¯‘</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/04/18/Cassandra%20Batch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/04/18/Cassandra%20Batch/" class="post-title-link" itemprop="url">Cassandra Batch</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-04-18 10:17:44" itemprop="dateCreated datePublished" datetime="2019-04-18T10:17:44+08:00">2019-04-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-02-22 16:24:27" itemprop="dateModified" datetime="2021-02-22T16:24:27+08:00">2021-02-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/cassandra/" itemprop="url" rel="index"><span itemprop="name">cassandra</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/04/18/Cassandra%20Batch/" class="post-meta-item leancloud_visitors" data-flag-title="Cassandra Batch" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/04/18/Cassandra%20Batch/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/04/18/Cassandra%20Batch/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="cassandra-batch"><a class="header-anchor" href="#cassandra-batch"></a>Cassandra Batch</h2>
<p>æœ€è¿‘å·¥ä½œæ¯”è¾ƒå¿™æ´»ï¼Œä¸€ä¸ªæœˆéƒ½æ²¡å†™blogå–½ã€‚å·¥ä½œä¸­ç¢°åˆ°äº†ä¸€äº›ä¸cassandraç›¸å…³çš„åŒæ­¥å¼‚æ­¥ï¼ŒsimpleStatementï¼ŒbatchStatementçš„ä¸œè¥¿ã€‚é¡ºåŠ¿å¤šç ”ç©¶ä¸€ä¸‹ã€‚<br>
ç ”ç©¶å‘ç°ï¼Œè¿™ç©æ„è¿˜æŒºå¤æ‚çš„å•Šã€‚</p>
<h3 id="execute-ä¸-executeasync"><a class="header-anchor" href="#execute-ä¸-executeasync"></a>execute ä¸ executeAsync</h3>
<ul>
<li>
<p>cassandra driveråœ¨æ‰§è¡Œè¯­å¥æ—¶å€™æä¾›äº†<code>execute</code>å’Œ<code>executeAsync</code> ä¸¤ä¸ªæ¥å£</p>
</li>
<li>
<p>å¯¹äº<code>batch</code>æ¥è¯´ï¼Œåªèƒ½è°ƒç”¨å‰è€…ï¼Œè¿™ä¸ªå¥½åƒä¸å¤ªå¯¹ã€‚</p>
</li>
<li>
<p>ä½†æ˜¯è¿›å…¥ä»£ç ä¼šçœ‹åˆ°ï¼Œ<code>execute</code>æœ€åè°ƒç”¨çš„ä¹Ÿæ˜¯<code>executeAsync</code></p>
<pre><code>  public ResultSet execute(Statement statement) {
         this.checkNotInEventLoop();
         return this.executeAsync(statement).getUninterruptibly();
  }
</code></pre>
</li>
<li>
<p>è¿™ä¸ª<code>executeAsync</code>æ¥å£æ˜¯åœ¨<code>SessionManager</code>é‡Œé¢å®šä¹‰çš„</p>
</li>
<li>
<p>æŒ‰ç…§å‚è€ƒé“¾æ¥1é‡Œé¢æ‰€è¿°çš„ï¼Œä»ä»¥ä¸Šä»£ç ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥çš„<code>execute</code>åœ¨äºæ˜¯<code>block</code>çš„ã€‚å°±æ˜¯ä¸å¯æ‰“æ–­çš„ã€‚å¿…é¡»å¾—<code>cassandra</code>è¿”å›ä¸€äº›æ•°æ®æ‰èƒ½è¿”å›ã€‚æ‰€ä»¥å®ƒå¯ä»¥ä¿è¯åœ¨<code>invalid request</code>çš„æƒ…å†µä¸‹æŠ¥é”™ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯<code>request</code>å°±ä¸€å®šæ‰§è¡ŒæˆåŠŸäº†ã€‚</p>
</li>
<li>
<p><code>executeAsync</code>å°±æ˜¯éé˜»å¡çš„ï¼Œä¹Ÿä¸èƒ½ä¿è¯è¿™ä¸ª<code>request</code>ä¸€å®šè¢«æ‰§è¡Œæˆ–è€…åœ¨<code>invalid request</code>çš„æƒ…å†µä¸‹æŠ¥é”™</p>
</li>
<li>
<p>å‚è€ƒé“¾æ¥1é‡Œé¢æœ‰è¿™ä¹ˆä¸€æ®µè¯ï¼šçœ‹èµ·æ¥å°‘é‡<code>batch</code>ï¼Œå¹¶ä¸”æ˜¯åŒæ ·<code>partition key</code>çš„æ—¶å€™ï¼Œä¼šæ¯”è¾ƒå¿«ã€‚</p>
</li>
<li>
<p>æˆ‘ä»¬åœ¨äº§å“ä¸­çš„æ”¹è¿›åœ¨æœ‰äº›åœºæ™¯ä¸‹é¢ç¡®å®æ€§èƒ½å˜å¥½äº†</p>
</li>
</ul>
<blockquote>
<p>To further improve throughput, you might want to consider using BatchStatement and submitting requests in batches. This is a good option if you keep your batches small (50-250 is a good number) and if your inserts in a batch all share the same partition key.</p>
</blockquote>
<ul>
<li>å‚è€ƒé“¾æ¥ï¼š
<ol>
<li><a href="https://stackoverflow.com/questions/34949292/how-cassandra-handle-blocking-execute-statement-in-datastax-java-driver" target="_blank" rel="noopener">How Cassandra handle blocking execute statement in datastax java driver<br>
</a></li>
</ol>
</li>
</ul>
<ol start="2">
<li><a href="http://zqhxuyuan.github.io/2015/11/10/2015-11-10-Cassandra-Client/" target="_blank" rel="noopener">Cassandra ClientæŸ¥è¯¢ä¼˜åŒ–</a>: è¿™ç¯‡æœ‰ç‚¹çœ‹ä¸æ˜ç™½ã€‚ä½†æ˜¯ç…ç€è¿˜æŒºå¥½çš„ï¼Œå…ˆæ”¾åœ¨è¿™é‡Œã€‚</li>
</ol>
<h3 id="batchstatement"><a class="header-anchor" href="#batchstatement"></a>BatchStatement</h3>
<p>ä¸¥æ ¼è¯´æ¥ï¼Œ<code>cassanda</code>é‡Œé¢çš„<code>batch</code>ç§°ä¸º<code>LOGGED batch</code>ï¼Œè€Œä¸åº”è¯¥æ˜¯<code>atomic batch</code>ã€‚<code>Cassanda</code>çš„ç­–ç•¥å§‹ç»ˆæ˜¯<code>Eventually Consistent</code>ã€‚è€Œä¸”ç”±äº<code>cassandra</code>é‡Œé¢åŠ ä¸€ä¸ªæ•°æ®æ¯”åˆ é™¤ä¸€ä¸ªæ•°æ®è¦æ–¹ä¾¿å¤ªå¤šã€‚æ‰€ä»¥<code>cassandra</code>ä¼šè®°ä¸€å †æ—¥å¿—å•¥çš„ï¼Œè€Œä¸æ˜¯å›æ»šã€‚</p>
<ul>
<li><code>cassandra</code>æ˜¯åŸºäº<code>co-ordinator</code>æ¥å®ç°çš„ã€‚<code>batch</code>åœ¨<code>co-ordinator</code>å¼€å§‹å¤„ç†ä¹‹å‰å°±ç•™ä¼šå†™åˆ°å…¶ä»–èŠ‚ç‚¹å»</li>
<li>å¦‚æœ<code>batch</code>é‡Œé¢çš„æŸäº›å¤±è´¥äº†ï¼Œé‚£ä¹ˆæ˜¯ä¸ä¼šå›æ»šçš„ã€‚è€Œæ˜¯ä¼šä¸æ–­å°è¯•ã€‚</li>
<li><code>LOGGER</code>çš„<code>batch</code>æ“ä½œä¼šæ¯”<code>unlogged</code>çš„å¤šåšå¾ˆå¤šäº‹æƒ…</li>
</ul>
<h4 id="batchstatement-type"><a class="header-anchor" href="#batchstatement-type"></a>BatchStatement.Type</h4>
<p>è¿™ä¸ªæ˜¯<code>BatchStatement class</code>çš„ä¸€ä¸ªå­ç±»</p>
<ul>
<li><code>COUNTER</code>: A counter batch. Note that such batch is the only type that can contain counter operations and it can only contain these. è¿™ä¸ªè§£é‡Šä¹Ÿå¤ªç®€å•äº†ã€‚æ„æ€æ˜¯è¯´å¯ä»¥çŸ¥é“å¤šå°‘ä¸ªæˆåŠŸäº†ï¼Ÿ</li>
<li><code>LOGGED</code>:
<ul>
<li>Cassandra will first write the batch to its distributed batch log to ensure the atomicity of the batch (atomicity meaning that if any statement in the batch succeeds, all will eventually succeed).è¿™ä¸ªè§£é‡Šä¹Ÿä¸å¤ªæ‡‚å•Šï¼Œåˆ°åº•æ€ä¹ˆä¿è¯çš„ã€‚ ORZ</li>
<li>é»˜è®¤è°ƒç”¨<code>new BatchStatement()</code>å°±ä¼šåˆ›ä¸€ä¸ªLOGGED typeçš„Batch-</li>
</ul>
</li>
<li><code>UNLOGGED</code>ï¼š A batch that doesnâ€™t use Cassandraâ€™s distributed batch log. Such batch are not guaranteed to be atomic.</li>
</ul>
<h4 id="logged-batchçš„è¿‡ç¨‹"><a class="header-anchor" href="#logged-batchçš„è¿‡ç¨‹"></a>LOGGED Batchçš„è¿‡ç¨‹</h4>
<p><img src="http://3.bp.blogspot.com/-dv9zIC84QD4/VNoNE0YXn8I/AAAAAAAAAX0/b3wtV48fuB0/s1600/Screenshot%2B2015-02-10%2B13.51.56.png" alt=""></p>
<blockquote>
<p>å›¾ç‰‡æ¥è‡ªå‚è€ƒé“¾æ¥2</p>
</blockquote>
<ul>
<li>æ‰€ä»¥ä»å›¾ç‰‡é‡Œé¢çœ‹å‡ºæ¥ï¼Œ<code>cassandra</code>æ”¶åˆ°ä¸€ä¸ª<code>batch</code>è¯·æ±‚çš„æ—¶å€™ï¼š
<ul>
<li>ç”±<code>co-ordinator</code>æ¥å¤„ç†ï¼Œä¹Ÿå°±æ˜¯ç§å­èŠ‚ç‚¹</li>
<li>ä¼šå…ˆå†™<code>batch log</code>ï¼Œé€šå¸¸å†™ä¸¤ä¸ª<code>node</code>ï¼Ÿ</li>
<li>ç„¶åå†ä»ç§å­èŠ‚ç‚¹å†™åˆ°å„ä¸ªåˆ†èŠ‚ç‚¹</li>
</ul>
</li>
<li>æŒ‰ç…§å‚è€ƒé“¾æ¥2é‡Œé¢çš„æè¿°ï¼Œ<code>performance hit</code>ï¼Œæ€§èƒ½æ˜¯æœ‰å¯èƒ½ä¸‹é™çš„ã€‚å› ä¸ºå¤šåšäº†å¾ˆå¤šäº‹æƒ…ï¼Œè€Œä¸”æ˜¯ä»ç§å­èŠ‚ç‚¹åˆ†å‘å‡ºå»çš„ã€‚</li>
<li>ç»“è®ºå°±æ˜¯ï¼šåªæœ‰åœ¨ä¸ºäº†ä¿è¯ä¸€è‡´æ€§çš„æƒ…å†µä¸‹ï¼Œæ‰ä½¿ç”¨<code>batch</code>ï¼Œè€Œä¸æ˜¯è¯´æ”¹å–„æ€§èƒ½</li>
</ul>
<h4 id="logged-batch-fail"><a class="header-anchor" href="#logged-batch-fail"></a>LOGGED Batch Fail</h4>
<ul>
<li>é¦–å…ˆä¸ä¼šå›æ»š</li>
<li><code>WriteTimeoutException with write type of BATCH_LOG.</code> è¯´æ˜åœ¨å†™<code>batch log</code>æ—¶å€™æŒ‚äº†ã€‚éœ€è¦æ‰‹åŠ¨å†å‘ä¸€ä¸‹ã€‚</li>
<li><code>WriteTimeoutException with the write type of BATCH</code>ã€‚ åœ¨çœŸæ­£å†™<code>request</code>çš„æ—¶å€™å‡ºé”™äº†ã€‚<code>cassandra</code>ä¼šä¸æ–­é‡å¤ï¼Œç›´è‡³æˆåŠŸã€‚</li>
<li>æœ‰æ—¶å€™ä¼šåœ¨<code>Cassandra</code>çš„æ—¥å¿—é‡Œé¢çœ‹åˆ°ä»¥ä¸‹å†…å®¹ã€‚è¿™æ˜¯è¯´<code>batch</code>çš„è¯·æ±‚è¶…é™äº†ã€‚è¿™ä¸ªå‚æ•°çš„é»˜è®¤å€¼æ˜¯5Kï¼Œ<code>batch_size_warn_threshold_in_kb</code></li>
</ul>
<pre><code>WARN  [SharedPool-Worker-2] 2018-05-16 08:33:48,585 BatchStatement.java:287 - Batch of prepared statements for [test, test1] is of size 6419, exceeding specified threshold of 5120 by 1299.
</code></pre>
<ul>
<li><a href="https://stackoverflow.com/questions/50385262/cassandra-batch-prepared-statement-size-warning" target="_blank" rel="noopener">batch size warning</a></li>
</ul>
<h3 id="å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3>
<ol>
<li><a href="https://stackoverflow.com/questions/22664129/atomic-batches-in-cassandra" target="_blank" rel="noopener">Atomic Batches in Cassandra</a></li>
<li><a href="http://christopher-batey.blogspot.com/2015/03/cassandra-anti-pattern-cassandra-logged.html" target="_blank" rel="noopener">Cassandra anti-pattern: Logged batches</a><br>
3.<a href="https://docs.datastax.com/en/archived/cql/3.3/cql/cql_using/useBatchBadExample.html" target="_blank" rel="noopener">batchçš„é”™è¯¯ä½¿ç”¨æ–¹å¼</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/03/11/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/03/11/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="post-title-link" itemprop="url">Javaå¤šçº¿ç¨‹æ•°æ®ç±»å‹</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-03-11 10:22:53" itemprop="dateCreated datePublished" datetime="2019-03-11T10:22:53+08:00">2019-03-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-07-18 11:12:59" itemprop="dateModified" datetime="2019-07-18T11:12:59+08:00">2019-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/03/11/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="post-meta-item leancloud_visitors" data-flag-title="Javaå¤šçº¿ç¨‹æ•°æ®ç±»å‹" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/03/11/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/03/11/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>è¿™ç¯‡è®°å½•æ”¹æˆä¸“é—¨è®°å½•å’Œå¤šçº¿ç¨‹ç›¸å…³çš„æ•°æ®ç±»å‹</p>
<h3 id="executors"><a class="header-anchor" href="#executors"></a>Executors</h3>
<p>è¿™ä¸ª<code>Executors</code>æ²¡æœ‰ç»§æ‰¿æˆ–è€…å®ç°ä»»ä½•å…¶ä»–ç±»ã€‚å°±æ˜¯è¯´ï¼Œä»–å˜å˜£è‡ªå·±ä¸€ä¸ªã€‚å®é™…ä¸Šæ˜¯ä¸€ä¸ªå·¥å…·ç±»å•Šï¼Œæ›´ç¡®åˆ‡åœ°è¯´ï¼Œåƒä¸€ä¸ªå·¥å‚ç±»ã€‚ä¸»è¦åŠŸèƒ½æ˜¯è¿”å›å„ç§<code>ExecutorService</code>ã€‚<br>
å…¶å®å°±æ˜¯<code>new</code>å‡ºå„ç§<code>ThreadPoolExecutor</code>ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code>public static ExecutorService newSingleThreadExecutor() {
    return new FinalizableDelegatedExecutorService
        (new ThreadPoolExecutor(1, 1,
                                0L, TimeUnit.MILLISECONDS,
                      new LinkedBlockingQueue&lt;Runnable&gt;()));
}
</code></pre>
<h3 id="executorservice"><a class="header-anchor" href="#executorservice"></a>ExecutorService</h3>
<h4 id="æ¦‚è§ˆ"><a class="header-anchor" href="#æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h4>
<pre><code>public interface ExecutorService extends Executor
</code></pre>
<ul>
<li>æ‰€ä»¥é¦–å…ˆæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¥å£</li>
<li>Executoræ¥å£å¾ˆç®€å•ï¼Œåªæœ‰ä¸€ä¸ªexecuteæ–¹æ³•ã€‚ExecutorServiceé™¤äº†è¿™ä¸€ä¸ªæ–¹æ³•ï¼Œè¿˜å¢åŠ äº†ä¸€äº›æ–¹æ³•ï¼Œå¢åŠ çš„æ–¹æ³•åŒ…æ‹¬ï¼š<code>awaitTerminate</code>ï¼Œ<code>invokeAll</code>ï¼Œ<code>invokeAny</code>ï¼Œ<code>shutdown</code>ï¼Œ<code>shutdownNow</code>ï¼Œ<code>submit</code>ç­‰ã€‚</li>
<li><a href="https://www.cnblogs.com/Steven0805/p/6393443.html" target="_blank" rel="noopener">Javaçº¿ç¨‹æ± ExecutorService</a></li>
</ul>
<h4 id="å‡ ç§å¸¸ç”¨çº¿ç¨‹æ± çš„å…·ä½“å®ç°"><a class="header-anchor" href="#å‡ ç§å¸¸ç”¨çº¿ç¨‹æ± çš„å…·ä½“å®ç°"></a>å‡ ç§å¸¸ç”¨çº¿ç¨‹æ± çš„å…·ä½“å®ç°</h4>
<ul>
<li>ç„¶åæœ‰æ„æ€çš„æ¥äº†ï¼š</li>
<li>Javaé€šè¿‡Executors classæä¾›äº†å¥½å‡ ç§çº¿ç¨‹æ± ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„å‡ ç§äº†ã€‚</li>
<li><code>newFixedThreadPool</code>ï¼šå°±æ˜¯è¯´è¿™ä¸ªç©æ„ï¼Œé™å®šå¥½äº†æœ€å¤§æ•°ç›®ï¼Œæ ¸å¿ƒæ•°ç›®ï¼Œç„¶åæœ¬è´¨æ˜¯ä¸€ä¸ª<code>LinkedBlockingQueue</code>å¥—äº†<code>runnable</code></li>
</ul>
<pre><code> public static ExecutorService newFixedThreadPool(int nThreads) {
    return new ThreadPoolExecutor(nThreads, nThreads,
                                  0L, TimeUnit.MILLISECONDS,
                                  new LinkedBlockingQueue&lt;Runnable&gt;());
</code></pre>
<ul>
<li><code>newCachedThreadPool</code>ï¼š</li>
</ul>
<pre><code>   public static ExecutorService newCachedThreadPool() {
    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,
                                  60L, TimeUnit.SECONDS,
                                  new SynchronousQueue&lt;Runnable&gt;());    }
</code></pre>
<ul>
<li>è¿˜æœ‰<code>newScheduledThreadPool</code>å’Œ<code>newSingleThreadExecutor</code></li>
</ul>
<h4 id="ä¸€äº›è¦ç‚¹"><a class="header-anchor" href="#ä¸€äº›è¦ç‚¹"></a>ä¸€äº›è¦ç‚¹</h4>
<ul>
<li><code>submit</code>ä¸<code>execute</code>çš„åŒºåˆ«ï¼š
<ul>
<li>submitæ¥å—runnableå’Œcallable  æœ‰è¿”å›å€¼ã€‚</li>
<li>executeæ¥å—runnable æ— è¿”å›å€¼</li>
<li>submitæ–¹ä¾¿Exceptionå¤„ç†</li>
</ul>
</li>
<li>Runnableä¸CallableåŒºåˆ«
<ul>
<li>runnableæ¥å£å®ç°çš„æ²¡æœ‰è¿”å›å€¼çš„å¹¶å‘ç¼–ç¨‹ã€‚</li>
<li>callableå®ç°çš„å­˜åœ¨è¿”å›å€¼çš„å¹¶å‘ç¼–ç¨‹ã€‚ä½¿ç”¨Futureè·å–è¿”å›å€¼ã€‚</li>
</ul>
</li>
</ul>
<h3 id="threadpoolexecutor"><a class="header-anchor" href="#threadpoolexecutor"></a>ThreadPoolExecutor</h3>
<pre><code>public abstract class AbstractExecutorService implements ExecutorService
public class ThreadPoolExecutor extends AbstractExecutorService    
</code></pre>
<ul>
<li>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºæ¥ï¼ŒThreadPoolExecutorä¹Ÿæ˜¯ä¸€ç§Executorï¼Œç»§æ‰¿è‡ªAbstractExecutorServiceï¼Œè‡ªç„¶ä¹Ÿå®ç°äº†ExecutorService.</li>
<li><a href="https://www.cnblogs.com/zedosu/p/6665306.html" target="_blank" rel="noopener">ThreadPoolExecutorä½¿ç”¨è¯¦è§£</a></li>
</ul>
<h4 id="threadpoolexecutor-shutdown"><a class="header-anchor" href="#threadpoolexecutor-shutdown"></a>ThreadPoolExecutor shutdown</h4>
<p>ThreadPoolExecutor æœ‰ä¸‰ä¸ªshutdownæ–¹æ³•ï¼š <code>shutdown</code>ã€<code>shutdownNow</code>ã€<code>awaitTermination</code></p>
<ul>
<li>
<p><code>shutdown</code>ï¼š åœæ­¢æ¥æ”¶å¤–éƒ¨submitçš„ä»»åŠ¡ï¼›å†…éƒ¨æ­£åœ¨è·‘çš„ä»»åŠ¡å’Œé˜Ÿåˆ—é‡Œç­‰å¾…çš„ä»»åŠ¡ï¼Œä¼šæ‰§è¡Œå®Œã€‚å…¶å®graceful shutdownçš„æ„Ÿè§‰å•Š</p>
</li>
<li>
<p><code>shutdownNow</code>ï¼š åœæ­¢æ¥æ”¶å¤–éƒ¨æäº¤çš„ä»»åŠ¡ï¼›å¿½ç•¥é˜Ÿåˆ—é‡Œç­‰å¾…çš„ä»»åŠ¡ï¼›å°è¯•å°†æ­£åœ¨è·‘çš„ä»»åŠ¡interruptä¸­æ–­ï¼›è¿”å›æœªæ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚å¼ºåˆ¶ä¸­æ–­ã€‚çº¿ç¨‹ä¼šæ”¶åˆ°InterupptedException.</p>
<ul>
<li>éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªæ–¹æ³•ä»…ä»…æ˜¯å°è¯•ä¸­æ–­çº¿ç¨‹ï¼Œå®ƒé€šè¿‡çš„æ˜¯è°ƒç”¨interruptæ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•çš„ä½œç”¨æœ‰é™ï¼Œå¦‚æœçº¿ç¨‹ä¸­æ²¡æœ‰sleep ã€waitã€Conditionã€å®šæ—¶é”ç­‰åº”ç”¨, interrupt()æ–¹æ³•æ˜¯æ— æ³•ä¸­æ–­å½“å‰çš„çº¿ç¨‹çš„ã€‚</li>
</ul>
</li>
<li>
<p><code>awaitTermination</code>ï¼šåªæ˜¯åŠ äº†ä¸€ä¸ªwaitæ—¶é—´çš„é™åˆ¶</p>
<ul>
<li>å¾ˆå¤šåšå®¢çš„é‡Œé¢ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¿”å›booleançš„è¿”å›å€¼ã€‚å°±æ˜¯è¯´<code>awaitTermination</code>ä¸€èˆ¬å’Œ<code>shutdown</code>æ­é…ä½¿ç”¨ï¼Œ<code>awaitTermination</code>æ¥ç›‘æ§çº¿ç¨‹æœ‰æ²¡æœ‰ç»“æŸå¥½ã€‚ç»“æŸäº†è¿”å›<code>true</code>ï¼Œæ²¡ç»“æŸè¿”å›<code>false</code></li>
<li>è¿™ä¸ªå‡½æ•°è¿˜ä¼šæŠ›å‡ºInterupptedExceptionï¼Œä½†æ˜¯çœ‹ä»£ç æ²¡å¤ªæ˜ç™½ä»€ä¹ˆçŠ¶å†µä¸‹ä¼šæŠ›è¿™ä¸ª<code>exception</code>ã€‚ä½†æ˜¯æ˜¯è¿™ä¸ªå‡½æ•°æœ¬èº«è¢«interruptäº†ã€‚</li>
<li>æœ‰ä¸€ç‚¹ä¸å¤ªæ˜ç™½ï¼Œçº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ï¼Œå¤„äºé˜»å¡çŠ¶æ€æ—¶å€™ï¼Œè¿˜ä¼šæ¥æ”¶æ¶ˆæ¯ï¼Ÿåªæ˜¯ä¸å¤„ç†ï¼Ÿ</li>
<li>åœ¨å®é™…å·¥ä½œä¸­è§£å†³bugç¢°åˆ°äº†è¿™ç»„å‡½æ•°ã€‚äº‹å®ä¸Šå°±æ˜¯è¦ä¸‰ä¸ªä¸€èµ·ç”¨çš„ã€‚<code>awaitTermination</code>åªä¼šè¿”å›ä¸€ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸ä¼šåšä»»ä½•çš„äº‹æƒ…ã€‚æ‰€ä»¥åœ¨è¿™ä¸ªå‡½æ•°è¿”å›falseçš„æ—¶å€™åº”è¯¥è¦è°ƒç”¨<code>shutdownNow</code>æ–¹æ³•æ¥è¿›ä¸€æ­¥ä¸­æ–­çº¿ç¨‹</li>
</ul>
</li>
<li>
<p>å‚è€ƒé“¾æ¥</p>
<ul>
<li><a href="https://blog.csdn.net/u012168222/article/details/52790400" target="_blank" rel="noopener">shutdown æ–¹æ³•</a></li>
<li><a href="https://blog.csdn.net/zaozi/article/details/38854561#commentBox" target="_blank" rel="noopener">ExecutorServiceçš„æ­£ç¡®å…³é—­æ–¹æ³•</a>ï¼š è¿™ç¯‡æ–‡ç« æ¯”å–»å¾—å¾ˆæ¸…æ¥šï¼Œåªæ˜¯ä¸çŸ¥é“æ­£ç¡®ä¸å¦</li>
</ul>
</li>
<li>
<ul>
<li><a href="https://blog.csdn.net/liwenxia626/article/details/80754886" target="_blank" rel="noopener">csdnçš„å¦ä¸€ç¯‡åšå®¢</a></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/03/04/TLS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/03/04/TLS/" class="post-title-link" itemprop="url">TLS - Algorithm</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-03-04 14:50:11" itemprop="dateCreated datePublished" datetime="2019-03-04T14:50:11+08:00">2019-03-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-02-22 15:53:15" itemprop="dateModified" datetime="2021-02-22T15:53:15+08:00">2021-02-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/security/" itemprop="url" rel="index"><span itemprop="name">security</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/03/04/TLS/" class="post-meta-item leancloud_visitors" data-flag-title="TLS - Algorithm" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/03/04/TLS/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/03/04/TLS/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2>
<ul>
<li><a href="https://xz.aliyun.com/t/2526" target="_blank" rel="noopener">SSL/TLSåè®®è¯¦è§£(ä¸Š)ï¼šå¯†ç å¥—ä»¶ï¼Œå“ˆå¸Œï¼ŒåŠ å¯†ï¼Œå¯†é’¥äº¤æ¢ç®—æ³•</a>
<ul>
<li>è‹±æ–‡ç‰ˆ: <a href="https://www.wst.space/ssl-part1-ciphersuite-hashing-encryption/" target="_blank" rel="noopener">SSL/TLS for dummies part 1 : Ciphersuite, Hashing,Encryption</a></li>
</ul>
</li>
<li><a href="https://xz.aliyun.com/t/2530" target="_blank" rel="noopener">SSL/TLSåè®®è¯¦è§£(ä¸­)â€”â€”è¯ä¹¦é¢å‘æœºæ„</a></li>
<li><a href="https://xz.aliyun.com/t/2531" target="_blank" rel="noopener">SSL/TLSåè®®è¯¦è§£(ä¸‹)â€”â€”TLSæ¡æ‰‹åè®®</a></li>
<li>ä»¥ä¸Šæ˜¯ä¸€ä¸ªç³»åˆ—ï¼ŒçœŸçš„æ˜¯è¯¦è§£ï¼Œéå¸¸è¯¦å°½ã€‚</li>
</ul>
<h2 id="ç®—æ³•"><a class="header-anchor" href="#ç®—æ³•"></a>ç®—æ³•</h2>
<ul>
<li>è¿™è¾¹ä¸»è¦æ˜¯å‚è€ƒäº†ä¸Šé¢å‚è€ƒé“¾æ¥é‡Œé¢çš„ç¬¬ä¸€ç¯‡ï¼Œæ€»çš„æ¥è¯´ï¼Œåº”è¯¥äº†è§£ä¸€ä¸‹è¿™äº›</li>
</ul>
<h3 id="å“ˆå¸Œç®—æ³•"><a class="header-anchor" href="#å“ˆå¸Œç®—æ³•"></a>å“ˆå¸Œç®—æ³•</h3>
<ul>
<li>å“ˆå¸Œç®—æ³•ç”Ÿæˆçš„æ•°æ®æ ¼å¼è¢«ç§°ä¸ºæ•£åˆ—ï¼Œæ•£åˆ—ä¸æ˜¯ä¸€ä¸ªå¯é€†çš„è¿‡ç¨‹ã€‚<br>
è€Œä¹‹å‰è¯´è¿‡ï¼Œ<code>Base64</code>åªæ˜¯ç¼–ç ï¼Œé¡¾åæ€ä¹‰ï¼Œç¼–ç åªè¦çŸ¥é“è§„åˆ™ï¼Œæ˜¯å¯ä»¥è§£ç çš„ï¼Œæ²¡æœ‰å®‰å…¨æ€§å¯è¨€ã€‚æ‰€ä»¥ç¼–ç ç®—æ³•å’ŒåŠ å¯†ç®—æ³•ä¸æ˜¯ä¸€å›äº‹æ¥ç€ã€‚</li>
<li>æ‰€ä»¥è®²å¯†ç å“ˆå¸Œä¸€ä¸‹ï¼Œæ˜¯æ²¡æ³•çœ‹å‡ºæ¥åŸå§‹å¯†ç æ˜¯ä»€ä¹ˆçš„ã€‚</li>
<li>è¿™è¾¹å¯ä»¥æ‰©å±•ï¼Œè¿›ä¸€æ­¥ç ”ç©¶çš„æ˜¯ï¼Œå¦‚æœè¿›è¡Œæ”»å‡»çš„è¯ï¼Œç§°ä¸ºå­—å…¸æ”»å‡»ï¼Œå°±æ˜¯çŒœå¯†ç ï¼Œå°†å¸¸ç”¨çš„ï¼Œå¯èƒ½å‡ºç°çš„å¯†ç éƒ½å“ˆå¸Œç®—æ³•ä¸€ä¸‹ï¼Œå»å¯¹æ¯”ã€‚</li>
<li>å“ˆå¸Œç®—æ³•æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚<code>MD5</code>æ˜¯ä¸€ç§ï¼Œè™½ç„¶ä¹‹å‰è¯´å°±æ˜¯æå–æ‘˜è¦çš„ã€‚<code>SHA-512</code>æ˜¯å¦ä¸€ç§ã€‚</li>
</ul>
<h3 id="åŠ å¯†ç®—æ³•"><a class="header-anchor" href="#åŠ å¯†ç®—æ³•"></a>åŠ å¯†ç®—æ³•</h3>
<ul>
<li><em>Encryption lies in between hashing and encoding</em> åŠ å¯†å¯ä»¥ä»»åŠ¡æ˜¯ä»‹äºå“ˆå¸Œå’Œç¼–ç ä¹‹é—´ã€‚å®ƒæ˜¯å¯ä»¥è¢«è§£å¯†çš„ï¼Œä½†æ˜¯å¹¶ä¸ä¼šåƒè§£ç é‚£ä¹ˆç®€å•</li>
<li>åŠ å¯†ç®—æ³•å¯ä»¥åˆ†ä¸ºå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ä¸¤ç§</li>
</ul>
<h4 id="å¯¹ç§°åŠ å¯†"><a class="header-anchor" href="#å¯¹ç§°åŠ å¯†"></a>å¯¹ç§°åŠ å¯†</h4>
<ul>
<li><code>DES</code>å°±æ˜¯æŒ‡å¯¹ç§°åŠ å¯†</li>
<li>ä¸»è¦æ¥è‡ªå‚è€ƒé“¾æ¥ä¸€ï¼Œ å¯¹ç§°åŠ å¯†çš„è¯ï¼Œæ–‡ç« ä¸­ç”¨ä¸€ä¸ªä¾‹å­æ¥è®²è§£ï¼šâ€œç§»ä½â€ã€‚æ¯”å¦‚æœ‰æ•°å­—&quot;123&quot;ï¼Œå¯¹å…¶è¿›è¡ŒåŠ å¯†ï¼Œéƒ½å¢å¤§3ï¼Œæˆä¸ºâ€œ456â€ï¼Œå°±æ˜¯å¯¹ç§°åŠ å¯†äº†ã€‚</li>
<li>å…¶ä¸­çš„æ•°å­—3å°±æ˜¯<code>Encryption key (symmetric key)</code>ã€‚å¯¹ç§°åŠ å¯†çš„æ—¶å€™ï¼ŒçŸ¥é“<code>key</code>çš„è¯ï¼Œå°±å¯ä»¥è¿›è¡Œè§£å¯†äº†ã€‚</li>
<li><em>Anyone who knows the encryption key and can apply the reverse of Caesarâ€™s algorithm and retrieve the original Plaintext.</em> å‡¯æ’’ç®—æ³•å°±æ˜¯ä¸Šé¢è¿™ç§æ„å‘³å¼çš„åŠ å¯†ç®—æ³•ã€‚</li>
<li>æœ‰æ­¤å¯çŸ¥ï¼Œåœ¨<code>TLS</code>ä¸­ä½¿ç”¨ç®€å•çš„å¯¹ç§°åŠ å¯†ä¸æ˜¯å¾ˆå®‰å…¨çš„ã€‚æ¯•ç«ŸçŸ¥é“<code>Encryption key</code>å°±å¯ä»¥è¿›è¡Œè§£å¯†äº†ã€‚<br>
å¯¹ç§°åŠ å¯†ä¸€ä»£ä»£å‘å±•ï¼Œç°åœ¨ä¹Ÿæœ‰æ¯”è¾ƒå¤æ‚çš„ç®—æ³•ï¼Œæ¯”å¦‚<code>Triple Data Encryption Algorithm</code>ï¼Œåé¢å¯ä»¥å†è¿›ä¸€æ­¥ç ”ç©¶ã€‚AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†ï¼‰å’Œ3DESï¼ˆä¸‰é‡æ•°æ®åŠ å¯†ç®—æ³•ï¼‰çš„å¤æ‚ç®—æ³•ä¹Ÿæ˜¯æœ‰çš„</li>
<li>ä»è¿‡ç¨‹å¯ä»¥çŸ¥é“ï¼Œ<code>key</code>æ˜¯éå¸¸å…³é”®çš„ã€‚ä½†æ˜¯ç”±äºæ˜¯å¯¹ç§°åŠ å¯†è§£å¯†ï¼ŒåŒæ–¹å¿…é¡»éƒ½çŸ¥é“çº¦å®šçš„å€¼ï¼Œé‚£ä¹ˆç¬¬ä¸€æ­¥å°±æ˜¯ä¼ é€’<code>key</code>ï¼Œè€Œè¿™ä¸ªæ—¶å€™æ˜¯æ²¡æ³•åŠ å¯†çš„ã€‚æ‰€ä»¥å°±å‡ºç°äº†ä¸å¯¹ç§°åŠ å¯†ã€‚<em>So we need a secure mechanism to exchange the keys without an attacker actually seeing it. There comes the role of Asymmetric Key Encryption.</em></li>
<li>åœ¨<code>TLS</code>ä¸­ï¼Œä¼ è¾“å’Œæ¥æ”¶æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚äº‹å®ä¸Šï¼Œå¾ˆå¯èƒ½å¤§éƒ¨åˆ†éƒ½æ˜¯ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†ã€‚ä¸å¯¹ç§°åŠ å¯†æ¶‰åŠåŒå¯†é’¥æ¶æ„å¹¶ä¸”å¯†é’¥é•¿åº¦é€šå¸¸å¾ˆå¤§ï¼Œå› æ­¤åŠ å¯†-è§£å¯†å¼€é”€éå¸¸é«˜ã€‚ä¸å¯¹ç§°å¯†é’¥åŠ å¯†ç›¸æ¯”ï¼Œå®ƒéœ€è¦æ›´å¤šçš„æ—¶é—´å’Œ<code>CPU</code>å æœ‰ç‡ã€‚</li>
</ul>
<h4 id="ä¸å¯¹ç§°åŠ å¯†"><a class="header-anchor" href="#ä¸å¯¹ç§°åŠ å¯†"></a>ä¸å¯¹ç§°åŠ å¯†</h4>
<ul>
<li>1976å¹´ï¼ŒWhitfield Diffieå’ŒMartin Hellmané¦–æ¬¡æå‡ºäº†éå¯¹ç§°åŠ å¯†çš„æ¦‚å¿µï¼Œè¯¥ç®—æ³•è¢«ç§°ä¸º<code>Diffie-Hellman</code>å¯†é’¥äº¤æ¢ã€‚ç„¶ååœ¨1978å¹´ï¼Œéº»çœç†å·¥å­¦é™¢çš„Ron Rivestï¼ŒAdi Shamirå’ŒLeonard Adlemanå‘è¡¨äº†<code>RSA</code>ç®—æ³•ã€‚</li>
<li>ä¸å¯¹ç§°åŠ å¯†çš„ç®€å•è§£é‡Šå°±æ˜¯ï¼šç”¨ä¸åŒçš„<code>key</code>æ¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚</li>
<li>éå¯¹ç§°åŠ å¯†ä¹Ÿç§°ä¸ºå…¬é’¥åŸºç¡€ç»“æ„ï¼Œåˆç§°<code>PKI public key ixxx</code></li>
<li>ä¸å¯¹ç§°åŠ å¯†é€šå¸¸ç”¨äºåœ¨åˆšå¼€å§‹ä¼ è¾“å¯¹ç§°åŠ å¯†çš„<code>key</code>çš„æ—¶å€™</li>
<li>å…¬é’¥ç”¨æ¥ç»™å¯¹æ–¹ä½¿ç”¨ï¼Œæ¯”å¦‚Aæƒ³ç»™Bå‘æ¶ˆæ¯ï¼Œé‚£ä¹ˆAéœ€è¦ä½¿ç”¨Bçš„å…¬é’¥æ¥åŠ å¯†è‡ªå·±çš„æ¶ˆæ¯ã€‚<br>
æ‰€ä»¥å…¬é’¥æ˜¯å¯ä»¥ä¸ä»»ä½•æƒ³ä¸ä½ é€šä¿¡çš„äººå…±äº«çš„ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œåœ¨å…¬é’¥ä¸­ä¼šæŒ‡å®šä½¿ç”¨ä½•ç§åŠ å¯†ç®—æ³•ã€‚ <em>å¦‚æœå¯†é’¥å¯¹æ˜¯ä½¿ç”¨RSAç®—æ³•ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆå®ƒä»¬åº”è¯¥åœ¨åŠ å¯†æ•°æ®æ—¶ä½¿ç”¨ç›¸åŒçš„ç®—æ³•ã€‚</em></li>
<li>ç§é’¥ç”¨æ¥è§£å¯†æ”¶åˆ°çš„æ¶ˆæ¯ã€‚æ¯”å¦‚Aæ”¶åˆ°äº†ä¸€æ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆAåº”å½“ä½¿ç”¨è‡ªå·±çš„ç§é’¥æ¥è§£å¯†æ”¶åˆ°çš„æ¶ˆæ¯</li>
<li>éå¯¹ç§°åŠ å¯†ç®—æ³•é™¤äº†<code>RSA</code>ã€<code>Diffie-Hellmanå¯†é’¥äº¤æ¢</code>ã€<code>ECDHï¼ˆElliptic Curve Diffie-Hellmanï¼‰</code>ã€<code>SRPï¼ˆå®‰å…¨è¿œç¨‹å¯†ç ï¼‰</code>ä»¥åŠç”±TLS 1.2æ”¯æŒå¯†é’¥äº¤æ¢ç®—æ³•<code>PSKï¼ˆPre Shared Keyï¼‰</code>ã€‚æ€»ä¹‹ï¼Œä¹Ÿæ˜¯æœ‰ä¸€å¤§å †çš„</li>
</ul>
<h5 id="rsaç®—æ³•ç»†èŠ‚"><a class="header-anchor" href="#rsaç®—æ³•ç»†èŠ‚"></a>RSAç®—æ³•ç»†èŠ‚</h5>
<ul>
<li>æ‰€ä»¥<code>RSA</code>ç®—æ³•æœ‰å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ç»„æˆï¼Œç§é’¥ï¼Œå…¬é’¥ï¼ŒåŠ å¯†ç®—æ³•å’Œè§£å¯†ç®—æ³•</li>
<li>é‚£ä¹ˆä¸€ä¸ªä¸¥è‚ƒçš„é—®é¢˜å°±æ˜¯ï¼Œä¸åŒçš„é’¥åŒ™è¿›è¡Œè®¡ç®—çš„æ¶ˆæ¯ï¼Œæ€ä¹ˆèƒ½å¤Ÿè§£å¼€å‘¢ï¼Ÿæ¥ä¸‹æ¥å°±æ˜¯æ•°å­¦è¯¾çš„æ—¶é—´äº†ã€‚
<ul>
<li>å‚è€ƒé“¾æ¥ï¼š
<ul>
<li><a href="https://blog.csdn.net/dbs1215/article/details/48953589" target="_blank" rel="noopener">å¸¦ä½ å½»åº•ç†è§£RSAç®—æ³•åŸç†</a></li>
<li><a href="https://www.zhihu.com/question/25038691" target="_blank" rel="noopener">RSA ç®—æ³•çš„åŠ å¯†åŸç†æ˜¯ä»€ä¹ˆ,çŸ¥ä¹é—®ç­”</a></li>
</ul>
</li>
<li>äº’è´¨æ•°ï¼š åªæœ‰ä¸€ä¸ªå…¬å› å­ä¸º1çš„æ•°ã€‚æ¯”å¦‚6å’Œ9ï¼Œéƒ½æœ‰å…¬å› å­ä¸º3ï¼Œé‚£ä¹ˆå°±ä¸æ˜¯äº’è´¨æ•°ï¼›è€Œ7å’Œ9åªæœ‰å…¬å› å­ä¸º1ï¼Œå°±æ˜¯äº’è´¨æ•°ã€‚</li>
<li>æ¬§æ‹‰å‡½æ•°ï¼š<code>Ï†(n)</code>ã€‚ å°äºæˆ–ç­‰äºnçš„æ­£æ•´æ•°ä¸­ä¸näº’è´¨çš„æ•°çš„æ•°ç›®ã€‚</li>
<li>ä¸‰ä¸ªæ¨ªçº¿çš„å¥‡æ€ªç­‰å·æ˜¯æ’ç­‰äºã€‚</li>
<li>ç”Ÿæˆå…¬é’¥ï¼šéšæœºé€‰å–ä¸¤ä¸ªè´¨æ•°<code>p1ã€p2</code>ï¼Œ<code>n=p1*p2</code>ï¼Œå†éšæœºé€‰å–ä¸€ä¸ªæ•´æ•°<code>e</code>ï¼Œ<code>e</code>ä¸<code>Ï†(n)</code>äº’è´¨ã€‚å…¬é’¥å°±æ˜¯<code>(e, n)</code>ã€‚</li>
<li>æ ¹æ®æ¬§æ‹‰å‡½æ•°å®šç†ï¼Œ<code>Ï†(n) = (p1-1)*(p2-1)</code></li>
<li>è´¹é©¬å®šç†ï¼šè‹¥pæ˜¯ç´ æ•°ï¼Œaä¸päº’ç´ ï¼Œåˆ™<code>a^(p-1ï¼‰â‰¡1 ï¼ˆmod pï¼‰</code> æ²¡çœ‹æ‡‚è¿™ä¸ªè´¹é©¬å®šç†</li>
<li>åŠ å¯†ç®—æ³•ï¼šå‡è®¾<code>m</code>ä¸ºéœ€è¦åŠ å¯†çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆ<code>(m^e) mod n</code>å°±åŠ å¯†å¥½äº†ï¼Œç”ŸæˆåŠ å¯†åçš„ä¿¡æ¯<code>c</code></li>
<li>è§£å¯†ç®—æ³•ï¼š è§£å¯†ç®—æ³•å…¶å®å’ŒåŠ å¯†ç®—æ³•çš„å…¬å¼æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œåªæ˜¯è¿™é‡Œçš„<code>m</code>å’Œ<code>e</code>æ¢æˆ<code>c</code>å’Œ<code>d</code>ï¼Œæˆä¸º<code>(c^d) mod n</code>ã€‚ç›¸å½“äºé‡‡ç”¨å…¬å¼éƒ½æ˜¯<code>(x^y) mod n</code>ï¼Œæ‰€ä»¥å…¶å®ä½¿ç”¨çš„å…¬å¼æ˜¯ä¸€æ ·çš„</li>
<li>é‚£ä¹ˆè¿™é‡Œçš„<code>(d, n)</code>å°±è¢«æˆä¸ºç§é’¥ã€‚é‚£ä¹ˆå¦‚ä½•å¾—åˆ°<code>d</code>å‘¢ï¼Ÿçƒ§è„‘çš„æ•°å­¦å°±æ¥äº†ã€‚æœç„¶æ•°å­¦ç³»æ‰æœ‰å‰é€”å•Š ğŸ˜‚ å®åœ¨æ˜¯é¢‡ä¸ºçƒ§è„‘å•Šã€‚</li>
<li>å„ä¸ªå‚è€ƒé“¾æ¥ä¸­å‡æœ‰å®é™…çš„ä¾‹å­ï¼Œæˆ‘è¿™é‡Œå°±ä¸å†çƒ§è„‘æ¥çœ‹äº†</li>
<li>å‚è€ƒé“¾æ¥ï¼š
<ul>
<li><a href="https://blog.csdn.net/qq_38313548/article/details/85387466" target="_blank" rel="noopener">å¦‚ä½•è·å¾—d</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>(c^d) mod n = ((m^e)mod n)^d mod n = (m^ed) mod n = m
(m^Ï†(n)) mod nâ‰¡1 åˆ 1^kâ‰¡1, æ‰€ä»¥(m^k*Ï†(n)) mod nâ‰¡1 ï¼Œæ‰€ä»¥(m^(k*Ï†(n)+1)) mod nâ‰¡m
ç»“åˆä»¥ä¸Šä¸¤æ¡ï¼Œed=k*Ï†(n)+1 , d=(k*Ï†(n)+1)/e
</code></pre>
<h5 id="dhå’Œrsaçš„åŒºåˆ«"><a class="header-anchor" href="#dhå’Œrsaçš„åŒºåˆ«"></a>DHå’ŒRSAçš„åŒºåˆ«</h5>
<ul>
<li>æœ‰ä¸€æœ¬ä¹¦ï¼Œå«åšâ€œå›¾è§£å¯†ç æŠ€æœ¯â€ï¼Œ</li>
<li><code>RSA</code>åˆ©ç”¨æœ€å¤§å…¬çº¦æ•°ï¼ˆäº’è´¨ï¼‰æ¥æ±‚å‡ºå…¬é’¥å’Œç§é’¥ã€‚<code>DHå¯†é’¥åå•†</code>åˆ™æ˜¯åˆ©ç”¨ç”Ÿæˆå…ƒæ¥å¾—åˆ°å…±äº«å¯†é’¥ã€‚</li>
<li>åœ¨ç¬¬ä¸€ç¯‡å‚è€ƒé“¾æ¥ä¸­æœ‰<code>DH</code>ç®—æ³•çš„è¯¦ç»†æ•°å­¦è¿‡ç¨‹ï¼Œæš‚æ—¶ç•¥è¿‡ï¼Œè¿™äº›éœ€è¦æ•°å­¦åŸºç¡€å•Šã€‚</li>
</ul>
<h3 id="ç­¾åç®—æ³•"><a class="header-anchor" href="#ç­¾åç®—æ³•"></a>ç­¾åç®—æ³•</h3>
<h4 id="eddsa"><a class="header-anchor" href="#eddsa"></a>EdDSA</h4>
<ul>
<li>å·¥ä½œä¸­ç¢°åˆ°çš„é—®é¢˜ï¼Œ<code>SSHD</code>ä¸€ç›´åœ¨æŠ¥<code>EdDSA</code>ç®—æ³•çš„<code>provider</code>æ²¡æœ‰: <code>EdDSA provider not supported</code></li>
<li><a href="https://stackoverflow.com/questions/65566138/apache-mina-sshd-ssh-client-always-prints-eddsa-provider-not-supported" target="_blank" rel="noopener">EdDSA provider not supported</a> è¿™ä¸ªé“¾æ¥é‡Œé¢è¯¦å°½æè¿°äº†è¿™ä¸ªé—®é¢˜</li>
<li>å‡ ä¸ªè§£å†³æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯åƒä¸Šè¿°é“¾æ¥é‡Œé¢æè¿°çš„ï¼Œå¼•å…¥æ–°çš„ä¾èµ–åŒ…ï¼Œå¦ä¸€ä¸ªï¼Œæ˜¯åœ¨å®¢æˆ·ç«¯å¯åŠ¨çš„æ—¶å€™ï¼Œä¸è¦ç”¨<code>default</code>çš„ç®—æ³•åº“ï¼Œè€Œæ˜¯è‡ªå·±é…ç½®å¯ç”¨çš„ç®—æ³•ã€‚</li>
<li><code>EdDSA</code>ç®—æ³•çš„ç»†èŠ‚æ²¡æœ‰æ·±ç©¶ï¼Œé‡Œé¢éƒ½æ˜¯æ•°å­¦ç›¸å…³ï¼Œä»€ä¹ˆä½¿ç”¨äº†çˆ±å¾·åæ›²çº¿ã€‚æ¯”<code>EcDSA</code>è¦å…ˆè¿›</li>
<li><a href="https://www.cnblogs.com/chinareny2k/archive/2010/03/02/1676238.html" target="_blank" rel="noopener">JAVA å¯†ç æŠ€æœ¯åŸºç¡€</a>é‡Œé¢æåˆ°äº†æ‰€è°“çš„<code>provider</code>ï¼Œå…¶ä¸­çš„<code>BouncyCastle</code>æ˜¯å¾ˆå¸¸ç”¨çš„ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œè€Œ<code>EdDSA</code>ç®—æ³•å°±æ˜¯å…¶ä¸­å®ç°çš„ã€‚</li>
<li>å…³äº<code>BounctCastle</code>å¯çœ‹<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1305362418368545" target="_blank" rel="noopener">BounctCastle</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/02/27/K8s%E6%A6%82%E5%BF%B5%E7%90%86%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/02/27/K8s%E6%A6%82%E5%BF%B5%E7%90%86%E8%A7%A3/" class="post-title-link" itemprop="url">K8sæ¦‚å¿µç†è§£</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-02-27 14:44:21" itemprop="dateCreated datePublished" datetime="2019-02-27T14:44:21+08:00">2019-02-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-11-09 16:15:54" itemprop="dateModified" datetime="2020-11-09T16:15:54+08:00">2020-11-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/02/27/K8s%E6%A6%82%E5%BF%B5%E7%90%86%E8%A7%A3/" class="post-meta-item leancloud_visitors" data-flag-title="K8sæ¦‚å¿µç†è§£" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/02/27/K8s%E6%A6%82%E5%BF%B5%E7%90%86%E8%A7%A3/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/02/27/K8s%E6%A6%82%E5%BF%B5%E7%90%86%E8%A7%A3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="k8sæ¦‚å¿µ"><a class="header-anchor" href="#k8sæ¦‚å¿µ"></a>K8sæ¦‚å¿µ</h2>
<p>è¿™ç¯‡æ˜¯ä»K8sçš„å¸¸ç”¨å‘½ä»¤åˆ†å‡ºæ¥çš„ï¼Œå®åœ¨æ˜¯æ¦‚å¿µæ¯”è¾ƒå¤šï¼Œè·Ÿå¸¸ç”¨å‘½ä»¤æ‚åœ¨ä¸€èµ·ä¸åˆé€‚äº†ã€‚</p>
<h3 id="namespace"><a class="header-anchor" href="#namespace"></a>namespace</h3>
<ul>
<li>
<p>å½“å›¢é˜Ÿæˆ–é¡¹ç›®ä¸­å…·æœ‰è®¸å¤šç”¨æˆ·æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨Namespaceæ¥åŒºåˆ†ã€‚</p>
</li>
<li>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç›¸åŒNamespaceä¸­çš„å¯¹è±¡å°†å…·æœ‰ç›¸åŒçš„è®¿é—®æ§åˆ¶ç­–ç•¥ã€‚</p>
</li>
<li>
<p>Kubernetesä»ä¸¤ä¸ªåˆå§‹çš„Namespaceå¼€å§‹ï¼š</p>
<ul>
<li>
<p>default</p>
</li>
<li>
<p>kube-system ç”±Kubernetesç³»ç»Ÿåˆ›å»ºçš„å¯¹è±¡çš„Namespace</p>
</li>
<li>
<p>è‡ªå·±ç”µè„‘ä¸Šé¢è£…å¥½çš„docker for desktopé‡Œé¢æœ‰ä»¥ä¸‹çš„namespace</p>
<pre><code>$ kubectl get namespaces
NAME           STATUS    AGE
default        Active    15d
docker         Active    15d
kube-public    Active    15d
kube-system    Active    15d
</code></pre>
</li>
</ul>
</li>
<li>
<p>å¤§å¤šæ•°<code>Kubernetes</code>èµ„æºï¼ˆä¾‹å¦‚<code>pod</code>ã€<code>services</code>ã€<code>replication controllers</code>æˆ–å…¶ä»–ï¼‰éƒ½åœ¨æŸäº›Namespaceä¸­ï¼Œä½†Namespaceèµ„æºæœ¬èº«å¹¶ä¸åœ¨Namespaceä¸­ã€‚è€Œä½çº§åˆ«èµ„æºï¼ˆå¦‚<code>Node</code>å’Œ<code>persistentVolumes</code>ï¼‰ä¸åœ¨ä»»ä½•Namespaceä¸­ã€‚</p>
</li>
<li>
<p><code>Events</code>æ˜¯ä¸€ä¸ªä¾‹å¤–ï¼šå®ƒä»¬å¯èƒ½æœ‰ä¹Ÿå¯èƒ½æ²¡æœ‰Namespaceï¼Œå…·ä½“å–å†³äº<code>Events</code>çš„å¯¹è±¡ã€‚</p>
</li>
<li>
<p>å‚è€ƒé“¾æ¥ï¼š<a href="http://docs.kubernetes.org.cn/242.html" target="_blank" rel="noopener">Kubernetes Namespaces</a></p>
</li>
</ul>
<h3 id="deployment"><a class="header-anchor" href="#deployment"></a>deployment</h3>
<ul>
<li>è¿™å‡ è€…çš„å…³ç³»æ¯”è¾ƒå¤æ‚ã€‚è¿˜éœ€è¦è¿›ä¸€æ­¥å»çœ‹ã€‚ç›®å‰å…ˆè®°å½•ä¸€ä¸‹ï¼š<code>deployment</code>æ˜¯å®é™…çš„<code>deploy</code>ï¼Œç„¶å<code>pod</code>æ˜¯æ ¹æ®<code>replica</code>é‡Œé¢çš„è®¾å®šæ¥èµ·çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœå°†<code>deployment</code>åˆ é™¤æ‰ï¼Œé‚£ä¹ˆç›¸åº”çš„<code>pod</code>å’Œ<code>replica set</code>éƒ½ä¼šæ²¡æœ‰</li>
</ul>
<h4 id="deployment-specè¯¦è§£"><a class="header-anchor" href="#deployment-specè¯¦è§£"></a>deployment specè¯¦è§£</h4>
<p>ç½‘ä¸ŠåŸºæœ¬æœç´¢ä¸åˆ°è¿™æ–¹é¢çš„ä¿¡æ¯ã€‚åº”è¯¥æ˜¯yamlæ–‡ä»¶é‡Œé¢çš„å„ä¸ªå­—æ®µå¤ªè¿‡ç›¸ä¼¼äº†ã€‚</p>
<ul>
<li><code>spec</code>è¯¦è§£ï¼š
<ul>
<li><code>metadata</code>ï¼šå…ƒæ•°æ®ï¼ŒåŒ…å«åå­—ï¼Œæ ‡ç­¾å’Œäº§å“å£°æ˜ã€‚å…ƒæ•°æ®å°±æ˜¯è¯´åŸºç¡€ä¿¡æ¯ï¼Œç™½æ</li>
</ul>
</li>
</ul>
<h4 id="deploymentå‚è€ƒé“¾æ¥"><a class="header-anchor" href="#deploymentå‚è€ƒé“¾æ¥"></a>deploymentå‚è€ƒé“¾æ¥</h4>
<ul>
<li><a href="http://www.ruanyifeng.com/blog/2007/03/metadata.html" target="_blank" rel="noopener">å…ƒæ•°æ®å‚è€ƒé“¾æ¥</a></li>
</ul>
<h3 id="pod"><a class="header-anchor" href="#pod"></a>Pod</h3>
<p><code>pod</code>å®åœ¨æ˜¯<code>K8s</code>é‡Œé¢å¾ˆé‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œä¹Ÿæ˜¯å¾ˆå®½æ³›çš„ä¸€ä¸ªæ¦‚å¿µã€‚å¾ˆå¤šéƒ½å¯ä»¥æ˜¯ä¸€ä¸ª<code>pod</code>ã€‚</p>
<ul>
<li>All containers described as Pods.åŒ…æ‹¬replication cotronllerï¼Œ serviceï¼Œ deploymentã€‚<br>
<strong>ä¸çŸ¥é“æ˜¯ä¸æ˜¯æ‰€æœ‰çš„serviceç±»å‹éƒ½ä¼šè¢«å½“åšæ˜¯podï¼Œè¿™ä¸€ç‚¹æœ‰å¾…ç¡®è®¤</strong></li>
<li>A pod is a collection of containers that makes up a particular application, for example Redis.<br>
<strong>è¿™å¥æ²¡æœ‰å¾ˆæ˜ç™½å•Šï¼Œä¸æ˜¯è¯´podæ˜¯ä¸€ä¸ªcontainerå˜›ï¼Œåˆå˜æˆä¸€å †containeräº†</strong><br>
<strong>ç»è¿‡ä¸€æ®µæ—¶é—´çš„å­¦ä¹ ï¼Œæˆ‘æƒ³è¿™é‡Œå¯èƒ½æŒ‡çš„æ˜¯initContainerä¹‹ç±»çš„ï¼Œæ‰€ä»¥ä¸€ä¸ªpodé‡Œé¢å¯èƒ½æ˜¯æœ‰å¾ˆå¤šcontainerçš„</strong></li>
</ul>
<h3 id="services"><a class="header-anchor" href="#services"></a>Services</h3>
<p>serviceæ˜¯K8sé‡Œé¢å¦ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œè€Œä¸”å®åœ¨æ˜¯æœ‰ç‚¹å¤æ‚ã€‚ç±»å‹æ¯”è¾ƒå¤šã€‚K8sä¸­æ–‡æ–‡æ¡£é‡Œé¢çš„åè¯è§£é‡Šè¿˜æ˜¯æ¯”è¾ƒæ¸…æ¥šçš„ï¼Œå¹¶ä¸”ç»™å‡ºäº†ä¸ºä»€ä¹ˆéœ€è¦serviceï¼Œserviceå’Œpodæœ‰ä»€ä¹ˆåŒºåˆ«</p>
<p>æŒªåˆ°å¦ä¸€ç¯‡å•ç‹¬çš„åšå®¢é‡Œé¢äº†ï¼š<a href="https://sallyslove.github.io/hexo_blog/2019/10/11/K8s-Service/">K8s_Service</a></p>
<ul>
<li>å‚è€ƒé“¾æ¥
<ul>
<li><a href="https://www.kubernetes.org.cn/kubernetes-services" target="_blank" rel="noopener">åè¯è§£é‡Š Services</a></li>
</ul>
</li>
</ul>
<h3 id="configmap"><a class="header-anchor" href="#configmap"></a>configmap</h3>
<h4 id="configmapçš„ä½œç”¨"><a class="header-anchor" href="#configmapçš„ä½œç”¨"></a>configmapçš„ä½œç”¨</h4>
<ul>
<li><em>In Kubernetes, a ConfigMap is simply a container for storing configuration data. Other things, like pods, can access the data in a ConfigMap.</em></li>
</ul>
<h4 id="åˆ›å»ºconfigmap"><a class="header-anchor" href="#åˆ›å»ºconfigmap"></a>åˆ›å»ºconfigmap</h4>
<ul>
<li>
<p>å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œåˆ›å»º<code>kubectl create configmap</code>,å½“ç„¶ä¹Ÿå¯ä»¥ç”¨<code>yaml</code>æ–‡ä»¶çš„æ–¹å¼åˆ›å»ºã€‚</p>
</li>
<li>
<p>ä»¥ä¸‹çš„ä¾‹å­é‡Œé¢æ˜¯ç›´æ¥ç»™å‡ºäº†ä¸€ä¸ªé”®å€¼å¯¹ï¼Œäº‹å®ä¸Šï¼Œå¯ä»¥ä»æ–‡ä»¶<code>--from-file</code>æˆ–è€…ç›®å½•æ¥åˆ›å»º</p>
<pre><code>$ kubectl create configmap special-config --from-literal=special.how=very
configmap &quot;special-config&quot; created
$ kubectl get configmap special-config -o go-template='{{.data}}'
map[special.how:very]
</code></pre>
</li>
<li>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<ul>
<li><a href="https://www.jianshu.com/p/b1d516f02ecd" target="_blank" rel="noopener">k8s â€“ ConfigMap</a></li>
</ul>
</li>
</ul>
<h4 id="podè°ƒç”¨configmap"><a class="header-anchor" href="#podè°ƒç”¨configmap"></a>PODè°ƒç”¨configmap</h4>
<ul>
<li><code>configmap</code>é‡Œé¢æ˜¯æ–‡ä»¶çš„è¯ï¼Œå¯ä»¥è¿›è¡ŒåŠ è½½ç›®å½•ï¼Œçœ‹ä¸‹é¢å·çš„æ®µè½</li>
</ul>
<h3 id="volume"><a class="header-anchor" href="#volume"></a>Volume</h3>
<ul>
<li>è¿™ä¸ªå•è¯çš„å«ä¹‰æ„Ÿè§‰çœŸæ˜¯å¥‡æ€ªï¼Œç¿»è¯‘æˆä¸­æ–‡æ˜¯å·ï¼Œå·å’Œç£ç›˜æœ‰ä»€ä¹ˆå…³ç³»å“¦ï¼Œæˆ‘åªæƒ³åˆ°äº†èŠ±å·ã€‚ğŸ˜†</li>
<li>æ€»çš„æ¥è¯´ï¼Œå·å°±æ˜¯æ‰€æœ‰å®¹å™¨éƒ½å¯ä»¥è®¿é—®çš„ç£ç›˜ç©ºé—´ï¼Œå¹¶ä¸”åœ¨<code>pod</code>é‡å¯ä¹‹åå†…å®¹ä»æ—§å­˜åœ¨</li>
<li>å‚è€ƒ<a href="https://blog.51cto.com/3842834/2320539" target="_blank" rel="noopener">ä¸¤ç§å¸¸è§ç±»å‹çš„Volumeæ·±åº¦å®è·µ</a></li>
</ul>
<h4 id="emptydir"><a class="header-anchor" href="#emptydir"></a>emptyDir</h4>
<ul>
<li>ç®€å•çš„åœ¨<code>pod</code>çš„é‡Œé¢è¿›è¡Œå®šä¹‰ï¼Œä¸åˆ»æ„æŒ‡å®šç±»å‹ï¼Œå°±æ˜¯è¿™ä¸ªç±»å‹</li>
<li>å®Œå…¨å°±æ˜¯ä¸€ä¸ªç©ºç›®å½•</li>
<li>é»˜è®¤ä¸ºç©ºï¼ˆå¦‚æœè¯¥ç›®å½•åŸæ¥æœ‰æ–‡ä»¶ä¹Ÿä¼šè¢«é‡ç½®ä¸ºç©ºï¼‰</li>
</ul>
<pre><code>apiVersion: v1
kind: Pod
metadata:
  name: test-pd
spec:
  containers:
  - image: ...
    name: ...
    volumeMounts:
    - mountPath: /cache
      name: cache-volume
  volumes:
  - name: cache-volume
    emptyDir: {}
</code></pre>
<h4 id="configmapæ–¹å¼"><a class="header-anchor" href="#configmapæ–¹å¼"></a>configMapæ–¹å¼</h4>
<ul>
<li>
<p><code>configMap</code>ä¹Ÿå¯ä»¥ç”¨æ¥åŠ è½½å·å·ï¼ŒåŠ è½½çš„æ—¶å€™è¿˜å¯ä»¥æŒ‡å®šæƒé™ã€‚å®ä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code>apiVersion: v1
kind: Pod
metadata:
  name: configmap-pod
spec:
  containers:
    - name: ...
      image: ...
      volumeMounts:
        - name: config-vol
          mountPath: /etc/config
  volumes:
    - name: config-vol
      configMap:
        name: log-config
        defaultMode: 420
</code></pre>
</li>
<li>
<p>é»˜è®¤çš„æƒé™åº”è¯¥æ˜¯<code>420</code>ï¼Œåº”è¯¥æ˜¯<code>read only</code>ï¼Œåœ¨å·¥ä½œä¸­æ˜¯åŠ è½½äº†ä¸€ä¸ª<code>SHELLè„šæœ¬</code>ï¼Œæ‰€ä»¥å°†æƒé™ä¿®æ”¹ä¸º<code>0755</code>ï¼Œç„¶åå°±å¯ä»¥åœ¨ä»£ç é‡Œé¢è°ƒç”¨äº†ã€‚ å¯å‚è€ƒ<a href="https://cloud.tencent.com/developer/ask/230096" target="_blank" rel="noopener">k8s configMap æŒ‚è½½ç›®å½• æƒé™ 420</a></p>
</li>
</ul>
<h3 id="secrets"><a class="header-anchor" href="#secrets"></a>secrets</h3>
<h3 id="persistentvolumnclumns"><a class="header-anchor" href="#persistentvolumnclumns"></a>PersistentVolumnClumns</h3>
<ul>
<li><code>PVC</code>åœ¨å®šä¹‰çš„æ—¶å€™æœ‰ä¸ª<code>storageclass</code>ã€‚è¿™ä¸ª<code>storageclass</code>æ˜¯å®šä¹‰åœ¨<code>kube-system</code>çš„<code>namespace</code>é‡Œé¢çš„</li>
<li>åœ¨å®‰è£…æ—¶å€™ï¼Œ<code>share C</code>ç›˜é‡åˆ°äº†é—®é¢˜ï¼Œç”¨<code>docker for desktop</code>çš„é»˜è®¤çš„<code>storageclass</code>ï¼š<code>hostpath</code>æ¥åˆ›<code>PVC</code>ï¼Œå°±èµ·ä¸æ¥äº†ã€‚äºæ˜¯åœ¨å¤§ç¥çš„æ•™å¯¼ä¸‹å¦åˆ›äº†ä¸€ä¸ª<code>StorageClass</code>ï¼Œå°†å…¶æ˜ å°„åˆ°<code>docker machine</code>çš„è™šæœºé‡Œé¢ã€‚è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</li>
<li>åœ¨å°è¯•è§£å†³è¿™ä¸ªCç›˜æ²¡æ³•shareçš„é—®é¢˜æ—¶å€™å‚è€ƒäº†å¾ˆå¤šèµ„æ–™ã€‚å·¥ä½œç”µè„‘ç”±äºç³»ç»Ÿå…³ç³»ï¼Œæ²¡æœ‰åŠæ³•åˆ›å»º<code>administrator group</code>çš„<code>user</code>ï¼Œæ‰€ä»¥ç»•ä¸è¿‡å»ã€‚</li>
<li>å‚è€ƒçš„é“¾æ¥æœ‰ï¼š
<ul>
<li><a href="https://dotblogs.com.tw/swater111/2017/01/26/101009" target="_blank" rel="noopener">share Cç›˜æ€»ç»“</a>ï¼šè¿™ç¯‡èµ„æ–™è¿˜æ˜¯ä¸é”™çš„ï¼Œé‡Œé¢æ±‡æ€»äº†å¯èƒ½é‡åˆ°çš„å¥½å‡ ä¸ªé—®é¢˜ã€‚</li>
<li><a href="https://blogs.msdn.microsoft.com/stevelasker/2016/06/14/configuring-docker-for-windows-volumes/" target="_blank" rel="noopener">share Cç›˜å®¶é‡Œå’‹æ•´</a></li>
<li><a href="https://tomssl.com/2018/01/11/sharing-your-c-drive-with-docker-for-windows-when-using-azure-active-directory-azuread-aad/" target="_blank" rel="noopener">local useræ–¹æ³•</a></li>
</ul>
</li>
</ul>
<h3 id="replication-controller"><a class="header-anchor" href="#replication-controller"></a>replication controller</h3>
<ul>
<li>The replication controller defines how many instances should be running, the Docker Image to use, and a name to identify the service.<br>
<strong>å†³å®šå¤šå°‘ä¸ªinstanceå¯ä»¥ç†è§£ï¼Œä¸åŒçš„instanceå¯ä»¥ä½¿ç”¨ä¸åŒçš„imageå—</strong></li>
</ul>
<h3 id="ingress"><a class="header-anchor" href="#ingress"></a>Ingress</h3>
<p><code>Ingress</code>çš„å†…å®¹æŒªåˆ°æ–°çš„ä¸€ç¯‡åšå®¢é‡Œé¢å»äº†ï¼š<a href="https://sallyslove.github.io/hexo_blog/2020/02/11/K8s-Ingress/">K8s-Ingress</a></p>
<h3 id="daemonset"><a class="header-anchor" href="#daemonset"></a>DaemonSet</h3>
<ul>
<li>ä¸€ä¸ª<code>DaemonSet</code>å¯¹è±¡èƒ½ç¡®ä¿å…¶åˆ›å»ºçš„<code>Pod</code>åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸€å°ï¼ˆæˆ–æŒ‡å®šï¼‰<code>Node</code>ä¸Šéƒ½è¿è¡Œä¸€ä¸ªå‰¯æœ¬ã€‚</li>
<li>åœ¨<code>Kubernetes 1.8</code>ä¹‹åï¼Œå¿…é¡»æŒ‡å®š<code>.spec.selector</code>æ¥ç¡®å®šè¿™ä¸ª<code>DaemonSet</code>å¯¹è±¡ç®¡ç†çš„<code>Pod</code>ï¼Œé€šå¸¸ä¸<code>.spec.template.metadata.labels</code>ä¸­å®šä¹‰çš„<code>Pod</code>çš„<code>label</code>ä¸€è‡´ã€‚</li>
<li>ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šå‚æ•°è¦æ±‚<code>DaemonSet</code>å°†<code>POD</code>å»ºåœ¨æŒ‡å®šçš„<code>Node</code>ä¸Šé¢ï¼Œç»†èŠ‚çœ‹å‚è€ƒé“¾æ¥é‡Œé¢</li>
</ul>
<h4 id="å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h4>
<ul>
<li><a href="https://www.jianshu.com/p/79981db6d4e6" target="_blank" rel="noopener">K8s â€“ DaemonSet</a></li>
</ul>
<h3 id="custom-resource-definition"><a class="header-anchor" href="#custom-resource-definition"></a>Custom Resource Definition</h3>
<h4 id="custom-resource"><a class="header-anchor" href="#custom-resource"></a>Custom Resource</h4>
<ul>
<li>å®˜æ–¹æ–‡æ¡£è§£é‡Šæœ‰ç‚¹éš¾ä»¥ç†è§£ï¼Œ<em>A resource is an endpoint in the Kubernetes API that stores a collection of API objects of a certain kind. For example, the built-in pods resource contains a collection of Pod objects.</em> ä¸€ä¸ªèµ„æºå°±æ˜¯æŸç§ç±»å‹çš„ç‰©ä½“çš„é›†åˆçš„ç»Ÿç§°ã€‚æ¯”å¦‚<code>pod resource</code>å°±æ˜¯è‡ªå¸¦çš„èµ„æºã€‚</li>
<li>æ‰€ä»¥å°±æ˜¯è¯´è‡ªå·±å®šä¹‰çš„ç±»ä¼¼<code>pod</code>ï¼Œ<code>service</code>ä¹‹ç±»çš„èµ„æºã€‚</li>
</ul>
<h4 id="crd"><a class="header-anchor" href="#crd"></a>CRD</h4>
<ul>
<li>
<p>éƒ¨ç½²ä¸€ä¸ª<code>CRD</code>åˆ°é›†ç¾¤ä¸­ï¼Œ<code>kube-apiserver</code>ä¼šå¸®åŠ©ä½ å®‰è£…å¥½è·¯ç”±å’Œæä¾›è‡ªå®šä¹‰èµ„æºçš„ä¸€èˆ¬æœåŠ¡ç«¯å®ç°ã€‚</p>
</li>
<li>
<p>ä¾‹å­ï¼š</p>
<pre><code>{
&quot;apiVersion&quot;: &quot;apiextensions.k8s.io/v1beta1&quot;,
&quot;kind&quot;: &quot;CustomResourceDefinition&quot;,
...
&quot;spec&quot;: {
  # group name to use for REST API: /apis/&lt;group&gt;/&lt;version&gt;
  &quot;group&quot;: &quot;stable.netease&quot;,
    ...
      &quot;kind&quot;: &quot;Task&quot;,
      # shortNames allow shorter string to match your resource on the CLI
      &quot;shortNames&quot;: [
          &quot;task&quot;
      ]
  }
}
</code></pre>
</li>
</ul>
<h4 id="å‚è€ƒé“¾æ¥-v2"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥-v2"></a>å‚è€ƒé“¾æ¥</h4>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/#custom-resources" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£Custom Resource</a></li>
<li><a href="https://sq.163yun.com/blog/article/193062240727805952" target="_blank" rel="noopener">CRD å’Œ CRå®šä¹‰çš„ä¾‹å­</a></li>
<li><a href="https://k2r2bai.com/2019/10/04/ironman2020/day19/" target="_blank" rel="noopener">K8sçš„æ¶æ„ï¼ŒCRDæ‰€åœ¨ä½ç½®</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/02/26/Helm%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/02/26/Helm%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">Helm</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-02-26 15:50:36" itemprop="dateCreated datePublished" datetime="2019-02-26T15:50:36+08:00">2019-02-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-01-22 10:50:45" itemprop="dateModified" datetime="2020-01-22T10:50:45+08:00">2020-01-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/02/26/Helm%E5%85%A5%E9%97%A8/" class="post-meta-item leancloud_visitors" data-flag-title="Helm" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/02/26/Helm%E5%85%A5%E9%97%A8/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/02/26/Helm%E5%85%A5%E9%97%A8/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="helm"><a class="header-anchor" href="#helm"></a>Helm</h2>
<p><code>Helm</code>å…¥é—¨ç¯‡ã€‚æ„Ÿè§‰æœ‰ç‚¹ç±»ä¼¼<code>maven</code>ï¼Œæ€»å½’æœ‰è¿™æ ·ä¸€ä¸ªç®¡ç†å·¥å…·ã€‚</p>
<p>å†™äº†ä¸€é˜µä¹‹åå†çœ‹çœ‹ï¼Œä¼šå‘ç°æœ‰äº›çœ‹ä¸æ˜ç™½çš„åœ°æ–¹ã€‚æœç„¶ï¼Œæˆ‘å†™åšå®¢çš„é£æ ¼å’Œä¸Šå­¦å¹´ä»£è®°ç¬”è®°çš„é£æ ¼ä¸€æ ·ï¼Œå–œæ¬¢ç®€ç•¥è€Œä¸å¤Ÿè¯¦å°½å•Šã€‚è¿™æ˜¯è¯´å¥½å¤šå¹´æ²¡æœ‰å˜åŒ–å’Œè¿›æ­¥å˜› ğŸ˜‚</p>
<h3 id="helmç‰ˆæœ¬"><a class="header-anchor" href="#helmç‰ˆæœ¬"></a>Helmç‰ˆæœ¬</h3>
<ul>
<li>åœ¨å·¥ä½œä¸­å‘ç°ï¼Œ<code>Helm</code>å‘å±•å¾ˆå¿«ã€‚ä½†æ˜¯ä¹Ÿä»ä¾§é¢è¯´æ˜ç°åœ¨é—®é¢˜å¾ˆå¤šã€‚</li>
<li>æˆ‘ä»¬è‡ªå·±äº§å“é‡Œé¢è¿˜æ˜¯<code>1.x</code>çš„ç‰ˆæœ¬ï¼Œå®é™…å·²ç»å‘å±•åˆ°<code>3.x</code>äº†ã€‚</li>
<li>è€Œä»æ–‡æ¡£æ¥çœ‹ï¼Œ<code>Helm</code>ä»<code>1.x</code>åˆ°<code>3.x</code>å˜åŒ–è¿˜æ˜¯æŒºå¤§çš„ã€‚ç”šè‡³<code>Tiller</code>éƒ½è¢«ç§»é™¤äº†!</li>
<li>ç›®å‰çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä¸åŒçš„ç‰ˆæœ¬æ”¯æŒçš„åŠŸèƒ½æœ‰ä¸€å®šå·®å¼‚ï¼Œç›®å‰å‘ç°çš„æœ‰ï¼š<br>
1ã€æœ‰çš„<code>yaml</code>æ–‡ä»¶åœ¨æ¯”è¾ƒé«˜çš„<code>Helm</code>ç‰ˆæœ¬é‡Œé¢åè€Œæ ¡éªŒä¸è¿‡ã€‚åº”è¯¥æ˜¯æ ¡éªŒçš„è§„åˆ™åŠ å¼ºäº†<br>
2ã€<code>--set-file</code>åœ¨<code>2.10.0</code>ä¹‹å‰å¹¶ä¸æ”¯æŒ</li>
</ul>
<h3 id="helmæ˜¯ä»€ä¹ˆ"><a class="header-anchor" href="#helmæ˜¯ä»€ä¹ˆ"></a>Helmæ˜¯ä»€ä¹ˆ</h3>
<ul>
<li><code>Helm</code>æ˜¯åœ¨Kubernetesä¸­å®‰è£…éƒ¨ç½²å®¹å™¨çš„ä¸€ä¸ªå·¥å…·ã€‚</li>
<li><em>Helm is a tool for managing Kubernetes charts.</em></li>
<li><code>Helm</code>ç”±<code>Helm</code>å®¢æˆ·ç«¯ã€<code>Tiller</code>æœåŠ¡å™¨ç«¯å’Œ<code>Chart</code>ä»“åº“æ‰€ç»„æˆ
<ul>
<li><code>Helm</code>å®¢æˆ·ç«¯ï¼š å®¢æˆ·ç«¯äº¤äº’</li>
<li><code>Tiller</code>æœåŠ¡å™¨ç«¯ï¼š è£…åœ¨k8sçš„clusteré‡Œé¢ï¼Œç®¡ç†<code>chart</code></li>
<li><code>Chart</code>ä»“åº“ï¼šåˆ›å»º<code>Kubernetes</code>åº”ç”¨å®ä¾‹çš„ä¿¡æ¯é›†åˆ
<ul>
<li><code>Chart</code>ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼Œç¬¬ä¸€ä¸ªéƒ¨åˆ†æ˜¯A description of the package (Chart.yaml)</li>
<li>One or more templates, which contain Kubernetes manifest filesã€‚è¿™ä¸ªtemplatesçš„è¯ï¼Œåº”è¯¥ä¹Ÿæ˜¯yamlæ–‡ä»¶å§ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="å¸¸ç”¨çš„helmå‘½ä»¤"><a class="header-anchor" href="#å¸¸ç”¨çš„helmå‘½ä»¤"></a>å¸¸ç”¨çš„helmå‘½ä»¤</h3>
<ul>
<li><code>helm status &lt;namespace&gt;</code> æŸ¥çœ‹<code>Helm</code>çš„çŠ¶æ€</li>
<li><code>helm install</code>: å®é™…å°†<code>helm</code>é‡Œé¢çš„å†…å®¹å®‰è£…åˆ°å½“å‰çš„<code>k8s</code>ä¸Šé¢ã€‚æ¯”å¦‚æˆ‘åˆ›äº†ä¸€ä¸ª<code>configMap.yaml</code>çš„<code>templete</code>ï¼Œé‚£ä¹ˆå°±ä¼šå®‰è£…ä¸Šå»ã€‚
<ul>
<li>å¦‚æœåªæ˜¯æƒ³çœ‹çœ‹<code>template</code>çš„<code>rending</code>ï¼Œé‚£ä¹ˆä½¿ç”¨å‘½ä»¤<code>helm install ./mychart --debug --dry-run</code></li>
<li>å¦‚æœæƒ³ä¼ å€¼è¿›å»ï¼Œå¯ä»¥ä½¿ç”¨<code>-f</code> å‘½ä»¤ï¼Œæ¯”å¦‚<code>helm install -f myvals.yaml ./mychart</code>ã€‚è¿™æ ·ä¼ çš„å€¼ï¼Œå¯ä»¥ç”¨<code>.Value</code>æ¥è®¿é—®</li>
<li>å•ç‹¬ä¼ å€¼æ˜¯<code>--set foo=bar</code>ï¼Œ<code>--set</code>æ¯”æ–‡ä»¶çš„çº§åˆ«é«˜ï¼Œå¯ä»¥è¦†ç›–æ–‡ä»¶é‡Œé¢çš„å€¼</li>
<li>ä»¥ä¸‹å‘½ä»¤é‡Œé¢å°†<code>livenessProbe.httpGet</code>åˆ é™¤æ‰äº†ã€‚ä½†æ˜¯å‚è€ƒä¸Šä¸€ç« çš„<code>Helm</code>ç‰ˆæœ¬çš„æè¿°ï¼Œè¿™ä¸ªåŠŸèƒ½ä¹Ÿæ˜¯åœ¨è¾ƒé«˜çš„ç‰ˆæœ¬é‡Œé¢æ‰å®ç°ã€‚</li>
</ul>
</li>
</ul>
<pre><code>helm install stable/drupal --set image=my-registry/drupal:0.1.0 --set livenessProbe.exec.command=[cat,docroot/CHANGELOG.txt] --set livenessProbe.httpGet=null

$ helm install ./mychart
  NAME:   guiding-ocelot
  LAST DEPLOYED: Mon Aug 19 17:23:00 2019
  NAMESPACE: gear-1
  STATUS: DEPLOYED

  RESOURCES:
      ==&gt; v1/ConfigMap
      NAME               DATA  AGE
      mychart-configmap  1     0s
</code></pre>
<ul>
<li>
<p><code>helm get manifest &lt;release name&gt;</code>: æ¯”å¦‚ä¸Šé¢çš„è¿™ä¸ª<code>guiding-ocelot</code></p>
<pre><code> $ helm get manifest guiding-ocelot

 ---
  # Source: myChart/templates/configmap.yaml
  apiVersion: v1
  kind: ConfigMap
  metadata:
    name: mychart-configmap
  data:
    myvalue: &quot;Hello World&quot;
</code></pre>
</li>
<li>
<p><code>helm init</code>:å®‰è£…tilleræœåŠ¡å™¨ç«¯</p>
<ul>
<li>åœ¨å·¥ä½œä¸­ç¢°åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨åš<code>helm init</code>çš„æ—¶å€™æ²¡æœ‰å¸¦ä¸Š<code>--client-only</code>é€‰é¡¹ï¼Œç»“æœå°†æœåŠ¡å™¨ç«¯çš„<code>Tiller</code>ç»™æ›´æ–°äº†ã€‚</li>
<li>è¯è¯´æˆ‘åœ¨åšå®¢ä¸Šé¢è¿™æ ·å†™äº†å•Šã€‚å…¶å®å®¢æˆ·ç«¯ä¹Ÿæ˜¯æ›´æ–°çš„</li>
</ul>
</li>
<li>
<p><code>helm delete --purge &lt;release name&gt;</code></p>
</li>
<li>
<p><code>helm repo add &lt;repo name&gt; &lt;repo address&gt;</code></p>
</li>
<li>
<p><code>helm create &lt;chart name&gt;</code>: ç”Ÿæˆä¸€ä¸ªç›®å½•</p>
<pre><code>$ find myChart/
  myChart/
  myChart/.helmignore
  myChart/Chart.yaml
  myChart/charts
  myChart/templates
  myChart/templates/deployment.yaml
  myChart/templates/ingress.yaml
  myChart/templates/NOTES.txt
  myChart/templates/service.yaml
  myChart/templates/tests
  myChart/templates/tests/test-connection.yaml
  myChart/templates/_helpers.tpl
  myChart/values.yaml
</code></pre>
</li>
</ul>
<h3 id="helm-chart"><a class="header-anchor" href="#helm-chart"></a>Helm Chart</h3>
<h4 id="helm-chart-dependency-management"><a class="header-anchor" href="#helm-chart-dependency-management"></a>Helm Chart Dependency Management</h4>
<ul>
<li><code>3.x</code>çš„æ—¶å€™ï¼Œ<code>Chart</code>ä¾èµ–å…³é”®ç”±<code>requirements.yaml</code>å’Œ<code>requirements.lock</code>æŒªåˆ°äº†<code>chart.yaml</code>å’Œ<code>chart.lock</code>é‡Œé¢å»äº†ã€‚ä½†æ˜¯è¿˜æ˜¯ä¼šå…¼å®¹<code>1.x</code>çš„<code>requirements.yaml</code>å’Œ<code>requirements.lock</code></li>
<li>ä¸è®º<code>Helm2</code>è¿˜æ˜¯<code>Helm3</code>éƒ½å¯ä»¥ä½¿ç”¨<code>tag</code>æˆ–è€…<code>condition</code>æ¥åŠ²ä¾èµ–çš„æ§åˆ¶ç®¡ç†</li>
</ul>
<pre><code>condition: somechart.enabled
tags:
  - webaccelerator
</code></pre>
<ul>
<li>ä¸è®ºæ˜¯<code>tag</code>è¿˜æ˜¯<code>condition</code>ï¼Œéƒ½éœ€è¦åœ¨<code>values.yaml</code>é‡Œé¢å®šä¹‰ã€‚<code>tag</code>å¿…é¡»æ˜¯<code>global</code>ä¸‹é¢çš„ä¸€å±‚ã€‚è‡ªå·±ä¸ºé¡¶å±‚çš„æ„æ€ã€‚</li>
<li>åŒºåˆ«åœ¨äºï¼Œ<code>tag</code>å¯ä»¥ç”¨äºå¾ˆå¤š<code>subchart</code>ï¼Œå¦‚æœè®¾ä¸º<code>true</code>ï¼Œé‚£ä¹ˆè¢«è¿™ä¸ªæ ‡ç­¾æ ‡ç¤ºçš„<code>subchart</code>éƒ½ä¼šè¢«è£…ä¸Šã€‚è€Œ<code>condition</code>åº”è¯¥æ˜¯åªæœ‰ç¬¬ä¸€ä¸ªä¼šæœ‰æ•ˆã€‚ä½†æ˜¯è¿™ç‚¹éœ€è¦éªŒè¯ä¸€ä¸‹ã€‚<em>Only the first valid path found in the list is evaluated and if no paths exist then the condition has no effect.</em></li>
<li>åœ¨æˆ‘ä»¬äº§å“é‡Œé¢çš„<code>Helm1.x</code>é‡Œé¢ï¼Œè¿™ä¸ªåŠŸèƒ½æœ‰ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜ï¼Œå°±æ˜¯å½“<code>Helm Upgrade</code>ä¹‹åå°±ä¼šå¤±æ•ˆã€‚
<ul>
<li>ç¬¬ä¸€æ¬¡<code>helm upgrade</code>æ—¶å€™å°†<code>somechart.enabled</code>æ”¹ä¸ºäº†<code>true</code>ï¼Œä¹Ÿé¡ºåˆ©åœ°å°†<code>subchart</code>åŠ åˆ°äº†åŒä¸€ä¸ªreleaseé‡Œé¢ã€‚</li>
<li>ä½¿ç”¨<code>helm upgrade</code>ä¿®æ”¹å…¶ä»–å‚æ•°ï¼Œåœ¨ç¬¬ä¸€æ­¥ä¸­è¢«å®‰è£…ä¸Šçš„<code>subchart</code>åˆä¸¢äº†ã€‚å³ä½¿è¿™ä¸ªæ—¶å€™<code>somechart.enabled</code>å‚æ•°åœ¨<code>helm get values</code>é‡Œé¢ä»æ—§ç»´æŒç€<code>true</code></li>
<li>åœ¨ç½‘ä¸Šä¹Ÿçœ‹åˆ°ä¸€äº›ç±»ä¼¼çš„é—®é¢˜ï¼š
<ul>
<li><a href="https://github.com/helm/helm/issues/3796" target="_blank" rel="noopener">condition problem</a></li>
<li><a href="https://github.com/helm/helm/issues/6313" target="_blank" rel="noopener">helm upgrade issue</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="helm-template"><a class="header-anchor" href="#helm-template"></a>Helm Template</h3>
<ul>
<li>å‚è€ƒä»¥ä¸Šï¼Œé»˜è®¤ç”Ÿæˆä¸€å¥—chartçš„æ—¶å€™ä¼šç”Ÿæˆtemplateç›®å½•ã€‚
<ul>
<li><em>NOTES.txt: The â€œhelp textâ€ for your chart. This will be displayed to your users when they run helm install.</em></li>
<li><em>deployment.yaml: A basic manifest for creating a Kubernetes deployment</em></li>
<li><em>service.yaml: A basic manifest for creating a service endpoint for your deployment</em></li>
<li>_ <em>helpers.tpl: A place to put template helpers that you can re-use throughout the chart</em></li>
</ul>
</li>
</ul>
<h4 id="template-values"><a class="header-anchor" href="#template-values"></a>Template Values</h4>
<ul>
<li>
<p>E.g. <code>nameï¼š</code>ï¼Œä¸‹é¢è¿™ä¸ªä¾‹å­é‡Œé¢ç”¨<code>release name</code> æ¥åšå‰ç¼€ã€‚è¯è¯´è¿™ä¸ª<code>release name</code>åœ¨å“ªé‡Œå®šä¹‰çš„ï¼Œæˆ‘æ²¡æ‰¾åˆ°ã€‚</p>
<ul>
<li>
<p><em>So we could read <code>.Release.Name</code> as â€œstart at the top namespace, find the <code>Release</code> object, then look inside of it for an object called <code>Name</code>â€.</em></p>
</li>
<li>
<p><code>.Release</code>è¡¨ç¤º<code>Release</code>æ˜¯é¡¶çº§çš„object</p>
<pre><code>apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: &quot;Hello World&quot;
</code></pre>
</li>
</ul>
</li>
<li>
<p>é¡¶çº§çš„è‡ªå¸¦çš„objectåŒ…æ‹¬ï¼š <code>Release</code>,<code>Value</code>,<code>Chart</code>,<code>Template</code>, <code>Capabilities</code>è¿˜æœ‰<code>File</code>ã€‚åä¸¤ä¸ªè¿˜ä¸æ˜¯å¾ˆç†è§£</p>
<ul>
<li>
<p><code>Release</code>é‡Œé¢åŒ…å«å¾ˆå¤šå˜é‡ï¼Œæœ‰<code>Release.Time</code>,<code>Release.Namespace</code>, <code>Release.Revision</code>,è¯¦æƒ…å¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£</p>
</li>
<li>
<p><code>Values</code>é‡Œé¢çš„å…¶å®æ˜¯ä»<code>values.yaml</code>é‡Œé¢æ¥çš„</p>
</li>
<li>
<p><code>Template</code>: åŒ…å«å½“å‰æ­£åœ¨æ‰§è¡Œçš„<code>template</code>çš„ä¿¡æ¯</p>
</li>
<li>
<p><code>Chart</code> é‡Œé¢çš„å°±æ˜¯<code>chart.yaml</code>æ¥çš„ã€‚æ¯”å¦‚</p>
<pre><code>{{.Chart.Name}}-{{.Chart.Version}} 
</code></pre>
</li>
</ul>
</li>
</ul>
<h4 id="template-functions"><a class="header-anchor" href="#template-functions"></a>Template Functions</h4>
<ul>
<li>
<p><em>Helm has over 60 available functions.</em> å…¶ä¸­ä¸€äº›æ˜¯è°ƒç”¨<code>GO</code>è¯­è¨€é‡Œé¢<code>tamplate</code>å®šä¹‰çš„å‡½æ•°ã€‚åœ¨<a href="https://godoc.org/text/template" target="_blank" rel="noopener">Go Template Function</a>å¯ä»¥æŸ¥è¯¢åˆ°</p>
</li>
<li>
<p>å…¶å®<code>Helm Template</code>å¹¶ä¸æ˜¯Helmè‡ªèº«åšå‡ºæ¥çš„ï¼Œå…¶å®æ˜¯ä»Goè¿™äº›æ¥çš„ã€‚å°±æ˜¯ä¸ªæ‹¿æ¥å†é›†æˆä¸€ä¸‹ã€‚å¹¶ä¸æ˜¯Helmè‡ªå·±çš„ã€‚</p>
</li>
<li>
<p><code>Helm functions</code>æ”¯æŒç®¡é“<code>pipeline</code>ã€‚è¿™é‡Œçš„<code>pipeline</code>å’Œ<code>Unix</code>é‡Œé¢çš„åŒæ ·å«ä¹‰ã€‚å¦‚ä¸‹é¢çš„ä¾‹å­é‡Œé¢çš„ï¼š</p>
<pre><code>food: {{ .Values.favorite.food | upper | quote }}
drink: {{ .Values.favorite.drink | repeat 5 | quote }}
</code></pre>
</li>
</ul>
<h5 id="å¸¸ç”¨å‡½æ•°"><a class="header-anchor" href="#å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h5>
<ul>
<li>
<p><code>default</code>ï¼šç”¨æ¥æŒ‡å®šé»˜è®¤å€¼</p>
<pre><code>  drink: {{ .Values.favorite.drink | default "tea" | quote }}
</code></pre>
</li>
<li>
<p><code>toyaml</code>: è½¬æˆyamlæ ¼å¼ <strong><em>å…¶å®ä¸æ˜ç™½å•¥å«åšYamlæ ¼å¼</em></strong></p>
</li>
</ul>
<h5 id="å‡½æ•°æ§åˆ¶å’Œæ“ä½œè¿ç®—ç¬¦"><a class="header-anchor" href="#å‡½æ•°æ§åˆ¶å’Œæ“ä½œè¿ç®—ç¬¦"></a>å‡½æ•°æ§åˆ¶å’Œæ“ä½œè¿ç®—ç¬¦</h5>
<ul>
<li><code>Helm Template</code>çš„å‡½æ•°æ˜¯å¯ä»¥å¼•å…¥é€»è¾‘æ§åˆ¶çš„</li>
<li>è¿ç®—ç¬¦æœ‰ï¼š
<ul>
<li><code>if/else</code> for creating conditional blocksï¼š <code>if</code>åˆ¤æ–­æœ‰ç‚¹ä¸ä¸€æ ·çš„æ˜¯ç©ºçš„å­—ç¬¦ä¸²æˆ–è€…ç©ºçš„é›†åˆä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯<code>false</code>ï¼Œè¿˜æœ‰æ•°å­—0</li>
<li><code>with</code> to specify a scope</li>
<li><code>range</code> which provides a â€œfor eachâ€-style loop</li>
</ul>
</li>
</ul>
<h6 id="function-if-else"><a class="header-anchor" href="#function-if-else"></a>Function if/else</h6>
<ul>
<li>
<p>é€»è¾‘ç¨å¾®æœ‰ç‚¹éš¾ç†è§£ã€‚å°±æ˜¯<code>if</code>è¯­å¥é‡Œé¢çš„å†…å®¹æ˜¯åˆ¤æ–­æ¡ä»¶æˆç«‹çš„æ—¶å€™åŒ…å«çš„ã€‚ç„¶åå…³ç³»è¿ç®—ç¬¦åœ¨å‰ï¼Œè¿™é‡Œæ˜¯<code>or</code>è¿ç®—ç¬¦</p>
<pre><code>  {{/* include the body of this if statement when the variable .Values.anUnsetVariable is set or .values.aSetVariable is not set */}}
  {{ if or .Values.anUnsetVariable (not    .Values.aSetVariable) }}
   {{ ... }}
  {{ end }}
</code></pre>
</li>
</ul>
<h6 id="function-range"><a class="header-anchor" href="#function-range"></a>Function Range</h6>
<ul>
<li>
<p><code>range</code>ç›¸å½“äºæ˜¯<code>foreach</code>,æ¯”å¦‚ä»¥ä¸‹æ˜¯ä¸€ä¸ª<code>slice</code>ï¼Œå…¶å®å°±æ˜¯åˆ—è¡¨ã€‚</p>
<pre><code>pizzaToppings:
 - mushrooms
 - cheese
 - peppers
 - onions
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥è¿™æ ·æ“ä½œï¼š</p>
<pre><code> toppings: |-
  {{- range .Values.pizzaToppings }}
  - {{ . | title | quote }}
  {{- end }}
</code></pre>
<ul>
<li>ä»¥ä¸Š<code>range</code>å‡½æ•°éå†<code>pizzaToppings</code>é‡Œé¢çš„æ¯ä¸ªæ•°å€¼ï¼Œ <code>.</code>ä»£è¡¨å…¶ä¸­æ¯ä¸ªæ•°å€¼ï¼Œä¼ é€’ç»™<code>title</code>å’Œ<code>quote</code>å‡½æ•°ã€‚</li>
<li><code>|-</code>ä»£è¡¨ä»¥ä¸‹å†…å®¹æ˜¯ä¸€ä¸ªé•¿å­—ç¬¦ä¸²ã€‚å› ä¸º<code>Configmap</code>åªæ”¯æŒé”®å€¼å¯¹ã€‚</li>
</ul>
</li>
<li>
<p><code>range</code>ä¹Ÿå¯ä»¥å’Œ<code>list</code>åˆå¹¶èµ·æ¥ç”¨ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code> sizes: |-
 {{- range list "small" "medium" "large" }}
  - {{ . }}
 {{- end }}
</code></pre>
<ul>
<li>å¼•å·é‡Œé¢çš„ç»„æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åå†éå†å­—ç¬¦ä¸²</li>
</ul>
</li>
<li>
<p><code>range</code>ä¹Ÿå¯ä»¥å’Œå…¶ä»–é›†åˆå‡½æ•°è”åˆä½¿ç”¨ï¼Œæ¯”å¦‚<code>dict</code>å’Œ<code>map</code></p>
</li>
</ul>
<h6 id="function-with"><a class="header-anchor" href="#function-with"></a>Function with</h6>
<ul>
<li>
<p><code>.</code>æŒ‡çš„æ˜¯å½“å‰ä½œç”¨åŸŸï¼Œæ¯”å¦‚<code>.Values</code>ï¼Œå°±æ˜¯åœ¨å½“å‰ä½œç”¨åŸŸçš„<code>Value</code>é‡Œé¢</p>
</li>
<li>
<p>ä½¿ç”¨<code>with</code>å‡½æ•°å¯ä»¥æ”¹å˜ä½œç”¨åŸŸï¼Œç”¨æ³•å’Œ<code>if</code>ç±»ä¼¼ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code>{{ with PIPELINE }}
# restricted scope
{{ end }}
</code></pre>
</li>
</ul>
<h5 id="ç©ºæ ¼å’Œç©ºè¡Œ"><a class="header-anchor" href="#ç©ºæ ¼å’Œç©ºè¡Œ"></a>ç©ºæ ¼å’Œç©ºè¡Œ</h5>
<ul>
<li>
<p>è¿™å°±æ˜¯ä¸ºå•¥æ¯è¡Œéƒ½ä¸¤ä¸ªå¤§æ‹¬å·åŠ å°æ¨ªçº¿çš„ç¼˜æ•…ï¼Œç…ç€ä¸€å †å°æ¨ªçº¿å®åœ¨æ— è¯­å•Šã€‚è¿™ä¸ªä¸¤ä¸ªå¤§æ‹¬å·åŠ å°æ¨ªçº¿markdownè¿˜æ‰“ä¸å‡ºæ¥ï¼ŒOMG ğŸ˜•</p>
<ul>
<li>
<p>ä»¥ä¸‹çš„è¯­å¥ä¼šäº§ç”Ÿä¸€ä¸ª<code>Json</code>å­—æ®µ<code>mugï¼štrue</code>å¹¶ä¸”æ²¡æœ‰ç©ºè¡Œ</p>
<pre><code>{{ if and .Values.favorite.drink (eq .Values.favorite.drink "coffee") }}mug: true{{ end }}
</code></pre>
</li>
<li>
<p>ä½†æ˜¯å¦‚æœæ˜¯ä»¥ä¸‹è¯­å¥å°±ä¼šäº§ç”Ÿåœ¨è¿™ä¸ªå­—æ®µä¹‹å‰ç”Ÿæˆä¸€ä¸ªç©ºè¡Œã€‚ä¼°è®¡<code>helm</code>å°±æ˜¯ç®€å•çš„å°†<code>if</code>è¯­å¥çš„ä¸€è¡Œç»™ç”¨ç©ºæ ¼æ›¿ä»£äº†</p>
<pre><code>{{if eq .Values.favorite.drink "coffee"}}
 mug: true
{{end}}
</code></pre>
</li>
<li>
<p>æ‰€ä»¥ä¸Šé¢çš„è¯­å¥å…¶å®è¾ƒä¸ºæ¸…æ™°ï¼Œå´å¿…é¡»ç”¨ä»¥ä¸‹æ ·å¼æ›¿ä»£ï¼Œè¿™æ ·<code>Helm</code>å°±çŸ¥é“å°†è¿™è¾¹çš„ç©ºæ ¼éƒ½åˆ é™¤æ‰</p>
<pre><code>{{- if eq .Values.favorite.drink "coffee"}}
 mug: true
{{- end}}
</code></pre>
</li>
<li>
<p>For the details on whitespace control in templates,see the Official <a href="https://godoc.org/text/template" target="_blank" rel="noopener">Go template documentation</a></p>
</li>
</ul>
</li>
<li>
<p>ä¹Ÿå¯ä»¥æ›´ä¸ºç²¾ç¡®å¾—æ§åˆ¶ç©ºæ ¼ï¼Œå¦‚ä¸‹ã€‚è¿™ç§ç”¨æ³•åœ¨ä»£ç é‡Œä¹Ÿçœ‹åˆ°å¾ˆå¤šã€‚</p>
<pre><code>{{indent 2 "mug:true"}}
</code></pre>
</li>
<li>
<p>è¿˜å¯ä»¥ç”¨<code>*</code>ç¬¦å·ï¼Œ<em>Just for the sake of making this point clear, letâ€™s adjust the above, and substitute an <code>*</code> for each whitespace that will be deleted following this rule. an <code>*</code> at the end of the line indicates a newline character that would be removed</em> æ²¡çœ‹çš„å¤ªæ˜ç™½ã€‚è¿™ä¸ª<code>*</code>æ˜¯å¹²å˜›ç”¨çš„ã€‚</p>
<pre><code>**{{- if eq .Values.favorite.drink "coffee"}}
  mug: true*
**{{- end}}
</code></pre>
</li>
</ul>
<h4 id="å˜é‡"><a class="header-anchor" href="#å˜é‡"></a>å˜é‡</h4>
<ul>
<li>
<p>å˜é‡æ˜¯ç”¨<code>:=</code>æ¥å®šä¹‰çš„ã€‚</p>
</li>
<li>
<p>å¦‚ä¸‹ã€‚åŸæœ¬åœ¨ä½¿ç”¨äº†<code>with</code>ä¹‹åä½œç”¨åŸŸå·²ç»æ”¹å˜äº†ï¼Œæ‰¾ä¸åˆ°<code>Release</code>äº†ï¼Œä½†æ˜¯ä½¿ç”¨äº†å˜é‡ï¼Œå°±åˆå¯ä»¥è®¿é—®äº†ã€‚</p>
<pre><code>data:
myvalue: &quot;Hello World&quot;
{{- $relname := .Release.Name -}}
{{- with .Values.favorite }}
drink: {{ .drink | default "tea" | quote }}
food: {{ .food | upper | quote }}
release: {{ $relname }}
{{- end }}
</code></pre>
</li>
<li>
<p>å¯ä»¥å’Œ<code>range</code>ç»“åˆèµ·æ¥ç”¨ã€‚</p>
<ul>
<li>
<p>éå†ä¸€ä¸ªåˆ—è¡¨ã€‚<code>index</code>å˜é‡æ˜¯ä¸‹æ ‡ï¼Œä»<code>0</code>å¼€å§‹</p>
<pre><code>toppings: |-
  {{- range $index, $topping := .Values.pizzaToppings }}
    {{ $index }}: {{ $topping }}
  {{- end }}
</code></pre>
</li>
<li>
<p>é”®å€¼å¯¹ã€‚æ³¨æ„<code>Values.favorite</code>æ˜¯é”®å€¼å¯¹çš„é›†åˆã€‚æ‰€ä»¥ç¬¬ä¸€æ¬¡æ˜¯ä¸€å¯¹ï¼Œç¬¬äºŒæ¬¡æ˜¯ç¬¬äºŒå¯¹</p>
<pre><code>{{- range $key, $val := .Values.favorite }}
  {{ $key }}: {{ $val | quote }}
{{- end}}
</code></pre>
</li>
</ul>
</li>
<li>
<p>å˜é‡æ˜¯æœ‰ä½œç”¨åŸŸçš„ã€‚é¡¶å±‚å£°æ˜çš„å°±æ˜¯æ•´ä¸ª<code>template</code>å¯ç”¨ï¼Œ<code>range</code>é‡Œé¢å£°æ˜çš„ï¼Œå°±æ˜¯<code>range</code>é‡Œé¢å¯ç”¨ã€‚æ¯”å¦‚ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œå‡ºäº†<code>end</code>å°±æ²¡ç”¨äº†ã€‚</p>
</li>
<li>
<p><strong>æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å˜é‡ <code>$</code>ï¼Œä»£è¡¨æ ¹ä½œç”¨åŸŸï¼</strong></p>
</li>
</ul>
<h4 id="å·²å‘½åçš„template"><a class="header-anchor" href="#å·²å‘½åçš„template"></a>å·²å‘½åçš„Template</h4>
<p>å°±æ˜¯ä»‹ç»ä¸€ä¸‹å¦‚ä½•å¼•ç”¨å•Šï¼Œå‘½åä¹‹ç±»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åå­—æ˜¯å…¨å±€çš„ï¼Œä¸ç®¡è¿™ä¸ª<code>template</code>æ˜¯ä¸æ˜¯åŒ…åœ¨å…¶ä»–çš„<code>template</code>é‡Œé¢ã€‚<br>
__éœ€è¦çš„ä¸€ç‚¹æ˜¯ï¼Œåå­—ä¸­æœ‰ä¸‹åˆ’çº¿çš„<code>template</code>æ˜¯ä¸ä¼šè¢«éƒ¨ç½²åˆ°<code>kubernate</code>ä¸Šé¢çš„ã€‚ä½†æ˜¯å¯ä»¥è¢«å…¶ä»–<code>template</code>å¼•ç”¨</p>
<h5 id="define"><a class="header-anchor" href="#define"></a>define</h5>
<ul>
<li>
<p>ä½¿ç”¨<code>define</code>å¯ä»¥åœ¨ä¸€ä¸ª<code>template</code>å†…éƒ¨åˆ›å»ºä¸€ä¸ªæ–°çš„<code>template</code>ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code>{{- define "mychart.labels" }}
  labels:
    generator: helm
    date: {{ now | htmlDate }}
{{- end }}
</code></pre>
</li>
<li></li>
</ul>
<h5 id="templateå’Œinclude"><a class="header-anchor" href="#templateå’Œinclude"></a>templateå’Œinclude</h5>
<ul>
<li>
<p><code>template</code>æ„Ÿè§‰å’Œ<code>include</code>æœ‰ç‚¹ç›¸ä¼¼ã€‚æ˜¯è°ƒç”¨ç”¨<code>define</code>å®šä¹‰çš„<code>template</code>çš„ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code>metadata:
  name: {{ .Release.Name }}-configmap
  {{- template "mychart.labels" }}
</code></pre>
</li>
<li>
<p>é€šå¸¸è¿™ç±»<code>template</code>ä¼šè¢«æ”¾åœ¨<code>_helpers.tpl</code>æ–‡ä»¶é‡Œé¢ã€‚æˆ‘çš„æ„Ÿè§‰æ˜¯ï¼Œè¿™ç±»<code>template</code>å¾ˆåƒ<code>util</code>å‡½æ•°ï¼Œç„¶åæ”¾åœ¨ä¸€ä¸ªé›†ä¸­çš„æ–‡ä»¶é‡Œé¢ã€‚ä¸€èˆ¬ä¼šåœ¨å‰é¢åŠ ä¸€ä¸ªæ³¨é‡Šï¼Œå¦‚ä¸‹çš„æ ¼å¼ï¼š</p>
<pre><code>{{/* ... */}}
</code></pre>
</li>
<li>
<p>ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä¸Šé¢ä¾‹å­çš„è°ƒç”¨ï¼Œå¹¶æ²¡æœ‰ç»™ä»»ä½•çš„ä½œç”¨åŸŸï¼Œè€Œ<code>template</code>çš„é»˜è®¤ä½œç”¨åŸŸä¸ºç©ºã€‚å¦‚ä¸‹çš„<code>template</code>é‡Œé¢çš„<code>.Chart</code>æ˜¯æ— æ³•ç”Ÿæ•ˆçš„ã€‚æ‰€ä»¥è°ƒç”¨æ—¶å€™åº”è¯¥ç”¨ä»¥ä¸‹å½¢å¼ã€‚è¿™æ ·ä¼ å…¥ä¸€ä¸ªä½œç”¨åŸŸå°±å¯ä»¥äº†ã€‚</p>
<pre><code>{{/* Generate basic labels */}}
  {{- define "mychart.labels" }}
    labels:
      generator: helm
      date: {{ now | htmlDate }}
      chart: {{ .Chart.Name }}
      version: {{ .Chart.Version }}
  {{- end }}
  

{{- template "mychart.labels" .}}
</code></pre>
</li>
<li>
<p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œ<code>template</code>æœ‰ç‚¹ç±»ä¼¼<code>inline</code>ï¼Œå°±æ˜¯ç®€å•çš„å°†å†…å®¹å±•å¼€ï¼Œå¹¶ä¸è€ƒè™‘ç¼©è¿›çš„é—®é¢˜ã€‚ä¸ºæ­¤ï¼Œå¼•å…¥äº†<code>include</code>ï¼Œ <code>include</code>å¯ä»¥ç”¨<code>pipeline</code>æ¥æŒ‡å®šç¼©è¿›ã€‚æ¨èä½¿ç”¨<code>include</code>æ¥æ›¿ä»£<code>template</code></p>
<pre><code>{{- include "mychart.app" . | nindent 2 }}
</code></pre>
</li>
</ul>
<h4 id="å¼•ç”¨æ–‡ä»¶"><a class="header-anchor" href="#å¼•ç”¨æ–‡ä»¶"></a>å¼•ç”¨æ–‡ä»¶</h4>
<ul>
<li>
<p><code>.File</code>å¯ä»¥å°†æ–‡ä»¶åŒ…å«è¿›æ¥ã€‚éœ€è¦æ³¨æ„çš„æœ‰ï¼Œ<code>template</code>ç›®å½•ä¸‹é¢çš„æ–‡ä»¶æ²¡æ³•è¢«åŒ…å«ã€‚å¦‚ä¸‹ä¾‹å­ã€‚<code>.File.Get</code>å°±æ˜¯è¯»å–æ–‡ä»¶çš„å†…å®¹çš„å‡½æ•°</p>
<pre><code> {{- $files := .Files }}
 {{- range list "config1.toml" "config2.toml" "config3.toml" }}
  {{ . }}: |-
    {{ $files.Get . }}
 {{- end }}
</code></pre>
</li>
</ul>
<h3 id="å‚è€ƒæ–‡æ¡£"><a class="header-anchor" href="#å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3>
<ul>
<li><a href="https://www.cnblogs.com/Erik_Xu/p/8893725.html" target="_blank" rel="noopener">Helmä»‹ç»</a></li>
<li><a href="https://github.com/helm/helm" target="_blank" rel="noopener">Helm GitHubé¡µé¢</a></li>
<li><a href="https://helm.sh/docs/using_helm/#quickstart-guide" target="_blank" rel="noopener">Helmä½¿ç”¨æ–‡æ¡£</a></li>
<li><a href="https://helm.sh/docs/chart_template_guide/" target="_blank" rel="noopener">Helmå®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://v2.helm.sh/docs/charts/#managing-dependencies-with-requirements-yaml" target="_blank" rel="noopener">Helm2å®˜æ–¹æ–‡æ¡£</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/02/26/Liveness-Readiness/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/02/26/Liveness-Readiness/" class="post-title-link" itemprop="url">Liveness & Readiness</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-02-26 14:29:11" itemprop="dateCreated datePublished" datetime="2019-02-26T14:29:11+08:00">2019-02-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-08-16 10:09:17" itemprop="dateModified" datetime="2019-08-16T10:09:17+08:00">2019-08-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/02/26/Liveness-Readiness/" class="post-meta-item leancloud_visitors" data-flag-title="Liveness & Readiness" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/02/26/Liveness-Readiness/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/02/26/Liveness-Readiness/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="liveness-readiness"><a class="header-anchor" href="#liveness-readiness"></a>Liveness &amp; Readiness</h2>
<h3 id="readiness"><a class="header-anchor" href="#readiness"></a>Readiness</h3>
<ul>
<li>Readiness Probes checks if an application is ready to start processing traffic.</li>
<li>This probe solves the problem of the container having started, but the process still warming up and configuring itself meaning itâ€™s not ready to receive traffic.</li>
<li>The configuration is as following:<br>
readinessProbe:<br>
httpGet:<br>
path: /<br>
port: 80<br>
initialDelaySeconds: 1<br>
timeoutSeconds: 1</li>
</ul>
<h3 id="liveness"><a class="header-anchor" href="#liveness"></a>Liveness</h3>
<ul>
<li>Liveness Probes ensure that the application is healthy and capable of processing requests.</li>
<li>The configuration is as following:<br>
livenessProbe:<br>
httpGet:<br>
path: /<br>
port: 80<br>
initialDelaySeconds: 1<br>
timeoutSeconds: 1</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/hexo_blog/page/2/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/hexo_blog/">1</a><a class="page-number" href="/hexo_blog/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/hexo_blog/page/4/">4</a><a class="page-number" href="/hexo_blog/page/5/">5</a><a class="extend next" rel="next" href="/hexo_blog/page/4/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Lynn Shen</p>
  <div class="site-description" itemprop="description">35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/hexo_blog/archives/">
        
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/hexo_blog/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lynn Shen</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> å¼ºåŠ›é©±åŠ¨
  </div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"ffyWzhHueqJEC5UEfPUhAWzF-MdYXbMMI","app_key":"vS7xTvT1vD1DxluERkmlkvme","server_url":"https://sallyslove.github.io/hexo_blog","security":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/hexo_blog/lib/anime.min.js"></script>
  <script src="/hexo_blog/lib/velocity/velocity.min.js"></script>
  <script src="/hexo_blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/hexo_blog/js/utils.js"></script>

<script src="/hexo_blog/js/motion.js"></script>


<script src="/hexo_blog/js/schemes/muse.js"></script>


<script src="/hexo_blog/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'ffyWzhHueqJEC5UEfPUhAWzF-MdYXbMMI',
      appKey     : 'vS7xTvT1vD1DxluERkmlkvme',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
