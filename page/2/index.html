<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/hexo_blog/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/hexo_blog/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/hexo_blog/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/hexo_blog/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/hexo_blog/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/hexo_blog/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/hexo_blog/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
<meta property="og:type" content="website">
<meta property="og:title" content="è·¬æ­¥">
<meta property="og:url" content="https://sallyslove.github.io/hexo_blog/page/2/index.html">
<meta property="og:site_name" content="è·¬æ­¥">
<meta property="og:description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="è·¬æ­¥">
<meta name="twitter:description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/hexo_blog/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://sallyslove.github.io/hexo_blog/page/2/">





  <title>è·¬æ­¥</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/hexo_blog/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">è·¬æ­¥</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ä¸ç§¯è·¬æ­¥ï¼Œæ— ä»¥è‡³åƒé‡Œ</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/hexo_blog/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/hexo_blog/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/hexo_blog/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            å½’æ¡£
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/hexo_blog/2019/05/15/Cassandraçš„repairæœºåˆ¶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexo_blog/2019/05/15/Cassandraçš„repairæœºåˆ¶/" itemprop="url">Cassandraçš„repairæœºåˆ¶</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-05-15T17:52:05+08:00">
                2019-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/cassandra/" itemprop="url" rel="index">
                    <span itemprop="name">cassandra</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="cassandraçš„repairæœºåˆ¶"><a class="header-anchor" href="#cassandraçš„repairæœºåˆ¶"></a>Cassandraçš„repairæœºåˆ¶</h2>
<p>è¿™ç¯‡è®¨è®ºä¸€äº›robustnessçš„ä¸œè¥¿ã€‚ä¸»è¦å°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹downäº†ä¼šæ€ä¹ˆæ ·ã€‚å…¶å®ç›®å‰çŸ¥é“çš„å°±æ˜¯hintï¼Œä½†æ˜¯è®°å½•ä¸‹æ¥ã€‚<br>
ä»ä¸€äº›æ–‡æ¡£é‡Œé¢çœ‹ï¼Œè¿™ä¸ªå±äºå†™æµç¨‹çš„ä¸€éƒ¨åˆ†ã€‚ç¡®å®æ˜¯ï¼Œè¯»çš„è¯ï¼Œå¦‚æœnode downäº†åº”è¯¥ä¸ä¼šä»ä¸Šé¢è¯»å–äº†ã€‚ä¼šå†™åˆ°the coordinator nodeä¸Šé¢ã€‚version 1.0æœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯è¿™ä¸ªç‰ˆæœ¬å¤ªæ—§äº†ã€‚</p>
<blockquote>
<p>By design, hinted handoff inherently allows Cassandra to continue performing the same number of writes even when the cluster is operating at reduced capacity.</p>
</blockquote>
<h3 id="hinted-handoffç®€è¿°"><a class="header-anchor" href="#hinted-handoffç®€è¿°"></a>Hinted Handoffç®€è¿°</h3>
<ul>
<li><strong><code>hinted handoff</code> å’Œ ä¸€èˆ¬è¯´çš„<code>hint</code>åº”è¯¥æ˜¯åŒä¸€ä¸ªä¸œè¥¿ã€‚</strong> å‰è€…æ˜¯ä¸€ä¸ªæœºåˆ¶ï¼Œåè€…å°±æ˜¯è¿™ä¸ªæœºåˆ¶äº§ç”Ÿçš„äº‹ä»¶æˆ–è€…è®°å½•ã€‚</li>
<li><code>hinted handoff</code>è·Ÿconsistency level ç›¸å…³ï¼Œæ¯•ç«Ÿè¿™ä¸ªæ˜¯å†™æœºåˆ¶çš„ä¸€éƒ¨åˆ†ã€‚</li>
<li>cassandraçš„configæ–‡ä»¶é‡Œé¢éœ€è¦é…ç½®å‡ ä¸ªå‚æ•°ï¼š
<ul>
<li><code>hinted_handoff_enabled</code>ï¼šé»˜è®¤ä¸ºtrueï¼Œæ‰“å¼€è¿™ä¸ªæœºåˆ¶</li>
<li><code>max_hint_window_in_ms</code>ï¼š ä¸ºå·²ç»downæ‰çš„nodeè®°å½•hint logçš„æ—¶é—´é•¿åº¦</li>
<li><code>gc_grace_seconds</code>: Configures the time-to-live (TTL) period for a hint so that the database wonâ€™t replay the hint after this duration. Setting this parameter to 0 disables hintsã€‚ è¿™ä¸ªå‚æ•°æ²¡ç”¨è¿‡ï¼Œåé¢å¯ä»¥è¯•è¯•çœ‹</li>
<li><code>hinted_handoff_throttle_in_kb</code> å’Œ    <code>max_hints_delivery_threads</code> è¿™ä¸¤ä¸ªæ²¡å’‹ç ”ç©¶è¿‡ï¼Œå…ˆæ”¾ç€å§</li>
</ul>
</li>
<li>æŒ‰ç…§æ–‡æ¡£ï¼Œå½“å†™å…¥å‘ç”Ÿæ—¶å€™ï¼Œå¹¶ä¸”a replica node for the key is downã€‚å°±å¯èƒ½ä¼šè§¦å‘hinted handoffçš„æœºåˆ¶</li>
</ul>
<h4 id="hint-è¯¦è¿°"><a class="header-anchor" href="#hint-è¯¦è¿°"></a>Hint è¯¦è¿°</h4>
<ul>
<li>
<blockquote>
<p>The hint consists of a target ID for the downed node, a hint ID that is a time UUID for the data, a message ID that identifies the Cassandra version, and the data itself as a blob.</p>
</blockquote>
<ul>
<li>hinté‡Œé¢æœ‰ï¼šdown nodeçš„target IDï¼Œ æ ‡æ³¨è¿™æ¡æ•°æ®çš„hint IDï¼Œ æ ‡æ³¨cassandra versionçš„message IDä»¥åŠæ•°æ®æœ¬èº«</li>
<li>è¿™æ˜¯cassandra 3.0ä¹‹åçš„ã€‚ä¹‹å‰çš„å¯èƒ½ä¸ä¸€æ ·</li>
</ul>
</li>
<li>
<p>å’Œæƒ³è±¡åœ°ä¸€æ ·ï¼Œå½“Gossipyå‘ç°downed nodeèµ·æ¥ä¹‹åï¼Œcoordinator nodeä¼šå°†hintè®°å½•çš„æ•°æ®å†™è¿‡å»ï¼Œå¹¶ä¸”åˆ é™¤æ‰hint</p>
</li>
<li>
<blockquote>
<p>The coordinator also checks every ten minutes for hints corresponding to writes that timed out during an outage too brief for the failure detector to notice through gossip.</p>
</blockquote>
</li>
<li>
<p>è¿™å¥æœ‰ç‚¹éš¾ä»¥ç†è§£ï¼Œçœ‹äº†ä¸‹ä¸€å¥æœ‰ç‚¹æ˜ç™½ã€‚å¦‚æœæœ‰çš„èŠ‚ç‚¹å®•æœºæ—¶é—´å¾ˆçŸ­ï¼Œè€ŒGossdipå¹¶æ²¡æœ‰å‘ç°ï¼Œé‚£ä¹ˆcoordinator ä¼šè¿”å›ä¸€ä¸ªexceptionï¼ŒåŒæ—¶æŠŠwrite failäº†ï¼Œä½†æ˜¯ä¼šè®°å½•ä¸€ä¸ªhintã€‚æ‰€ä»¥å¦‚æœç¬é—´æœ‰å¾ˆå¤šçŸ­æš‚çš„failï¼Œcoordinator nodeä¼šä¸€ä¸‹å­å‹åŠ›è¿‡å¤§ï¼Œæ‰”å‡ºoverloadexception</p>
</li>
</ul>
<blockquote>
<p>If a replica node is overloaded or unavailable, and the failure detector has not yet marked the node as down, then expect most or all writes to that node to fail after the timeout triggered by write_request_timeout_in_ms, (10 seconds by default). The coordinator returns a TimeOutException exception, and the write will fail but a hint will be stored.</p>
</blockquote>
<h4 id="hint-å’Œ-consistency-level"><a class="header-anchor" href="#hint-å’Œ-consistency-level"></a>Hint å’Œ consistency level</h4>
<ul>
<li>
<blockquote>
<p>å½“ä¸€è‡´æ€§ç­‰çº§è®¾å®šä¸ºONEï¼ŒQUORUMï¼Œæˆ–è€…ALLçš„æ—¶å€™ï¼Œæç¤ºçš„å†™å¹¶ä¸å‚ä¸åˆ°ä¸€è‡´æ€§çº§åˆ«çš„è®¡æ•°ä¸­ã€‚å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„èŠ‚ç‚¹æ»¡è¶³å†™çš„ä¸€è‡´æ€§çº§åˆ«éœ€è¦ï¼Œä¼šæŠ›å‡º UnavailableExceptionè€Œä¸æ˜¯è§¦å‘Hinted Handoffã€‚ï¼ˆè¿™æ˜¯Casssandraå’ŒDynamoå¤åˆ¶æ¨¡å‹ä¸ä¸€æ ·çš„åœ°æ–¹ä¹‹ä¸€ï¼‰</p>
</blockquote>
</li>
<li>æ¥ä¸Šæ–‡ï¼Œå¦‚æœå°†consistency levelè®¾ç½®æˆä¸ºAnyï¼Œé‚£ä¹ˆhintå°±ç®—äº†ã€‚æ‰€ä»¥å³ä½¿åªæ˜¯å†™äº†hintï¼Œå†™æ“ä½œä¹Ÿä¼šæˆåŠŸï¼Œä½†æ˜¯è¿™æ—¶å€™è¯»æ•°æ®æ˜¯è¯»ä¸å‡ºæ¥çš„ã€‚</li>
</ul>
<h3 id="repairing-data"><a class="header-anchor" href="#repairing-data"></a>Repairing Data</h3>
<ul>
<li>Read repair: The reconciliation or correction happens when a read finds an inconsistency.</li>
<li>When data is read, a read repair can resolve any data inconsistencies. When data isnâ€™t read, you need to use either the hinted handoff or anti-entropy mechanism to resolve any data inconsistences.</li>
</ul>
<h4 id="read-repair"><a class="header-anchor" href="#read-repair"></a>Read Repair</h4>
<h4 id="anti-entropy"><a class="header-anchor" href="#anti-entropy"></a>anti-entropy</h4>
<h3 id="å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3>
<ul>
<li><a href="https://wiki.apache.org/cassandra/HintedHandoff" target="_blank" rel="noopener">wikiä¸Šé¢çš„ç®€ä»‹</a></li>
<li><a href="https://docs.datastax.com/en/cassandra/3.0/cassandra/operations/opsRepairNodesHintedHandoff.html" target="_blank" rel="noopener">å®˜æ–¹</a></li>
<li><a href="http://www.cnblogs.com/sing1ee/archive/2012/07/09/2765056.html" target="_blank" rel="noopener">æ¯”è¾ƒå¥½çš„åšå®¢ä¸€ç¯‡</a>ï¼š çœ‹èµ·æ¥å¾ˆå¤šå°±æ˜¯å®˜æ–¹æ–‡æ¡£çš„ç¿»è¯‘</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/hexo_blog/2019/04/29/k8så’Œdockeré—®é¢˜è§£å†³/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexo_blog/2019/04/29/k8så’Œdockeré—®é¢˜è§£å†³/" itemprop="url">k8så’Œdockeré—®é¢˜è§£å†³</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-04-29T15:44:03+08:00">
                2019-04-29
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="æ¦‚è¿°"><a class="header-anchor" href="#æ¦‚è¿°"></a>æ¦‚è¿°</h2>
<p>å·¥ä½œä¸­ç¢°åˆ°çš„ä¸€äº›ç›¸å…³é—®é¢˜ï¼Œæœ‰çš„ä¹Ÿè®¸å¾ˆç®€å•ï¼Œè®°å½•åœ¨è¿™é‡Œã€‚çœå¾—åé¢å†èŠ±åŠŸå¤«å»çœ‹å•¦ã€‚</p>
<h4 id="é—®é¢˜ä¸€"><a class="header-anchor" href="#é—®é¢˜ä¸€"></a>é—®é¢˜ä¸€</h4>
<p>$ kubectl cluster-info<br>
Kubernetes master is running at â€¦</p>
<p>To further debug and diagnose cluster problems, use â€˜kubectl cluster-info dumpâ€™.<br>
Unable to connect to the server: x509: certificate signed by unknown authority (possibly because of â€œcrypto/rsa: verification errorâ€ while trying to verify candidate authority certificate â€œkubernetesâ€)</p>
<ul>
<li>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/baobaoxiannv/article/details/83818426" target="_blank" rel="noopener">csdnåšå®¢ä¸€ç¯‡</a></li>
<li>å…¶å®å°±æ˜¯kubeçš„configæ–‡ä»¶: <code>~/.kube/config</code> æ–‡ä»¶è¿‡æ—¶äº†ã€‚é‡Œé¢çš„certificationéœ€è¦æ›´æ–°ã€‚ä»kube serverä¸Šé¢æŠŠconfigæ‹¿ä¸‹æ¥æ›¿æ¢ä¸€äº›æœ¬åœ°çš„å°±å¥½äº†ã€‚</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/hexo_blog/2019/04/18/Cassandraé‡Œé¢çš„Batchæ“ä½œ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexo_blog/2019/04/18/Cassandraé‡Œé¢çš„Batchæ“ä½œ/" itemprop="url">Cassandraé‡Œé¢çš„Batchæ“ä½œ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-04-18T10:17:44+08:00">
                2019-04-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/cassandra/" itemprop="url" rel="index">
                    <span itemprop="name">cassandra</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="cassandraé‡Œé¢çš„batchæ“ä½œ"><a class="header-anchor" href="#cassandraé‡Œé¢çš„batchæ“ä½œ"></a>Cassandraé‡Œé¢çš„Batchæ“ä½œ</h2>
<p>æœ€è¿‘å·¥ä½œæ¯”è¾ƒå¿™æ´»ï¼Œä¸€ä¸ªæœˆéƒ½æ²¡å†™blogå–½ã€‚å·¥ä½œä¸­ç¢°åˆ°äº†ä¸€äº›ä¸cassandraç›¸å…³çš„åŒæ­¥å¼‚æ­¥ï¼ŒsimpleStatementï¼ŒbatchStatementçš„ä¸œè¥¿ã€‚é¡ºåŠ¿å¤šç ”ç©¶ä¸€ä¸‹ã€‚<br>
ç ”ç©¶å‘ç°ï¼Œè¿™ç©æ„è¿˜æŒºå¤æ‚çš„å•Šã€‚</p>
<h3 id="execute-ä¸-executeasync"><a class="header-anchor" href="#execute-ä¸-executeasync"></a>execute ä¸ executeAsync</h3>
<ul>
<li>
<p>cassandra driveråœ¨æ‰§è¡Œè¯­å¥æ—¶å€™æä¾›äº†<code>execute</code>å’Œ<code>executeAsync</code> ä¸¤ä¸ªæ¥å£</p>
</li>
<li>
<p>å¯¹äºbatchæ¥è¯´ï¼Œåªèƒ½è°ƒç”¨å‰è€…ï¼Œè¿™ä¸ªå¥½åƒä¸å¤ªå¯¹ã€‚</p>
</li>
<li>
<p>ä½†æ˜¯è¿›å…¥ä»£ç ä¼šçœ‹åˆ°ï¼Œ<code>execute</code>æœ€åè°ƒç”¨çš„ä¹Ÿæ˜¯<code>executeAsync</code></p>
<pre><code>  public ResultSet execute(Statement statement) {
         this.checkNotInEventLoop();
         return this.executeAsync(statement).getUninterruptibly();
  }
</code></pre>
</li>
<li>
<p>è¿™ä¸ª<code>executeAsync</code>apiæ˜¯åœ¨<code>SessionManager</code>é‡Œé¢å®šä¹‰çš„</p>
</li>
<li>
<p>æŒ‰ç…§å‚è€ƒé“¾æ¥1é‡Œé¢æ‰€è¿°çš„ï¼Œä»ä»¥ä¸Šä»£ç ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥çš„<code>execute</code>åœ¨äºæ˜¯blockçš„ã€‚å°±æ˜¯ä¸å¯æ‰“æ–­çš„ã€‚å¿…é¡»å¾—cassandraè¿”å›ä¸€äº›æ•°æ®æ‰èƒ½è¿”å›ã€‚æ‰€ä»¥å®ƒå¯ä»¥ä¿è¯åœ¨invalid requestçš„æƒ…å†µä¸‹æŠ¥é”™ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯requestå°±ä¸€å®šæ‰§è¡ŒæˆåŠŸäº†ã€‚</p>
</li>
<li>
<p><code>executeAsync</code>å°±æ˜¯éblockingçš„ï¼Œä¹Ÿä¸èƒ½ä¿è¯è¿™ä¸ªrequestä¸€å®šè¢«æ‰§è¡Œæˆ–è€…åœ¨invalidçš„requestçš„æƒ…å†µä¸‹æŠ¥é”™</p>
</li>
<li>
<p>å‚è€ƒé“¾æ¥1é‡Œé¢æœ‰è¿™ä¹ˆä¸€æ®µè¯ï¼šçœ‹èµ·æ¥å°‘é‡batchï¼Œå¹¶ä¸”æ˜¯åŒæ ·partition keyçš„æ—¶å€™ï¼Œä¼šæ¯”è¾ƒå¿«ã€‚</p>
</li>
<li>
<p>æˆ‘ä»¬åœ¨äº§å“ä¸­çš„æ”¹è¿›åœ¨æœ‰äº›åœºæ™¯ä¸‹é¢ç¡®å®performanceå˜å¥½äº†</p>
</li>
</ul>
<blockquote>
<p>To further improve throughput, you might want to consider using BatchStatement and submitting requests in batches. This is a good option if you keep your batches small (50-250 is a good number) and if your inserts in a batch all share the same partition key.</p>
</blockquote>
<ul>
<li>å‚è€ƒé“¾æ¥ï¼š
<ol>
<li><a href="https://stackoverflow.com/questions/34949292/how-cassandra-handle-blocking-execute-statement-in-datastax-java-driver" target="_blank" rel="noopener">How Cassandra handle blocking execute statement in datastax java driver<br>
</a></li>
</ol>
</li>
</ul>
<ol start="2">
<li><a href="http://zqhxuyuan.github.io/2015/11/10/2015-11-10-Cassandra-Client/" target="_blank" rel="noopener">Cassandra ClientæŸ¥è¯¢ä¼˜åŒ–</a>: è¿™ç¯‡æœ‰ç‚¹çœ‹ä¸æ˜ç™½ã€‚ä½†æ˜¯ç…ç€è¿˜æŒºå¥½çš„ï¼Œå…ˆæ”¾åœ¨è¿™é‡Œã€‚</li>
</ol>
<h3 id="batchstatement"><a class="header-anchor" href="#batchstatement"></a>BatchStatement</h3>
<p>ä¸¥æ ¼è¯´æ¥ï¼Œcassandaé‡Œé¢çš„batchç§°ä¸ºLOGGED batchï¼Œè€Œä¸åº”è¯¥æ˜¯atomic batchã€‚ Cassandaçš„ç­–ç•¥å§‹ç»ˆæ˜¯Eventually Consistentã€‚è€Œä¸”ç”±äºcassandraé‡Œé¢addä¸€ä¸ªæ•°æ®æ¯”deleteä¸€ä¸ªæ•°æ®è¦æ–¹ä¾¿å¤ªå¤šã€‚æ‰€ä»¥cassandraä¼šè®°ä¸€å †logå•¥çš„ï¼Œè€Œä¸æ˜¯å›æ»šã€‚</p>
<ul>
<li>cassandraæ˜¯åŸºäºco-ordinatoræ¥å®ç°çš„ã€‚batchåœ¨co-ordinatorå¼€å§‹å¤„ç†ä¹‹å‰å°±ç•™ä¼šå†™åˆ°å…¶ä»–nodeå»</li>
<li>å¦‚æœbatché‡Œé¢çš„æŸäº›å¤±è´¥äº†ï¼Œé‚£ä¹ˆæ˜¯ä¸ä¼šå›æ»šçš„ã€‚è€Œæ˜¯ä¼šä¸æ–­å°è¯•ã€‚</li>
<li>LOGGERçš„batchæ“ä½œä¼šæ¯”unloggedçš„å¤šåšå¾ˆå¤šäº‹æƒ…</li>
</ul>
<h4 id="batchstatement-type"><a class="header-anchor" href="#batchstatement-type"></a>BatchStatement.Type</h4>
<p>è¿™ä¸ªæ˜¯BatchStatement classçš„ä¸€ä¸ªå­ç±»</p>
<ul>
<li><code>COUNTER</code>: A counter batch. Note that such batch is the only type that can contain counter operations and it can only contain these. è¿™ä¸ªè§£é‡Šä¹Ÿå¤ªç®€å•äº†ã€‚æ„æ€æ˜¯è¯´å¯ä»¥çŸ¥é“å¤šå°‘ä¸ªæˆåŠŸäº†ï¼Ÿ</li>
<li><code>LOGGED</code>:
<ul>
<li>Cassandra will first write the batch to its distributed batch log to ensure the atomicity of the batch (atomicity meaning that if any statement in the batch succeeds, all will eventually succeed).è¿™ä¸ªè§£é‡Šä¹Ÿä¸å¤ªæ‡‚å•Šï¼Œåˆ°åº•æ€ä¹ˆä¿è¯çš„ã€‚ ORZ</li>
<li>é»˜è®¤è°ƒç”¨<code>new BatchStatement()</code>å°±ä¼šåˆ›ä¸€ä¸ªLOGGED typeçš„Batch-</li>
</ul>
</li>
<li><code>UNLOGGED</code>ï¼š A batch that doesnâ€™t use Cassandraâ€™s distributed batch log. Such batch are not guaranteed to be atomic.</li>
</ul>
<h4 id="logged-batchçš„è¿‡ç¨‹"><a class="header-anchor" href="#logged-batchçš„è¿‡ç¨‹"></a>LOGGED Batchçš„è¿‡ç¨‹</h4>
<p><img src="http://3.bp.blogspot.com/-dv9zIC84QD4/VNoNE0YXn8I/AAAAAAAAAX0/b3wtV48fuB0/s1600/Screenshot%2B2015-02-10%2B13.51.56.png" alt></p>
<blockquote>
<p>å›¾ç‰‡æ¥è‡ªå‚è€ƒé“¾æ¥2</p>
</blockquote>
<ul>
<li>æ‰€ä»¥ä»å›¾ç‰‡é‡Œé¢çœ‹å‡ºæ¥ï¼Œcassandraæ”¶åˆ°ä¸€ä¸ªbatchçš„requestçš„æ—¶å€™ï¼š
<ul>
<li>ç”±co-ordinatoræ¥å¤„ç†ï¼Œä¹Ÿå°±æ˜¯ç§å­èŠ‚ç‚¹</li>
<li>ä¼šå…ˆå†™batch logï¼Œé€šå¸¸å†™ä¸¤ä¸ªnodeï¼Ÿ</li>
<li>ç„¶åå†ä»ç§å­èŠ‚ç‚¹å†™åˆ°å„ä¸ªåˆ†èŠ‚ç‚¹</li>
</ul>
</li>
<li>æŒ‰ç…§å‚è€ƒé“¾æ¥2é‡Œé¢çš„æè¿°ï¼Œperformance hitï¼Œperformanceä¼šä¸‹é™çš„ã€‚å› ä¸ºå¤šåšäº†å¾ˆå¤šäº‹æƒ…ï¼Œè€Œä¸”æ˜¯ä»ç§å­èŠ‚ç‚¹åˆ†å‘å‡ºå»çš„ã€‚</li>
<li>ç»“è®ºå°±æ˜¯ï¼šåªæœ‰åœ¨ä¸ºäº†ä¿è¯ä¸€è‡´æ€§çš„æƒ…å†µä¸‹ï¼Œæ‰ä½¿ç”¨batchï¼Œè€Œä¸æ˜¯è¯´æ”¹å–„performance</li>
</ul>
<h4 id="logged-batch-fail"><a class="header-anchor" href="#logged-batch-fail"></a>LOGGED Batch Fail</h4>
<ul>
<li>é¦–å…ˆä¸ä¼šå›æ»š</li>
<li>WriteTimeoutException with write type of BATCH_LOG. è¯´æ˜åœ¨å†™batch logæ—¶å€™æŒ‚äº†ã€‚éœ€è¦æ‰‹åŠ¨å†å‘ä¸€ä¸‹ã€‚</li>
<li>WriteTimeoutException with the write type of BATCHã€‚ åœ¨çœŸæ­£å†™requestçš„æ—¶å€™å‡ºé”™äº†ã€‚cassandraä¼šä¸æ–­é‡å¤ï¼Œç›´è‡³æˆåŠŸã€‚</li>
</ul>
<h3 id="å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3>
<ol>
<li><a href="https://stackoverflow.com/questions/22664129/atomic-batches-in-cassandra" target="_blank" rel="noopener">Atomic Batches in Cassandra</a></li>
<li><a href="http://christopher-batey.blogspot.com/2015/03/cassandra-anti-pattern-cassandra-logged.html" target="_blank" rel="noopener">Cassandra anti-pattern: Logged batches</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/hexo_blog/2019/03/11/Javaå¤šçº¿ç¨‹æ•°æ®ç±»å‹/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexo_blog/2019/03/11/Javaå¤šçº¿ç¨‹æ•°æ®ç±»å‹/" itemprop="url">Javaå¤šçº¿ç¨‹æ•°æ®ç±»å‹</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-03-11T10:22:53+08:00">
                2019-03-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è¿™ç¯‡è®°å½•æ”¹æˆä¸“é—¨è®°å½•å’Œå¤šçº¿ç¨‹ç›¸å…³çš„æ•°æ®ç±»å‹</p>
<h3 id="executors"><a class="header-anchor" href="#executors"></a>Executors</h3>
<p>è¿™ä¸ª<code>Executors</code>æ²¡æœ‰ç»§æ‰¿æˆ–è€…å®ç°ä»»ä½•å…¶ä»–ç±»ã€‚å°±æ˜¯è¯´ï¼Œä»–å˜å˜£è‡ªå·±ä¸€ä¸ªã€‚å®é™…ä¸Šæ˜¯ä¸€ä¸ªå·¥å…·ç±»å•Šï¼Œæ›´ç¡®åˆ‡åœ°è¯´ï¼Œåƒä¸€ä¸ªå·¥å‚ç±»ã€‚ä¸»è¦åŠŸèƒ½æ˜¯è¿”å›å„ç§<code>ExecutorService</code>ã€‚<br>
å…¶å®å°±æ˜¯<code>new</code>å‡ºå„ç§<code>ThreadPoolExecutor</code>ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code>public static ExecutorService newSingleThreadExecutor() {
    return new FinalizableDelegatedExecutorService
        (new ThreadPoolExecutor(1, 1,
                                0L, TimeUnit.MILLISECONDS,
                      new LinkedBlockingQueue&lt;Runnable&gt;()));
}
</code></pre>
<h3 id="executorservice"><a class="header-anchor" href="#executorservice"></a>ExecutorService</h3>
<h4 id="æ¦‚è§ˆ"><a class="header-anchor" href="#æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h4>
<pre><code>public interface ExecutorService extends Executor
</code></pre>
<ul>
<li>æ‰€ä»¥é¦–å…ˆæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¥å£</li>
<li>Executoræ¥å£å¾ˆç®€å•ï¼Œåªæœ‰ä¸€ä¸ªexecuteæ–¹æ³•ã€‚ExecutorServiceé™¤äº†è¿™ä¸€ä¸ªæ–¹æ³•ï¼Œè¿˜å¢åŠ äº†ä¸€äº›æ–¹æ³•ï¼Œå¢åŠ çš„æ–¹æ³•åŒ…æ‹¬ï¼š<code>awaitTerminate</code>ï¼Œ<code>invokeAll</code>ï¼Œ<code>invokeAny</code>ï¼Œ<code>shutdown</code>ï¼Œ<code>shutdownNow</code>ï¼Œ<code>submit</code>ç­‰ã€‚</li>
<li><a href="https://www.cnblogs.com/Steven0805/p/6393443.html" target="_blank" rel="noopener">Javaçº¿ç¨‹æ± ExecutorService</a></li>
</ul>
<h4 id="å‡ ç§å¸¸ç”¨çº¿ç¨‹æ± çš„å…·ä½“å®ç°"><a class="header-anchor" href="#å‡ ç§å¸¸ç”¨çº¿ç¨‹æ± çš„å…·ä½“å®ç°"></a>å‡ ç§å¸¸ç”¨çº¿ç¨‹æ± çš„å…·ä½“å®ç°</h4>
<ul>
<li>ç„¶åæœ‰æ„æ€çš„æ¥äº†ï¼š</li>
<li>Javaé€šè¿‡Executors classæä¾›äº†å¥½å‡ ç§çº¿ç¨‹æ± ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„å‡ ç§äº†ã€‚</li>
<li><code>newFixedThreadPool</code>ï¼šå°±æ˜¯è¯´è¿™ä¸ªç©æ„ï¼Œé™å®šå¥½äº†æœ€å¤§æ•°ç›®ï¼Œæ ¸å¿ƒæ•°ç›®ï¼Œç„¶åæœ¬è´¨æ˜¯ä¸€ä¸ª<code>LinkedBlockingQueue</code>å¥—äº†<code>runnable</code></li>
</ul>
<pre><code> public static ExecutorService newFixedThreadPool(int nThreads) {
    return new ThreadPoolExecutor(nThreads, nThreads,
                                  0L, TimeUnit.MILLISECONDS,
                                  new LinkedBlockingQueue&lt;Runnable&gt;());
</code></pre>
<ul>
<li><code>newCachedThreadPool</code>ï¼š</li>
</ul>
<pre><code>   public static ExecutorService newCachedThreadPool() {
    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,
                                  60L, TimeUnit.SECONDS,
                                  new SynchronousQueue&lt;Runnable&gt;());    }
</code></pre>
<ul>
<li>è¿˜æœ‰<code>newScheduledThreadPool</code>å’Œ<code>newSingleThreadExecutor</code></li>
</ul>
<h4 id="ä¸€äº›è¦ç‚¹"><a class="header-anchor" href="#ä¸€äº›è¦ç‚¹"></a>ä¸€äº›è¦ç‚¹</h4>
<ul>
<li><code>submit</code>ä¸<code>execute</code>çš„åŒºåˆ«ï¼š
<ul>
<li>submitæ¥å—runnableå’Œcallable  æœ‰è¿”å›å€¼ã€‚</li>
<li>executeæ¥å—runnable æ— è¿”å›å€¼</li>
<li>submitæ–¹ä¾¿Exceptionå¤„ç†</li>
</ul>
</li>
<li>Runnableä¸CallableåŒºåˆ«
<ul>
<li>runnableæ¥å£å®ç°çš„æ²¡æœ‰è¿”å›å€¼çš„å¹¶å‘ç¼–ç¨‹ã€‚</li>
<li>callableå®ç°çš„å­˜åœ¨è¿”å›å€¼çš„å¹¶å‘ç¼–ç¨‹ã€‚ä½¿ç”¨Futureè·å–è¿”å›å€¼ã€‚</li>
</ul>
</li>
</ul>
<h3 id="threadpoolexecutor"><a class="header-anchor" href="#threadpoolexecutor"></a>ThreadPoolExecutor</h3>
<pre><code>public abstract class AbstractExecutorService implements ExecutorService
public class ThreadPoolExecutor extends AbstractExecutorService    
</code></pre>
<ul>
<li>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºæ¥ï¼ŒThreadPoolExecutorä¹Ÿæ˜¯ä¸€ç§Executorï¼Œç»§æ‰¿è‡ªAbstractExecutorServiceï¼Œè‡ªç„¶ä¹Ÿå®ç°äº†ExecutorService.</li>
<li><a href="https://www.cnblogs.com/zedosu/p/6665306.html" target="_blank" rel="noopener">ThreadPoolExecutorä½¿ç”¨è¯¦è§£</a></li>
</ul>
<h4 id="threadpoolexecutor-shutdown"><a class="header-anchor" href="#threadpoolexecutor-shutdown"></a>ThreadPoolExecutor shutdown</h4>
<p>ThreadPoolExecutor æœ‰ä¸‰ä¸ªshutdownæ–¹æ³•ï¼š <code>shutdown</code>ã€<code>shutdownNow</code>ã€<code>awaitTermination</code></p>
<ul>
<li>
<p><code>shutdown</code>ï¼š åœæ­¢æ¥æ”¶å¤–éƒ¨submitçš„ä»»åŠ¡ï¼›å†…éƒ¨æ­£åœ¨è·‘çš„ä»»åŠ¡å’Œé˜Ÿåˆ—é‡Œç­‰å¾…çš„ä»»åŠ¡ï¼Œä¼šæ‰§è¡Œå®Œã€‚å…¶å®graceful shutdownçš„æ„Ÿè§‰å•Š</p>
</li>
<li>
<p><code>shutdownNow</code>ï¼š åœæ­¢æ¥æ”¶å¤–éƒ¨æäº¤çš„ä»»åŠ¡ï¼›å¿½ç•¥é˜Ÿåˆ—é‡Œç­‰å¾…çš„ä»»åŠ¡ï¼›å°è¯•å°†æ­£åœ¨è·‘çš„ä»»åŠ¡interruptä¸­æ–­ï¼›è¿”å›æœªæ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚å¼ºåˆ¶ä¸­æ–­ã€‚çº¿ç¨‹ä¼šæ”¶åˆ°InterupptedException.</p>
<ul>
<li>éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªæ–¹æ³•ä»…ä»…æ˜¯å°è¯•ä¸­æ–­çº¿ç¨‹ï¼Œå®ƒé€šè¿‡çš„æ˜¯è°ƒç”¨interruptæ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•çš„ä½œç”¨æœ‰é™ï¼Œå¦‚æœçº¿ç¨‹ä¸­æ²¡æœ‰sleep ã€waitã€Conditionã€å®šæ—¶é”ç­‰åº”ç”¨, interrupt()æ–¹æ³•æ˜¯æ— æ³•ä¸­æ–­å½“å‰çš„çº¿ç¨‹çš„ã€‚</li>
</ul>
</li>
<li>
<p><code>awaitTermination</code>ï¼šåªæ˜¯åŠ äº†ä¸€ä¸ªwaitæ—¶é—´çš„é™åˆ¶</p>
<ul>
<li>å¾ˆå¤šåšå®¢çš„é‡Œé¢ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¿”å›booleançš„è¿”å›å€¼ã€‚å°±æ˜¯è¯´<code>awaitTermination</code>ä¸€èˆ¬å’Œ<code>shutdown</code>æ­é…ä½¿ç”¨ï¼Œ<code>awaitTermination</code>æ¥ç›‘æ§çº¿ç¨‹æœ‰æ²¡æœ‰ç»“æŸå¥½ã€‚ç»“æŸäº†è¿”å›<code>true</code>ï¼Œæ²¡ç»“æŸè¿”å›<code>false</code></li>
<li>è¿™ä¸ªå‡½æ•°è¿˜ä¼šæŠ›å‡ºInterupptedExceptionï¼Œä½†æ˜¯çœ‹ä»£ç æ²¡å¤ªæ˜ç™½ä»€ä¹ˆçŠ¶å†µä¸‹ä¼šæŠ›è¿™ä¸ª<code>exception</code>ã€‚ä½†æ˜¯æ˜¯è¿™ä¸ªå‡½æ•°æœ¬èº«è¢«interruptäº†ã€‚</li>
<li>æœ‰ä¸€ç‚¹ä¸å¤ªæ˜ç™½ï¼Œçº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ï¼Œå¤„äºé˜»å¡çŠ¶æ€æ—¶å€™ï¼Œè¿˜ä¼šæ¥æ”¶æ¶ˆæ¯ï¼Ÿåªæ˜¯ä¸å¤„ç†ï¼Ÿ</li>
<li>åœ¨å®é™…å·¥ä½œä¸­è§£å†³bugç¢°åˆ°äº†è¿™ç»„å‡½æ•°ã€‚äº‹å®ä¸Šå°±æ˜¯è¦ä¸‰ä¸ªä¸€èµ·ç”¨çš„ã€‚<code>awaitTermination</code>åªä¼šè¿”å›ä¸€ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸ä¼šåšä»»ä½•çš„äº‹æƒ…ã€‚æ‰€ä»¥åœ¨è¿™ä¸ªå‡½æ•°è¿”å›falseçš„æ—¶å€™åº”è¯¥è¦è°ƒç”¨<code>shutdownNow</code>æ–¹æ³•æ¥è¿›ä¸€æ­¥ä¸­æ–­çº¿ç¨‹</li>
</ul>
</li>
<li>
<p>å‚è€ƒé“¾æ¥</p>
<ul>
<li><a href="https://blog.csdn.net/u012168222/article/details/52790400" target="_blank" rel="noopener">shutdown æ–¹æ³•</a></li>
<li><a href="https://blog.csdn.net/zaozi/article/details/38854561#commentBox" target="_blank" rel="noopener">ExecutorServiceçš„æ­£ç¡®å…³é—­æ–¹æ³•</a>ï¼š è¿™ç¯‡æ–‡ç« æ¯”å–»å¾—å¾ˆæ¸…æ¥šï¼Œåªæ˜¯ä¸çŸ¥é“æ­£ç¡®ä¸å¦</li>
</ul>
</li>
<li>
<ul>
<li><a href="https://blog.csdn.net/liwenxia626/article/details/80754886" target="_blank" rel="noopener">csdnçš„å¦ä¸€ç¯‡åšå®¢</a></li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/hexo_blog/2019/03/04/TLS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexo_blog/2019/03/04/TLS/" itemprop="url">SSL/TLSç›¸å…³çŸ¥è¯†</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-03-04T14:50:11+08:00">
                2019-03-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/security/" itemprop="url" rel="index">
                    <span itemprop="name">security</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2>
<ul>
<li><a href="https://xz.aliyun.com/t/2526" target="_blank" rel="noopener">SSL/TLSåè®®è¯¦è§£(ä¸Š)ï¼šå¯†ç å¥—ä»¶ï¼Œå“ˆå¸Œï¼ŒåŠ å¯†ï¼Œå¯†é’¥äº¤æ¢ç®—æ³•</a>
<ul>
<li>è‹±æ–‡ç‰ˆ: <a href="https://www.wst.space/ssl-part1-ciphersuite-hashing-encryption/" target="_blank" rel="noopener">SSL/TLS for dummies part 1 : Ciphersuite, Hashing,Encryption</a></li>
</ul>
</li>
<li><a href="https://xz.aliyun.com/t/2530" target="_blank" rel="noopener">SSL/TLSåè®®è¯¦è§£(ä¸­)â€”â€”è¯ä¹¦é¢å‘æœºæ„</a></li>
<li><a href="https://xz.aliyun.com/t/2531" target="_blank" rel="noopener">SSL/TLSåè®®è¯¦è§£(ä¸‹)â€”â€”TLSæ¡æ‰‹åè®®</a></li>
<li>ä»¥ä¸Šæ˜¯ä¸€ä¸ªç³»åˆ—ï¼ŒçœŸçš„æ˜¯è¯¦è§£ï¼Œéå¸¸è¯¦å°½ã€‚</li>
</ul>
<h2 id="åŠ å¯†ç®—æ³•"><a class="header-anchor" href="#åŠ å¯†ç®—æ³•"></a>åŠ å¯†ç®—æ³•</h2>
<ul>
<li>è¿™è¾¹ä¸»è¦æ˜¯å‚è€ƒäº†ä¸Šé¢å‚è€ƒé“¾æ¥é‡Œé¢çš„ç¬¬ä¸€ç¯‡ï¼Œæ€»çš„æ¥è¯´ï¼Œåº”è¯¥äº†è§£ä¸€ä¸‹è¿™äº›</li>
</ul>
<h3 id="å“ˆå¸Œç®—æ³•"><a class="header-anchor" href="#å“ˆå¸Œç®—æ³•"></a>å“ˆå¸Œç®—æ³•</h3>
<ul>
<li>å“ˆå¸Œç®—æ³•ç”Ÿæˆçš„æ•°æ®æ ¼å¼è¢«ç§°ä¸ºæ•£åˆ—ï¼Œæ•£åˆ—ä¸æ˜¯ä¸€ä¸ªå¯é€†çš„è¿‡ç¨‹ã€‚è€Œä¹‹å‰è¯´è¿‡ï¼Œ<code>Base64</code>åªæ˜¯ç¼–ç ï¼Œé¡¾åæ€ä¹‰ï¼Œç¼–ç åªè¦çŸ¥é“è§„åˆ™ï¼Œæ˜¯å¯ä»¥è§£ç çš„ï¼Œæ²¡æœ‰å®‰å…¨æ€§å¯è¨€ã€‚</li>
<li>æ‰€ä»¥è®²å¯†ç å“ˆå¸Œä¸€ä¸‹ï¼Œæ˜¯æ²¡æ³•çœ‹å‡ºæ¥åŸå§‹å¯†ç æ˜¯ä»€ä¹ˆçš„ã€‚</li>
<li>è¿™è¾¹å¯ä»¥æ‰©å±•ï¼Œè¿›ä¸€æ­¥ç ”ç©¶çš„æ˜¯ï¼Œå¦‚æœè¿›è¡Œæ”»å‡»çš„è¯ï¼Œç§°ä¸ºå­—å…¸æ”»å‡»ï¼Œå°±æ˜¯çŒœå¯†ç ï¼Œå°†å¸¸ç”¨çš„éƒ½å“ˆå¸Œä¸€ä¸‹ï¼Œå»å¯¹æ¯”ã€‚</li>
<li>å“ˆå¸Œç®—æ³•æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚<code>MD5</code>æ˜¯ä¸€ç§ï¼Œè™½ç„¶ä¹‹å‰è¯´å°±æ˜¯æå–æ‘˜è¦çš„ã€‚<code>SHA-512</code>æ˜¯å¦ä¸€ç§ã€‚</li>
</ul>
<h3 id="åŠ å¯†"><a class="header-anchor" href="#åŠ å¯†"></a>åŠ å¯†</h3>
<ul>
<li><em>Encryption lies in between hashing and encoding</em> è¿™å¥æ²¡çœ‹æ˜ç™½</li>
<li>åŠ å¯†ç®—æ³•å¯ä»¥åˆ†ä¸ºå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ä¸¤ç§</li>
</ul>
<h4 id="å¯¹ç§°åŠ å¯†"><a class="header-anchor" href="#å¯¹ç§°åŠ å¯†"></a>å¯¹ç§°åŠ å¯†</h4>
<ul>
<li>ä¸»è¦æ¥è‡ªå‚è€ƒé“¾æ¥ä¸€ï¼Œ å¯¹ç§°åŠ å¯†çš„è¯ï¼Œæ–‡ç« ä¸­ç”¨ä¸€ä¸ªä¾‹å­æ¥è®²è§£ï¼šâ€œç§»ä½â€ã€‚æ¯”å¦‚æœ‰æ•°å­—&quot;123&quot;ï¼Œå¯¹å…¶è¿›è¡ŒåŠ å¯†ï¼Œéƒ½å¢å¤§3ï¼Œæˆä¸ºâ€œ456â€ï¼Œå°±æ˜¯å¯¹ç§°åŠ å¯†äº†ã€‚</li>
<li>å…¶ä¸­çš„æ•°å­—3å°±æ˜¯<code>Encryption key (symmetric key)</code>ã€‚å¯¹ç§°åŠ å¯†çš„æ—¶å€™ï¼ŒçŸ¥é“<code>key</code>çš„è¯ï¼Œå°±å¯ä»¥è¿›è¡Œè§£å¯†äº†ã€‚</li>
<li><em>Anyone who knows the encryption key and can apply the reverse of Caesarâ€™s algorithm and retrieve the original Plaintext.</em></li>
<li>æœ‰æ­¤å¯çŸ¥ï¼Œåœ¨<code>TLS</code>ä¸­ä½¿ç”¨ç®€å•çš„å¯¹ç§°åŠ å¯†ä¸æ˜¯å¾ˆå®‰å…¨çš„ã€‚æ¯•ç«ŸçŸ¥é“<code>Encryption key</code>å°±å¯ä»¥è¿›è¡Œè§£å¯†äº†ã€‚å¯¹ç§°åŠ å¯†ä¸€ä»£ä»£å‘å±•ï¼Œç°åœ¨ä¹Ÿæœ‰æ¯”è¾ƒå¤æ‚çš„ç®—æ³•ï¼Œæ¯”å¦‚<code>Triple Data Encryption Algorithm</code>ï¼Œåé¢å¯ä»¥å†è¿›ä¸€æ­¥ç ”ç©¶ã€‚</li>
<li>ä»è¿‡ç¨‹å¯ä»¥çŸ¥é“ï¼Œ<code>key</code>æ˜¯éå¸¸å…³é”®çš„ã€‚ä½†æ˜¯ç”±äºæ˜¯å¯¹ç§°åŠ å¯†è§£å¯†ï¼ŒåŒæ–¹å¿…é¡»éƒ½çŸ¥é“çº¦å®šçš„å€¼ï¼Œé‚£ä¹ˆç¬¬ä¸€æ­¥å°±æ˜¯ä¼ é€’<code>key</code>ï¼Œè€Œè¿™ä¸ªæ—¶å€™æ˜¯æ²¡æ³•åŠ å¯†çš„ã€‚æ‰€ä»¥å°±å‡ºç°äº†ä¸å¯¹ç§°åŠ å¯†ã€‚<em>So we need a secure mechanism to exchange the keys without an attacker actually seeing it. There comes the role of Asymmetric Key Encryption.</em></li>
</ul>
<h4 id="ä¸å¯¹ç§°åŠ å¯†"><a class="header-anchor" href="#ä¸å¯¹ç§°åŠ å¯†"></a>ä¸å¯¹ç§°åŠ å¯†</h4>
<ul>
<li>ä¸å¯¹ç§°åŠ å¯†å§‹äº<code>RSA</code>ç®—æ³•ã€‚ç®€å•çš„è§£é‡Šå°±æ˜¯ï¼Œç”¨ä¸åŒçš„<code>key</code>æ¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚</li>
<li>å…¬é’¥ç”¨æ¥ç»™å¯¹æ–¹ä½¿ç”¨ï¼Œæ¯”å¦‚Aæƒ³ç»™Bå‘æ¶ˆæ¯ï¼Œé‚£ä¹ˆAéœ€è¦ä½¿ç”¨Bçš„å…¬é’¥æ¥åŠ å¯†è‡ªå·±çš„æ¶ˆæ¯ã€‚</li>
<li>ç§é’¥ç”¨æ¥è§£å¯†æ”¶åˆ°çš„æ¶ˆæ¯ã€‚æ¯”å¦‚Aæ”¶åˆ°äº†ä¸€æ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆAåº”å½“ä½¿ç”¨è‡ªå·±çš„ç§é’¥æ¥è§£å¯†æ”¶åˆ°çš„æ¶ˆæ¯</li>
<li>æ‰€ä»¥<code>RSA</code>ç®—æ³•æœ‰å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ç»„æˆï¼Œç§é’¥ï¼Œå…¬é’¥ï¼ŒåŠ å¯†ç®—æ³•å’Œè§£å¯†ç®—æ³•</li>
<li>é‚£ä¹ˆä¸€ä¸ªä¸¥è‚ƒçš„é—®é¢˜å°±æ˜¯ï¼Œä¸åŒçš„é’¥åŒ™è¿›è¡Œè®¡ç®—çš„æ¶ˆæ¯ï¼Œæ€ä¹ˆèƒ½å¤Ÿè§£å¼€å‘¢ï¼Ÿæ¥ä¸‹æ¥å°±æ˜¯æ•°å­¦è¯¾çš„æ—¶é—´äº†ã€‚
<ul>
<li>å‚è€ƒé“¾æ¥ï¼š
<ul>
<li><a href="https://blog.csdn.net/dbs1215/article/details/48953589" target="_blank" rel="noopener">å¸¦ä½ å½»åº•ç†è§£RSAç®—æ³•åŸç†</a></li>
<li><a href="https://www.zhihu.com/question/25038691" target="_blank" rel="noopener">RSA ç®—æ³•çš„åŠ å¯†åŸç†æ˜¯ä»€ä¹ˆ,çŸ¥ä¹é—®ç­”</a></li>
</ul>
</li>
<li>äº’è´¨æ•°ï¼š åªæœ‰ä¸€ä¸ªå…¬å› å­ä¸º1çš„æ•°ã€‚æ¯”å¦‚6å’Œ9ï¼Œéƒ½æœ‰å…¬å› å­ä¸º3ï¼Œé‚£ä¹ˆå°±ä¸æ˜¯äº’è´¨æ•°ï¼›è€Œ7å’Œ9åªæœ‰å…¬å› å­ä¸º1ï¼Œå°±æ˜¯äº’è´¨æ•°ã€‚</li>
<li>æ¬§æ‹‰å‡½æ•°ï¼š<code>Ï†(n)</code>ã€‚ å°äºæˆ–ç­‰äºnçš„æ­£æ•´æ•°ä¸­ä¸näº’è´¨çš„æ•°çš„æ•°ç›®ã€‚</li>
<li>ä¸‰ä¸ªæ¨ªçº¿çš„å¥‡æ€ªç­‰å·æ˜¯æ’ç­‰äºã€‚</li>
<li>ç”Ÿæˆå…¬é’¥ï¼šéšæœºé€‰å–ä¸¤ä¸ªè´¨æ•°<code>p1ã€p2</code>ï¼Œ<code>n=p1*p2</code>ï¼Œå†éšæœºé€‰å–ä¸€ä¸ªæ•´æ•°<code>e</code>ï¼Œ<code>e</code>ä¸<code>Ï†(n)</code>äº’è´¨ã€‚å…¬é’¥å°±æ˜¯<code>(e, n)</code>ã€‚</li>
<li>æ ¹æ®æ¬§æ‹‰å‡½æ•°å®šç†ï¼Œ<code>Ï†(n) = (p1-1)*(p2-1)</code></li>
<li>è´¹é©¬å®šç†ï¼šè‹¥pæ˜¯ç´ æ•°ï¼Œaä¸päº’ç´ ï¼Œåˆ™<code>a^(p-1ï¼‰â‰¡1 ï¼ˆmod pï¼‰</code> æ²¡çœ‹æ‡‚è¿™ä¸ªè´¹é©¬å®šç†</li>
<li>åŠ å¯†ç®—æ³•ï¼šå‡è®¾<code>m</code>ä¸ºéœ€è¦åŠ å¯†çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆ<code>(m^e) mod n</code>å°±åŠ å¯†å¥½äº†ï¼Œç”ŸæˆåŠ å¯†åçš„ä¿¡æ¯<code>c</code></li>
<li>è§£å¯†ç®—æ³•ï¼š è§£å¯†ç®—æ³•å…¶å®å’ŒåŠ å¯†ç®—æ³•çš„å…¬å¼æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œåªæ˜¯è¿™é‡Œçš„<code>m</code>å’Œ<code>e</code>æ¢æˆ<code>c</code>å’Œ<code>d</code>ï¼Œæˆä¸º<code>(c^d) mod n</code>ã€‚ç›¸å½“äºé‡‡ç”¨å…¬å¼éƒ½æ˜¯<code>(x^y) mod n</code>ï¼Œæ‰€ä»¥å…¶å®ä½¿ç”¨çš„å…¬å¼æ˜¯ä¸€æ ·çš„</li>
<li>é‚£ä¹ˆè¿™é‡Œçš„<code>(d, n)</code>å°±è¢«æˆä¸ºç§é’¥ã€‚é‚£ä¹ˆå¦‚ä½•å¾—åˆ°<code>d</code>å‘¢ï¼Ÿçƒ§è„‘çš„æ•°å­¦å°±æ¥äº†ã€‚æœç„¶æ•°å­¦ç³»æ‰æœ‰å‰é€”å•Š ğŸ˜‚ å®åœ¨æ˜¯é¢‡ä¸ºçƒ§è„‘å•Šã€‚</li>
<li>å„ä¸ªå‚è€ƒé“¾æ¥ä¸­å‡æœ‰å®é™…çš„ä¾‹å­ï¼Œæˆ‘è¿™é‡Œå°±ä¸å†çƒ§è„‘æ¥çœ‹äº†</li>
<li>å‚è€ƒé“¾æ¥ï¼š
<ul>
<li><a href="https://blog.csdn.net/qq_38313548/article/details/85387466" target="_blank" rel="noopener">å¦‚ä½•è·å¾—d</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>(c^d) mod n = ((m^e)mod n)^d mod n = (m^ed) mod n = m
(m^Ï†(n)) mod nâ‰¡1 åˆ 1^kâ‰¡1, æ‰€ä»¥(m^k*Ï†(n)) mod nâ‰¡1 ï¼Œæ‰€ä»¥(m^(k*Ï†(n)+1)) mod nâ‰¡m
ç»“åˆä»¥ä¸Šä¸¤æ¡ï¼Œed=k*Ï†(n)+1 , d=(k*Ï†(n)+1)/e
</code></pre>
<h2 id="sslç›¸å…³çŸ¥è¯†"><a class="header-anchor" href="#sslç›¸å…³çŸ¥è¯†"></a>SSLç›¸å…³çŸ¥è¯†</h2>
<p><code>KeyStore</code>å·¥ä½œä¸­ç¢°åˆ°çš„ä¸å°‘ã€‚ç›¸å…³çš„é—®é¢˜å…ˆæ”¾è¿™é‡Œå§ã€‚</p>
<h3 id="tlsç‰ˆæœ¬"><a class="header-anchor" href="#tlsç‰ˆæœ¬"></a>TLSç‰ˆæœ¬</h3>
<ul>
<li><code>SSL3.0</code> å’Œ <code>TLS1.0</code> æ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚å—¯ï¼Œå¾®è½¯å¹²çš„ã€‚å¾®è½¯è™½ç„¶æ˜¯ä¸€ä¸ªä¼Ÿå¤§çš„å…¬å¸ï¼Œä½†æ˜¯è¿™ä¸ªå¹²å¾—ä¸å¥½ï¼Œç›¸å½“ä¸å¥½ï¼Œè‡³å°‘æˆ‘æœ¬äººè§‰å¾—ä¸å¥½ã€‚å®åœ¨æ˜¯é™¤äº†å¢åŠ å¤§å®¶çš„æ··æ·†ä»¥å¤–ï¼Œæ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚å˜›ï¼Œæˆ‘ä»¬è‡ªå·±çš„äº§å“ä¹Ÿç»å¸¸å¹²è¿™ç§äº‹æƒ…ã€‚é€šå¸¸å‘¢ï¼Œæ˜¯å› ä¸ºè‡ªå·±è®¤ä¸ºå‘ç”Ÿäº†è·¨æ—¶ä»£çš„æ”¹å˜ï¼Œå¸Œæœ›è®©åˆ«äººä¹Ÿæ˜ç™½ã€‚</li>
<li>ç›®å‰æœ€æµè¡Œçš„ç‰ˆæœ¬æ˜¯<code>TLS1.2</code>ï¼Œæœ€æ–°çš„ç‰ˆæœ¬æ˜¯<code>TLS1.3</code>ã€‚</li>
<li><code>java8</code>ä¸­é»˜è®¤çš„æ˜¯<code>TLS1.2</code>ç‰ˆæœ¬ã€‚<code>java11</code>é‡Œé¢æ”¯æŒçš„æ˜¯<code>TLS1.3</code></li>
<li>å„ç§<code>web</code>åº”ç”¨æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶é‡Œé¢éƒ½å¯ä»¥é…ç½®æ”¯æŒæˆ–è€…ä¸æ”¯æŒçš„ç‰ˆæœ¬ã€‚æ¯”å¦‚<code>tomcat</code>æä¾›äº†å‚æ•°:<code>sslEnabledProtocols</code></li>
</ul>
<h4 id="å¦‚ä½•å‘ç°æˆ‘çš„æµè§ˆå™¨ä½¿ç”¨çš„tlsç‰ˆæœ¬"><a class="header-anchor" href="#å¦‚ä½•å‘ç°æˆ‘çš„æµè§ˆå™¨ä½¿ç”¨çš„tlsç‰ˆæœ¬"></a>å¦‚ä½•å‘ç°æˆ‘çš„æµè§ˆå™¨ä½¿ç”¨çš„TLSç‰ˆæœ¬</h4>
<ul>
<li>å› ä¸ºè¦æµ‹è¯•<code>tomcat</code>é‡Œé¢é…ç½®çš„å‚æ•°æ˜¯å¦ç”Ÿæ•ˆï¼Œæ‰€ä»¥ç¬¬ä¸€ååº”å°±æ˜¯æˆ‘å’‹çŸ¥é“å‘¢ã€‚åæ¥ç»åŒäº‹æç‚¹ï¼Œå…¶å®ç”¨<code>openssl</code>å°±å¯ä»¥äº†ã€‚å½“ç„¶ï¼Œç›®å‰ï¼Œæˆ‘è¿˜ä¸çŸ¥é“å½“å¦‚ä½•ä½¿ç”¨ã€‚</li>
<li>åœ¨æµè§ˆå™¨çš„é…ç½®ä¸­èƒ½çœ‹åˆ°ï¼Œ æ¯”å¦‚IE, <code>File</code>-&gt;<code>Properties</code>, åœ¨<code>Connection</code>ä¸€æ å°±èƒ½çœ‹åˆ°ã€‚</li>
<li>å‚è€ƒé“¾æ¥ï¼š
<ul>
<li><a href="https://www.thesslstore.com/blog/google-chrome-72-deprecates-support-for-tls-1-0-tls-1-1/" target="_blank" rel="noopener">chromeå¦‚ä½•é…ç½®å’ŒæŸ¥çœ‹</a></li>
<li><a href="https://security.stackexchange.com/questions/19096/how-to-determine-if-a-browser-is-using-an-ssl-or-tls-connection/169418" target="_blank" rel="noopener">å¦‚ä½•æŸ¥çœ‹websiteçš„TLSç‰ˆæœ¬</a></li>
</ul>
</li>
</ul>
<h4 id="å¦‚ä½•æµ‹è¯•tlsè¿æ¥"><a class="header-anchor" href="#å¦‚ä½•æµ‹è¯•tlsè¿æ¥"></a>å¦‚ä½•æµ‹è¯•TLSè¿æ¥</h4>
<ul>
<li>è¿™ä¸ªæ˜¯åˆšéœ€å•Šåˆšéœ€ã€‚æˆ‘æƒ³ä½¿ç”¨<code>openssl</code>è‚¯å®šä¹Ÿæ˜¯å¯ä»¥çš„ã€‚è¿™å›ä½¿ç”¨çš„æ˜¯<code>curl</code>å‘½ä»¤ã€‚</li>
<li><code>curl help</code>ä¸€ä¸‹å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨å‚æ•°å°±å¯ä»¥æŒ‡å®š<code>TLS</code>ç‰ˆæœ¬ï¼Œè¿˜æ˜¯å¾ˆå¥½ç”¨çš„ã€‚</li>
</ul>
<h3 id="tlså’Œoauth"><a class="header-anchor" href="#tlså’Œoauth"></a>TLSå’ŒOAuth</h3>
<ul>
<li><a href="https://stackoverflow.com/questions/8378664/does-an-oauth-2-client-really-need-tls" target="_blank" rel="noopener">does-an-oauth-2-client-really-need-tls</a>ï¼š æˆ‘è‡ªå·±æœ‰ç‚¹æä¸æ¸…æ¥šè¿™äº›çš„å…³ç³»ï¼Œè¿™è¾¹æœ‰ä¸€ä¸ªè§£é‡Šå¾ˆæ˜¯æ¸…æ™°ï¼Œçœ‹äº†å°±æ˜ç™½äº†
<ul>
<li><em>3.1.2.1.  Endpoint Request Confidentiality If a redirection request will result in the transmission of an authorization code or access token over an open network (between the resource ownerâ€™s user-agent and the client), the client SHOULD require the use of a transport-layer security mechanism.</em> è¿™ä¸ªæ˜¯<code>Oauth</code>å®˜æ–¹æ–‡æ¡£é‡Œé¢çš„ä¸€æ®µè¯ã€‚</li>
<li>ä¸Šé¢ä¸€æ®µçš„æ„æ€åº”è¯¥æ˜¯è¿™æ ·çš„ï¼šä¸€ä¸ªç¬¬ä¸‰æ–¹è®¤è¯çš„è¯·æ±‚åœ¨ä¼ è¾“<code>authorization code</code>æˆ–è€…<code>access token</code>çš„æ—¶å€™åº”å½“åœ¨ä¼ è¾“å±‚ä½¿ç”¨å®‰å…¨æœºåˆ¶ã€‚è¿™é‡Œçš„å®‰å…¨æœºåˆ¶å°±æ˜¯æŒ‡<code>TLS</code>åè®®ã€‚</li>
</ul>
</li>
</ul>
<h3 id="tlsåŒå‘æ¡æ‰‹"><a class="header-anchor" href="#tlsåŒå‘æ¡æ‰‹"></a>TLSåŒå‘æ¡æ‰‹</h3>
<h3 id="keystoreå’Œtruststore"><a class="header-anchor" href="#keystoreå’Œtruststore"></a>KeyStoreå’ŒTrustStore</h3>
<ul>
<li>keystoreå’Œtruststoreä»å…¶æ–‡ä»¶æ ¼å¼æ¥çœ‹å…¶å®æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†å°†å…¶åˆ†å¼€</li>
<li>keystoreä¸­ä¸€èˆ¬ä¿å­˜çš„æ˜¯æˆ‘ä»¬çš„ç§é’¥ï¼Œç”¨æ¥åŠ è§£å¯†æˆ–è€…ä¸ºåˆ«äººåšç­¾å</li>
<li>truststoreä¸­ä¿å­˜çš„æ˜¯ä¸€äº›å¯ä¿¡ä»»çš„è¯ä¹¦ï¼Œä¸»è¦æ˜¯javaåœ¨ä»£ç ä¸­è®¿é—®æŸä¸ªhttpsçš„æ—¶å€™å¯¹è¢«è®¿é—®è€…è¿›è¡Œè®¤è¯çš„ï¼Œä»¥ç¡®ä¿å…¶å®å¯ä¿¡ä»»çš„ã€‚ä¸€èˆ¬ä¸ºå…¬é’¥</li>
<li>åªæœ‰HTTPSæ‰éœ€è¦è¿™äº›å—ï¼Ÿ</li>
<li>å‚è€ƒé“¾æ¥
<ol>
<li><a href="https://www.cnblogs.com/gsls200808/p/4500246.html" target="_blank" rel="noopener">KeyStoreå’ŒTrustStore</a></li>
</ol>
</li>
</ul>
<h3 id="certificate"><a class="header-anchor" href="#certificate"></a>Certificate</h3>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/hexo_blog/2019/02/27/K8sæ¦‚å¿µç†è§£/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexo_blog/2019/02/27/K8sæ¦‚å¿µç†è§£/" itemprop="url">K8sæ¦‚å¿µç†è§£</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-02-27T14:44:21+08:00">
                2019-02-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="k8sæ¦‚å¿µ"><a class="header-anchor" href="#k8sæ¦‚å¿µ"></a>K8sæ¦‚å¿µ</h2>
<p>è¿™ç¯‡æ˜¯ä»K8sçš„å¸¸ç”¨å‘½ä»¤åˆ†å‡ºæ¥çš„ï¼Œå®åœ¨æ˜¯æ¦‚å¿µæ¯”è¾ƒå¤šï¼Œè·Ÿå¸¸ç”¨å‘½ä»¤æ‚åœ¨ä¸€èµ·ä¸åˆé€‚äº†ã€‚</p>
<h3 id="deployment"><a class="header-anchor" href="#deployment"></a>deployment</h3>
<ul>
<li>è¿™å‡ è€…çš„å…³ç³»æ¯”è¾ƒå¤æ‚ã€‚è¿˜éœ€è¦è¿›ä¸€æ­¥å»çœ‹ã€‚ç›®å‰å…ˆè®°å½•ä¸€ä¸‹ï¼šdeploymentæ˜¯å®é™…çš„deployï¼Œç„¶åpodæ˜¯æ ¹æ®replicaé‡Œé¢çš„è®¾å®šæ¥èµ·çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœå°†deploymentåˆ é™¤æ‰ï¼Œé‚£ä¹ˆç›¸åº”çš„podå’Œreplica setéƒ½ä¼šæ²¡æœ‰</li>
</ul>
<h3 id="pod"><a class="header-anchor" href="#pod"></a>Pod</h3>
<p>podå®åœ¨æ˜¯K8sé‡Œé¢å¾ˆé‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œä¹Ÿæ˜¯å¾ˆå®½æ³›çš„ä¸€ä¸ªæ¦‚å¿µã€‚å¾ˆå¤šéƒ½å¯ä»¥æ˜¯ä¸€ä¸ªpodã€‚</p>
<ul>
<li>All containers described as Pods.åŒ…æ‹¬replication cotronllerï¼Œ serviceï¼Œ deploymentã€‚<br>
<strong>ä¸çŸ¥é“æ˜¯ä¸æ˜¯æ‰€æœ‰çš„serviceç±»å‹éƒ½ä¼šè¢«å½“åšæ˜¯podï¼Œè¿™ä¸€ç‚¹æœ‰å¾…ç¡®è®¤</strong></li>
<li>A pod is a collection of containers that makes up a particular application, for example Redis.<br>
<strong>è¿™å¥æ²¡æœ‰å¾ˆæ˜ç™½å•Šï¼Œä¸æ˜¯è¯´podæ˜¯ä¸€ä¸ªcontainerå˜›ï¼Œåˆå˜æˆä¸€å †containeräº†</strong></li>
</ul>
<h3 id="services"><a class="header-anchor" href="#services"></a>Services</h3>
<p>serviceæ˜¯K8sé‡Œé¢å¦ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œè€Œä¸”å®åœ¨æ˜¯æœ‰ç‚¹å¤æ‚ã€‚ç±»å‹æ¯”è¾ƒå¤šã€‚K8sä¸­æ–‡æ–‡æ¡£é‡Œé¢çš„åè¯è§£é‡Šè¿˜æ˜¯æ¯”è¾ƒæ¸…æ¥šçš„ï¼Œå¹¶ä¸”ç»™å‡ºäº†ä¸ºä»€ä¹ˆéœ€è¦serviceï¼Œserviceå’Œpodæœ‰ä»€ä¹ˆåŒºåˆ«</p>
<ul>
<li>Kubernete Service æ˜¯ä¸€ä¸ªå®šä¹‰äº†ä¸€ç»„Podçš„ç­–ç•¥çš„æŠ½è±¡ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰æ—¶å€™å«åšå®è§‚æœåŠ¡ã€‚è¿™äº›è¢«æœåŠ¡æ ‡è®°çš„Podéƒ½æ˜¯ï¼ˆä¸€èˆ¬ï¼‰é€šè¿‡label Selectorå†³å®šçš„ï¼ˆä¸‹é¢æˆ‘ä»¬ä¼šè®²åˆ°æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ªæ²¡æœ‰label selectorçš„æœåŠ¡ï¼‰</li>
<li>A Kubernetes service is a named load balancer that proxies traffic to one or more containers.</li>
<li>The proxy works even if the containers are on different nodes. Services proxy communicate within the cluster and rarely expose ports to an outside interface.When you launch a service it looks like you cannot connect using curl or netcat unless you start it as part of Kubernetes. The recommended approach is to have a LoadBalancer service to handle external communications.<br>
<strong>å¥½å§ï¼Œè¿™æ®µè¯åŸºæœ¬æ²¡çœ‹æ‡‚ï¼Œæš‚æ—¶å°±ä¸ç®¡å®ƒäº†ã€‚serviceä¸ä»…ä»…æ˜¯load balancerå§ï¼Œéš¾é“æ¯ä¸€ç§serviceéƒ½æ˜¯load balancerçš„ä¸€ç§ä½“ç°å—ï¼Ÿ</strong></li>
<li>Kubernetes Services are an abstract that defines a policy and approach on how to access a set of Pods. The set of Pods accessed via a Service is based on a Label Selector.<br>
<strong>ä¹‹å‰æ˜¯æœ‰è¯¾ç¨‹è¯´serviceèµ·èµ·æ¥æ—¶å€™éœ€è¦é…å¥—ä¸€ä¸ªSelectorçš„ã€‚ä¹Ÿå¯ä»¥å’Œdeploymentä¸€èµ·ç”¨ï¼Ÿ åæ­£ä¸æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ã€‚</strong><br>
<strong>è¿™ä¸ªç†è§£ä¹Ÿä¸ä¸€å®šå¯¹å•Šï¼Œä¸ç‹¬ç«‹ï¼Œå“ªé‡Œèƒ½åœ¨get podsé‡Œé¢çœ‹åˆ°</strong></li>
<li>Serviceæœ‰å¾ˆå¤šç§ï¼ŒåŒ…æ‹¬targetPortï¼Œç»å¸¸ç”¨åˆ°çš„ï¼Œè¿˜æœ‰ï¼šCluster IPï¼Œ NodePort ï¼ŒExternal IPsï¼Œ Load Balancerä¹‹ç±»
<ul>
<li>Cluster IPçš„è§£é‡Šï¼š Cluster IP is the default approach when creating a Kubernetes Service. The service is allocated an internal IP that other components can use to access the pods.</li>
<li>Target Portçš„è§£é‡Šï¼šTarget ports allows us to separate the port the service is available on from the port the application is listening on. TargetPort is the Port which the application is configured to listen on. Port is how the application will be accessed from the outside.æ²¡çœ‹æ˜ç™½ï¼Œtarget portæ˜¯applicationçš„ã€‚è¿˜çœŸæ˜¯ï¼ŒPortæ‰æ˜¯å¤–éƒ¨è®¿é—®çš„ã€‚é‚£è·Ÿä¹‹å‰çš„exposeå‘½ä»¤é‡Œé¢çš„ä¸ä¸€æ ·å˜›ã€‚å›å¤´å¾—ç ”ç©¶ä¸€ä¸‹ã€‚è¯•è¯•çœ‹ã€‚</li>
<li>NodePortçš„è§£é‡Šï¼šthe NodePort exposes the service on each Nodeâ€™s IP via the defined static port. No matter which Node within the cluster is accessed, the service will be reachable based on the port number defined.åº”è¯¥æ˜¯<code>get Nodes</code>çš„å‘½ä»¤å‡ºæ¥çš„Nodeå§ã€‚å®ä½“æœºï¼Ÿå¯èƒ½è¿˜æœ‰ç‚¹ä¸åŒã€‚<code>get Nodes</code>å‘½ä»¤ç»™å‡ºçš„æ˜¯hostnameã€‚ä¸Šé¢å¯èƒ½æœ‰å¤šä¸ªIPï¼Ÿ</li>
<li>External IPsçš„è§£é‡Šï¼šç»™å®šmaster Nodeçš„ä¸€ä¸ªIPã€‚ç„¶åThe service is now bound to the IP address and Port 80 of the master node</li>
<li>Load Balancerçš„è§£é‡Šï¼šcloud Provideréƒ½æ˜¯æœ‰è‡ªå·±çš„load Balancerçš„ã€‚å¦‚æœæ²¡æœ‰çš„è¯ï¼Œå¯ä»¥dynamically allocate IP addresses to LoadBalancer type services.When a service requests a Load Balancer, the provider will allocate one from the 10.10.0.0/26 range defined in the configuration.è¿™ä¸ªæ˜¯ç¡®å®šçš„èŒƒå›´å—</li>
<li>ç»“åˆä¸Šé¢çš„ï¼Œæˆ‘è§‰å¾—éƒ½éœ€è¦å•Šã€‚</li>
</ul>
</li>
<li>å‚è€ƒé“¾æ¥
<ul>
<li><a href="https://www.kubernetes.org.cn/kubernetes-services" target="_blank" rel="noopener">åè¯è§£é‡Š Services</a></li>
</ul>
</li>
</ul>
<h3 id="configmap"><a class="header-anchor" href="#configmap"></a>configmap</h3>
<ul>
<li><em>In Kubernetes, a ConfigMap is simply a container for storing configuration data. Other things, like pods, can access the data in a ConfigMap.</em></li>
</ul>
<h3 id="secrets"><a class="header-anchor" href="#secrets"></a>secrets</h3>
<h3 id="persistentvolumnclumns"><a class="header-anchor" href="#persistentvolumnclumns"></a>PersistentVolumnClumns</h3>
<ul>
<li>PVCåœ¨å®šä¹‰çš„æ—¶å€™æœ‰ä¸ªstorageclassã€‚è¿™ä¸ªstorageclassæ˜¯å®šä¹‰åœ¨<code>kube-system</code>çš„namespaceé‡Œé¢çš„</li>
<li>åœ¨å®‰è£…æ—¶å€™ï¼Œshare Cç›˜é‡åˆ°äº†é—®é¢˜ï¼Œç”¨â€œdocker for desktopâ€çš„é»˜è®¤çš„storageclassï¼šhostpathæ¥åˆ›PVCï¼Œå°±èµ·ä¸æ¥äº†ã€‚äºæ˜¯åœ¨å¤§ç¥çš„æ•™å¯¼ä¸‹å¦åˆ›äº†ä¸€ä¸ªStorageClassï¼Œå°†å…¶æ˜ å°„åˆ°docker machineçš„è™šæœºé‡Œé¢ã€‚è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</li>
<li>åœ¨å°è¯•è§£å†³è¿™ä¸ªCç›˜æ²¡æ³•shareçš„é—®é¢˜æ—¶å€™å‚è€ƒäº†å¾ˆå¤šèµ„æ–™ã€‚å·¥ä½œç”µè„‘ç”±äºç³»ç»Ÿå…³ç³»ï¼Œæ²¡æœ‰åŠæ³•åˆ›å»ºadministrator groupçš„userï¼Œæ‰€ä»¥ç»•ä¸è¿‡å»ã€‚</li>
<li>å‚è€ƒçš„é“¾æ¥æœ‰ï¼š
<ul>
<li><a href="https://dotblogs.com.tw/swater111/2017/01/26/101009" target="_blank" rel="noopener">share Cç›˜æ€»ç»“</a>ï¼šè¿™ç¯‡èµ„æ–™è¿˜æ˜¯ä¸é”™çš„ï¼Œé‡Œé¢æ±‡æ€»äº†å¯èƒ½é‡åˆ°çš„å¥½å‡ ä¸ªé—®é¢˜ã€‚</li>
<li><a href="https://blogs.msdn.microsoft.com/stevelasker/2016/06/14/configuring-docker-for-windows-volumes/" target="_blank" rel="noopener">share Cç›˜å®¶é‡Œå’‹æ•´</a></li>
<li><a href="https://tomssl.com/2018/01/11/sharing-your-c-drive-with-docker-for-windows-when-using-azure-active-directory-azuread-aad/" target="_blank" rel="noopener">local useræ–¹æ³•</a></li>
</ul>
</li>
</ul>
<h3 id="namespace"><a class="header-anchor" href="#namespace"></a>namespace</h3>
<ul>
<li>
<p>å½“å›¢é˜Ÿæˆ–é¡¹ç›®ä¸­å…·æœ‰è®¸å¤šç”¨æˆ·æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨Namespaceæ¥åŒºåˆ†ã€‚</p>
</li>
<li>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç›¸åŒNamespaceä¸­çš„å¯¹è±¡å°†å…·æœ‰ç›¸åŒçš„è®¿é—®æ§åˆ¶ç­–ç•¥ã€‚</p>
</li>
<li>
<p>Kubernetesä»ä¸¤ä¸ªåˆå§‹çš„Namespaceå¼€å§‹ï¼š</p>
<ul>
<li>
<p>default</p>
</li>
<li>
<p>kube-system ç”±Kubernetesç³»ç»Ÿåˆ›å»ºçš„å¯¹è±¡çš„Namespace</p>
</li>
<li>
<p>è‡ªå·±ç”µè„‘ä¸Šé¢è£…å¥½çš„docker for desktopé‡Œé¢æœ‰ä»¥ä¸‹çš„namespace</p>
<pre><code>$ kubectl get namespaces
NAME           STATUS    AGE
default        Active    15d
docker         Active    15d
kube-public    Active    15d
kube-system    Active    15d
</code></pre>
</li>
</ul>
</li>
<li>
<p>å¤§å¤šæ•°<code>Kubernetes</code>èµ„æºï¼ˆä¾‹å¦‚<code>pod</code>ã€<code>services</code>ã€<code>replication controllers</code>æˆ–å…¶ä»–ï¼‰éƒ½åœ¨æŸäº›Namespaceä¸­ï¼Œä½†Namespaceèµ„æºæœ¬èº«å¹¶ä¸åœ¨Namespaceä¸­ã€‚è€Œä½çº§åˆ«èµ„æºï¼ˆå¦‚<code>Node</code>å’Œ<code>persistentVolumes</code>ï¼‰ä¸åœ¨ä»»ä½•Namespaceä¸­ã€‚</p>
</li>
<li>
<p><code>Events</code>æ˜¯ä¸€ä¸ªä¾‹å¤–ï¼šå®ƒä»¬å¯èƒ½æœ‰ä¹Ÿå¯èƒ½æ²¡æœ‰Namespaceï¼Œå…·ä½“å–å†³äº<code>Events</code>çš„å¯¹è±¡ã€‚</p>
</li>
<li>
<p>å‚è€ƒé“¾æ¥ï¼š<a href="http://docs.kubernetes.org.cn/242.html" target="_blank" rel="noopener">Kubernetes Namespaces</a></p>
</li>
</ul>
<h3 id="replication-controller"><a class="header-anchor" href="#replication-controller"></a>replication controller</h3>
<ul>
<li>The replication controller defines how many instances should be running, the Docker Image to use, and a name to identify the service.<br>
<strong>å†³å®šå¤šå°‘ä¸ªinstanceå¯ä»¥ç†è§£ï¼Œä¸åŒçš„instanceå¯ä»¥ä½¿ç”¨ä¸åŒçš„imageå—</strong></li>
</ul>
<h3 id="ingress"><a class="header-anchor" href="#ingress"></a>Ingress</h3>
<ul>
<li>Ingressï¼šAn Ingress enables inbound connections to the cluster, allowing external traffic to reach the correct Pod.å‰ä¸€å¥æ²¡çœ‹æ‡‚ã€‚</li>
<li>Ingress enables externally-reachable urls, load balance traffic, terminate SSL, offer name based virtual hosting for a Kubernetes cluster.</li>
<li>é€šå¸¸æƒ…å†µä¸‹ï¼Œserviceå’Œpodçš„IPä»…å¯åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®ã€‚é›†ç¾¤å¤–éƒ¨çš„è¯·æ±‚éœ€è¦é€šè¿‡è´Ÿè½½å‡è¡¡è½¬å‘åˆ°serviceåœ¨Nodeä¸Šæš´éœ²çš„NodePortä¸Šï¼Œç„¶åå†ç”±kube-proxyå°†å…¶è½¬å‘ç»™ç›¸å…³çš„Podã€‚è€ŒIngresså°±æ˜¯ä¸ºè¿›å…¥é›†ç¾¤çš„è¯·æ±‚æä¾›è·¯ç”±è§„åˆ™çš„é›†åˆ</li>
<li>Ingress.yamlé‡Œé¢çš„ä¿¡æ¯ä¸å¯èƒ½å®Œå…¨åˆ—è¿™é‡Œï¼Œæœ‰ä»¥ä¸‹ä¸€äº›å…ƒç´ å’Œç±»å‹:
<ul>
<li>Kind: namespace ä»è¿™è¾¹çœ‹ingressçš„å®è´¨æ˜¯namespaceï¼Ÿ</li>
<li>Kindï¼šsecret  typeï¼šOpaqueï¼Œé‡Œé¢çš„æ•°æ®çœ‹èµ·æ¥æ˜¯è¯ä¹¦å½¢å¼ The default server secret is a self-signed certificate for other Nginx example SSL connections and is required by the Nginx Default Example.</li>
<li>Kindï¼šServiceAccount: The ServiceAccount defines the account with a set of permissions on how to access the cluster to access the defined Ingress Rules.</li>
<li>Kindï¼šConfigMap</li>
<li>ç°åœ¨çœ‹æ¥ï¼Œä¸Šé¢è¿™ä¸€æ®µæœ‰ç‚¹è¯¯è§£ã€‚å› ä¸ºå½“æ—¶æ˜¯å­¦ä¹ k8sçš„åœ¨çº¿trainingï¼Œæˆ‘æƒ³è¿™ä¸ªIngress.yamlåªä¸è¿‡æ˜¯éƒ¨ç½²ä¸€ä¸ªå…ƒç´ ã€‚çœŸæ­£èµ·ä½œç”¨çš„æ˜¯ingress-rules.yamlæ–‡ä»¶ã€‚è¿™ä¸ªæ‰æ˜¯å¦‚ä½•ç”Ÿæˆä¸€ä¸ªingressã€‚</li>
</ul>
</li>
<li>è¿˜æœ‰ä¸ªingress-rulesçš„yamlæ–‡ä»¶ã€‚é‡Œé¢çš„å†…å®¹å¦‚ä¸‹ï¼š
<ul>
<li>Kind: Ingress è¿™ä¸ªruleå°±æ˜¯ruleï¼Œå“ªä¸ªendPointè¿›å“ªä¸ªdeployment</li>
<li>æ¯ä¸ªIngresséƒ½éœ€è¦é…ç½®rulesï¼Œç›®å‰Kubernetesä»…æ”¯æŒhttpè§„åˆ™ã€‚æ‰€ä»¥æœ€å…³é”®çš„å°±æ˜¯rule</li>
</ul>
</li>
<li>å‚è€ƒé“¾æ¥ï¼š
<ul>
<li><a href="https://www.kubernetes.org.cn/ingress" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£ åè¯è§£é‡Šï¼šIngress</a></li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/hexo_blog/2019/02/26/Helmå…¥é—¨/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexo_blog/2019/02/26/Helmå…¥é—¨/" itemprop="url">Helmå…¥é—¨</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-02-26T15:50:36+08:00">
                2019-02-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="helm"><a class="header-anchor" href="#helm"></a>Helm</h2>
<p><code>Helm</code>å…¥é—¨ç¯‡ã€‚æ„Ÿè§‰æœ‰ç‚¹ç±»ä¼¼<code>maven</code>ï¼Œæ€»å½’æœ‰è¿™æ ·ä¸€ä¸ªç®¡ç†å·¥å…·ã€‚å…¶å®æ˜¯æƒ³çœ‹<code>Ingress</code>çš„ï¼Œå¯æ˜¯ä¸çœ‹<code>Helm</code>ï¼Œyamlçœ‹ä¸æ‡‚å‘€ã€‚åªå¥½æ»šå›æ¥çœ‹Helmã€‚</p>
<h3 id="helmæ˜¯ä»€ä¹ˆ"><a class="header-anchor" href="#helmæ˜¯ä»€ä¹ˆ"></a>Helmæ˜¯ä»€ä¹ˆ</h3>
<ul>
<li><code>Helm</code>æ˜¯åœ¨Kubernetesä¸­å®‰è£…éƒ¨ç½²å®¹å™¨çš„ä¸€ä¸ªå·¥å…·ã€‚</li>
<li><em>Helm is a tool for managing Kubernetes charts.</em> æ‰€ä»¥Chartså¯èƒ½æ˜¯K8sçš„ä¸€ä¸ªæ¦‚å¿µã€‚ä¸­æ–‡çš„åšå®¢ä¸ä¸€å®šå¯¹ã€‚</li>
<li><code>Helm</code>ç”±<code>Helm</code>å®¢æˆ·ç«¯ã€<code>Tiller</code>æœåŠ¡å™¨ç«¯å’Œ<code>Chart</code>ä»“åº“æ‰€ç»„æˆ
<ul>
<li><code>Helm</code>å®¢æˆ·ç«¯ï¼š å®¢æˆ·ç«¯äº¤äº’</li>
<li><code>Tiller</code>æœåŠ¡å™¨ç«¯ï¼š è£…åœ¨k8sçš„clusteré‡Œé¢ï¼Œç®¡ç†<code>chart</code></li>
<li><code>Chart</code>ä»“åº“ï¼šåˆ›å»º<code>Kubernetes</code>åº”ç”¨å®ä¾‹çš„ä¿¡æ¯é›†åˆ
<ul>
<li><code>Chart</code>ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼Œç¬¬ä¸€ä¸ªéƒ¨åˆ†æ˜¯A description of the package (Chart.yaml)</li>
<li>One or more templates, which contain Kubernetes manifest filesã€‚è¿™ä¸ªtemplatesçš„è¯ï¼Œåº”è¯¥ä¹Ÿæ˜¯yamlæ–‡ä»¶å§ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="å¸¸ç”¨çš„helmå‘½ä»¤"><a class="header-anchor" href="#å¸¸ç”¨çš„helmå‘½ä»¤"></a>å¸¸ç”¨çš„helmå‘½ä»¤</h3>
<ul>
<li>
<p><code>helm status &lt;namespace&gt;</code> æŸ¥çœ‹<code>Helm</code>çš„çŠ¶æ€</p>
</li>
<li>
<p><code>helm install</code>: å®é™…å°†helmé‡Œé¢çš„å†…å®¹å®‰è£…åˆ°å½“å‰çš„k8sä¸Šé¢ã€‚æ¯”å¦‚æˆ‘åˆ›äº†ä¸€ä¸ª<code>configMap.yaml</code>çš„<code>templete</code>ï¼Œé‚£ä¹ˆå°±ä¼šå®‰è£…ä¸Šå»ã€‚</p>
<ul>
<li>
<p>å¦‚æœåªæ˜¯æƒ³çœ‹çœ‹templateçš„rendingï¼Œé‚£ä¹ˆä½¿ç”¨å‘½ä»¤<code>helm install ./mychart --debug --dry-run</code></p>
</li>
<li>
<p>å¦‚æœæƒ³ä¼ å€¼è¿›å»ï¼Œå¯ä»¥ä½¿ç”¨<code>-f</code> å‘½ä»¤ï¼Œæ¯”å¦‚<code>helm install -f myvals.yaml ./mychart</code>ã€‚è¿™æ ·ä¼ çš„å€¼ï¼Œå¯ä»¥ç”¨<code>.Value</code>æ¥è®¿é—®</p>
</li>
<li>
<p>å•ç‹¬ä¼ å€¼æ˜¯<code>--set foo=bar</code>ï¼Œ<code>--set</code>æ¯”æ–‡ä»¶çš„çº§åˆ«é«˜ï¼Œå¯ä»¥è¦†ç›–æ–‡ä»¶é‡Œé¢çš„å€¼</p>
</li>
<li>
<p><code>helm install stable/drupal --set image=my-registry/drupal:0.1.0 --set livenessProbe.exec.command=[cat,docroot/CHANGELOG.txt] --set livenessProbe.httpGet=null</code> è¿™æ¡å‘½ä»¤é‡Œé¢å°†<code>livenessProbe.httpGet</code>åˆ é™¤æ‰äº†ã€‚</p>
<pre><code>$ helm install ./mychart
 NAME:   guiding-ocelot
 LAST DEPLOYED: Mon Aug 19 17:23:00 2019
 NAMESPACE: gear-1
 STATUS: DEPLOYED

 RESOURCES:
 ==&gt; v1/ConfigMap
 NAME               DATA  AGE
 mychart-configmap  1     0s
</code></pre>
</li>
</ul>
</li>
<li>
<p><code>helm get manifest &lt;release name&gt;</code>: æ¯”å¦‚ä¸Šé¢çš„è¿™ä¸ª<code>guiding-ocelot</code></p>
<pre><code> $ helm get manifest guiding-ocelot

 ---
  # Source: myChart/templates/configmap.yaml
  apiVersion: v1
  kind: ConfigMap
  metadata:
    name: mychart-configmap
  data:
    myvalue: &quot;Hello World&quot;
</code></pre>
</li>
<li>
<p><code>helm init</code>:å®‰è£…tilleræœåŠ¡å™¨ç«¯</p>
</li>
<li>
<p><code>helm delete --purge &lt;release name&gt;</code></p>
</li>
<li>
<p><code>helm repo add &lt;repo name&gt; &lt;repo address&gt;</code></p>
</li>
<li>
<p><code>helm create &lt;chart name&gt;</code>: ç”Ÿæˆä¸€ä¸ªç›®å½•</p>
<pre><code>$ find myChart/
  myChart/
  myChart/.helmignore
  myChart/Chart.yaml
  myChart/charts
  myChart/templates
  myChart/templates/deployment.yaml
  myChart/templates/ingress.yaml
  myChart/templates/NOTES.txt
  myChart/templates/service.yaml
  myChart/templates/tests
  myChart/templates/tests/test-connection.yaml
  myChart/templates/_helpers.tpl
  myChart/values.yaml
</code></pre>
</li>
</ul>
<h3 id="helm-chart"><a class="header-anchor" href="#helm-chart"></a>Helm Chart</h3>
<h3 id="helm-template"><a class="header-anchor" href="#helm-template"></a>Helm Template</h3>
<ul>
<li>å‚è€ƒä»¥ä¸Šï¼Œé»˜è®¤ç”Ÿæˆä¸€å¥—chartçš„æ—¶å€™ä¼šç”Ÿæˆtemplateç›®å½•ã€‚
<ul>
<li><em>NOTES.txt: The â€œhelp textâ€ for your chart. This will be displayed to your users when they run helm install.</em></li>
<li><em>deployment.yaml: A basic manifest for creating a Kubernetes deployment</em></li>
<li><em>service.yaml: A basic manifest for creating a service endpoint for your deployment</em></li>
<li>_ <em>helpers.tpl: A place to put template helpers that you can re-use throughout the chart</em></li>
</ul>
</li>
</ul>
<h4 id="template-values"><a class="header-anchor" href="#template-values"></a>Template Values</h4>
<ul>
<li>
<p>E.g. <code>nameï¼š</code>ç”¨<code>release name</code> æ¥åšå‰ç¼€ã€‚è¯è¯´è¿™ä¸ª<code>release name</code>åœ¨å“ªé‡Œå®šä¹‰çš„ï¼Œæˆ‘æ²¡æ‰¾åˆ°ã€‚</p>
<ul>
<li>
<p><em>So we could read <code>.Release.Name</code> as â€œstart at the top namespace, find the <code>Release</code> object, then look inside of it for an object called <code>Name</code>â€.</em></p>
</li>
<li>
<p><code>.Release</code>è¡¨ç¤º<code>Release</code>æ˜¯é¡¶çº§çš„object</p>
<pre><code>apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: &quot;Hello World&quot;
</code></pre>
</li>
</ul>
</li>
<li>
<p>é¡¶çº§çš„è‡ªå¸¦çš„objectåŒ…æ‹¬ï¼š <code>Release</code>,<code>Value</code>,<code>Chart</code>,<code>Template</code>, <code>Capabilities</code>è¿˜æœ‰<code>File</code>ã€‚åä¸¤ä¸ªè¿˜ä¸æ˜¯å¾ˆç†è§£</p>
<ul>
<li>
<p><code>Release</code>é‡Œé¢åŒ…å«å¾ˆå¤šå˜é‡ï¼Œæœ‰<code>Release.Time</code>,<code>Release.Namespace</code>, <code>Release.Revision</code>,è¯¦æƒ…å¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£</p>
</li>
<li>
<p><code>Values</code>é‡Œé¢çš„å…¶å®æ˜¯ä»<code>values.yaml</code>é‡Œé¢æ¥çš„</p>
</li>
<li>
<p><code>Chart</code> é‡Œé¢çš„å°±æ˜¯<code>chart.yaml</code>æ¥çš„ã€‚æ¯”å¦‚</p>
<pre><code>{{.Chart.Name}}-{{.Chart.Version}} 
</code></pre>
</li>
</ul>
</li>
</ul>
<h4 id="template-functions"><a class="header-anchor" href="#template-functions"></a>Template Functions</h4>
<ul>
<li>
<p><em>Helm has over 60 available functions.</em> å…¶ä¸­ä¸€äº›æ˜¯è°ƒç”¨<code>GO</code>è¯­è¨€é‡Œé¢<code>tamplate</code>å®šä¹‰çš„å‡½æ•°ã€‚åœ¨<a href="https://godoc.org/text/template" target="_blank" rel="noopener">Go Template Function</a>å¯ä»¥æŸ¥è¯¢åˆ°</p>
</li>
<li>
<p>å…¶å®<code>Helm Template</code>å¹¶ä¸æ˜¯Helmè‡ªèº«åšå‡ºæ¥çš„ï¼Œå…¶å®æ˜¯ä»Goè¿™äº›æ¥çš„ã€‚å°±æ˜¯ä¸ªæ‹¿æ¥å†é›†æˆä¸€ä¸‹ã€‚å¹¶ä¸æ˜¯Helmè‡ªå·±çš„ã€‚</p>
</li>
<li>
<p><code>Helm functions</code>æ”¯æŒ<code>pipeline</code>ã€‚è¿™é‡Œçš„<code>pipeline</code>å’Œ<code>Unix</code>é‡Œé¢çš„åŒæ ·å«ä¹‰ã€‚å¦‚ä¸‹é¢çš„ä¾‹å­é‡Œé¢çš„ï¼š</p>
<pre><code>food: {{ .Values.favorite.food | upper | quote }}
drink: {{ .Values.favorite.drink | repeat 5 | quote }}
</code></pre>
</li>
</ul>
<h5 id="å¸¸ç”¨å‡½æ•°"><a class="header-anchor" href="#å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h5>
<ul>
<li>
<p><code>default</code>ï¼šç”¨æ¥æŒ‡å®šé»˜è®¤å€¼</p>
<pre><code>  drink: {{ .Values.favorite.drink | default "tea" | quote }}
</code></pre>
</li>
<li>
<p><code>toyaml</code>: è½¬æˆyamlæ ¼å¼ <strong><em>å…¶å®ä¸æ˜ç™½å•¥å«åšYamlæ ¼å¼</em></strong></p>
</li>
</ul>
<h5 id="å‡½æ•°æ§åˆ¶å’Œæ“ä½œè¿ç®—ç¬¦"><a class="header-anchor" href="#å‡½æ•°æ§åˆ¶å’Œæ“ä½œè¿ç®—ç¬¦"></a>å‡½æ•°æ§åˆ¶å’Œæ“ä½œè¿ç®—ç¬¦</h5>
<ul>
<li><code>Helm Template</code>çš„å‡½æ•°æ˜¯å¯ä»¥å¼•å…¥é€»è¾‘æ§åˆ¶çš„</li>
<li>è¿ç®—ç¬¦æœ‰ï¼š
<ul>
<li><code>if/else</code> for creating conditional blocksï¼š <code>if</code>åˆ¤æ–­æœ‰ç‚¹ä¸ä¸€æ ·çš„æ˜¯ç©ºçš„å­—ç¬¦ä¸²æˆ–è€…ç©ºçš„é›†åˆä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯<code>false</code>ï¼Œè¿˜æœ‰æ•°å­—0</li>
<li><code>with</code> to specify a scope</li>
<li><code>range</code> which provides a â€œfor eachâ€-style loop</li>
</ul>
</li>
</ul>
<h6 id="function-if-else"><a class="header-anchor" href="#function-if-else"></a>Function if/else</h6>
<ul>
<li>
<p>é€»è¾‘ç¨å¾®æœ‰ç‚¹éš¾ç†è§£ã€‚å°±æ˜¯<code>if</code>è¯­å¥é‡Œé¢çš„å†…å®¹æ˜¯åˆ¤æ–­æ¡ä»¶æˆç«‹çš„æ—¶å€™åŒ…å«çš„ã€‚ç„¶åå…³ç³»è¿ç®—ç¬¦åœ¨å‰ï¼Œè¿™é‡Œæ˜¯<code>or</code>è¿ç®—ç¬¦</p>
<pre><code>  {{/* include the body of this if statement when the variable .Values.anUnsetVariable is set or .values.aSetVariable is not set */}}
  {{ if or .Values.anUnsetVariable (not    .Values.aSetVariable) }}
   {{ ... }}
  {{ end }}
</code></pre>
</li>
</ul>
<h6 id="function-range"><a class="header-anchor" href="#function-range"></a>Function Range</h6>
<ul>
<li>
<p><code>range</code>ç›¸å½“äºæ˜¯<code>foreach</code>,æ¯”å¦‚ä»¥ä¸‹æ˜¯ä¸€ä¸ª<code>slice</code>ï¼Œå…¶å®å°±æ˜¯åˆ—è¡¨ã€‚</p>
<pre><code>pizzaToppings:
 - mushrooms
 - cheese
 - peppers
 - onions
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥è¿™æ ·æ“ä½œï¼š</p>
<pre><code> toppings: |-
  {{- range .Values.pizzaToppings }}
  - {{ . | title | quote }}
  {{- end }}
</code></pre>
<ul>
<li>ä»¥ä¸Š<code>range</code>å‡½æ•°éå†<code>pizzaToppings</code>é‡Œé¢çš„æ¯ä¸ªæ•°å€¼ï¼Œ <code>.</code>ä»£è¡¨å…¶ä¸­æ¯ä¸ªæ•°å€¼ï¼Œä¼ é€’ç»™<code>title</code>å’Œ<code>quote</code>å‡½æ•°ã€‚</li>
<li><code>|-</code>ä»£è¡¨ä»¥ä¸‹å†…å®¹æ˜¯ä¸€ä¸ªé•¿å­—ç¬¦ä¸²ã€‚å› ä¸º<code>Configmap</code>åªæ”¯æŒé”®å€¼å¯¹ã€‚</li>
</ul>
</li>
<li>
<p><code>range</code>ä¹Ÿå¯ä»¥å’Œ<code>list</code>åˆå¹¶èµ·æ¥ç”¨ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code> sizes: |-
 {{- range list "small" "medium" "large" }}
  - {{ . }}
 {{- end }}
</code></pre>
<ul>
<li>å¼•å·é‡Œé¢çš„ç»„æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åå†éå†å­—ç¬¦ä¸²</li>
</ul>
</li>
<li>
<p><code>range</code>ä¹Ÿå¯ä»¥å’Œå…¶ä»–é›†åˆå‡½æ•°è”åˆä½¿ç”¨ï¼Œæ¯”å¦‚<code>dict</code>å’Œ<code>map</code></p>
</li>
</ul>
<h6 id="function-with"><a class="header-anchor" href="#function-with"></a>Function with</h6>
<ul>
<li>
<p><code>.</code>æŒ‡çš„æ˜¯å½“å‰ä½œç”¨åŸŸï¼Œæ¯”å¦‚<code>.Values</code>ï¼Œå°±æ˜¯åœ¨å½“å‰ä½œç”¨åŸŸçš„<code>Value</code>é‡Œé¢</p>
</li>
<li>
<p>ä½¿ç”¨<code>with</code>å‡½æ•°å¯ä»¥æ”¹å˜ä½œç”¨åŸŸï¼Œç”¨æ³•å’Œ<code>if</code>ç±»ä¼¼ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code>{{ with PIPELINE }}
# restricted scope
{{ end }}
</code></pre>
</li>
</ul>
<h5 id="ç©ºæ ¼å’Œç©ºè¡Œ"><a class="header-anchor" href="#ç©ºæ ¼å’Œç©ºè¡Œ"></a>ç©ºæ ¼å’Œç©ºè¡Œ</h5>
<ul>
<li>
<p>è¿™å°±æ˜¯ä¸ºå•¥æ¯è¡Œéƒ½ä¸¤ä¸ªå¤§æ‹¬å·åŠ å°æ¨ªçº¿çš„ç¼˜æ•…ï¼Œç…ç€ä¸€å †å°æ¨ªçº¿å®åœ¨æ— è¯­å•Šã€‚è¿™ä¸ªä¸¤ä¸ªå¤§æ‹¬å·åŠ å°æ¨ªçº¿markdownè¿˜æ‰“ä¸å‡ºæ¥ï¼ŒOMG ğŸ˜•</p>
<ul>
<li>
<p>ä»¥ä¸‹çš„è¯­å¥ä¼šäº§ç”Ÿä¸€ä¸ª<code>Json</code>å­—æ®µ<code>mugï¼štrue</code>å¹¶ä¸”æ²¡æœ‰ç©ºè¡Œ</p>
<pre><code>{{ if and .Values.favorite.drink (eq .Values.favorite.drink "coffee") }}mug: true{{ end }}
</code></pre>
</li>
<li>
<p>ä½†æ˜¯å¦‚æœæ˜¯ä»¥ä¸‹è¯­å¥å°±ä¼šäº§ç”Ÿåœ¨è¿™ä¸ªå­—æ®µä¹‹å‰ç”Ÿæˆä¸€ä¸ªç©ºè¡Œã€‚ä¼°è®¡<code>helm</code>å°±æ˜¯ç®€å•çš„å°†<code>if</code>è¯­å¥çš„ä¸€è¡Œç»™ç”¨ç©ºæ ¼æ›¿ä»£äº†</p>
<pre><code>{{if eq .Values.favorite.drink "coffee"}}
 mug: true
{{end}}
</code></pre>
</li>
<li>
<p>æ‰€ä»¥ä¸Šé¢çš„è¯­å¥å…¶å®è¾ƒä¸ºæ¸…æ™°ï¼Œå´å¿…é¡»ç”¨ä»¥ä¸‹æ ·å¼æ›¿ä»£ï¼Œè¿™æ ·<code>Helm</code>å°±çŸ¥é“å°†è¿™è¾¹çš„ç©ºæ ¼éƒ½åˆ é™¤æ‰</p>
<pre><code>{{- if eq .Values.favorite.drink "coffee"}}
 mug: true
{{- end}}
</code></pre>
</li>
<li>
<p>For the details on whitespace control in templates,see the Official <a href="https://godoc.org/text/template" target="_blank" rel="noopener">Go template documentation</a></p>
</li>
</ul>
</li>
<li>
<p>ä¹Ÿå¯ä»¥æ›´ä¸ºç²¾ç¡®å¾—æ§åˆ¶ç©ºæ ¼ï¼Œå¦‚ä¸‹ã€‚è¿™ç§ç”¨æ³•åœ¨ä»£ç é‡Œä¹Ÿçœ‹åˆ°å¾ˆå¤šã€‚</p>
<pre><code>{{indent 2 "mug:true"}}
</code></pre>
</li>
<li>
<p>è¿˜å¯ä»¥ç”¨<code>*</code>ç¬¦å·ï¼Œ<em>Just for the sake of making this point clear, letâ€™s adjust the above, and substitute an <code>*</code> for each whitespace that will be deleted following this rule. an <code>*</code> at the end of the line indicates a newline character that would be removed</em> æ²¡çœ‹çš„å¤ªæ˜ç™½ã€‚è¿™ä¸ª<code>*</code>æ˜¯å¹²å˜›ç”¨çš„ã€‚</p>
<pre><code>**{{- if eq .Values.favorite.drink "coffee"}}
  mug: true*
**{{- end}}
</code></pre>
</li>
</ul>
<h4 id="å˜é‡"><a class="header-anchor" href="#å˜é‡"></a>å˜é‡</h4>
<ul>
<li>
<p>å˜é‡æ˜¯ç”¨<code>:=</code>æ¥å®šä¹‰çš„ã€‚</p>
</li>
<li>
<p>å¦‚ä¸‹ã€‚åŸæœ¬åœ¨ä½¿ç”¨äº†<code>with</code>ä¹‹åä½œç”¨åŸŸå·²ç»æ”¹å˜äº†ï¼Œæ‰¾ä¸åˆ°<code>Release</code>äº†ï¼Œä½†æ˜¯ä½¿ç”¨äº†å˜é‡ï¼Œå°±åˆå¯ä»¥è®¿é—®äº†ã€‚</p>
<pre><code>data:
myvalue: &quot;Hello World&quot;
{{- $relname := .Release.Name -}}
{{- with .Values.favorite }}
drink: {{ .drink | default "tea" | quote }}
food: {{ .food | upper | quote }}
release: {{ $relname }}
{{- end }}
</code></pre>
</li>
<li>
<p>å¯ä»¥å’Œ<code>range</code>ç»“åˆèµ·æ¥ç”¨ã€‚</p>
<ul>
<li>
<p>éå†ä¸€ä¸ªåˆ—è¡¨ã€‚<code>index</code>å˜é‡æ˜¯ä¸‹æ ‡ï¼Œä»<code>0</code>å¼€å§‹</p>
<pre><code>toppings: |-
  {{- range $index, $topping := .Values.pizzaToppings }}
    {{ $index }}: {{ $topping }}
  {{- end }}
</code></pre>
</li>
<li>
<p>é”®å€¼å¯¹ã€‚æ³¨æ„<code>Values.favorite</code>æ˜¯é”®å€¼å¯¹çš„é›†åˆã€‚æ‰€ä»¥ç¬¬ä¸€æ¬¡æ˜¯ä¸€å¯¹ï¼Œç¬¬äºŒæ¬¡æ˜¯ç¬¬äºŒå¯¹</p>
<pre><code>{{- range $key, $val := .Values.favorite }}
  {{ $key }}: {{ $val | quote }}
{{- end}}
</code></pre>
</li>
</ul>
</li>
<li>
<p>å˜é‡æ˜¯æœ‰ä½œç”¨åŸŸçš„ã€‚é¡¶å±‚å£°æ˜çš„å°±æ˜¯æ•´ä¸ª<code>template</code>å¯ç”¨ï¼Œ<code>range</code>é‡Œé¢å£°æ˜çš„ï¼Œå°±æ˜¯<code>range</code>é‡Œé¢å¯ç”¨ã€‚æ¯”å¦‚ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œå‡ºäº†<code>end</code>å°±æ²¡ç”¨äº†ã€‚</p>
</li>
<li>
<p><strong>æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å˜é‡ <code>$</code>ï¼Œä»£è¡¨æ ¹ä½œç”¨åŸŸï¼</strong></p>
</li>
</ul>
<h4 id="å·²å‘½åçš„template"><a class="header-anchor" href="#å·²å‘½åçš„template"></a>å·²å‘½åçš„Template</h4>
<p>å°±æ˜¯ä»‹ç»ä¸€ä¸‹å¦‚ä½•å¼•ç”¨å•Šï¼Œå‘½åä¹‹ç±»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åå­—æ˜¯å…¨å±€çš„ï¼Œä¸ç®¡è¿™ä¸ª<code>template</code>æ˜¯ä¸æ˜¯åŒ…åœ¨å…¶ä»–çš„<code>template</code>é‡Œé¢ã€‚<br>
__éœ€è¦çš„ä¸€ç‚¹æ˜¯ï¼Œåå­—ä¸­æœ‰ä¸‹åˆ’çº¿çš„<code>template</code>æ˜¯ä¸ä¼šè¢«éƒ¨ç½²åˆ°<code>kubernate</code>ä¸Šé¢çš„ã€‚ä½†æ˜¯å¯ä»¥è¢«å…¶ä»–<code>template</code>å¼•ç”¨</p>
<h5 id="define"><a class="header-anchor" href="#define"></a>define</h5>
<ul>
<li>
<p>ä½¿ç”¨<code>define</code>å¯ä»¥åœ¨ä¸€ä¸ª<code>template</code>å†…éƒ¨åˆ›å»ºä¸€ä¸ªæ–°çš„<code>template</code>ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code>{{- define "mychart.labels" }}
  labels:
    generator: helm
    date: {{ now | htmlDate }}
{{- end }}
</code></pre>
</li>
<li></li>
</ul>
<h5 id="templateå’Œinclude"><a class="header-anchor" href="#templateå’Œinclude"></a>templateå’Œinclude</h5>
<ul>
<li>
<p><code>template</code>æ„Ÿè§‰å’Œ<code>include</code>æœ‰ç‚¹ç›¸ä¼¼ã€‚æ˜¯è°ƒç”¨ç”¨<code>define</code>å®šä¹‰çš„<code>template</code>çš„ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code>metadata:
  name: {{ .Release.Name }}-configmap
  {{- template "mychart.labels" }}
</code></pre>
</li>
<li>
<p>é€šå¸¸è¿™ç±»<code>template</code>ä¼šè¢«æ”¾åœ¨<code>_helpers.tpl</code>æ–‡ä»¶é‡Œé¢ã€‚æˆ‘çš„æ„Ÿè§‰æ˜¯ï¼Œè¿™ç±»<code>template</code>å¾ˆåƒ<code>util</code>å‡½æ•°ï¼Œç„¶åæ”¾åœ¨ä¸€ä¸ªé›†ä¸­çš„æ–‡ä»¶é‡Œé¢ã€‚ä¸€èˆ¬ä¼šåœ¨å‰é¢åŠ ä¸€ä¸ªæ³¨é‡Šï¼Œå¦‚ä¸‹çš„æ ¼å¼ï¼š</p>
<pre><code>`{{/* ... */}}`
</code></pre>
</li>
<li>
<p>ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä¸Šé¢ä¾‹å­çš„è°ƒç”¨ï¼Œå¹¶æ²¡æœ‰ç»™ä»»ä½•çš„ä½œç”¨åŸŸï¼Œè€Œ<code>template</code>çš„é»˜è®¤ä½œç”¨åŸŸä¸ºç©ºã€‚å¦‚ä¸‹çš„<code>template</code>é‡Œé¢çš„<code>.Chart</code>æ˜¯æ— æ³•ç”Ÿæ•ˆçš„ã€‚æ‰€ä»¥è°ƒç”¨æ—¶å€™åº”è¯¥ç”¨ä»¥ä¸‹å½¢å¼ã€‚è¿™æ ·ä¼ å…¥ä¸€ä¸ªä½œç”¨åŸŸå°±å¯ä»¥äº†ã€‚</p>
<pre><code>{{/* Generate basic labels */}}
  {{- define "mychart.labels" }}
    labels:
      generator: helm
      date: {{ now | htmlDate }}
      chart: {{ .Chart.Name }}
      version: {{ .Chart.Version }}
  {{- end }}
  

{{- template "mychart.labels" .}}
</code></pre>
</li>
<li>
<p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œ<code>template</code>æœ‰ç‚¹ç±»ä¼¼<code>inline</code>ï¼Œå°±æ˜¯ç®€å•çš„å°†å†…å®¹å±•å¼€ï¼Œå¹¶ä¸è€ƒè™‘ç¼©è¿›çš„é—®é¢˜ã€‚ä¸ºæ­¤ï¼Œå¼•å…¥äº†<code>include</code>ï¼Œ <code>include</code>å¯ä»¥ç”¨<code>pipeline</code>æ¥æŒ‡å®šç¼©è¿›ã€‚æ¨èä½¿ç”¨<code>include</code>æ¥æ›¿ä»£<code>template</code></p>
<pre><code>{{- include "mychart.app" . | nindent 2 }}
</code></pre>
</li>
</ul>
<h4 id="å¼•ç”¨æ–‡ä»¶"><a class="header-anchor" href="#å¼•ç”¨æ–‡ä»¶"></a>å¼•ç”¨æ–‡ä»¶</h4>
<ul>
<li>
<p><code>.File</code>å¯ä»¥å°†æ–‡ä»¶åŒ…å«è¿›æ¥ã€‚éœ€è¦æ³¨æ„çš„æœ‰ï¼Œ<code>template</code>ç›®å½•ä¸‹é¢çš„æ–‡ä»¶æ²¡æ³•è¢«åŒ…å«ã€‚å¦‚ä¸‹ä¾‹å­ã€‚<code>.File.Get</code>å°±æ˜¯è¯»å–æ–‡ä»¶çš„å†…å®¹çš„å‡½æ•°</p>
<pre><code> {{- $files := .Files }}
 {{- range list "config1.toml" "config2.toml" "config3.toml" }}
  {{ . }}: |-
    {{ $files.Get . }}
 {{- end }}
</code></pre>
</li>
</ul>
<h3 id="å‚è€ƒæ–‡æ¡£"><a class="header-anchor" href="#å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3>
<ul>
<li><a href="https://www.cnblogs.com/Erik_Xu/p/8893725.html" target="_blank" rel="noopener">Helmä»‹ç»</a></li>
<li><a href="https://github.com/helm/helm" target="_blank" rel="noopener">Helm GitHubé¡µé¢</a></li>
<li><a href="https://helm.sh/docs/using_helm/#quickstart-guide" target="_blank" rel="noopener">Helmä½¿ç”¨æ–‡æ¡£</a></li>
<li><a href="https://helm.sh/docs/chart_template_guide/" target="_blank" rel="noopener">Helmå®˜æ–¹æ–‡æ¡£</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/hexo_blog/2019/02/26/Liveness-Readiness/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexo_blog/2019/02/26/Liveness-Readiness/" itemprop="url">Liveness & Readiness</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-02-26T14:29:11+08:00">
                2019-02-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="liveness-readiness"><a class="header-anchor" href="#liveness-readiness"></a>Liveness &amp; Readiness</h2>
<h3 id="readiness"><a class="header-anchor" href="#readiness"></a>Readiness</h3>
<ul>
<li>Readiness Probes checks if an application is ready to start processing traffic.</li>
<li>This probe solves the problem of the container having started, but the process still warming up and configuring itself meaning itâ€™s not ready to receive traffic.</li>
<li>The configuration is as following:<br>
readinessProbe:<br>
httpGet:<br>
path: /<br>
port: 80<br>
initialDelaySeconds: 1<br>
timeoutSeconds: 1</li>
</ul>
<h3 id="liveness"><a class="header-anchor" href="#liveness"></a>Liveness</h3>
<ul>
<li>Liveness Probes ensure that the application is healthy and capable of processing requests.</li>
<li>The configuration is as following:<br>
livenessProbe:<br>
httpGet:<br>
path: /<br>
port: 80<br>
initialDelaySeconds: 1<br>
timeoutSeconds: 1</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/hexo_blog/2019/02/22/Jetty-Graceful-shutdown/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexo_blog/2019/02/22/Jetty-Graceful-shutdown/" itemprop="url">Jetty Graceful shutdown</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-02-22T15:21:42+08:00">
                2019-02-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/Other/" itemprop="url" rel="index">
                    <span itemprop="name">Other</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="jetty"><a class="header-anchor" href="#jetty"></a>Jetty</h2>
<p>å·¥ä½œä¸­éœ€è¦äº†è§£Jettyå¯åœçš„ä¸€äº›çŸ¥è¯†ï¼Œå¯èƒ½ä¸èƒ½çœ‹åˆ°å…¨è²Œï¼Œè¿™è¾¹è®°å½•ä¸‹æ¥ã€‚æ¯•ç«Ÿä¸æ˜¯webçš„äº§å“ã€‚äº†è§£å¾—è¿˜ä¸å¤Ÿæ·±å…¥å•Šã€‚</p>
<h3 id="what-is-graceful-shutdown"><a class="header-anchor" href="#what-is-graceful-shutdown"></a>what is graceful shutdown</h3>
<ul>
<li>Graceful shutdown of a server, context or connector is when existing request/connections are allowed to gracefully complete while no new requests and/or connections are accepted.</li>
<li>It is configured on the Server instance with the setGracefulShutdown(long) method. Heres an example of setting this via the jetty.xml file, where we specify a â€œgraceâ€ period of 30000 milliseconds:<br>
<set name="gracefulShutdown">30000</set></li>
<li>The parameter may be already not used any more</li>
</ul>
<h3 id="how-it-works"><a class="header-anchor" href="#how-it-works"></a>How it works</h3>
<ul>
<li>As soon as the shutdown command is given, the container will close the connectors so that they do not accept any more inbound connections.</li>
<li>æ‰€ä»¥åœ¨<code>ServerControllerImpl</code>é‡Œé¢ï¼Œå¦‚æœHTTPçš„é…ç½®å‚æ•°æ˜¯falseï¼ŒConnectorç¡®å®æ˜¯ä¸€ä¸Šæ¥å°±åœæ‰äº†ã€‚ä½†æ˜¯æ€ä¹ˆéƒ½åˆ°<code>JettyServerçš„</code>getContextï¼ˆï¼‰`å‡½æ•°é‡Œé¢çš„</li>
<li><code>ServerControllerImpl</code> åº”è¯¥æ˜¯HTTP serverçš„controller</li>
</ul>
<pre><code> if (!ServerControllerImpl.this.configuration.isHttpEnabled()) {
                connectorsx = ServerControllerImpl.this.jettyServer.getConnectors();
                if (connectorsx != null) {
                     ...
                      this.stopConnector(backupConnector);
                            ServerControllerImpl.this.jettyServer.removeConnector(backupConnector);
  ...
</code></pre>
<ul>
<li>This will inform most load balancers that the server is no longer part of the cluster.</li>
<li>The contexts are closed so that they do not accept any more requests, but the requests currently inside the container will drain out and the Server instance will shutdown after the grace period expires.<br>
not very sure here. It seems that connector and context are different. I think the connector is more related with port. But context is more related with servlet.</li>
</ul>
<h3 id="elements"><a class="header-anchor" href="#elements"></a>Elements</h3>
<p>æˆ‘ç†è§£åœ¨æ•´ä¸ªjetty server shutdownçš„æ—¶å€™æœ‰å‡ ä¸ªä¸œè¥¿ï¼š connectorã€contextã€serverã€‚ä»¥ä¸‹æ˜¯ç†è§£ï¼Œä¸ä¸€å®šå‡†ç¡®ï¼š</p>
<ul>
<li>servlet æ˜¯åœ¨contexté‡Œé¢çš„ï¼Œcontextä¸€æ—¦stopæ‰ï¼Œservletä¹Ÿä¼šè·Ÿç€destroyã€‚contextæ˜¯WebAppHttpContextï¼Œservletæ˜¯å…¶ä¸­çš„ä¸€ä¸ªweb Elementã€‚</li>
<li>æœ‰ä¸‰ä¸ªcontextï¼Œä¸€ä¸ªæ˜¯HttpServiceContextï¼Œ ä¸€ä¸ªæ˜¯WebAppHttpContextï¼Œè¿˜æœ‰servletçš„contextã€‚WebAppHttpContextæ˜¯jetty stop contextæ—¶å€™åœæ‰çš„ï¼Œæ¯ä¸ªweb appå¯¹åº”ä¸€ä¸ªã€‚å‰è€…æ˜¯jetty serveråœæ‰çš„æ—¶å€™åœæ‰çš„ã€‚æ„Ÿè§‰serveråœæ‰çš„æ—¶å€™ï¼ŒwebAppHttpContextä¸ä¸€å®šéƒ½ç»“æŸäº†ã€‚ä½†æ˜¯jetty serveråœæ‰çš„æ—¶å€™ï¼ŒHttpServiceContextæ˜¯åœæ­¢äº†ã€‚servletçš„contextç»“æ„æ˜¯servleté‡Œé¢çš„ä¸€ä¸ªinternal classï¼Œè·Ÿæ¯ä¸ªuriç»‘å®šã€‚</li>
<li>connectoræ˜¯åœ¨jettyé‡Œé¢å®šä¹‰çš„,æœ‰å‡ ç§connectorï¼Œæ¯”å¦‚<code>org.eclipse.jetty.server.ssl.SslSelectChannelConnector</code>ï¼Œ<code>org.eclipse.jetty.server.nio.SelectChannelConnector</code>ã€‚</li>
</ul>
<p>åœ¨Connectorçš„interfaceé‡Œé¢æœ‰ä¸ªmaxIdleTimeoutçš„å‚æ•°ï¼Œæ ‡ç¤ºè¿™ä¸ªconnectionåœ¨idleæ—¶å€™ä¼šç­‰å¤šä¹…ä»ESTABLISHçŠ¶æ€å˜æˆTIME_WAITçŠ¶æ€ã€‚ä½†æ˜¯å¹¶æ²¡æœ‰åœ¨ä»£ç é‡Œé¢æ‰¾åˆ°è°ƒç”¨çš„åœ°æ–¹ã€‚</p>
<p>___ è¿™ä¸ªæ˜¯åœ¨åœçš„æ—¶å€™è°ƒç”¨çš„é‚£ä¸ªå—ï¼Ÿæœç„¶å†™blogè¦å†æ¸…æ¥šä¸€ç‚¹æ‰å¥½___</p>
<ul>
<li>Connectoræ˜¯åœ¨jettyçš„é…ç½®æ–‡ä»¶é‡Œé¢é…ç½®çš„</li>
</ul>
<h3 id="jettyå¯åŠ¨è¿‡ç¨‹"><a class="header-anchor" href="#jettyå¯åŠ¨è¿‡ç¨‹"></a>Jettyå¯åŠ¨è¿‡ç¨‹</h3>
<p>å¤§éƒ¨åˆ†webå®¹å™¨çš„å¯åŠ¨è¿‡ç¨‹éƒ½å·®ä¸å¤šï¼Œåˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥ï¼š</p>
<ul>
<li>åˆ›å»ºç”¨äºè¿æ¥çš„connectorï¼Œåˆ›å»ºçº¿ç¨‹æ± </li>
<li>æ‰«æå½“å‰çš„webç¨‹åºçš„éƒ¨ç½²ç›®å½•ï¼Œä¸ºä»–ä»¬åˆ›å»ºä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå¹¶å¯¹ä»–ä»¬è¿›è¡Œpathçš„è·¯ç”±è®¾ç½®ï¼Œè¿™ä¸ªçš„åå­—æ˜¯WebAppHttpContext</li>
<li>åˆå§‹åŒ–åˆ›å»ºçš„webç¨‹åºä¸Šä¸‹æ–‡ï¼Œè¿™é‡Œå°±åŒ…æ‹¬åˆ›å»ºservletå•¥çš„ã€‚ï¼Œåˆå§‹åŒ–linstenerå•¥çš„ã€‚å¹¶åšå¥½è‡ªå·±çš„pathè·¯ç”±ã€‚.</li>
<li>å¯åŠ¨connectorï¼Œå¼€å§‹ç›‘å¬ï¼Œæ•´ä¸ªserverå¼€å§‹è¿è¡Œ</li>
<li>æ²¡çœ‹å‡ºæ¥HttpServiceContextæ˜¯ä»€ä¹ˆ</li>
<li>å‚è€ƒæ–‡æ¡£ï¼š
<ul>
<li><a href="https://blog.csdn.net/kobejayandy/article/details/20291953" target="_blank" rel="noopener">Jettyçš„Serveråˆ›å»ºä¸å¯åŠ¨</a></li>
</ul>
</li>
</ul>
<h3 id="filter-servlet-listeneré¡ºåº"><a class="header-anchor" href="#filter-servlet-listeneré¡ºåº"></a>Filterã€Servletã€Listeneré¡ºåº</h3>
<h4 id="å¯åŠ¨é¡ºåº"><a class="header-anchor" href="#å¯åŠ¨é¡ºåº"></a>å¯åŠ¨é¡ºåº</h4>
<ul>
<li>filterçš„åˆå§‹åŒ–æ˜¯web serverå¯åŠ¨çš„æ—¶å€™åˆå§‹åŒ–çš„</li>
<li>servletçš„åˆå§‹åŒ–æ˜¯æ”¶åˆ°å¯¹åº”çš„ç¬¬ä¸€æ¡requestæ—¶å€™è¿›è¡Œçš„</li>
<li>æ‰§è¡Œæ—¶å€™æ˜¯å…ˆæ‰§è¡Œfilterï¼Œå†æ‰§è¡Œservlet</li>
<li>ä»å¯åŠ¨æ—¥å¿—æ¥çœ‹ï¼Œå¯åŠ¨çš„é¡ºåºä¸ºlistener-&gt;Filter-&gt;servlet.</li>
</ul>
<h4 id="åœæ­¢é¡ºåº"><a class="header-anchor" href="#åœæ­¢é¡ºåº"></a>åœæ­¢é¡ºåº</h4>
<ul>
<li>å®¹å™¨å…³é—­æˆ–è€…contexté‡æ–°éƒ¨ç½²ï¼Œè¿™æ—¶å€™servletå…ˆdestroyæ‰</li>
<li>servletä¹‹åæ‰æ˜¯filterå…³é—­</li>
</ul>
<h4 id="å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4>
<ul>
<li><a href="https://www.jianshu.com/p/612c3a6673b2" target="_blank" rel="noopener">Listenerã€Filterã€Servletæ‰§è¡Œé¡ºåº</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/hexo_blog/2019/02/15/å¸¸ç”¨k8så‘½ä»¤è®°å½•/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hexo_blog/2019/02/15/å¸¸ç”¨k8så‘½ä»¤è®°å½•/" itemprop="url">å¸¸ç”¨k8så‘½ä»¤è®°å½•</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-02-15T14:15:01+08:00">
                2019-02-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å¸¸ç”¨k8så‘½ä»¤"><a class="header-anchor" href="#å¸¸ç”¨k8så‘½ä»¤"></a>å¸¸ç”¨k8så‘½ä»¤</h2>
<p>è¿™ç¯‡è®°å½•ä¸€ä¸‹å¸¸ç”¨çš„k8så‘½ä»¤ï¼Œæˆ‘æ€•æˆ‘ä¼šå¿˜å•Š  -_-#<br>
æ²¡é”™ï¼Œè¿™æ˜¯dockeré‚£ç¯‡çš„å§å¦¹ç¯‡å“¦ã€‚æ£’æ£’å“’:P</p>
<ul>
<li><code>kubectl cluster-info</code></li>
<li><code>kubectl get nodes</code></li>
<li><code>kubectl run first-deployment --image=katacoda/docker-http-server --port=80</code>
<ul>
<li>è¿™æ ·å°±æœ‰ä¸€ä¸ªpodå•¦ã€‚åœ¨get pods commandé‡Œé¢èƒ½çœ‹åˆ°ä¸€ä¸ªpod</li>
<li><code>-port</code>ä»æ—§æ˜¯å†…éƒ¨çš„ç«¯å£</li>
<li>å¤–éƒ¨ç«¯å£å¯ä»¥ç”¨<code>--hostport=8001</code>æŒ‡å®šï¼Œ ä½†æ˜¯è¿™æ ·åšçš„è¯ï¼Œ Under the covers, this exposes the Pod via Docker Port Mapping. As a result, you will not see the service listed using <code>kubectl get svc</code>ã€‚ç›®å‰çš„ç†è§£æ˜¯ï¼Œå› ä¸ºæ˜¯ç”¨çš„dockerçš„æ–¹æ³•ï¼Œæ‰€ä»¥k8sä¸çŸ¥é“
<ul>
<li>ç”¨docker pså‘½ä»¤èƒ½çœ‹åˆ°è¿™ä¸ªcontainerï¼Œç„¶åå¯ä»¥æ³¨æ„åˆ°æœ‰ä¸¤ä¸ªpsè¿›ç¨‹ã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯pausedçŠ¶æ€ï¼Œç„¶åæˆ‘ä»¬çš„ç«¯å£8001å…¶å®å¼€åœ¨è¿™ä¸ªpausedçš„psä¸Šé¢ã€‚</li>
<li>The ports are exposed on the Pod, not the http container itself. The Pause container is responsible for defining the network for the Pod. Other containers in the pod share the same network namespace. This improves network performance and allow multiple containers to communicate over the same network interfaceâ€¦æ„Ÿè§‰è¿™æ®µè§£é‡Šå¾ˆå…³é”®å•Šã€‚è¿™ä¸ªcontainerçš„åå­—æ˜¯ï¼š k8s_POD_â€œhttpexposedâ€,æœ€åä¸€ä¸ªå­—æ®µæ˜¯æˆ‘ä»¬èµ·çš„podçš„åå­—</li>
</ul>
</li>
<li><code>--replicas</code>ï¼š å¤åˆ¶å› å­</li>
</ul>
</li>
<li><code>kubectl get pods</code>
<ul>
<li>æ‰€ä»¥get podsçš„è¯ï¼Œä¼šæŠŠreplication cotronllerï¼Œ serviceï¼Œ deploymentéƒ½ç»™æ‰“å°å‡ºæ¥</li>
</ul>
</li>
<li><code>kubectl get rc</code>
<ul>
<li>å°†replication controlleræ‰“å°å‡ºæ¥ã€‚</li>
</ul>
</li>
<li><code>kubectl get services</code></li>
<li><code>kubectl get deployments</code>
<ul>
<li>æ„Ÿå—ä¸€ä¸‹è¿™ä¸¤ä¸ªçš„åŒºåˆ«</li>
</ul>
</li>
</ul>
<pre><code>  $ kubectl get pods
     NAME                           READY     STATUS    RESTARTS   AGE
     http-7b77c4cd66-74zqx          1/1       Running   0          4s
     http-7b77c4cd66-fhlmx          1/1       Running   0          19m
     http-7b77c4cd66-xrbpf          1/1       Running   0          4s
     httpexposed-5c4cf8b7d8-qprzc   1/1       Running   0          11m
  $ kubectl get deployments
     NAME          DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
     http          3         3         3            3           19m
     httpexposed   1         1         1            1           11m
</code></pre>
<ul>
<li><code>kubectl describe deployment http</code></li>
<li><code>kubectl describe svc http</code> èƒ½çœ‹åˆ°å¾ˆå¤šä¿¡æ¯ï¼ŒåŒ…æ‹¬æ•´ä¸ªclusterå¯¹å¤–çš„ipï¼Œå„ä¸ªnodeçš„å†…éƒ¨ipä¹‹ç±»</li>
<li><code>kubectl expose deployment first-deployment --port=80 --type=NodePort</code>
<ul>
<li>è¿™æ¡å‘½ä»¤æœ‰ç‚¹å¤æ‚ï¼Œè§£é‡Šè¯´ï¼šOnce the container is running it can be exposed via different networking options, depending on requirements.</li>
<li>å°†èµ„æºæš´éœ²ä¸ºæ–°çš„Kubernetes Serviceã€‚</li>
<li>exposeåé¢çš„èµ„æºæœ‰å¾ˆå¤šç§ï¼ŒåŒ…æ‹¬ï¼špodï¼ˆpoï¼‰ï¼Œserviceï¼ˆsvcï¼‰ï¼Œreplication controllerï¼ˆrcï¼‰ï¼Œdeploymentï¼ˆdeployï¼‰ï¼Œreplica setï¼ˆrsï¼‰</li>
<li>A Kubernetes service deployment has, at least, two parts. A replication controller and a service. ç¨å¾®æœ‰ç‚¹ç†è§£äº†ã€‚ä¸€ä¸ªserviceéƒ¨ç½²çš„æ—¶å€™ä¸€èˆ¬æœ‰ä¸¤ä¸ªyamlæ–‡ä»¶</li>
<li>'first-deploymentâ€™æ˜¯deploymentçš„åå­—</li>
<li><code>-port</code> æ˜¯å†…éƒ¨çš„ç«¯å£</li>
<li>``â€“target-port`æ˜¯å¤–éƒ¨è®¿é—®çš„ç«¯å£</li>
<li>å®Œæ•´è¯­æ³•ä¸ºï¼š<code>expose (-f FILENAME | TYPE NAME) [--port=port] [--protocol=TCP|UDP] [--target-port=number-or-name] [--name=name] [--external-ip=external-ip-of-service] [--type=type]</code></li>
</ul>
</li>
<li><code>kubectl scale --replicas=3 deployment http</code> scaleçš„å‘½ä»¤</li>
<li><code>kubectl create -f deployment.yaml</code> é€šè¿‡yamlæ–‡ä»¶åˆ›å»ºä¸€ä¸ªdeployment
<ul>
<li><code>kubectl create -f service.yaml</code> ä¹Ÿå¯ä»¥é€šè¿‡yamlæ–‡ä»¶åˆ›å»ºservice</li>
<li>ymalæ–‡ä»¶é‡Œé¢çš„å†…å®¹è¿˜ä¸æ˜¯éå¸¸æ¸…æ¥šã€‚å‚è€ƒ<a href="https://blog.csdn.net/luanpeng825485697/article/details/83753260" target="_blank" rel="noopener">k8s yamlæ–‡ä»¶è¯¦è§£</a></li>
</ul>
</li>
<li><code>kubectl apply -f deployment.yaml</code>å¦‚æœyamlæ–‡ä»¶æœ‰æ”¹åŠ¨çš„è¯ï¼Œå¯ä»¥ç”¨è¿™æ¡å‘½ä»¤æ¥update</li>
</ul>
<pre><code> $ kubectl apply -f deployment.yaml
   Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply
  deployment.extensions/webapp1 configured
</code></pre>
<ul>
<li><code>kubectl exec $pod -- /usr/bin/curl -s localhost/unhealthy</code></li>
<li><code>kubectl get ing</code> å¯ä»¥ç”¨æ¥çœ‹Ingress</li>
<li><code>kubectl create namespace</code>åˆ›å»ºnamespace</li>
<li><code>kubectl config set-context $(kubectl config current-context) --namespace=&lt;insert-namespace-name-here&gt;</code></li>
<li><code>kubectl config get-contexts</code> è¿™ä¸ªcontextä¸çŸ¥é“æ˜¯å•¥</li>
<li><code>kubectl get namespaces</code></li>
<li><code>kubectl delete pvc --all --namespace default</code> ç”¨è¿™ä¸ªå‘½ä»¤æ¥åšdeleteã€‚ä¸€å †éƒ½è¡Œã€‚pvcæ¢æˆpodï¼Œdeploymentsï¼Œsecretï¼Œconfigmapï¼Œserviceå•¥çš„</li>
<li>å®‰è£…k8sçš„dashboardï¼š
<ul>
<li>ä½¿ç”¨â€œdocker for desktopâ€œçš„æ—¶å€™ï¼Œè¿™ä¸ªdashboardè²Œä¼¼ä¸æ˜¯äº‹å…ˆè£…å¥½çš„ã€‚å°è±¡ä¸æ·±åˆ»äº†ã€‚éœ€è¦è£…ä¸€ä¸‹ï¼š</li>
<li><code>kubectl create -f https://raw.githubusercontent.com/kubernetes/dashboard/master/src/deploy/recommended/kubernetes-dashboard.yaml</code></li>
<li><code>kubectl proxy</code> å†å°†proxyç»™å¼„å‡ºæ¥ï¼Œå°±å¯ä»¥è®¿é—®äº†ã€‚</li>
<li>å¦‚ä¸‹å›¾ï¼š<br>
<img src="https://user-images.githubusercontent.com/5803001/34945022-c57b369a-fa3c-11e7-85e7-83f716d10705.png" alt></li>
<li>å‚è€ƒé“¾æ¥ç™»å½•ï¼š
<ul>
<li><a href="https://segmentfault.com/a/1190000012850396" target="_blank" rel="noopener">configç™»å½•æ–¹å¼</a></li>
<li><a href="https://www.cnblogs.com/guigujun/p/8366530.html" target="_blank" rel="noopener">configç™»å½•æ–¹å¼2</a></li>
<li><a href="https://www.cnblogs.com/jackyfei/p/10180465.html" target="_blank" rel="noopener">tokenæ–¹å¼ç™»å½•</a></li>
</ul>
</li>
<li>è·å–tokençš„å‘½ä»¤ï¼š<code>kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk '{print $1}')</code></li>
</ul>
</li>
</ul>
<h3 id="å‚è€ƒæ–‡æ¡£"><a class="header-anchor" href="#å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3>
<ul>
<li><a href="http://docs.kubernetes.org.cn/475.html" target="_blank" rel="noopener">k8sä¸­æ–‡æ–‡æ¡£</a></li>
<li><a href="https://www.katacoda.com/courses/kubernetes/kubectl-run-containers" target="_blank" rel="noopener">codekaraçš„åœ¨çº¿è¯¾ç¨‹</a></li>
</ul>
<h3 id="ä¸»è¦ç‰¹æ€§"><a class="header-anchor" href="#ä¸»è¦ç‰¹æ€§"></a>ä¸»è¦ç‰¹æ€§</h3>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/hexo_blog/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/hexo_blog/">1</a><span class="page-number current">2</span><a class="page-number" href="/hexo_blog/page/3/">3</a><a class="page-number" href="/hexo_blog/page/4/">4</a><a class="extend next" rel="next" href="/hexo_blog/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Lynn Shen</p>
              <p class="site-description motion-element" itemprop="description">35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/hexo_blog/archives/">
              
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/hexo_blog/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lynn Shen</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/hexo_blog/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/hexo_blog/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/hexo_blog/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/hexo_blog/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/hexo_blog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/hexo_blog/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/hexo_blog/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/hexo_blog/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/hexo_blog/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/hexo_blog/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/hexo_blog/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://billts.site/extra_css/gitment.css">
        <script src="https://billts.site/js/gitment.js"></script>
    
<!-- END LOCAL -->

    

    







  





  

  

  

  
  

  

  

  

</body>
</html>
