<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/hexo_blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/hexo_blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/hexo_blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/hexo_blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/hexo_blog/css/main.css">


<link rel="stylesheet" href="/hexo_blog/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"sallyslove.github.io","root":"/hexo_blog/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
<meta property="og:type" content="website">
<meta property="og:title" content="è·¬æ­¥">
<meta property="og:url" content="https://sallyslove.github.io/hexo_blog/page/4/index.html">
<meta property="og:site_name" content="è·¬æ­¥">
<meta property="og:description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Lynn Shen">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://sallyslove.github.io/hexo_blog/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>è·¬æ­¥</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/hexo_blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">è·¬æ­¥</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">ä¸ç§¯è·¬æ­¥ï¼Œæ— ä»¥è‡³åƒé‡Œ</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/hexo_blog/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/hexo_blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/02/22/Jetty-Graceful-shutdown/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/02/22/Jetty-Graceful-shutdown/" class="post-title-link" itemprop="url">Jetty Graceful shutdown</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-02-22 15:21:42" itemprop="dateCreated datePublished" datetime="2019-02-22T15:21:42+08:00">2019-02-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-08-16 10:09:54" itemprop="dateModified" datetime="2019-08-16T10:09:54+08:00">2019-08-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/Other/" itemprop="url" rel="index"><span itemprop="name">Other</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/02/22/Jetty-Graceful-shutdown/" class="post-meta-item leancloud_visitors" data-flag-title="Jetty Graceful shutdown" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/02/22/Jetty-Graceful-shutdown/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/02/22/Jetty-Graceful-shutdown/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="jetty"><a class="header-anchor" href="#jetty"></a>Jetty</h2>
<p>å·¥ä½œä¸­éœ€è¦äº†è§£Jettyå¯åœçš„ä¸€äº›çŸ¥è¯†ï¼Œå¯èƒ½ä¸èƒ½çœ‹åˆ°å…¨è²Œï¼Œè¿™è¾¹è®°å½•ä¸‹æ¥ã€‚æ¯•ç«Ÿä¸æ˜¯webçš„äº§å“ã€‚äº†è§£å¾—è¿˜ä¸å¤Ÿæ·±å…¥å•Šã€‚</p>
<h3 id="what-is-graceful-shutdown"><a class="header-anchor" href="#what-is-graceful-shutdown"></a>what is graceful shutdown</h3>
<ul>
<li>Graceful shutdown of a server, context or connector is when existing request/connections are allowed to gracefully complete while no new requests and/or connections are accepted.</li>
<li>It is configured on the Server instance with the setGracefulShutdown(long) method. Heres an example of setting this via the jetty.xml file, where we specify a â€œgraceâ€ period of 30000 milliseconds:<br>
<Set name="gracefulShutdown">30000</Set></li>
<li>The parameter may be already not used any more</li>
</ul>
<h3 id="how-it-works"><a class="header-anchor" href="#how-it-works"></a>How it works</h3>
<ul>
<li>As soon as the shutdown command is given, the container will close the connectors so that they do not accept any more inbound connections.</li>
<li>æ‰€ä»¥åœ¨<code>ServerControllerImpl</code>é‡Œé¢ï¼Œå¦‚æœHTTPçš„é…ç½®å‚æ•°æ˜¯falseï¼ŒConnectorç¡®å®æ˜¯ä¸€ä¸Šæ¥å°±åœæ‰äº†ã€‚ä½†æ˜¯æ€ä¹ˆéƒ½åˆ°<code>JettyServerçš„</code>getContextï¼ˆï¼‰`å‡½æ•°é‡Œé¢çš„</li>
<li><code>ServerControllerImpl</code> åº”è¯¥æ˜¯HTTP serverçš„controller</li>
</ul>
<pre><code> if (!ServerControllerImpl.this.configuration.isHttpEnabled()) {
                connectorsx = ServerControllerImpl.this.jettyServer.getConnectors();
                if (connectorsx != null) {
                     ...
                      this.stopConnector(backupConnector);
                            ServerControllerImpl.this.jettyServer.removeConnector(backupConnector);
  ...
</code></pre>
<ul>
<li>This will inform most load balancers that the server is no longer part of the cluster.</li>
<li>The contexts are closed so that they do not accept any more requests, but the requests currently inside the container will drain out and the Server instance will shutdown after the grace period expires.<br>
not very sure here. It seems that connector and context are different. I think the connector is more related with port. But context is more related with servlet.</li>
</ul>
<h3 id="elements"><a class="header-anchor" href="#elements"></a>Elements</h3>
<p>æˆ‘ç†è§£åœ¨æ•´ä¸ªjetty server shutdownçš„æ—¶å€™æœ‰å‡ ä¸ªä¸œè¥¿ï¼š connectorã€contextã€serverã€‚ä»¥ä¸‹æ˜¯ç†è§£ï¼Œä¸ä¸€å®šå‡†ç¡®ï¼š</p>
<ul>
<li>servlet æ˜¯åœ¨contexté‡Œé¢çš„ï¼Œcontextä¸€æ—¦stopæ‰ï¼Œservletä¹Ÿä¼šè·Ÿç€destroyã€‚contextæ˜¯WebAppHttpContextï¼Œservletæ˜¯å…¶ä¸­çš„ä¸€ä¸ªweb Elementã€‚</li>
<li>æœ‰ä¸‰ä¸ªcontextï¼Œä¸€ä¸ªæ˜¯HttpServiceContextï¼Œ ä¸€ä¸ªæ˜¯WebAppHttpContextï¼Œè¿˜æœ‰servletçš„contextã€‚WebAppHttpContextæ˜¯jetty stop contextæ—¶å€™åœæ‰çš„ï¼Œæ¯ä¸ªweb appå¯¹åº”ä¸€ä¸ªã€‚å‰è€…æ˜¯jetty serveråœæ‰çš„æ—¶å€™åœæ‰çš„ã€‚æ„Ÿè§‰serveråœæ‰çš„æ—¶å€™ï¼ŒwebAppHttpContextä¸ä¸€å®šéƒ½ç»“æŸäº†ã€‚ä½†æ˜¯jetty serveråœæ‰çš„æ—¶å€™ï¼ŒHttpServiceContextæ˜¯åœæ­¢äº†ã€‚servletçš„contextç»“æ„æ˜¯servleté‡Œé¢çš„ä¸€ä¸ªinternal classï¼Œè·Ÿæ¯ä¸ªuriç»‘å®šã€‚</li>
<li>connectoræ˜¯åœ¨jettyé‡Œé¢å®šä¹‰çš„,æœ‰å‡ ç§connectorï¼Œæ¯”å¦‚<code>org.eclipse.jetty.server.ssl.SslSelectChannelConnector</code>ï¼Œ<code>org.eclipse.jetty.server.nio.SelectChannelConnector</code>ã€‚</li>
</ul>
<p>åœ¨Connectorçš„interfaceé‡Œé¢æœ‰ä¸ªmaxIdleTimeoutçš„å‚æ•°ï¼Œæ ‡ç¤ºè¿™ä¸ªconnectionåœ¨idleæ—¶å€™ä¼šç­‰å¤šä¹…ä»ESTABLISHçŠ¶æ€å˜æˆTIME_WAITçŠ¶æ€ã€‚ä½†æ˜¯å¹¶æ²¡æœ‰åœ¨ä»£ç é‡Œé¢æ‰¾åˆ°è°ƒç”¨çš„åœ°æ–¹ã€‚</p>
<p>___ è¿™ä¸ªæ˜¯åœ¨åœçš„æ—¶å€™è°ƒç”¨çš„é‚£ä¸ªå—ï¼Ÿæœç„¶å†™blogè¦å†æ¸…æ¥šä¸€ç‚¹æ‰å¥½___</p>
<ul>
<li>Connectoræ˜¯åœ¨jettyçš„é…ç½®æ–‡ä»¶é‡Œé¢é…ç½®çš„</li>
</ul>
<h3 id="jettyå¯åŠ¨è¿‡ç¨‹"><a class="header-anchor" href="#jettyå¯åŠ¨è¿‡ç¨‹"></a>Jettyå¯åŠ¨è¿‡ç¨‹</h3>
<p>å¤§éƒ¨åˆ†webå®¹å™¨çš„å¯åŠ¨è¿‡ç¨‹éƒ½å·®ä¸å¤šï¼Œåˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥ï¼š</p>
<ul>
<li>åˆ›å»ºç”¨äºè¿æ¥çš„connectorï¼Œåˆ›å»ºçº¿ç¨‹æ± </li>
<li>æ‰«æå½“å‰çš„webç¨‹åºçš„éƒ¨ç½²ç›®å½•ï¼Œä¸ºä»–ä»¬åˆ›å»ºä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå¹¶å¯¹ä»–ä»¬è¿›è¡Œpathçš„è·¯ç”±è®¾ç½®ï¼Œè¿™ä¸ªçš„åå­—æ˜¯WebAppHttpContext</li>
<li>åˆå§‹åŒ–åˆ›å»ºçš„webç¨‹åºä¸Šä¸‹æ–‡ï¼Œè¿™é‡Œå°±åŒ…æ‹¬åˆ›å»ºservletå•¥çš„ã€‚ï¼Œåˆå§‹åŒ–linstenerå•¥çš„ã€‚å¹¶åšå¥½è‡ªå·±çš„pathè·¯ç”±ã€‚.</li>
<li>å¯åŠ¨connectorï¼Œå¼€å§‹ç›‘å¬ï¼Œæ•´ä¸ªserverå¼€å§‹è¿è¡Œ</li>
<li>æ²¡çœ‹å‡ºæ¥HttpServiceContextæ˜¯ä»€ä¹ˆ</li>
<li>å‚è€ƒæ–‡æ¡£ï¼š
<ul>
<li><a href="https://blog.csdn.net/kobejayandy/article/details/20291953" target="_blank" rel="noopener">Jettyçš„Serveråˆ›å»ºä¸å¯åŠ¨</a></li>
</ul>
</li>
</ul>
<h3 id="filter-servlet-listeneré¡ºåº"><a class="header-anchor" href="#filter-servlet-listeneré¡ºåº"></a>Filterã€Servletã€Listeneré¡ºåº</h3>
<h4 id="å¯åŠ¨é¡ºåº"><a class="header-anchor" href="#å¯åŠ¨é¡ºåº"></a>å¯åŠ¨é¡ºåº</h4>
<ul>
<li>filterçš„åˆå§‹åŒ–æ˜¯web serverå¯åŠ¨çš„æ—¶å€™åˆå§‹åŒ–çš„</li>
<li>servletçš„åˆå§‹åŒ–æ˜¯æ”¶åˆ°å¯¹åº”çš„ç¬¬ä¸€æ¡requestæ—¶å€™è¿›è¡Œçš„</li>
<li>æ‰§è¡Œæ—¶å€™æ˜¯å…ˆæ‰§è¡Œfilterï¼Œå†æ‰§è¡Œservlet</li>
<li>ä»å¯åŠ¨æ—¥å¿—æ¥çœ‹ï¼Œå¯åŠ¨çš„é¡ºåºä¸ºlistener-&gt;Filter-&gt;servlet.</li>
</ul>
<h4 id="åœæ­¢é¡ºåº"><a class="header-anchor" href="#åœæ­¢é¡ºåº"></a>åœæ­¢é¡ºåº</h4>
<ul>
<li>å®¹å™¨å…³é—­æˆ–è€…contexté‡æ–°éƒ¨ç½²ï¼Œè¿™æ—¶å€™servletå…ˆdestroyæ‰</li>
<li>servletä¹‹åæ‰æ˜¯filterå…³é—­</li>
</ul>
<h4 id="å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4>
<ul>
<li><a href="https://www.jianshu.com/p/612c3a6673b2" target="_blank" rel="noopener">Listenerã€Filterã€Servletæ‰§è¡Œé¡ºåº</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/02/15/%E5%B8%B8%E7%94%A8k8s%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/02/15/%E5%B8%B8%E7%94%A8k8s%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url">å¸¸ç”¨k8så‘½ä»¤è®°å½•</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-02-15 14:15:01" itemprop="dateCreated datePublished" datetime="2019-02-15T14:15:01+08:00">2019-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-11-05 11:27:22" itemprop="dateModified" datetime="2020-11-05T11:27:22+08:00">2020-11-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/02/15/%E5%B8%B8%E7%94%A8k8s%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/" class="post-meta-item leancloud_visitors" data-flag-title="å¸¸ç”¨k8så‘½ä»¤è®°å½•" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/02/15/%E5%B8%B8%E7%94%A8k8s%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/02/15/%E5%B8%B8%E7%94%A8k8s%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="å¸¸ç”¨k8så‘½ä»¤"><a class="header-anchor" href="#å¸¸ç”¨k8så‘½ä»¤"></a>å¸¸ç”¨k8så‘½ä»¤</h2>
<p>è¿™ç¯‡è®°å½•ä¸€ä¸‹å¸¸ç”¨çš„<code>k8s</code>å‘½ä»¤ï¼Œæˆ‘æ€•æˆ‘ä¼šå¿˜å•Š  -_-#<br>
æ²¡é”™ï¼Œè¿™æ˜¯<code>docker</code>é‚£ç¯‡çš„å§å¦¹ç¯‡å“¦ã€‚æ£’æ£’å“’</p>
<h3 id="é›†ç¾¤å‘½ä»¤"><a class="header-anchor" href="#é›†ç¾¤å‘½ä»¤"></a>é›†ç¾¤å‘½ä»¤</h3>
<ul>
<li><code>kubectl cluster-info</code></li>
</ul>
<h3 id="æŸ¥è¯¢å‘½ä»¤"><a class="header-anchor" href="#æŸ¥è¯¢å‘½ä»¤"></a>æŸ¥è¯¢å‘½ä»¤</h3>
<ul>
<li>
<p><code>kubectl get nodes</code>ï¼šç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤å¯ä»¥æ‰“å‡º<code>node</code>çš„å…·ä½“ä¿¡æ¯</p>
<pre><code>kubectl get nodes -o wide
</code></pre>
</li>
<li>
<p><code>kubectl get pods</code>ï¼š <code>get pods</code>çš„è¯ï¼Œä¼šæŠŠ<code>replication cotronller</code>ï¼Œ <code>service</code>ï¼Œ <code>deployment</code>éƒ½ç»™æ‰“å°å‡ºæ¥</p>
</li>
<li>
<p><code>kubectl get rc</code>: <code>replication controller</code>æ‰“å°å‡ºæ¥ã€‚</p>
</li>
</ul>
<pre><code>$ kubectl get pods
NAME     READY     STATUS    RESTARTS   AGE
http-7b77c4cd66-74zqx          1/1       Running   0          4s
http-7b77c4cd66-fhlmx          1/1       Running   0          19m
http-7b77c4cd66-xrbpf          1/1       Running   0          4s
httpexposed-5c4cf8b7d8-qprzc   1/1       Running   0          11m

$ kubectl get deployments
NAME DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
http          3         3         3            3           19m
httpexposed   1         1         1            1           11m
</code></pre>
<ul>
<li><code>kubectl describe deployment http</code></li>
<li><code>kubectl describe svc http</code> èƒ½çœ‹åˆ°å¾ˆå¤šä¿¡æ¯ï¼ŒåŒ…æ‹¬æ•´ä¸ªclusterå¯¹å¤–çš„ipï¼Œå„ä¸ªnodeçš„å†…éƒ¨ipä¹‹ç±»</li>
<li><code>kubectl get ing</code> å¯ä»¥ç”¨æ¥çœ‹Ingress</li>
<li><code>kubectl config set-context $(kubectl config current-context) --namespace=&lt;insert-namespace-name-here&gt;</code></li>
<li><code>kubectl config get-contexts</code></li>
<li><code>kubectl get namespaces</code></li>
</ul>
<h3 id="åˆ›å»ºç±»å‘½ä»¤"><a class="header-anchor" href="#åˆ›å»ºç±»å‘½ä»¤"></a>åˆ›å»ºç±»å‘½ä»¤</h3>
<ul>
<li>
<p><code>kubectl run first-deployment --image=katacoda/docker-http-server --port=80</code></p>
<ul>
<li><code>-port</code>ä»æ—§æ˜¯å†…éƒ¨çš„ç«¯å£</li>
<li>å¤–éƒ¨ç«¯å£å¯ä»¥ç”¨<code>--hostport=8001</code>æŒ‡å®šï¼Œ ä½†æ˜¯è¿™æ ·åšçš„è¯ï¼Œ â€”<em>Under the covers, this exposes the Pod via Docker Port Mapping.</em> As a result, you will not see the service listed using <code>kubectl get svc</code>ã€‚ç›®å‰çš„ç†è§£æ˜¯ï¼Œå› ä¸ºæ˜¯ç”¨çš„<code>docker</code>çš„æ–¹æ³•ï¼Œæ‰€ä»¥<code>k8s</code>ä¸çŸ¥é“
<ul>
<li>ç”¨<code>docker ps</code>å‘½ä»¤èƒ½çœ‹åˆ°è¿™ä¸ª<code>container</code>ï¼Œç„¶åå¯ä»¥æ³¨æ„åˆ°æœ‰ä¸¤ä¸ª<code>ps</code>è¿›ç¨‹ã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯<code>paused</code>çŠ¶æ€ï¼Œç„¶åæˆ‘ä»¬çš„ç«¯å£<code>8001</code>å…¶å®å¼€åœ¨è¿™ä¸ª<code>paused</code>çš„<code>ps</code>ä¸Šé¢ã€‚</li>
<li><em>The ports are exposed on the Pod, not the http container itself. The Pause container is responsible for defining the network for the Pod. Other containers in the pod share the same network namespace. This improves network performance and allow multiple containers to communicate over the same network interface.</em> æ„Ÿè§‰è¿™æ®µè§£é‡Šå¾ˆå…³é”®å•Šã€‚è¿™ä¸ªcontainerçš„åå­—æ˜¯ï¼š k8s_POD_â€œhttpexposedâ€,æœ€åä¸€ä¸ªå­—æ®µæ˜¯æˆ‘ä»¬èµ·çš„podçš„åå­—</li>
</ul>
</li>
<li><code>--replicas</code>ï¼š å¤åˆ¶å› å­</li>
</ul>
</li>
<li>
<p><code>kubectl scale --replicas=3 deployment http</code> scaleçš„å‘½ä»¤</p>
</li>
<li>
<p><code>kubectl create -f deployment.yaml</code> é€šè¿‡yamlæ–‡ä»¶åˆ›å»ºä¸€ä¸ªdeployment</p>
</li>
<li>
<p><code>kubectl create -f service.yaml</code> ä¹Ÿå¯ä»¥é€šè¿‡<code>yaml</code>æ–‡ä»¶åˆ›å»º<code>service</code></p>
<ul>
<li><code>ymal</code>æ–‡ä»¶é‡Œé¢çš„å†…å®¹è¿˜ä¸æ˜¯éå¸¸æ¸…æ¥šã€‚å‚è€ƒ<a href="https://blog.csdn.net/luanpeng825485697/article/details/83753260" target="_blank" rel="noopener">k8s yamlæ–‡ä»¶è¯¦è§£</a></li>
</ul>
</li>
<li>
<p><code>kubectl apply -f deployment.yaml</code>å¦‚æœ<code>yaml</code>æ–‡ä»¶æœ‰æ”¹åŠ¨çš„è¯ï¼Œå¯ä»¥ç”¨è¿™æ¡å‘½ä»¤æ¥update</p>
</li>
</ul>
<pre><code> $ kubectl apply -f deployment.yaml
  Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply
  deployment.extensions/webapp1 configured
</code></pre>
<ul>
<li>
<p><code>kubectl exec $pod -- /usr/bin/curl -s localhost/unhealthy</code></p>
</li>
<li>
<p><code>kubectl create namespace</code>åˆ›å»ºnamespace</p>
</li>
<li>
<p><code>kubectl delete pvc --all --namespace default</code> ç”¨è¿™ä¸ªå‘½ä»¤æ¥åš<code>delete</code>ã€‚ä¸€å †éƒ½è¡Œã€‚<code>pvc</code>æ¢æˆ<code>pod</code>ï¼Œ<code>deployments</code>ï¼Œ<code>secret</code>ï¼Œ<code>configmap</code>ï¼Œ<code>service</code>å•¥çš„</p>
</li>
</ul>
<h3 id="å·¥ä½œä¸­å¸¸ç”¨å®ç”¨å‘½ä»¤"><a class="header-anchor" href="#å·¥ä½œä¸­å¸¸ç”¨å®ç”¨å‘½ä»¤"></a>å·¥ä½œä¸­å¸¸ç”¨å®ç”¨å‘½ä»¤</h3>
<h4 id="ç«¯å£æ˜ å°„"><a class="header-anchor" href="#ç«¯å£æ˜ å°„"></a>ç«¯å£æ˜ å°„</h4>
<ul>
<li><code>kubectl port-forward</code>
<ul>
<li>
<p>Forward one or more local ports to a pod. This command requires the node to have â€˜socatâ€™ installed. <strong><em>socatæ˜¯ä»€ä¹ˆ?</em></strong></p>
</li>
<li>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<ul>
<li><a href="https://imti.co/kubernetes-port-forwarding/" target="_blank" rel="noopener">Kubernetes Port Forwarding for Local Development</a></li>
<li><a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#port-forward" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></li>
</ul>
</li>
<li>
<p>ç”¨ä¾‹ï¼š</p>
<ul>
<li>ä»¥ä¸‹å‘½ä»¤çš„å«ä¹‰æ˜¯ï¼šå°†æœ¬åœ°ç«¯å£<code>8080</code>å’Œ<code>8081</code>ï¼Œæ˜ å°„åˆ°<code>k8s</code>æœåŠ¡<code>ok</code>çš„<code>8080</code>å’Œ<code>80</code>ç«¯å£ä¸Šé¢ã€‚<code>-n</code>ä»£è¡¨çš„<code>namespace</code></li>
<li>é»˜è®¤åœ°å€æ˜¯<code>localhost</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>  kubectl port-forward service/ok 8080:8080 8081:80 -n the-project
</code></pre>
<h4 id="ä¸´æ—¶ç¼–è¾‘èµ„æº"><a class="header-anchor" href="#ä¸´æ—¶ç¼–è¾‘èµ„æº"></a>ä¸´æ—¶ç¼–è¾‘èµ„æº</h4>
<ul>
<li><code>kubectl edit</code> å‘½ä»¤å¯ä»¥ç”¨æ¥ä¿®æ”¹ä¸€ä¸ªèµ„æºã€‚<code>kubectl edit deployment &lt;resource_name&gt; -n &lt;namespace&gt;</code>,éœ€è¦æ³¨æ„çš„æ˜¯ä¿®æ”¹æ˜¯æš‚æ—¶çš„ï¼Œå¦‚æœä½¿ç”¨<code>helm upgrade</code>å‘½ä»¤ï¼Œé‚£ä¹ˆä¿®æ”¹ä¼šè¢«è¦†ç›–æ‰
<ul>
<li>å‚è€ƒé“¾æ¥ï¼š <a href="https://stackoverflow.com/questions/45502729/how-do-i-edit-a-resource-configuration-with-kubectl" target="_blank" rel="noopener">kubectl edit</a></li>
</ul>
</li>
</ul>
<h3 id="å‚è€ƒæ–‡æ¡£"><a class="header-anchor" href="#å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3>
<ul>
<li><a href="http://docs.kubernetes.org.cn/475.html" target="_blank" rel="noopener">k8sä¸­æ–‡æ–‡æ¡£</a></li>
<li><a href="https://www.katacoda.com/courses/kubernetes/kubectl-run-containers" target="_blank" rel="noopener">codekaraçš„åœ¨çº¿è¯¾ç¨‹</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/02/14/%E5%B8%B8%E7%94%A8Docker%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/02/14/%E5%B8%B8%E7%94%A8Docker%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url">Docker</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-02-14 15:16:01" itemprop="dateCreated datePublished" datetime="2019-02-14T15:16:01+08:00">2019-02-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-06-18 09:54:12" itemprop="dateModified" datetime="2021-06-18T09:54:12+08:00">2021-06-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/02/14/%E5%B8%B8%E7%94%A8Docker%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/" class="post-meta-item leancloud_visitors" data-flag-title="Docker" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/02/14/%E5%B8%B8%E7%94%A8Docker%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/02/14/%E5%B8%B8%E7%94%A8Docker%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><code>Docker</code>ç›¸å…³çš„ä¿¡æ¯éƒ½è®°å½•åœ¨è¿™é‡Œ</p>
<h2 id="å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2>
<ul>
<li><a href="https://www.jianshu.com/p/f0a0f6a43907" target="_blank" rel="noopener">Dockerfile RUNï¼ŒCMDï¼ŒENTRYPOINTå‘½ä»¤åŒºåˆ«</a></li>
</ul>
<h2 id="å¸¸ç”¨dockerå‘½ä»¤"><a class="header-anchor" href="#å¸¸ç”¨dockerå‘½ä»¤"></a>å¸¸ç”¨dockerå‘½ä»¤</h2>
<p>è¿™ç¯‡è®°å½•ä¸€ä¸‹ <code>Docker</code> ç›¸å…³çš„çŸ¥è¯†ï¼Œæˆ‘æ€•æˆ‘ä¼šå¿˜å•Š ğŸ˜…</p>
<ul>
<li><code>docker run -d / -it / -v / -p /--name/-l</code>
<ul>
<li><code>-d</code>: background; <code>-v</code>: ç£ç›˜æ˜ å°„ ï¼›<code>-p</code>ï¼šç«¯å£æ˜ å°„; <code>-l</code>: label</li>
</ul>
</li>
<li><code>docker build -t ï¼ˆbuild-directoryï¼‰ dockerfile</code> build docker image
<ul>
<li><code>-t</code> æŒ‡å®šç¼–è¯‘å‡ºæ¥çš„imageçš„åå­—ã€‚å¯ä»¥å¸¦ä¸Šç‰ˆæœ¬ã€‚æ¯”å¦‚ï¼šfirstImage:v1</li>
<li><code>-f</code> æŒ‡å®šdockerfileçš„åå­—</li>
</ul>
</li>
<li><code>docker inspect</code>çœ‹ä¸€ä¸ªimageçš„ä¿¡æ¯æˆ–è€…containerçš„ä¿¡æ¯
<ul>
<li>docker inspect -f â€œâ€ katacoda-label-example</li>
<li>These labels will remain even if the image has been untagged. When an image is untagged, it will have the name <none></li>
</ul>
</li>
<li><code>docker exec</code></li>
</ul>
<h2 id="dockerçš„æ¦‚å¿µ"><a class="header-anchor" href="#dockerçš„æ¦‚å¿µ"></a>Dockerçš„æ¦‚å¿µ</h2>
<ul>
<li><code>Label</code>å°±æ˜¯ä¸­æ–‡å«ä¹‰ä¸€æ ·çš„æ ‡ç­¾ï¼Œ<code>key-value</code>çš„å½¢å¼ï¼Œæ¯”å¦‚user=lynnï¼Œè¿™æ ·å­ã€‚é™¤äº†userï¼Œè¿˜ä¼šæœ‰versionå•Š
<ul>
<li>LABEL vendor=Katacoda \ com.katacoda.version=0.0.5 \ com.katacoda.build-date=2016-07-01T10:47:29Z \ com.katacoda.course=Docker</li>
<li>container, image, demonéƒ½å¯ä»¥æœ‰labelï¼Œåœ¨æŸ¥çœ‹æ—¶å€™éƒ½å¯ä»¥ç”¨ä¸Š</li>
</ul>
</li>
<li>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.katacoda.com/courses/docker/2" target="_blank" rel="noopener">karacoda dockeråœ¨çº¿è¯¾ç¨‹</a></li>
</ul>
<h2 id="dockerfile"><a class="header-anchor" href="#dockerfile"></a>Dockerfile</h2>
<blockquote>
<p><a href="https://www.joyfulbikeshedding.com/blog/2019-08-27-debugging-docker-builds.html" target="_blank" rel="noopener">Debugging Docker builds</a></p>
</blockquote>
<ul>
<li>è¿™å‡ å¤©æ­£å¥½åœ¨åš<code>docker image</code>ï¼Œå‡ ç‚¹ç»éªŒå†™åœ¨ä¸‹é¢ï¼š
<ul>
<li>æ‰“åŒ…ï¼š ä½¿ç”¨åŸå§‹çš„<code>docker build</code>å‘½ä»¤è‡ªç„¶æ˜¯å¯ä»¥çš„ï¼Œäº§å“ä¸­å°±ä¸æ˜¯è¿™æ ·äº†ã€‚<code>JAVA</code>ä½¿ç”¨çš„è‡ªç„¶æ˜¯<code>maven</code>çš„<code>docker plugin</code>ï¼Œè¿™ä¸ªå¾ˆå¤šå¹´å‰å°±ç”¨è¿‡ã€‚è€Œè¿™å›<code>SCALA</code>é‡Œé¢ï¼Œæ„Ÿè§‰æ˜¯è‡ªç„¶å¸¦çš„ï¼Œç›´æ¥<code>sbt</code>é‡Œé¢<code>package</code>å°±å¯ä»¥æ‰“å‡ºï¼Œä¹Ÿè®¸è¿™ä¸ªç†è§£æœ‰å·®æ± ã€‚</li>
<li>è°ƒè¯•ï¼Œåˆ¶ä½œ<code>docker image</code>çš„è¿‡ç¨‹æˆ‘æ˜¯å¤§è‡´æ˜ç™½çš„ï¼Œå…¶å®æ¯ä¸€æ­¥éƒ½ä¼šæœ‰ä¸€ä¸ªä¸´æ—¶çš„<code>image</code>ï¼Œç„¶åä¼šåœ¨æ­¤åŸºç¡€ä¸Šé¢èµ·ä¸€ä¸ªå®¹å™¨ï¼Œåœ¨è¿™ä¸ªå®¹å™¨é‡Œé¢å»æ‰§è¡Œã€‚æ‰€ä»¥å‡ºé”™äº†ï¼Œéœ€è¦æ‰¾åˆ°è¿™ä¸€æ­¥çš„ä¸´æ—¶é•œåƒå’Œå®¹å™¨ã€‚</li>
<li>å‚è€ƒä»¥ä¸‹é“¾æ¥ï¼Œä¸»è¦æ˜¯ç”¨<code>docker commit 20f3e5cebec5 tempimagename</code> å°†ä¸´æ—¶çš„é•œåƒå­˜å‚¨ä¸‹æ¥</li>
</ul>
</li>
</ul>
<h3 id="cmd-run"><a class="header-anchor" href="#cmd-run"></a>CMD &amp; RUN</h3>
<ul>
<li><code>CMD</code> å’Œ <code>RUN</code>éƒ½å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œä¸¤è€…çš„åŒºåˆ«å¦‚ä¸‹ï¼š
<ul>
<li><code>RUN</code>ä¼šç”Ÿæˆæ–°çš„é•œåƒå±‚ï¼Œæ‰€ä»¥é€šå¸¸ç”¨æ¥å®‰è£…è½¯ä»¶</li>
<li><code>CMD</code>åˆ™æ˜¯åœ¨é•œåƒéƒ¨ç½²å®Œä¹‹åæ‰§è¡Œçš„å‘½ä»¤</li>
</ul>
</li>
<li>å¦‚æœåœ¨å¯åŠ¨å‘½ä»¤çš„æ—¶å€™å¸¦ä¸Šå‘½ä»¤çš„è¯ï¼Œé‚£ä¹ˆ<code>CMD</code>çš„å‘½ä»¤ä¼šè¢«è¦†ç›–æ‰
<ul>
<li><code>docker run -it [image] /bin/bash</code>æ¯”å¦‚ï¼Œæ‰§è¡Œäº†è¿™å¥ï¼Œé‚£ä¹ˆå³ä½¿æœ‰æ—¢å®šçš„<code>CMD</code>ï¼Œä¹Ÿä¼šä¸æ‰§è¡Œäº†ã€‚</li>
<li>æ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œä¸ºé•œåƒè®¾ç½®é»˜è®¤å¯åŠ¨å‘½ä»¤ï¼Œç„¶ååœ¨å®é™…å¯åŠ¨æ—¶å€™æ›¿æ¢ã€‚æ¯”å¦‚ï¼Œ<code>CMD echo &quot;hello world&quot;</code>, å¯ä»¥åœ¨å®é™…ä¸­å¯åŠ¨æ”¹ä¸º<code>hello new world</code></li>
</ul>
</li>
</ul>
<h3 id="entrypoint"><a class="header-anchor" href="#entrypoint"></a>ENTRYPOINT</h3>
<ul>
<li><code>ENTRYPOINT</code>æ˜¯æ‰§è¡Œçš„èµ·ç‚¹ï¼Œæ¯”å¦‚<code>bash</code>, <code>mysql</code>è¿™äº›ã€‚
<ul>
<li>ä¸€ä¸ªä¾‹å­å¯ä»¥ä¸º<code>ENTRYPOINT [&quot;/bin/echo&quot;]</code>ï¼Œ<code>CMD &quot;world&quot;</code>ã€‚é‚£ä¹ˆå¯åŠ¨çš„æ—¶å€™ä¼šæ‰§è¡Œ<code>echo world</code></li>
</ul>
</li>
</ul>
<h2 id="maven-docker-plugin"><a class="header-anchor" href="#maven-docker-plugin"></a>Maven Docker Plugin</h2>
<ul>
<li><code>maven</code>æœ‰å¥½å‡ ä¸ªæ”¯æŒ<code>Docker</code>çš„<code>plugin</code></li>
<li><code>io.fabric8:docker-maven-plugin</code> å°±æ˜¯å…¶ä¸­çš„ä¸€ä¸ª</li>
</ul>
<h2 id="ä¸€äº›å¼€æºå·¥å…·"><a class="header-anchor" href="#ä¸€äº›å¼€æºå·¥å…·"></a>ä¸€äº›å¼€æºå·¥å…·</h2>
<h3 id="tini-a-tiny-but-valid-init-for-containers"><a class="header-anchor" href="#tini-a-tiny-but-valid-init-for-containers"></a>Tiniï¼ˆA tiny but valid init for containersï¼‰</h3>
<blockquote>
<p><a href="https://github.com/krallin/tini/" target="_blank" rel="noopener">Tini_github</a><br>
<a href="https://zhuanlan.zhihu.com/p/59796137" target="_blank" rel="noopener">åœ¨entrypoint.shä¸­ä½¿ç”¨Tiniçš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ</a><br>
<a href="https://link.zhihu.com/?target=https%3A//github.com/krallin/tini/issues/8%23issuecomment-146135930">ä¸Šæ–‡çš„åŸæ–‡</a></p>
</blockquote>
<ul>
<li>è¿™æ˜¯å¯¹æ‰€æœ‰å®¹å™¨æœ‰æ•ˆçš„åˆå§‹åŒ–å°å·¥å…·</li>
<li>ä»<code>Docker1.13</code>ä¹‹åï¼Œ<code>Docker</code>é‡Œé¢å·²ç»åŒ…å«<code>Tini</code>äº†ã€‚åªéœ€è¦<code>docker run</code>å°±å¯ä»¥äº†</li>
<li>åœ¨ç¬¬äºŒç¯‡é“¾æ¥ä¸­æœ‰é˜è¿°æˆ‘ä¸ºä»€ä¹ˆè¦ä½¿ç”¨<code>Tini</code>ï¼Œæ¥è‡ªä½œè€…çš„è§£é‡Šã€‚å°½é‡æ‘˜è¦ç¿»è¯‘å¦‚ä¸‹ï¼š
<ul>
<li><code>Docker</code>ä¸ºå®¹å™¨åšäº†èµ„æºç‹¬ç«‹åˆ†å‰²ï¼Œè¿™æ˜¯å„ä¸ªå±‚é¢çš„ï¼ŒåŒ…æ‹¬ç½‘ç»œï¼Œå†…å­˜ç­‰ç­‰ã€‚ä¸€ä¸ªå®¹å™¨é‡Œé¢çš„è¿›ç¨‹æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ç©ºé—´ã€‚é‚£ä¹ˆç¬¬ä¸€ä¸ªåˆå§‹åŒ–çš„è¿›ç¨‹å«<code>PID1</code>ï¼Œä¹Ÿå°±æ˜¯åˆå§‹åŒ–çš„è¿›ç¨‹ã€‚</li>
<li><code>ENTRYPOINT</code>å…¶å®å°±æ˜¯<code>PID1</code>ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®<code>ENTRYPOINT</code>ï¼Œé‚£ä¹ˆå°±æ˜¯<code>CMD</code>å°±ä¼šå†³å®š<code>PID1</code>æ˜¯ä»€ä¹ˆ</li>
<li>å’Œå…¶ä»–çš„è¿›ç¨‹ä¸ä¸€æ ·ï¼Œ<code>PID1</code>éœ€è¦ç…§é¡¾é‚£äº›åƒµå°¸è¿›ç¨‹ï¼Œå¯¹åƒµå°¸è¿›ç¨‹è¿›è¡Œå›æ”¶ã€‚è¿™å°±æ˜¯<code>Tini</code>ä¼šåšçš„ã€‚ä¹Ÿæ˜¯<code>JVM</code>ä¸ä¼šåœ¨æ„çš„ã€‚(è‡ªç„¶ä¸åœ¨æ„å–½ï¼Œ<code>JVM</code>è‡ªå·±åªæ˜¯ä¸ªè¿›ç¨‹ï¼Œä¸æ˜¯<code>init</code>è¿›ç¨‹æ¥ç€ã€‚)</li>
<li>
<blockquote>
<p>One problem is, if you run Bash as PID 1, then all signals you send to your Docker container (e.g. using docker stop or docker kill) end up sent to Bash, which does not forward them anywhere (unless you code it yourself). In other words, if you use Bash to run Jenkins, and then run docker stop, then Jenkins will never see the stop command!</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p><strong>è¿™æ®µæœ‰ç‚¹æ²¡çœ‹æ˜ç™½ï¼Œå¦‚æœå°†<code>bash</code>ä½œä¸º<code>init</code>è¿›ç¨‹ï¼Œå®ƒå½“ç„¶ä¹Ÿæœ‰æ€æ­»åƒµå°¸è¿›ç¨‹çš„èŒè´£ã€‚ä½†æ˜¯å®ƒä¸ä¼šå°†<code>docker kill</code>è¿™ç§å‘½ä»¤å‘åˆ°è¯¥å‘çš„åœ°æ–¹ã€‚<code>Tini</code>è¡¥ä¸Šäº†è¿™ä¸ªä¸è¶³ï¼Œä¼šå°†è¿™ä¸ªå‘½ä»¤æˆ–è€…è¯´æŒ‡ä»¤å‘åˆ°æ­£åœ¨è¿è¡Œçš„<code>java</code>ç¨‹åºé‡Œé¢ã€‚ä½†æ˜¯<code>docker kill</code>è¿™ç§éš¾é“ä¸åº”è¯¥ç”±<code>docker demon</code>æ¥è´Ÿè´£å—ã€‚æˆ–è€…è¯´<code>docker demon</code>ä¼šå°†å®¹å™¨æ€æ‰ï¼Œä½†æ˜¯é‡Œé¢è¿è¡Œçš„åº”ç”¨å¹¶ä¸çŸ¥é“è¿™ä¸ªäº‹æƒ…ï¼Œå°±å˜æˆ<code>kill -9</code>é‚£ç§äº†</strong></p>
<ul>
<li>è¿˜æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå‡ä½¿ä½ çš„ç¨‹åºå´©æºƒï¼Œé€šå¸¸éƒ½æ˜¯åœ¨<code>shell</code>é‡Œé¢æ‹‰èµ·æ¥çš„ã€‚é‚£ä¹ˆä¸€æ—¦<code>java</code>ç¨‹åºå´©äº†ï¼Œé‚£ä¹ˆ<code>bash</code>ä¼šè·Ÿç€é€€å‡ºæ¥ã€‚å¹¶ä¸”<code>bash</code>ææœ‰å¯èƒ½æ˜¯ä»¥<code>code 0</code>é€€å‡ºæ¥çš„ã€‚è€Œå®é™…ä¸Šå†…é‡Œçš„åº”ç”¨æ˜¯å´©æºƒå¼é€€å‡ºã€‚å½“ç„¶è¿™å¯ä»¥é€šè¿‡è®©<code>bash</code>æ¥å¤„ç†ä¿¡å·æ¥è§£å†³ï¼Œä½†æ˜¯è¿™ä¼šæ˜¯æ›´å¤šçš„æ´»è®¡ï¼Œè€ŒåŠ ä¸Š<code>Tini</code>æ˜¯å‡ è¡Œä»£ç ã€‚</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/02/14/Scala/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/02/14/Scala/" class="post-title-link" itemprop="url">Scala Concept</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-02-14 10:18:49" itemprop="dateCreated datePublished" datetime="2019-02-14T10:18:49+08:00">2019-02-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-02-24 10:19:47" itemprop="dateModified" datetime="2021-02-24T10:19:47+08:00">2021-02-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/Scala/" itemprop="url" rel="index"><span itemprop="name">Scala</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/02/14/Scala/" class="post-meta-item leancloud_visitors" data-flag-title="Scala Concept" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/02/14/Scala/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/02/14/Scala/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="scalaæ¦‚å¿µå¿«é€Ÿè§£é‡Š"><a class="header-anchor" href="#scalaæ¦‚å¿µå¿«é€Ÿè§£é‡Š"></a>Scalaæ¦‚å¿µå¿«é€Ÿè§£é‡Š</h2>
<ul>
<li><code>Scala</code>æœ‰å¾ˆå¤šç‰¹æœ‰çš„æ¦‚å¿µã€‚å¦‚æœè¦çœ‹æ‡‚ä»£ç å°±å¾—å¤§è‡´æ˜ç™½å«ä¹‰ï¼Œè¿™ç¯‡åšå®¢å°±æ˜¯å¿«é€Ÿè§£é‡Šä¸€ä¸‹ï¼Œå…¶ä¸­å¯èƒ½ä¼šæœ‰ä¸å¤Ÿå‡†ç¡®çš„åœ°æ–¹ï¼Œå°±æ˜¯ä¸æ±‚ç”šè§£ï¼Œåªæ±‚è¿…é€Ÿè¯»æ‡‚<code>scala</code>ä»£ç äº†.</li>
<li>éš”äº†ä¸€æ®µæ—¶é—´åˆå¼€å§‹çœ‹<code>scala</code>çš„ä»£ç ï¼Œç»“æœå‘ç°è¿™ç¯‡åšå®¢å†™å¾—å¤ªä¸å£°æƒ…å¹¶èŒ‚äº†ã€‚<code>scala</code>è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚è¿™ä¹ˆç®€å•å†™å‡ å¥ä¸å¤ªæˆï¼Œå¾—ç»™ä¸€ç‚¹ä¾‹å­æ‰è¡Œã€‚</li>
</ul>
<h3 id="enum"><a class="header-anchor" href="#enum"></a>Enum</h3>
<ul>
<li>ç®€å•æ¥è¯´ï¼Œå¹¶æ²¡æœ‰æšä¸¾è¿™ä¸ªç±»å‹ï¼Œä½†æ˜¯å¯ä»¥ç»§æ‰¿<code>Enumeration</code>æ¥è¾¾åˆ°æšä¸¾çš„æ•ˆæœ</li>
<li>é€šå¸¸å®šä¹‰ä¸€ä¸ª<code>object</code>æ¥ç»§æ‰¿<code>Enumeration</code></li>
<li>ä½¿ç”¨<code>Enum</code>ï¼Œç±»å‹éƒ½æ˜¯<code>Enum.Value</code></li>
<li><a href="http://kubicode.me/2015/06/06/Scala/Enum-in-Scala/" target="_blank" rel="noopener">Scalaä¸­çš„Enumï¼Œè¿™ç¯‡å¯¹æ¯”äº†ä¸€ä¸‹javaå’Œscalaçš„æšä¸¾</a></li>
</ul>
<h3 id="none"><a class="header-anchor" href="#none"></a>&lt;-</h3>
<ul>
<li>
<p><code>for</code> å¾ªç¯é‡Œé¢ç”¨çš„ï¼Œçœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­å°±æ¯”è¾ƒæ¸…æ¥šï¼š</p>
<pre><code>for(x &lt;- 1 to 5)  println(i)

for { 
     x&lt;-1 to 5
     y&lt;-2 to 6
   } println (x,y)
</code></pre>
</li>
<li>
<p>å‚è€ƒé“¾æ¥ï¼š <a href="https://stackoverflow.com/questions/31799536/what-is-%E2%86%90-in-scala" target="_blank" rel="noopener">what-is-â†-in-scala</a></p>
</li>
</ul>
<h3 id="sealed-class"><a class="header-anchor" href="#sealed-class"></a>sealed class</h3>
<h3 id="valå’Œvarçš„åŒºåˆ«"><a class="header-anchor" href="#valå’Œvarçš„åŒºåˆ«"></a>valå’Œvarçš„åŒºåˆ«</h3>
<ul>
<li><code>val</code>å°±æ˜¯å¸¸é‡ï¼Œåªèƒ½èµ‹å€¼ä¸€æ¬¡</li>
<li><code>var</code>å˜é‡ï¼Œå¯ä»¥èµ‹å€¼å¤šæ¬¡</li>
<li><a href="https://www.cnblogs.com/IChing/p/7093345.html" target="_blank" rel="noopener">scalaåŸºç¡€- valå’Œvarçš„åŒºåˆ«</a></li>
</ul>
<h3 id="object"><a class="header-anchor" href="#object"></a>object</h3>
<p>çœ‹äº†å‡ ç¯‡åšå®¢ï¼Œè§£é‡Šéƒ½ä¸å¤Ÿæ¸…æ™°çš„æ„Ÿè§‰ï¼Œè¿˜æ˜¯<code>stackoverflow</code>ä¸Šé¢è§£é‡Šå¾—æ›´æ¸…æ¥š.</p>
<ul>
<li>æœ‰å¥½å‡ ç§ç”¨æ³•ï¼š
<ul>
<li>
<p>ä½œä¸º<code>static</code>å‡½æ•°çš„<code>class</code>æ–‡ä»¶ï¼Œè¿™æ˜¯æœ€å¸¸è§åˆ°çš„ç”¨æ³•ï¼š</p>
<pre><code>object A {
  def twice(i: Int): Int = 2*i
}
</code></pre>
<p>è¿™æ ·å¯ä»¥ç›´æ¥è°ƒç”¨<code>A.twice</code>ï¼Œæ²¡æœ‰å¿…è¦å…ˆå£°æ˜ä¸€ä¸ª<code>A</code>çš„å¯¹è±¡ã€‚è¿™ç§æ˜¯ç±»ä¼¼<code>java</code>é‡Œé¢çš„<code>static</code>å‡½æ•°çš„</p>
</li>
</ul>
</li>
</ul>
<ul>
<li>å‚è€ƒé“¾æ¥ï¼š<a href="https://stackoverflow.com/questions/1755345/difference-between-object-and-class-in-scala" target="_blank" rel="noopener">difference-between-object-and-class-in-scala</a></li>
</ul>
<h3 id="trait"><a class="header-anchor" href="#trait"></a>trait</h3>
<ul>
<li><a href="http://www.runoob.com/scala/scala-traits.html" target="_blank" rel="noopener">Scala Trait(ç‰¹å¾)</a></li>
<li>ç±»ä¼¼<code>java</code>çš„<code>Interface</code>ï¼Œå…¶å®æ›´è¿‘ä¼¼äºæŠ½è±¡ç±»</li>
<li>ä½†æ˜¯å¯ä»¥ä½¿ç”¨<code>with</code>å…³é”®å­—å¤šé‡ç»§æ‰¿ï¼Œå¾ˆå¥½ç”¨çš„æ„Ÿè§‰å“¦</li>
<li><code>scala</code>æœ¬èº«è¿˜æ˜¯æœ‰<code>interface</code>å…³é”®å­—çš„ï¼Œæœ¬èº«ä¹Ÿå¯ä»¥ä½¿ç”¨<code>with</code>å…³é”®å­—æ¥å®ç°æ¥å£</li>
</ul>
<h3 id="case-class"><a class="header-anchor" href="#case-class"></a>case class</h3>
<ul>
<li><a href="https://blog.csdn.net/bluishglc/article/details/50914001" target="_blank" rel="noopener">csdnä¸Šçš„ä¸€ç¯‡æ–‡ç« </a></li>
<li>ç®€å•æ¥è¯´ï¼Œ<code>case class</code>ä¼šé»˜è®¤ç”Ÿæˆå¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚ä¼´ç”Ÿå¯¹è±¡ï¼Œæ¯”å¦‚å·¥å‚æ–¹æ³•ï¼Œæ¯”å¦‚<code>toString</code>ï¼Œ <code>copy</code>ï¼Œæ„é€ æ–¹æ³•å‚æ•°åŒåçš„å±æ€§</li>
<li>æœ€å¼€å¿ƒçš„ç”¨æ³•ï¼Œåº”è¯¥å°±æ˜¯ä¸ç”¨<code>new</code>å‡ºä¸€ä¸ªå¯¹è±¡æ¥ã€‚è€Œæ˜¯å¯ä»¥ç›´æ¥<code>methodName(æ„é€ å‡½æ•°å‚æ•°)</code>è¿™æ ·æ¥è·å–ä¸€ä¸ªå¯¹è±¡ã€‚å…¶å®æ˜¯åŒåçš„å·¥å‚æ–¹æ³•</li>
<li>è¿˜æœ‰ä¸€ä¸ªå¼€å¿ƒçš„ç”¨æ³•å°±æ˜¯<code>case class</code>å¯ä»¥ç›´æ¥ç”¨åœ¨<code>case</code>è¯­å¥é‡Œé¢è¿›è¡Œåˆ¤æ–­</li>
</ul>
<h3 id="implicit"><a class="header-anchor" href="#implicit"></a>implicit</h3>
<ul>
<li>
<p>éšå¼è½¬æ¢ã€‚ä¾‹å­å¦‚ä¸‹ï¼š</p>
<pre><code>    def display(input:String):Unit = println(input)
    implicit def typeConvertor(input:Int):String = input.toString
    display(12)
</code></pre>
</li>
<li>
<p>æœ¬æ¥çš„è¯ï¼Œ<code>display</code>å‡½æ•°åªèƒ½æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°ï¼Œä½†æ˜¯åœ¨ç›¸åŒä½œç”¨åŸŸé‡Œé¢æœ‰éšå¼å‡½æ•°çš„å­˜åœ¨ï¼Œè‡ªåŠ¨å°†æ•´å‹è½¬æ¢æˆäº†å­—ç¬¦ä¸²ä¸‹ç±»å‹</p>
</li>
<li>
<p>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨ç›¸åŒä½œç”¨åŸŸé‡Œé¢ï¼Œç›¸åŒå‚æ•°ï¼Œç›¸åŒè¿”å›å€¼çš„å‡½æ•°ï¼Œå‡½æ•°åå¹¶ä¸å…³é”®ã€‚ç¡®å®ä¸å…³é”®ï¼Œåœ¨è°ƒç”¨<code>display(12)</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰è¯´ï¼Œå•Šï¼Œè¯·ç”¨éšå¼å‡½æ•°<code>typeConvertor</code></p>
</li>
<li>
<p>æ‰€ä»¥ï¼Œå¦‚æœæœ‰å¦ä¸€ä¸ªéšå¼å‡½æ•°ï¼Œä¹Ÿæ˜¯å°†æ•´å‹è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œ<code>scala</code>ä¼šå‡ºé”™ã€‚å› ä¸ºå›ä¸çŸ¥é“ç”¨å“ªä¸€ä¸ª</p>
</li>
<li>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<ul>
<li><a href="https://www.cnblogs.com/rollenholt/p/4118567.html" target="_blank" rel="noopener">è¯¦å°½è§£é‡Šçš„åšå®¢ï¼Œåšä¸»å…¶ä»–åšå®¢ä¹Ÿä¸é”™</a></li>
</ul>
</li>
</ul>
<h3 id="asscala"><a class="header-anchor" href="#asscala"></a>asScala</h3>
<ul>
<li><code>import scala.collection.JavaConverters._</code></li>
<li>ç†è§£å°±æ˜¯å°†<code>Java</code>çš„ä¸€äº›ç»“æ„è‡ªåŠ¨è½¬ä¸º<code>Scala</code>çš„ç»“æ„</li>
<li>ä»¥ä¸‹å‚è€ƒé‡Œé¢å°†<code>ArrayList</code>è½¬æˆäº†<code>mutable.Buffer</code>ã€‚</li>
<li>å‚è€ƒé“¾æ¥
<ul>
<li><a href="https://blog.csdn.net/guotong1988/article/details/51454281" target="_blank" rel="noopener">asScala</a></li>
</ul>
</li>
</ul>
<h3 id="actor"><a class="header-anchor" href="#actor"></a>Actor</h3>
<ul>
<li>
<p><code>actor</code>å…¶å®ä¸æ˜¯<code>scala</code>çš„æ¦‚å¿µï¼Œ<code>Linux</code>é‡Œé¢å°±æœ‰çš„ã€‚ä½†æ˜¯æ„Ÿè§‰å†™åœ¨<code>scala</code>é‡Œé¢æ¯”è¾ƒåˆé€‚ã€‚</p>
</li>
<li>
<p><a href="https://cloud.tencent.com/developer/article/1135999" target="_blank" rel="noopener">æ¼«è°ˆå¹¶å‘ç¼–ç¨‹ï¼šActoræ¨¡å‹</a>è¿™ç¯‡é‡Œé¢å…¶å®è›®æ¸…æ¥šçš„ã€‚åŸºç¡€çš„ä¸€äº›ç”¨æ³•åœ¨è¿™è¾¹çœ‹ä¸€ä¸‹ä¹Ÿå°±æ˜ç™½ä¸€äº›äº†</p>
</li>
<li>
<p>åŸºäº<code>Actor</code>çš„å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯ä¸€ä¸ª<code>actor</code>ï¼Œç±»ä¼¼é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„éƒ½æ˜¯å¯¹è±¡ä¸€æ ·ã€‚åªæ˜¯<code>Actor</code>å†å’Œ<code>Scala</code>ç»“åˆï¼Œè¿™ä¸ªå¯è¯»æ€§ï¼Œå¿…é¡»ç†Ÿæ‚‰ä»£ç çš„æ‰è¡Œã€‚</p>
</li>
<li>
<p>é¦–å…ˆæœ‰ä¸€ä¸ª<code>ActorSystem</code>ï¼Œç„¶å<code>Actor</code>æ˜¯å®¶æ—å¼çš„ï¼Œæœ‰ä¸€ä¸ªçˆ¶çš„<code>Actor</code>ï¼Œç„¶åå…¶ä»–<code>Actor</code>ç”±çˆ¶è€Œæ¥ã€‚çˆ¶<code>Actor</code>å¯ä»¥åˆ›å»ºå­<code>Actor</code>ï¼Œäº‹å®ä¸Šï¼Œæ˜¯æ•´ä¸ª<code>life cycle</code>çš„æ§åˆ¶</p>
</li>
<li>
<p>é¡¶å±‚çš„çˆ¶<code>Actor</code>ç”¨ä»¥ä¸‹è¯­å¥åˆ›å»ºã€‚<code>Props</code>é‡Œé¢çš„å°±æ˜¯<code>Actor</code>çš„ç±»çš„åå­—ï¼Œåé¢ä¸€ä¸ªå‚æ•°æ˜¯<code>Actor</code>çš„åå­—</p>
<pre><code>system.actorOf(Props[BetterMaster], &quot;master&quot;)
</code></pre>
</li>
<li>
<p>å­<code>Actor</code>åˆ›å»ºçš„æ–¹å¼æ˜¯ç±»ä¼¼çš„ï¼Œåªæ˜¯æ˜¯ç”±çˆ¶ <code>Actor</code>åˆ›å»ºçš„ã€‚çˆ¶<code>Actor</code>å†…éƒ¨ï¼Œé€šè¿‡è°ƒç”¨<code>ActorContext</code>çš„<code>actorOf()</code>æ–¹æ³•æ¥åˆ›å»ºå®ƒè‡ªèº«çš„<code>child actor</code>ã€‚å’Œçˆ¶<code>Actor</code>ä¸€æ ·ï¼Œå‚æ•°æ˜¯<code>Actor</code>çš„å®ç°çš„ç±»çš„åå­—å’Œ<code>Actor</code>çš„åå­—ã€‚</p>
</li>
</ul>
<pre><code>	context.actorOf(Props[BetterTalker], &quot;talker&quot;)
</code></pre>
<ul>
<li><code>Actor</code>æœ¬èº«æ˜¯<code>TRAIT</code>ï¼Œ<code>preStart</code>ä¸<code>postStop</code>æ˜¯å¾ˆé‡è¦çš„æ–¹æ³•ã€‚è¿™æ ·ï¼Œé€šè¿‡è¿™äº›å‡½æ•°ï¼Œå¯ä»¥æ§åˆ¶ä¸€ä¸ª<code>Actor</code>çš„ç”Ÿå‘½å‘¨æœŸã€‚åœ¨æˆ‘ä»¬çš„ä»£ç é‡Œé¢é€šè¿‡é‡è½½çˆ¶<code>Actor</code>çš„<code>preStart</code>æ–¹æ³•ï¼Œæ¥æ§åˆ¶äº†æ•´ä¸ª<code>Actor System</code></li>
</ul>
<h4 id="tell"><a class="header-anchor" href="#tell"></a>tell</h4>
<ul>
<li><code>tell</code>å…¶å®æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯<code>!</code>ï¼Œçœ‹åˆ°è¿™æ„Ÿå¹å·ç®€ç›´æ˜¯ ğŸ˜‚ è¿™éƒ½ä¸ªå¯è¯»æ€§åªèƒ½OMGäº†ã€‚</li>
<li><a href="https://stackoverflow.com/questions/49649745/what-is-the-second-argument-of-the-actorref-tell-method" target="_blank" rel="noopener">tell<br>
çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¹²å˜›çš„</a></li>
<li><code>tell</code>æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ¶ˆæ¯ï¼Œç¬¬äºŒä¸ªæ˜¯å›è°ƒçš„<code>Actor</code>ï¼Œå°±æ˜¯è¯´æ”¶åˆ°æ¶ˆæ¯çš„<code>Actor</code>å¯ä»¥ç»™ç¬¬äºŒä¸ªå‚æ•°(ä¹Ÿæ˜¯ä¸ª<code>Actor</code>)å‘é€æ¶ˆæ¯ï¼Œæ¥å‘Šè¯‰å®ƒè‡ªå·±æ”¶åˆ°äº†ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šçš„æ¶ˆæ¯ã€‚åŒæ—¶æ”¶åˆ°æ¶ˆæ¯çš„<code>Actor</code>ä¹Ÿä¼šè®¤ä¸ºæ¶ˆæ¯æ˜¯ç¬¬äºŒä¸ªå‚æ•°å‘æ¥çš„ã€‚</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/01/28/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/01/28/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-01-28 16:21:54" itemprop="dateCreated datePublished" datetime="2019-01-28T16:21:54+08:00">2019-01-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2017-10-28 08:39:58" itemprop="dateModified" datetime="2017-10-28T08:39:58+08:00">2017-10-28</time>
              </span>

          
            <span id="/hexo_blog/2019/01/28/hello-world/" class="post-meta-item leancloud_visitors" data-flag-title="Hello World" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/01/28/hello-world/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/01/28/hello-world/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="quick-start"><a class="header-anchor" href="#quick-start"></a>Quick Start</h2>
<h3 id="create-a-new-post"><a class="header-anchor" href="#create-a-new-post"></a>Create a new post</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="run-server"><a class="header-anchor" href="#run-server"></a>Run server</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="generate-static-files"><a class="header-anchor" href="#generate-static-files"></a>Generate static files</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="deploy-to-remote-sites"><a class="header-anchor" href="#deploy-to-remote-sites"></a>Deploy to remote sites</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/01/21/Cassandra%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/01/21/Cassandra%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="post-title-link" itemprop="url">Cassandraæ•°æ®ç»“æ„</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-01-21 15:35:56" itemprop="dateCreated datePublished" datetime="2019-01-21T15:35:56+08:00">2019-01-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-02-22 16:45:42" itemprop="dateModified" datetime="2021-02-22T16:45:42+08:00">2021-02-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/cassandra/" itemprop="url" rel="index"><span itemprop="name">cassandra</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/01/21/Cassandra%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="post-meta-item leancloud_visitors" data-flag-title="Cassandraæ•°æ®ç»“æ„" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/01/21/Cassandra%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/01/21/Cassandra%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="cassandra-æ•°æ®ç»“æ„"><a class="header-anchor" href="#cassandra-æ•°æ®ç»“æ„"></a>Cassandra æ•°æ®ç»“æ„</h2>
<p>å¿…é¡»äº†è§£<code>Cassandra</code>çš„æ•°æ®ç»“æ„ã€‚æœ¬èº«å¹¶ä¸æ˜¯å¤šä¹ˆå¤æ‚ï¼Œè€Œä¸”æœ‰è¶³å¤Ÿå¤šçš„æ–‡æ¡£ï¼Œæ‰€ä»¥ç®€å•å†™ä¸€ä¸‹ã€‚</p>
<h3 id="keyspace"><a class="header-anchor" href="#keyspace"></a>KeySpace</h3>
<ul>
<li>å¥½åƒæ²¡å•¥éœ€è¦è§£é‡Šçš„ã€‚</li>
<li>åœ¨è®ºæ–‡é‡Œé¢çœ‹åˆ°è¯´<code>namespace</code>çš„å¦ä¸€ä¸ªä½œç”¨æ˜¯å¯ä»¥åšæ•°æ®é‡å¤ã€‚</li>
</ul>
<h3 id="column"><a class="header-anchor" href="#column"></a>Column</h3>
<ul>
<li><code>Column</code>æ˜¯<code>Cassandra</code>ä¸­æœ€å°çš„æ•°æ®å•å…ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸‰å…ƒçš„æ•°æ®ç±»å‹ï¼ŒåŒ…å«<code>name,value,timestamp.</code></li>
<li><code>name</code>æ˜¯å¿…é¡»çš„ï¼Œ<code>value</code>ä¸æ˜¯å¿…é¡»çš„ï¼Œ<code>timestamp</code>ç»å¸¸å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œå¦‚ä¸‹å›¾<br>
<img src="https://raw.githubusercontent.com/sallyslove/Pictures/master/Cassandra/cassandra_column.png" alt="å¼•ç”¨è‡ªç¬¬ä¸€ç¯‡å‚è€ƒé“¾æ¥"></li>
</ul>
<blockquote>
<p>å¼•ç”¨è‡ªcsdn</p>
</blockquote>
<h3 id="super-column"><a class="header-anchor" href="#super-column"></a>Super Column</h3>
<ul>
<li>å¯ä»¥å°†<code>SuperColumn</code>æƒ³è±¡æˆ<code>Column</code>çš„æ•°ç»„ï¼Œå®ƒåŒ…å«ä¸€ä¸ª<code>name</code>ä»¥åŠä¸€ç³»åˆ—<code>Column</code>.</li>
<li><code>SuperColumn</code>æœ¬èº«ä¸åŒ…å«<code>timestamp</code>å±æ€§ã€‚ä½¿ç”¨<code>SuperColumn</code>æœ‰ä¸€ä¸ªé™åˆ¶ï¼Œè¦è¯»å–å…¶ä¸­ä¸€ä¸ªå­åˆ—çš„å€¼ï¼Œå¿…é¡»æŠŠæ‰€æœ‰å­åˆ—éƒ½ååºåˆ—åŒ–ï¼Œä¸”ä¸èƒ½åœ¨å­åˆ—ä¸­å»ºç´¢å¼•<br>
<img src="https://raw.githubusercontent.com/sallyslove/Pictures/master/Cassandra/cassandra_super_column.png" alt=""></li>
</ul>
<blockquote>
<p>å¼•ç”¨è‡ªcsdn</p>
</blockquote>
<ul>
<li>
<p>å‚è€ƒé“¾æ¥é‡Œé¢æœ‰ä»¥ä¸‹çš„ä¾‹å­</p>
<pre><code> {   // è¿™æ˜¯ä¸€ä¸ªSuperColumn
     name: &quot;info&quot;,
     // åŒ…å«ä¸€ç³»åˆ—çš„Columns
     value: {
        street: {name: &quot;street&quot;, value: &quot;1234 x street&quot;, timestamp: 123456789},
        city: {name: &quot;city&quot;, value: &quot;san francisco&quot;, timestamp: 123456789},
        zip: {name: &quot;zip&quot;, value: &quot;94107&quot;, timestamp: 123456789},
  }
}
</code></pre>
</li>
</ul>
<h3 id="columnfamily"><a class="header-anchor" href="#columnfamily"></a>ColumnFamily</h3>
<ul>
<li>
<p><code>columnFamily</code>ç›¸å½“äºæ•°æ®åº“ä¸­çš„è¡¨</p>
</li>
<li>
<p>æ¯ä¸€è¡Œæœ‰ä¸€ä¸ª<code>row</code>çš„åå­—ï¼Œç„¶åæ¯ä¸€è¡Œé‡Œé¢æ˜¯ä¸€ä¸ªä¸ªçš„<code>column</code>ï¼Œä¹Ÿå¯ä»¥æ˜¯<code>super column</code></p>
</li>
<li>
<p><code>ColumnFamily</code>æ˜¯ä¸€ä¸ªåŒ…å«äº†è®¸å¤š<code>Row</code>çš„ç»“æ„ï¼Œæ¯ä¸€ä¸ª<code>Row</code>éƒ½åŒ…å«æœ‰<code>client</code>æä¾›çš„<code>Key</code>ä»¥åŠå’Œè¯¥<code>Key</code>å…³è”çš„ä¸€ç³»åˆ—<code>Column</code>ã€‚</p>
</li>
<li>
<p>æ¯ä¸€è¡Œé‡Œé¢çš„<code>column</code>çš„åå­—å¯ä»¥æ˜¯ä¸å˜çš„ã€‚ä¹Ÿå¯ä»¥æ˜¯å¯å˜çš„ã€‚é™æ€å’ŒåŠ¨æ€<code>column</code></p>
</li>
<li>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ•°æ®å†™å…¥çš„æ—¶å€™å·²ç»ç»è¿‡æ’åºäº†ã€‚å°±æ˜¯è¯´ä¸€è¡Œçš„æ‰€æœ‰<code>column</code>ï¼Œä¼šæ ¹æ®å®ƒçš„åå­—æ¥è¿›è¡Œæ’åºã€‚</p>
</li>
<li>
<p>ç¬¬äºŒä¸ªå‚è€ƒé“¾æ¥é‡Œé¢çš„ä¾‹å­ï¼š</p>
</li>
</ul>
<pre><code>   UserProfile = { // è¿™æ˜¯ä¸€ä¸ªColumnFamily
        phatduckk: {   // è¿™æ˜¯å¯¹åº”ColumnFamilyçš„key
            // è¿™æ˜¯Keyä¸‹å¯¹åº”çš„Column
            username: &quot;gpcuster&quot;,
            email: &quot;gpcuster@gmail.com&quot;,
            phone: &quot;6666&quot;
        }, // ç¬¬ä¸€ä¸ªrowç»“æŸ
        ieure: {   // è¿™æ˜¯ColumnFamilyçš„å¦ä¸€ä¸ªkey
          //è¿™æ˜¯å¦ä¸€ä¸ªKeyå¯¹åº”çš„column
          username: &quot;pengguo&quot;,
          email: &quot;pengguo@live.com&quot;,
          phone: &quot;888&quot;
        }
</code></pre>
<p><img src="https://raw.githubusercontent.com/sallyslove/Pictures/master/Cassandra/cassandra_column_family.png" alt=""></p>
<blockquote>
<p>å¼•ç”¨è‡ªç¬¬ä¸€ç¯‡å‚è€ƒé“¾æ¥æ–‡æ¡£</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/sallyslove/Pictures/master/Cassandra/cassandra_storage_picture.png" alt=""></p>
<blockquote>
<p>å¼•ç”¨è‡ªç¬¬äºŒç¯‡å‚è€ƒé“¾æ¥æ–‡æ¡£</p>
</blockquote>
<h3 id="å¯¹åº”åˆ°è¡¨çš„å®šä¹‰é‡Œé¢"><a class="header-anchor" href="#å¯¹åº”åˆ°è¡¨çš„å®šä¹‰é‡Œé¢"></a>å¯¹åº”åˆ°è¡¨çš„å®šä¹‰é‡Œé¢</h3>
<p>ç›®å‰å¯¹äºè¡¨ç»“æ„çš„ç†è§£æ˜¯è¿™æ ·çš„ï¼Œå¯èƒ½åé¢æœ‰æ›´æ­£ï¼š</p>
<ul>
<li>å¦‚æœç”¨<code>desc tables</code>å»æŸ¥çœ‹ä¸€å¼ è¡¨ã€‚é‚£ä¹ˆå¯ä»¥çœ‹åˆ°<code>primaryKey</code>å­—æ ·ï¼Œç±»ä¼¼<code>PRIMARY KEY ()</code>ï¼Œè¿˜æœ‰<code>CLUSTERING ORDER</code> å­—æ ·</li>
<li><strong><em>é‚£ä¹ˆè¿™ä¸ªprimary keyå°±æ˜¯å¯¹åº”æ•°æ®æ¨¡å‹é‡Œé¢çš„rowçš„åå­—ã€‚ä¹Ÿå°±æ˜¯super columnçš„åå­—ã€‚åªä¸è¿‡è¿™ä¸ªåå­—æ˜¯å‡ ä¸ªprimaryKeyè”åˆèµ·æ¥ç»„æˆçš„ã€‚ï¼Ÿ</em></strong></li>
<li><code>primaryKey</code>å¯ä»¥ç”¨æ¥æŸ¥è¯¢æ•°æ®ã€‚<code>primary key</code>åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†<code>partition key</code>å’Œ<code>clustering key</code>ï¼Œ å‰è€…ç»„åˆèµ·æ¥å†³å®šä¸€ä¸ªæ•°æ®çš„å­˜å‚¨åœ¨å“ªä¸ª<code>node</code>ä¸Šé¢, åè€…ä¼šç”¨æ¥æ’åºã€‚è€Œ <code>CLUSTERING ORDER</code>å†³å®šæ’åºæ—¶å€™ä½¿ç”¨çš„å‚æ•°çš„é¡ºåº</li>
<li>æŸ¥è¯¢æ˜¯æ—¶å€™å¿…é¡»ç»™å‡ºæ‰€æœ‰çš„<code>partition key</code>ï¼Œä¹‹å‰æœ‰è¿‡<code>ALLOW FILTERING</code>çš„å­—æ®µæ¥å®¹å¿ç¼ºå¤±<code>partition key</code>ï¼Œç°åœ¨æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½äº†ã€‚</li>
</ul>
<p>å¦‚ä¸‹ï¼š</p>
<pre><code>PRIMARY KEY ((race_year, race_name), rank)
</code></pre>
<p>è¿™é‡Œçš„<code>race_year</code>å’Œ<code>race_name</code>å°±æ˜¯ç»„åˆçš„<code>partition key</code>,è€Œ<code>rank</code>å°±æ˜¯<code>a clustering column</code>ï¼Œç”¨æ¥æ’åºçš„</p>
<ul>
<li>ä¹Ÿå¯èƒ½çœ‹åˆ°<code>CLUSTERING ORDER BY</code>çš„å­—æ ·é‡Œé¢ï¼Œæœ‰<code>ASC</code>ï¼Œä»£è¡¨å‡åºæ’åºï¼Œå¯ä»¥æŒ‡å®šä¸º<code>DESC</code>é™åºæ’åº</li>
<li>åœ¨<code>3.0</code>çš„ç‰ˆæœ¬ä¹‹å‰ï¼Œè¿˜å¯èƒ½çœ‹åˆ°<code>COMPACT STORAGE</code>ï¼Œç°åœ¨å·²ç»æ²¡æœ‰å•¦ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸å†™äº†ã€‚</li>
</ul>
<h3 id="data-moduling"><a class="header-anchor" href="#data-moduling"></a>data moduling</h3>
<ul>
<li>æœ€è¿‘çœ‹äº†ä¸€äº›å…³äºå»ºæ¨¡çš„æ–‡ç« ã€‚æ–‡ç« é‡Œé¢ä¸€äº›åå¤å¼ºè°ƒçš„äº‹å¦‚ä¸‹ï¼š
<ul>
<li><code>cassandra</code>ä¸åŒäºå…¶ä»–æ•°æ®åº“çš„æ˜¯ï¼Œå®ƒå†™çš„æˆæœ¬ä½ï¼Œè¯»çš„æˆæœ¬é«˜ã€‚</li>
<li>åŸºäºè¿™ä¸€ç‚¹ï¼Œå¿…é¡»åœ¨ä¸€å¼€å§‹å…ˆè€ƒè™‘<code>query</code>çš„éœ€æ±‚ï¼Œç„¶åæ•°æ®å¯ä»¥<code>duplicated</code>ã€‚è€Œåœ¨å…³ç³»æ•°æ®åº“å»ºæ¨¡æ—¶å€™ï¼Œå®Œå…¨æ˜¯ä¸ä¸€æ ·çš„ã€‚</li>
<li>åŸºäº<code>cassandra</code>çš„å†™å’Œå­˜å‚¨çš„æ–¹å¼ï¼Œéœ€è¦è¯»å–çš„æ•°æ®åº”è¯¥æ”¾åœ¨åŒä¸€ä¸ª<code>partition</code>é‡Œé¢ã€‚</li>
<li>æ–‡ç« é‡Œé¢çš„è¿™å¥è¯è¯´æ˜äº†<code>partition</code>çš„å®šä¹‰å’Œé‡è¦æ€§ï¼š</li>
</ul>
<blockquote>
<p>a set of rows that share a partition key is called a partition<br>
Cassandra is a partitioned row store with tunable consistency.<br>
You perform several optimizations in the physical data modeling stage, including the specifying of partition sizes and ordering.</p>
</blockquote>
</li>
</ul>
<h3 id="å‚è€ƒæ–‡æ¡£"><a class="header-anchor" href="#å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3>
<ul>
<li><a href="https://blog.csdn.net/aesop_wubo/article/details/20289837" target="_blank" rel="noopener">æ•°æ®æ¨¡å‹</a></li>
<li><a href="http://www.cnblogs.com/gpcuster/archive/2010/03/12/1684072.html" target="_blank" rel="noopener">å¤§è¯Cassandraæ•°æ®æ¨¡å‹</a></li>
<li><a href="https://stackoverflow.com/questions/24949676/difference-between-partition-key-composite-key-and-clustering-key-in-cassandra" target="_blank" rel="noopener">primary key partition key and clustering key</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/01/21/Cassandra%E8%AF%BB%E6%95%B0%E6%8D%AE%E8%BF%87%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/01/21/Cassandra%E8%AF%BB%E6%95%B0%E6%8D%AE%E8%BF%87%E7%A8%8B/" class="post-title-link" itemprop="url">Cassandraè¯»æ•°æ®è¿‡ç¨‹</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-01-21 15:35:32" itemprop="dateCreated datePublished" datetime="2019-01-21T15:35:32+08:00">2019-01-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-07-09 17:44:25" itemprop="dateModified" datetime="2021-07-09T17:44:25+08:00">2021-07-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/cassandra/" itemprop="url" rel="index"><span itemprop="name">cassandra</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/01/21/Cassandra%E8%AF%BB%E6%95%B0%E6%8D%AE%E8%BF%87%E7%A8%8B/" class="post-meta-item leancloud_visitors" data-flag-title="Cassandraè¯»æ•°æ®è¿‡ç¨‹" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/01/21/Cassandra%E8%AF%BB%E6%95%B0%E6%8D%AE%E8%BF%87%E7%A8%8B/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/01/21/Cassandra%E8%AF%BB%E6%95%B0%E6%8D%AE%E8%BF%87%E7%A8%8B/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="cassandraè¯»æ•°æ®è¿‡ç¨‹"><a class="header-anchor" href="#cassandraè¯»æ•°æ®è¿‡ç¨‹"></a>Cassandraè¯»æ•°æ®è¿‡ç¨‹</h2>
<p>æ•°æ®åº“è¯»æ•°æ®è¿‡ç¨‹å¿…é¡»çŸ¥é“ã€‚</p>
<h3 id="å¤§è‡´çš„è¯»æµç¨‹"><a class="header-anchor" href="#å¤§è‡´çš„è¯»æµç¨‹"></a>å¤§è‡´çš„è¯»æµç¨‹</h3>
<p><img src="https://docs.datastax.com/en/archived/cassandra/3.0/cassandra/images/dml_caching-reads_12.png" alt="å®˜æ–¹è¯»æµç¨‹å›¾ç‰‡"></p>
<blockquote>
<p>å®˜æ–¹è¯»æµç¨‹å›¾ç‰‡</p>
</blockquote>
<ul>
<li>
<p>Check the memtable</p>
</li>
<li>
<p>Check row cache, if enabled</p>
</li>
<li>
<p>Checks Bloom filter</p>
</li>
<li>
<p>Checks partition key cache, if enabled</p>
</li>
<li>
<p>Goes directly to the compression offset map if a partition key is found in the partition key cache, or checks the partition summary if not<br>
If the partition summary is checked, then the partition index is accessed</p>
</li>
<li>
<p>Locates the data on disk using the compression offset map</p>
</li>
<li>
<p>Fetches the data from the SSTable on disk</p>
</li>
<li>
<p>åœ¨å­˜è´®æ•°æ®çš„æ—¶å€™ï¼Œ<code>Cassandra</code>ä¼šå°†åŒæ ·çš„æ•°æ®å­˜å‚¨å¾ˆå¤šä»½ï¼Œè¿™ä¸ªåœ¨å†™çš„æ—¶å€™å·²ç»æåŠè¿‡ã€‚</p>
</li>
<li>
<p>åœ¨è¯»çš„æ—¶å€™è¯»å‡ ä¸ªèŠ‚ç‚¹åŒæ ·æ˜¯ç”±å¤åˆ¶å› å­å’Œ<code>consistency level</code>ç­–ç•¥å†³å®šçš„ã€‚ä¹Ÿå°±æ˜¯è¯´å†™å‡ ä¸ªï¼Œè¯»å‡ ä¸ªã€‚</p>
</li>
</ul>
<h3 id="caches"><a class="header-anchor" href="#caches"></a>Caches</h3>
<p>è¿™ç¯‡ä¹Ÿä½œä¸º<code>KeyCache</code>å’Œ<code>RowCache</code>å­¦ä¹ çš„blog.<br>
<code>RowCache</code>ç¼“å­˜çš„æ˜¯æ•°æ®ï¼Œè€Œ<code>KeyCache</code>ç¼“å­˜çš„æ˜¯åœ¨<code>SSTable</code>æ–‡ä»¶ä¸­çš„ä½ç½®ã€‚<br>
<code>Cassandra</code>è¯»æ•°æ®æ…¢ï¼Œå†™æ•°æ®å¿«ã€‚</p>
<p>ä»¥ä¸‹å‡ ç§<code>cache</code>éƒ½æ˜¯é’ˆå¯¹<code>SSTable</code>æ¥è¯´çš„</p>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<ul>
<li><a href="https://stackoverflow.com/questions/25079311/difference-between-cassandra-row-caching-and-partition-key-caching" target="_blank" rel="noopener">row cache å’Œ key cache</a></li>
</ul>
<h4 id="rowcache"><a class="header-anchor" href="#rowcache"></a>rowCache</h4>
<ul>
<li><code>rowCache</code>å°±æ˜¯å°†æ•´ä¸ª<code>partition</code>æ”¾åœ¨å†…å­˜é‡Œé¢æ¥å¢é€Ÿ</li>
<li>ä¸æ˜¯é»˜è®¤å¼€çš„ï¼Œåœ¨2.2ä¹‹åï¼Œä¼šå°†è¿™äº›è¡Œå­˜è¿›éæ ˆçš„å†…å­˜é‡Œé¢ï¼Œä½¿å¾—ç³»ç»Ÿä¸éœ€è¦è¿›è¡Œ<code>GC</code></li>
<li>å½“å­˜åœ¨å†…å­˜ä¸­çš„è¡Œè¢«æ›´æ–°ä¹‹åï¼Œè¿™ä¸€è¡Œä¼šè¢«åˆ é™¤ï¼Œç›´åˆ°å†æ¬¡è¯»å–</li>
<li>åŒæ ·ï¼Œå½“ä¸€ä¸ª<code>partition</code>è¢«æ›´æ–°äº†ï¼Œè¿™ä¸ª<code>partition</code>ä¼šè¢«ä»å†…å­˜é‡Œé¢åˆ é™¤ï¼Œä¸€èˆ¬ä¸æ¨èä½¿ç”¨ã€‚å› ä¸ºå¾ˆå®¹æ˜“å¤±æ•ˆ</li>
<li>å‚æ•°ï¼š
<ul>
<li><code>rows_per_partition</code>ï¼š<em>set the number of rows the database must cache in a partition.This attribute has three values: ALL, NONE, and N.</em></li>
</ul>
</li>
</ul>
<h4 id="bloom-filters"><a class="header-anchor" href="#bloom-filters"></a>bloom filters</h4>
<ul>
<li><code>Bloom Filters</code> å°±æ˜¯åœ¨å†™<code>ssTable</code>æ—¶å€™åŒæ—¶å†™çš„<code>filter.db</code>æ–‡ä»¶ã€‚ä½†æ˜¯å®é™…æ˜¯è¯»çš„æ—¶å€™ç”¨çš„ä¸€ä¸ªæœºåˆ¶</li>
<li>è¯»çš„æ—¶å€™ä¼šç”¨è¿™ä¸ªæœºåˆ¶æ¥çœ‹ä¸€ä¸ªæ•°æ®keyæ˜¯ä¸æ˜¯åœ¨æŸä¸ª<code>SSTable</code>é‡Œé¢ã€‚å½“filterè¡¨ç¤ºä¸åœ¨ï¼Œè‚¯å®šæ˜¯ä¸åœ¨ï¼›ä½†æ˜¯è¯´åœ¨ï¼Œå¯èƒ½ä¸åœ¨ã€‚å°±æ˜¯è¯´å¯èƒ½å‡ç»¿çš„ã€‚ä¹Ÿä¼šç»™å‡ºä¸€ä¸ªæ¦‚ç‡å€¼ï¼ŒæŸä¸ª<code>partition</code>åœ¨ä¸åœ¨è¿™ä¸ª<code>SSTable</code>é‡Œé¢</li>
<li>å‡ç»¿çš„æ¦‚ç‡æ˜¯ä¸‡åˆ†ä¹‹ä¸€</li>
<li>å¯ä»¥é…ç½®<code>bloom_filter_fp_chance</code>æ¥é™ä½å‡ç»¿ï¼Œä½†æ˜¯ä¼šå æ›´å¤šå†…å­˜</li>
<li><code>Bloom Filters</code> ä¹Ÿæ˜¯å­˜å‚¨åœ¨<code>off-heap</code> memoryé‡Œé¢çš„ã€‚å¹¶ä¸”æ˜¯æ¯å¼ <code>SSTable</code>éƒ½æœ‰ä¸€ä¸ªçš„</li>
<li><em>A Bloom filter can establish that a SSTable does not contain certain partition data.</em></li>
<li>å‚è€ƒé“¾æ¥ï¼š
<ul>
<li><a href="https://blog.csdn.net/u010900754/article/details/78307808" target="_blank" rel="noopener">bloom è¿‡æ»¤å™¨</a></li>
<li><a href="https://blog.csdn.net/jiaomeng/article/details/1495500" target="_blank" rel="noopener">ç®—æ³•åŸç†</a></li>
<li><a href="https://blog.csdn.net/nangongyanya/article/details/54089568" target="_blank" rel="noopener">Cassandra Bloom è¿‡æ»¤å™¨</a></li>
</ul>
</li>
</ul>
<h4 id="keycache"><a class="header-anchor" href="#keycache"></a>keyCache</h4>
<ul>
<li>key cacheï¼šstores a map of partition keys to row index entriesã€‚stores a cache of the partition index in off-heap memory</li>
<li><code>keyCache</code>åˆå«åš<code>partition key cache</code>ï¼Œé‡Œé¢å­˜è´®çš„æ˜¯æ¯ä¸€ä¸ª<code>partition</code>åœ¨<code>SSTable</code>è¡¨é‡Œé¢å¼€å§‹çš„<code>index</code></li>
<li>ä¹Ÿåœ¨<code>off-heap</code>é‡Œé¢</li>
<li><code>key_cache_size_in_mb</code>ï¼šæ‰€æœ‰è¡¨çš„<code>keyCache</code>ä¸€èµ·çš„å¤§å°çš„é…ç½®</li>
</ul>
<p><img src="%5Chexo_blog%5Cimages%5Cpasted-4.png" alt="upload successful"></p>
<h4 id="counter-cache"><a class="header-anchor" href="#counter-cache"></a>counter cache</h4>
<ul>
<li>A counter cache improves performance for the counters that youâ€™ll need to access frequently. å¥½åƒæ²¡æ€ä¹ˆå¬è¯´è¿‡counterçš„æ¦‚å¿µã€‚è¿™ä¸ªcacheä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡çœ‹åˆ°æœ‰ã€‚</li>
</ul>
<h4 id="partition-summary-partition-index"><a class="header-anchor" href="#partition-summary-partition-index"></a>Partition Summary &amp; Partition Index</h4>
<ul>
<li><code>partition index</code>æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šé¢çš„æ–‡ä»¶ï¼Œé‡Œé¢æ˜¯_an index of all partition keys mapped to their offset._</li>
<li><code>partition summary</code>æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„<code>partition index</code>çš„é‡‡æ ·ã€‚ä¹Ÿæ˜¯åœ¨<code>off-heap</code>é‡Œé¢çš„ã€‚ä¹Ÿå°±æ˜¯å‡ ä¹æ‰€æœ‰å¸®åŠ©è¯»çš„æœºåˆ¶éƒ½å­˜åœ¨<code>off-heap</code>çš„å†…å­˜é‡Œé¢</li>
<li><code>partition summary</code>çš„é‡‡æ ·å­˜å‚¨ä¸¾ä¾‹æ¥è¯´ï¼Œå‡è®¾å› å­æ˜¯20ï¼Œé‚£ä¹ˆå°±æ˜¯ç¬¬ä¸€ä¸ªå’Œç¬¬20ä¸ªçš„åç§»é‡è¢«å­˜å‚¨äº†ã€‚</li>
<li>å¦‚æœåœ¨è¯»çš„æ—¶å€™å¿…é¡»è¯»åˆ°<code>partition summary</code>ï¼Œé‚£ä¹ˆæ•´ä¸ªè¯»çš„è¿‡ç¨‹ä¼šæœ‰ä¸¤æ¬¡è®¿é—®ç£ç›˜</li>
</ul>
<h3 id="gossip-protocal"><a class="header-anchor" href="#gossip-protocal"></a>Gossip Protocal</h3>
<h3 id="limit"><a class="header-anchor" href="#limit"></a>Limit</h3>
<ul>
<li><code>Cassandra</code>æ ¹æ®<code>primary key</code>æ¥è¯»å–æ•°æ®ï¼Œè¿™ä¸ª<code>key</code>å°±æ˜¯å­˜åœ¨<code>keyCache</code>é‡Œé¢çš„å†…å®¹ã€‚ç„¶åä¼šè¯»å–ä¸€ç‰‡æ•°æ®ã€‚<em>è¿™é‡Œç†è§£æ­£ç¡®å—ï¼Ÿ<code>keyCache</code>é‡Œé¢çš„ä¸æ˜¯<code>partition index</code>é‡Œé¢çš„å†…å®¹å—ï¼Ÿ</em></li>
<li>è¯»å–æ—¶å€™å¯ä»¥æŒ‡å®š<code>limit</code>å€¼ï¼Œè¿™æ ·ä¼šè¯»å–æœ‰é™çš„å†…å®¹ï¼Œè€Œä¸æ˜¯ä¸€å¤§ç‰‡ã€‚</li>
</ul>
<h3 id="å‚è€ƒæ–‡æ¡£"><a class="header-anchor" href="#å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3>
<ul>
<li>éå¸¸è¯¦å°½æ¸…æ™°çš„ä¸€ç¯‡æ–‡æ¡£ï¼š<a href="https://www.oschina.net/question/12_11855" target="_blank" rel="noopener">Cassandraæ•°æ®ç»“æ„å’Œå†™å…¥è¯»å–</a></li>
<li><a href="https://docs.datastax.com/en/archived/cassandra/3.0/cassandra/dml/dmlAboutReads.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£è¯»æµç¨‹</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/01/17/Cassandra-%E5%86%99%E6%95%B0%E6%8D%AE%E8%BF%87%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/01/17/Cassandra-%E5%86%99%E6%95%B0%E6%8D%AE%E8%BF%87%E7%A8%8B/" class="post-title-link" itemprop="url">Cassandra å†™æ•°æ®è¿‡ç¨‹</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-01-17 16:37:00" itemprop="dateCreated datePublished" datetime="2019-01-17T16:37:00+08:00">2019-01-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-07-08 10:19:59" itemprop="dateModified" datetime="2021-07-08T10:19:59+08:00">2021-07-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/cassandra/" itemprop="url" rel="index"><span itemprop="name">cassandra</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/01/17/Cassandra-%E5%86%99%E6%95%B0%E6%8D%AE%E8%BF%87%E7%A8%8B/" class="post-meta-item leancloud_visitors" data-flag-title="Cassandra å†™æ•°æ®è¿‡ç¨‹" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/01/17/Cassandra-%E5%86%99%E6%95%B0%E6%8D%AE%E8%BF%87%E7%A8%8B/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/01/17/Cassandra-%E5%86%99%E6%95%B0%E6%8D%AE%E8%BF%87%E7%A8%8B/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="cassandra-å†™æµç¨‹"><a class="header-anchor" href="#cassandra-å†™æµç¨‹"></a>Cassandra å†™æµç¨‹</h2>
<h3 id="å¤§è‡´æµç¨‹"><a class="header-anchor" href="#å¤§è‡´æµç¨‹"></a>å¤§è‡´æµç¨‹</h3>
<p>åˆ°æŠŠæ•°æ®å†™åˆ°ç£ç›˜ä¸­åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>å…ˆæ‰¾åˆ°åº”è¯¥å¾€å“ªå‡ ä¸ªèŠ‚ç‚¹å†™</li>
<li>å†™<code>log</code>åˆ°<code>commit log</code></li>
<li>å†™æ•°æ®åˆ°<code>memtable</code></li>
<li>ä»<code>memtable</code>ä¸­<code>flush</code>æ•°æ®</li>
<li>å°†æ•°æ®å­˜å‚¨åœ¨<code>SSTables</code>ä¸­çš„ç£ç›˜ä¸­</li>
</ol>
<ul>
<li>å®¢æˆ·ç«¯å†™ä¸€æ¡æ•°æ®å¿…é¡»æŒ‡å®š <code>Keyspaceã€ColumnFamilyã€Keyã€Column Name å’Œ Value</code>ï¼Œè¿˜å¯ä»¥æŒ‡å®š <code>Timestamp</code>ï¼Œä»¥åŠæ•°æ®çš„å®‰å…¨ç­‰çº§ã€‚<br>
<strong><em>è¿™ä¸ª<code>key</code>åˆæ˜¯ä»€ä¹ˆ<code>key</code>å‘¢ï¼Œ<code>partition Key, primary Key</code>,æ˜¯åæ–‡è¯´æ ¹æ®<code>key</code>ç®—å‡º<code>token</code>ï¼Œç„¶åå†æ ¹æ®<code>token</code>ç®—å‡º<code>partition Index</code>çš„</em></strong></li>
</ul>
<pre><code>Cassandra Node ---&gt;Commitlog---&gt; Memtable

Commitlog ---&gt; Periodically sync to  disk

Memtable  ---&gt; Periodically flush to SSTable
</code></pre>
<h3 id="replica-factor"><a class="header-anchor" href="#replica-factor"></a>Replica Factor</h3>
<ul>
<li>
<p><code>CassandraServer</code> æ¥æ”¶åˆ°è¦å†™å…¥çš„æ•°æ®æ—¶ï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ª <code>RowMutation</code> å¯¹è±¡ï¼Œå†åˆ›å»ºä¸€ä¸ª <code>QueryPath</code> å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­ä¿å­˜äº† <code>ColumnFamily</code>ã€<code>Column Name</code> æˆ–è€… <code>Super Column Name</code>ã€‚</li>
<li>æŠŠç”¨æˆ·æäº¤çš„æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨ <code>RowMutation</code> å¯¹è±¡çš„ Map&lt;String, ColumnFamily&gt; ç»“æ„ä¸­ã€‚</li>
<li>æ ¹æ®æäº¤çš„<code>Key</code>è®¡ç®—é›†ç¾¤ä¸­é‚£ä¸ªèŠ‚ç‚¹åº”è¯¥ä¿å­˜è¿™æ¡æ•°æ®ã€‚è¿™ä¸ªè®¡ç®—çš„è§„åˆ™æ˜¯ï¼šå°†<code>Key</code>è½¬åŒ–æˆ<code>Token</code>ï¼Œç„¶ååœ¨æ•´ä¸ªé›†ç¾¤çš„<code>Token</code>ç¯ä¸­æ ¹æ®äºŒåˆ†æŸ¥æ‰¾ç®—æ³•æ‰¾åˆ°ä¸ç»™å®šçš„<code>Token</code>æœ€æ¥è¿‘çš„ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li>
<li>å¦‚æœç”¨æˆ·æŒ‡å®šäº†æ•°æ®è¦ä¿å­˜å¤šä¸ªå¤‡ä»½ï¼Œé‚£ä¹ˆå°†ä¼šé¡ºåºåœ¨<code>Token</code>ç¯ä¸­è¿”å›ä¸å¤‡ä»½æ•°ç›¸ç­‰çš„èŠ‚ç‚¹ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„èŠ‚ç‚¹åˆ—è¡¨ï¼Œåé¢<code>Cassandra</code>ä¼šåˆ¤æ–­è¿™äº›èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œå¦‚æœä¸æ­£å¸¸å¯»æ‰¾æ›¿æ¢èŠ‚ç‚¹ã€‚è¿˜æœ‰è¿˜è¦æ£€æŸ¥æ˜¯å¦æœ‰èŠ‚ç‚¹æ­£åœ¨å¯åŠ¨ï¼Œè¿™ç§èŠ‚ç‚¹ä¹Ÿæ˜¯è¦åœ¨è€ƒè™‘çš„èŒƒå›´å†…ï¼Œæœ€ç»ˆä¼šå½¢æˆä¸€ä¸ªç›®æ ‡èŠ‚ç‚¹åˆ—è¡¨ã€‚æœ€åæŠŠæ•°æ®å‘é€åˆ°è¿™äº›èŠ‚ç‚¹ã€‚</li>
<li><strong><em>æ‰€ä»¥åœ¨çœŸæ­£å¼€å§‹å†™å…¥æ•°æ®ä¹‹å‰ï¼Œcassandraä¼šåšè¿™äº›äº‹æƒ…ï¼Ÿåœ¨commitLogä¹‹å‰ï¼Ÿ</em></strong> æˆ‘æƒ³åº”è¯¥æ˜¯ä¹‹å‰</li>
</ul>
</li>
<li>
<p><code>Replica Factor</code>å’Œ<code>consistency level</code>ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œç„¶åæœ‰ä¸€ä¸ªç®—æ³•ã€‚æ¯”å¦‚ï¼Œ<code>replica set</code>æ˜¯3ï¼Œ <code>consistency level</code>çš„ç­–ç•¥æ˜¯<code>Querum</code>ã€‚è¿™æ ·éœ€è¦<code>consistent</code>çš„èŠ‚ç‚¹æ˜¯<code>replica set/2 +1</code> ï¼Œæ‰€ä»¥å°±æ˜¯<code>2</code></p>
</li>
</ul>
<h3 id="eventual-consistency"><a class="header-anchor" href="#eventual-consistency"></a>Eventual Consistency</h3>
<p>è¿™åœ¨<code>Cassandra</code>é‡Œé¢æ˜¯éå¸¸å…³é”®çš„ä¸€ä¸ªæ¦‚å¿µã€‚å†™åœ¨è¿™é‡Œã€‚å› ä¸ºä¸å†™çš„æœºåˆ¶ç›¸å…³æœ€å¤šã€‚</p>
<ul>
<li>
<p><strong><em>Cassandra must make tradeoffs among data consistency, availability, and partition tolerance. Cassandraå¿…é¡»åœ¨æ•°æ®ä¸€è‡´æ€§ã€å¯ç”¨æ€§å’Œåˆ†åŒºå®¹å¿ä¹‹é—´å¹³è¡¡</em></strong></p>
<ul>
<li>
<p>Availability: all clients are able to access the data so they can read and write data. å¯ç”¨æ€§ï¼šæ‰€æœ‰å®¢æˆ·éƒ½èƒ½å¤Ÿè¯»å–å’Œå†™å…¥æ•°æ®</p>
</li>
<li>
<p>Consistencyçš„æ¦‚å¿µï¼š</p>
<ul>
<li>a read always return the latest written dataï¼š è¯»å–æ—¶å€™è¿”å›æœ€åä¸€æ¬¡å†™å…¥çš„æ•°æ®</li>
<li>All clients will read the same value for an element of data even when the database is simultaneously updating dataï¼š å½“æ•°æ®åº“åŒæ­¥å®Œæˆçš„æ—¶å€™ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯åº”è¯¥å¾—åˆ°åŒæ ·çš„æ•°æ®</li>
</ul>
</li>
<li>
<p>Partition toleranceï¼ša database can be split into multiple machines and be able keep functioning even during network segmentation breaksï¼š ä¸€ä¸ªæ•°æ®åº“å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„æœºå™¨ä¸Šé¢ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨ç½‘ç»œå‡ºç°æ•…éšœæ—¶å€™ä¿æŒæ­£å¸¸åŠŸèƒ½</p>
<p>è¿™é‡Œåº”è¯¥å’Œå…³ç³»å‹çš„ä¼ ç»Ÿæ•°æ®åº“ä¸ä¸€æ ·ã€‚Cassandraæ˜¯åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œæ‰€æœ‰nodeçš„åœ°ä½æ˜¯ä¸€æ ·çš„ã€‚<strong><em>è¯´å¥½çš„seedå‘¢ï¼Œæ€ä¹ˆæ„Ÿè§‰æœ‰seedï¼Œ seedåº”è¯¥æ˜¯Gossipæœºåˆ¶é‡Œé¢æå‡ºçš„ã€‚å‚è€ƒåšå®¢å†…æ–‡æ¡£<code>Cassandra system logåˆ†æ</code>åé¢ä¹Ÿè®¸ä¼šæ¢ä¸€ä»½æ–‡æ¡£æ”¾</em></strong></p>
<p>Oracleè¿™ç§æ•°æ®åº“ä¸€èˆ¬æ˜¯å•æœºç‰ˆçš„ï¼Œæ²¡æœ‰clusterï¼Œ ä½†æ˜¯æœ‰ä¸»ä»å¤‡ä»½ï¼Œæ‰€æœ‰ä¸ä¸€æ ·çš„</p>
</li>
</ul>
</li>
<li>
<p>ä¸¥æ ¼æ„ä¹‰ä¸Šé¢çš„Consistencyå¯¹äºåˆ†å¸ƒå¼æ•°æ®åº“æ¥è¯´å¾ˆéš¾åšåˆ°ã€‚æ‰€ä»¥æœ‰Eventual consistency requires that all updates must be present on all the copies (replicas) of data in a distributed database, but allows for the fact that the process can take a bit of time.<br>
å°±æ˜¯è¯´æ›´æ–°æ˜¯éƒ½è¦è¿›è¡Œçš„ï¼Œä½†æ˜¯å¯ä»¥æœ‰ä¸€æ®µæ—¶é—´å·®</p>
</li>
<li>
<p>tuneable consistencyï¼š å¯é…ç½®çš„consistencyã€‚å†™å’Œè¯»éƒ½å¯ä»¥é…ã€‚</p>
</li>
</ul>
<h3 id="commit-log"><a class="header-anchor" href="#commit-log"></a>commit log</h3>
<p><a href="https://stackoverflow.com/questions/34592948/what-is-the-purpose-of-cassandras-commit-log" target="_blank" rel="noopener">stackoverflowé—®ç­”</a><br>
è¿™ç¯‡æ–‡ç« é‡Œé¢è§£é‡Šå¾—æŒºæ¸…æ¥šçš„ã€‚è¿™é‡ŒåŸºæœ¬å°±æ˜¯ç¿»è¯‘ä»¥ä¸‹ã€‚è¿™ä¸ª<code>commit log</code>ä¹Ÿå°±æ˜¯è£…æœºæ—¶å€™é…ç½®çš„é‚£ä¸ª<code>commitlog_directory</code>çš„é…ç½®é¡¹ã€‚<br>
<code>commit log</code>å¤§å°é…ç½®æ˜¯<code>per-node</code>æ¥é…ç½®çš„ï¼Œæ‰€æœ‰çš„<code>table share</code>è¿™ä¸ªé…ç½®ã€‚è€Œ<code>Memtable</code>å’Œ<code>SSTable</code>æ˜¯<code>per-table</code>é…ç½®çš„</p>
<ul>
<li>
<p><code>cassandra</code>æ˜¯å…ˆå†™åˆ°å†…å­˜ï¼Œå†å†™åˆ°<code>disk</code>ä¸Šé¢çš„ï¼Œä½†æ˜¯å¦‚æœå½“æœºäº†ã€‚é‚£ä¹ˆå†…å­˜çš„æ•°æ®å°±ä¼šä¸¢ã€‚</p>
</li>
<li>
<p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦<code>commitLog</code>ï¼Œ<code>cassandra</code>ä¼šä»å½“æœºçš„æ—¶é—´ç‚¹å¼€å§‹ï¼Œå°†<code>commitlog</code>é‡Œé¢çš„æ•°æ®å†å†™åˆ°<code>memTable</code>é‡Œé¢ã€‚è¿™ä¸ªè¿‡ç¨‹å¹¶ä¸å¿«ï¼Œæ‰€ä»¥æœ€å¥½åœ¨<code>restart</code>ä¹‹å‰æ‰‹åŠ¨è¿›è¡Œä¸€ä¸‹<code>memTable</code>çš„<code>flush</code>ã€‚</p>
</li>
<li>
<p>A commit log serves just one purpose: to hold committed data until itâ€™s permanently written to disk in the SSTables</p>
</li>
<li>
<p>commitLogéœ€è¦å†™çš„æ•°æ®å°‘ï¼Œå¹¶ä¸”åªå†™åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œæ‰€ä»¥æ¯”å†™SSTableè¦å¿«</p>
</li>
<li>
<p>åœ¨å·¥ä½œä¸­ç¢°åˆ°çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯commitLogæŸåäº†ï¼Œç„¶åcassandraå°±èµ·ä¸æ¥äº†ã€‚æœ‰ä¸€ä¸ªé…ç½®é¡¹å¯ä»¥å¿½ç•¥commitLogæŠ¥é”™ã€‚</p>
</li>
<li>
<blockquote>
<p>Data in the commit log is purged after its corresponding data in the memtable is flushed to an SSTable on disk.</p>
</blockquote>
</li>
<li>
<blockquote>
<p>Commit log replay is the process of reading the commit log to recover lost writes in the event of interrupted operations.</p>
</blockquote>
</li>
<li>
<p>The database flushes memtables to disk when the space configured for the commit log reaches its limit. è¿™é‡Œé…ç½®çš„åº”è¯¥æ˜¯ç£ç›˜ç©ºé—´å¤§å°ï¼Œcommit logåªä¼šå†™åˆ°ç£ç›˜ä¸Šé¢ã€‚ä¸ä¼šå†™åˆ°å†…å­˜é‡Œé¢ã€‚</p>
</li>
<li>
<p>By default, the database doesnâ€™t compress the commit log, but you can make it compress.</p>
</li>
<li>
<p>The database archives the commit log at the following times. You configure commit log archiving in the commitlog_archiving.properties file. _<strong><em>archiveå’Œcompressä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µçš„æ„Ÿè§‰ã€‚ä½†æ˜¯å‰è€…æ˜¯æŒ‡ä»€ä¹ˆå‘¢</em></strong></p>
<ul>
<li>When the node starts up</li>
<li>When it writes a commit log to disk</li>
<li>At a point in time that you specify</li>
</ul>
</li>
</ul>
<h3 id="memtable"><a class="header-anchor" href="#memtable"></a>MemTable</h3>
<ul>
<li>
<blockquote>
<p>Each memtable is dedicated to storing data for a specific table, and there may be multiple memtables per table.</p>
</blockquote>
</li>
<li>æ¯æ¬¡å†™çš„æ—¶å€™åªå†™å…¶ä¸­ä¸€å¼ memtable memTableåœ¨å†…å­˜é‡Œé¢çœ‹ä¸åˆ°å“¦</li>
<li>memTableæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å†™çš„è¿™ç§ï¼Œå¦å¤–ä¸€ç§æ˜¯ä»SSTableè¯»è¿›æ¥çš„ï¼Œè¿™ç§ä¸ä¼šé‡æ–°å†™å›åˆ°ç£ç›˜é‡Œé¢</li>
<li><code>nodetool flush</code> or the <code>nodetool drain</code> command æ¥è§¦æ³•æ‰‹åŠ¨çš„flushã€‚å‰è€…æ˜¯æŒ‡å®štableã€‚åä¸€ä¸ªå‘½ä»¤æ˜¯flushè¿™ä¸ªnodeã€‚æœŸé—´ä¼šåœæ­¢ä»»ä½•connectionçš„æ¥å¬ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ‰§è¡Œå‘½ä»¤ä¹‹åé‡å¯æ•´ä¸ªnode</li>
</ul>
<h3 id="sstable"><a class="header-anchor" href="#sstable"></a>SSTable</h3>
<p>ç¬¬äºŒç¯‡å‚è€ƒé“¾æ¥éå¸¸å¥½ï¼Œä½†æ˜¯å›¾ç‰‡å¿’ä¸æ¸…æ¥šã€‚</p>
<p><img src="https://www.ibm.com/developerworks/cn/opensource/os-cn-cassandraxu2/image010-large.jpg" alt=""></p>
<blockquote>
<p>å¼•ç”¨è‡ªç¬¬äºŒç¯‡å‚è€ƒé“¾æ¥</p>
</blockquote>
<h4 id="sstableç‰¹æ€§"><a class="header-anchor" href="#sstableç‰¹æ€§"></a>SSTableç‰¹æ€§</h4>
<ul>
<li>ä¸å¯ä¿®æ”¹</li>
<li>Cassandraåœ¨å†™SSTableçš„æ—¶å€™æ˜¯batchæ“ä½œï¼Œå› ä¸ºæ¯æ¬¡éƒ½æ˜¯å¯¹åº”çš„Memtableæ»¡çš„æ—¶å€™æ‰å†™çš„ï¼Œä¸å¤ªä¼šæœ‰å³°å€¼ï¼Œè¿™æ ·ä¿è¯å†™å…¥çš„æ•ˆç‡</li>
</ul>
<h4 id="sstableæ•°æ®å­˜å‚¨"><a class="header-anchor" href="#sstableæ•°æ®å­˜å‚¨"></a>SSTableæ•°æ®å­˜å‚¨</h4>
<ul>
<li>SSTableæ˜¯<code>Sorted String Table</code></li>
<li>SSTableåˆ†ä¸ºdataã€indexã€filterä¸‰ä¸ªæ–‡ä»¶å†™åˆ°ç£ç›˜ä¸Šé¢ï¼Œå…¶å®è¿˜æœ‰å¥½å‡ ä¸ªå…¶ä»–æ–‡ä»¶:<br>
ä»¥ä¸‹æ˜¯ä¸€ä¸ªç›®å½•é‡Œé¢çš„æ–‡ä»¶</li>
</ul>
<pre><code> Filter.db
 Statistics.db
 CompressionInfo.db
 Digest.adler32
 TOC.txt(å°±æ˜¯æ–‡ä»¶åˆ—è¡¨)
 Summary.db
 Data.db
 Index.db
</code></pre>
<ul>
<li>Primary index: A list of partition keys and the start position of rows in the data file written on disk(è®°å¾—è¯»çš„æ—¶å€™è›®æœ‰ç”¨çš„)</li>
<li>Partition summaryï¼š è¿™ä¸ªsummaryæ–‡ä»¶è·Ÿä¸Šé¢çš„Index Summaryåº”è¯¥å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ã€‚è§£é‡Šä¹Ÿæ˜¯ä¸€æ ·ã€‚A sample of the partition index stored in memory</li>
<li>Bloom filterï¼š
<ul>
<li>
<blockquote>
<p>A structure stored in memory that checks if row data exists in the memtable before accessing SSTables on disk<br>
æŒ‰ç…§è¿™ä¸ªè§£é‡Šï¼Œæœ‰ç‚¹ä¸æ˜ç™½ï¼Œè¿™ä¹ˆè¯´åº”è¯¥æ˜¯memoryé‡Œé¢æ‰æœ‰çš„ã€‚<br>
- æ‰¾åˆ°è§£é‡Šäº†ï¼šFilter æ–‡ä»¶å­˜çš„å†…å®¹å°±æ˜¯ BloomFilter å¯¹è±¡çš„åºåˆ—åŒ–ç»“æœã€‚<strong><em>ä½†æ˜¯è¿™æ ·çš„è¯ï¼Œå°†å…¶åºåˆ—åŒ–åä¿å­˜åˆ°diskä¸Šé¢æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ Bloom filters for an SSTable enhance read performanceã€‚åé¢è¯»çš„æ—¶å€™çœ‹çœ‹æ€ä¹ˆæ¥enhanceçš„</em></strong></p>
</blockquote>
</li>
</ul>
</li>
<li>Statisticsï¼š Contains the statistical metadata about the SSTableâ€™s data</li>
</ul>
<ul>
<li>
<p>å­˜è´®çš„ç›®å½•å°±æ˜¯yamlæ–‡ä»¶é‡Œé¢é…ç½®çš„<code>data_file_directories</code>ç¡®å®š</p>
</li>
<li>
<p>For example, /data/data/ks1/cf1-5be396077b811e3a3ab9dc4b9ac088d/la-1-big-Data.db represents a data file. ks1 represents the keyspace name to distinguish the keyspace for streaming or bulk loading data. A hexadecimal string, 5be396077b811e3a3ab9dc4b9ac088d in this example, is appended to table names to represent unique table IDs.<br>
åŒæ ·ä¼šæœ‰ï¼šla-1-big-Index.db</p>
</li>
<li>
<p><strong><em>laæ˜¯å•¥ï¼Ÿ</em></strong></p>
</li>
<li>
<p>ç”¨<code>./tools/bin/sstable2json</code>å¯ä»¥æ‰“å¼€è¿™å †dataæ–‡ä»¶æ¥çœ‹ã€‚ä¸‹é¢æ˜¯æ‰“å¼€ä¸€ä¸ªdataæ–‡ä»¶çš„è¾“å‡ºã€‚</p>
<ul>
<li>ä»è¾“å‡ºæ¥çœ‹ï¼Œå­˜å‚¨çš„æ—¶å€™çš„keyå°±æ˜¯partition keyã€‚å¦‚æœæœ‰å¤šä¸ªï¼Œä¼šç”¨<code>ï¼š</code>éš”å¼€</li>
<li>ç„¶åå®ƒæ˜¯è¿™æ ·çš„ï¼š
<ul>
<li>ä¸æ˜¯partition keyçš„primary keyä¼šä½œä¸ºç¬¬ä¸€ä¸ªcolumnçš„åå­—ï¼ŒåŒæ ·ç”¨:éš”å¼€ã€‚</li>
<li>æ¥ä¸‹æ¥ä¸æ˜¯keyçš„columnå’Œä¸æ˜¯partition keyçš„primary keyè”åˆèµ·æ¥ä½œä¸ºcolumnçš„åå­—ã€‚</li>
<li>æ¯”å¦‚ï¼šé‚£ä¹ˆkeyå°±æ˜¯&quot;name:age&quot;, ç„¶åcellsé‡Œé¢çš„ç¬¬ä¸€è¡Œä¼šæ˜¯,æœ€åæ˜¯æ—¶é—´æˆ³<br>
<code>[&quot;address:salary&quot;,&quot;&quot;,1558958953681000]</code></li>
<li>ç¬¬äºŒè¡Œä¼šæ˜¯ï¼š<br>
<code>[&quot;address:salary:character&quot;,character_value,1558958953681000]</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>    name text PRIMARY KEY,
    age bigint,
    address int,
    salary int,
    character blob,
    PRIMARY KEY ((name, age), address, salary)
</code></pre>
<h3 id="ä»memtablesåˆ°sstable"><a class="header-anchor" href="#ä»memtablesåˆ°sstable"></a>ä»memTablesåˆ°SSTable</h3>
<ul>
<li>
<p>Cassandra flushes the memtables to disk when either the commit log space threshold or the memtable cleanup threshold is reached.</p>
<ul>
<li><code>memtable_cleanup_threshold</code> åé¢ä¸€ç§åº”è¯¥å’Œè¿™ä¸ªå‚æ•°æœ‰å…³</li>
<li>åœ¨<code>expert cassandra</code>çš„ä¹¦é‡Œæœ‰ä¸‰ç§æƒ…å†µä¸‹é¢ä¼šflushã€‚ä¸åŒ…æ‹¬æ‰‹åŠ¨flush</li>
</ul>
</li>
<li>
<blockquote>
<p>To flush the data, Cassandra sorts memtables by token and then writes the data to disk sequentially.<br>
Cassandraåœ¨å°†æ•°æ®å†™åˆ°diskçš„æ—¶å€™ï¼ŒåŒæ—¶ä¼šå°†memtablesæŒ‰ç…§tokenæ’åºã€‚_è¿™ä¸ªtokenæ˜¯ä¸æ˜¯å°±æ˜¯keyç®—å‡ºæ¥çš„é‚£ä¸ªtokenï¼Ÿä½†æ˜¯tableæ€ä¹ˆæŒ‰ç…§tokenæ’åºå‘¢ï¼Œåº”è¯¥è¯´çš„æ˜¯tableé‡Œé¢çš„æ•°æ®å§ _</p>
</blockquote>
</li>
<li>
<blockquote>
<p>A partition index is also created on the disk that maps the tokens to a location on disk.<br>
partition indexæ˜¯åœ¨è¿™é‡Œæ‰ç®—å‡ºæ¥çš„ã€‚é‚£ä¹ˆä¹‹å‰å°±éƒ½æ˜¯tokenã€‚___ Memtbleé‡Œé¢çš„ä¹Ÿéƒ½æ˜¯tokenï¼Ÿ___</p>
</blockquote>
</li>
<li>
<p>flushçš„æ—¶å€™ä¸æ˜¯ä¸€æŠŠå¤´å…¨å†™è¿›å»çš„ã€‚ä¼šå…ˆæŠŠmemTableçš„æ•°æ®æ”¾åˆ°ä¸€ä¸ªqueueé‡Œé¢ã€‚è¿™ä¸ªqueueçš„å¤§å°å¯ä»¥åœ¨configurationé‡Œé¢å®šä¹‰ã€‚</p>
<blockquote>
<p>The queue can be configured with the memtable_heap_space_in_mb or memtable_offheap_space_in_mb setting</p>
</blockquote>
</li>
<li>
<p>You can manually flush a table using nodetool flush.</p>
</li>
<li>
<blockquote>
<p>Consequently, a partition is typically stored across multiple SSTable files.</p>
</blockquote>
</li>
<li>
<p>ç›¸åŒpartition keyçš„è®°å½•åº”è¯¥æ˜¯å­˜è´®åœ¨ä¸€ä¸ªnodeä¸Šé¢ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¯èƒ½æ˜¯å¤šä¸ªæ–‡ä»¶ï¼Œè¦çœ‹æ•°æ®é‡ã€‚</p>
</li>
</ul>
<h3 id="å‚è€ƒæ–‡æ¡£"><a class="header-anchor" href="#å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3>
<ul>
<li><a href="https://blog.csdn.net/fs1360472174/article/details/55005335/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£â€“è¯»å†™æ•°æ®</a></li>
<li><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-cassandraxu2/index.html" target="_blank" rel="noopener">cassandraæ•°æ®åº“è¯¦è§£</a></li>
<li><a href="https://docs.datastax.com/en/cassandra/3.0/cassandra/dml/dmlHowDataWritten.html" target="_blank" rel="noopener">cassandraè¯»å†™è¿‡ç¨‹</a></li>
<li><a href="https://blog.csdn.net/qinzhihu/article/details/8807776" target="_blank" rel="noopener">ä¸€ç¯‡å¾ˆé€šä¿—çš„blog</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/01/17/Cassandra%20System%20Log%20Analyses/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/01/17/Cassandra%20System%20Log%20Analyses/" class="post-title-link" itemprop="url">Cassandra System Log Analyses</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-01-17 14:28:35" itemprop="dateCreated datePublished" datetime="2019-01-17T14:28:35+08:00">2019-01-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-06-04 15:32:29" itemprop="dateModified" datetime="2021-06-04T15:32:29+08:00">2021-06-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/cassandra/" itemprop="url" rel="index"><span itemprop="name">cassandra</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/01/17/Cassandra%20System%20Log%20Analyses/" class="post-meta-item leancloud_visitors" data-flag-title="Cassandra System Log Analyses" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/01/17/Cassandra%20System%20Log%20Analyses/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/01/17/Cassandra%20System%20Log%20Analyses/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>äº†è§£<code>Cassandra</code>çš„<code>system log</code>ï¼Œå¯ä»¥çœ‹åˆ°<code>Cassandra</code>åœ¨å¹²å˜›ã€‚å…¶ä¸­ä¼šæ¶‰åŠåˆ°<code>cassandra</code>çš„ä¸€äº›æœºåˆ¶ï¼Œæ¦‚å¿µè®°å½•ä¸‹æ¥ã€‚</p>
<h2 id="nodetool"><a class="header-anchor" href="#nodetool"></a>Nodetool</h2>
<p><code>Cassandra</code>çš„çŠ¶æ€å¯ä»¥ç”¨<code>NodeTool</code>æ¥æ£€æŸ¥ï¼Œå¦‚æœé‡‡ç”¨äº†<code>ssl</code>è®¤è¯ï¼Œé‚£ä¹ˆå‘½ä»¤æ˜¯ <code>NodeTool --ssl</code></p>
<h2 id="gossip-tasks"><a class="header-anchor" href="#gossip-tasks"></a>Gossip Tasks</h2>
<blockquote>
<p><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-apache-cassandra3x3/index.html" target="_blank" rel="noopener">Apache Cassandra 3.X ç³»åˆ—</a></p>
</blockquote>
<ul>
<li>åå­—å¤ªå¥½è®° ï¼Œæœ‰æ²¡æœ‰ ğŸ˜ƒ</li>
<li><code>Cassandra</code>çš„å„ä¸ªèŠ‚ç‚¹æ˜¯æ— ä¸­å¿ƒåŒ–å¯¹å¾…çš„ã€‚èƒ½åšåˆ°è¿™ä¸€ç‚¹çš„ä¸€ä¸ªå…³é”®æ˜¯ä½¿ç”¨äº†<code>Gossip</code>åè®®ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆé€‚ç”¨äºä¸å¯ä¿¡ç½‘ç»œçš„åè®®
<ul>
<li><code>Cassandra</code>ä¸­<code>Gossip</code>åè®®è¢«å®ç°åœ¨ç±»<code>Gossiper</code>ä¸­ã€‚</li>
<li><code>Gossiper</code>ç±»ç»´æŠ¤äº†ä¸€ä¸ªèŠ‚ç‚¹åˆ—è¡¨ï¼Œè¿™ä¸ªåˆ—è¡¨é‡ŒåŒ…æ‹¬å­˜æ´»çš„å’Œæ­»äº¡çš„èŠ‚ç‚¹ã€‚</li>
<li><code>GossipTask</code> æ˜¯ä½äº <code>org.apche.cassandra.gms.Gossip</code> ç±»ä¸‹çš„ä¸€ä¸ªå†…éƒ¨ç±»ã€‚</li>
<li><code>GossipTask</code>ä¼šå‘å…¶ä»–èŠ‚ç‚¹å‘æ¶ˆæ¯ï¼Œé»˜è®¤æ—¶é—´æ˜¯<code>1s</code></li>
</ul>
</li>
</ul>
<h3 id="pending-task-log"><a class="header-anchor" href="#pending-task-log"></a>Pending task log</h3>
<ul>
<li>
<p>åœ¨<code>log</code>é‡Œé¢ä¼šæœ‰ï¼š</p>
<pre><code>[GossipTasks:1] 2019-01-03 04:19:33,680 Gossiper.java:751 - Gossip stage has 378 pending tasks; skipping status check (no nodes will be marked down)
</code></pre>
</li>
</ul>
<h3 id="pause-error-not-making-nodes-down"><a class="header-anchor" href="#pause-error-not-making-nodes-down"></a>Pause Error: Not making Nodes Down</h3>
<blockquote>
<p><a href="http://www.cnblogs.com/jobforlife/p/7092467.html" target="_blank" rel="noopener">errorè§£é‡Š</a></p>
</blockquote>
<ul>
<li>åœ¨<code>log</code>é‡Œé¢ç»å¸¸ä¼šå‡ºç°</li>
<li>å«ä¹‰ï¼š<code>cassandra</code>åœ¨åšå…¶ä»–äº‹æƒ…ï¼Œå¯¼è‡´<code>Gossip</code>åœé¡¿äº†ï¼Œ <code>hang</code>ä½äº†ã€‚ä½†æ˜¯å¹¶ä¸æ ‡ç¤º<code>node</code>çŠ¶æ€ã€‚</li>
<li>é€šå¸¸æ˜¯<code>GC</code>çš„æ—¶å€™ï¼Œè¿™ä¸€å¥çš„ä¸Šä¸€å¥<code>log</code>ç¡®å®æç¤ºäº†ä¸€æ¬¡<code>55742ms</code>çš„<code>GC</code></li>
<li><strong><code>GC</code>é€šå¸¸ä¹Ÿå‘ç”Ÿåœ¨æœ‰å¾ˆå¤š<code>task</code>çš„æ—¶å€™ï¼Œæ‰€ä»¥åº”è¯¥çœ‹çœ‹å…¶ä»–åœ¨åšä»€ä¹ˆ<code>task</code></strong></li>
</ul>
<pre><code>WARN  [GossipTasks:1] 2019-01-02 00:00:04,546 FailureDetector.java:287 - Not marking nodes down due to local pause of 54491963082 &gt; 5000000000
</code></pre>
<h2 id="service-thread"><a class="header-anchor" href="#service-thread"></a>Service Thread</h2>
<p>æ²¡æœ‰çœ‹åˆ°è¿™ä¸ª<code>Service Thread</code>çš„å…·ä½“è§£é‡Šã€‚ä»<code>log</code>é‡Œé¢çœ‹æœ‰å¾ˆå¤šåŠŸèƒ½</p>
<h3 id="gcinspector"><a class="header-anchor" href="#gcinspector"></a>GCInspector</h3>
<ul>
<li>åœ¨<code>log</code>é‡Œé¢æ˜¯ï¼š</li>
</ul>
<pre><code>INFO  [Service Thread] GCInspector.java:284 - ConcurrentMarkSweep GC in 55742ms.  CMS Old Gen: 7331643368 -&gt; 7331643360; Par Eden Space: 1006632960 -&gt; 784484600; Par Survivor Space: 125829104 -&gt; 0
</code></pre>
<ul>
<li>è¿™å¥<code>log</code>çš„æ„æ€æ˜¯ï¼šåšäº†ä¸€æ¬¡<code>CMS GC</code>ã€‚ç„¶åæ•°å­—å¯¹åº”ï¼Œ<code>11</code>ä½æ˜¯<code>G</code>ï¼Œ<code>9</code>ä½æ˜¯<code>M</code>ï¼Œæ‰€ä»¥ <code>eden</code>åŒºæ˜¯784M</li>
<li>å‚è€ƒæœ¬ç«™<code>GC</code>çš„æ–‡ç« äº†è§£æ›´å¤š<code>CMS</code>ç®—æ³•çš„å†…å®¹</li>
</ul>
<h3 id="statuslogger"><a class="header-anchor" href="#statuslogger"></a>StatusLogger</h3>
<p>å¦‚æ­¤ç®€å•çš„ä¸€ä¸ªå‡½æ•°ä¹Ÿæœ‰å¥½å‡ ç§<code>log</code>å•¦ã€‚</p>
<h4 id="stage"><a class="header-anchor" href="#stage"></a>Stage</h4>
<p>æ‰“å°å‡ºå„ç§<code>stage</code>çš„çŠ¶æ€ï¼Œä¸€ä¸ªæ¥ä¸€ä¸ªçš„<code>pool</code>çš„çŠ¶æ€ã€‚çœŸå¿ƒä¸å°‘å•Šã€‚</p>
<ul>
<li>åœ¨<code>log</code>é‡Œé¢ä¼šæœ‰ï¼š</li>
</ul>
<pre><code>INFO  [Service Thread] StatusLogger.java:52 - Pool Name Active   Pending      Completed   Blocked  All Time Blocked
</code></pre>
<h4 id="cache"><a class="header-anchor" href="#cache"></a>Cache</h4>
<p>è¾“å‡º<code>KeyCache</code> å’Œ <code>RowCache</code>çš„çŠ¶æ€</p>
<ul>
<li>åœ¨<code>log</code>é‡Œé¢æ˜¯ï¼š</li>
</ul>
<pre><code>INFO  [Service Thread] StatusLogger.java:88 - Cache Type  Size Capacity KeysToSave
INFO  [Service Thread] StatusLogger.java:90 - KeyCache   1406343  104857600
</code></pre>
<h4 id="memtable"><a class="header-anchor" href="#memtable"></a>memTable</h4>
<ul>
<li>åœ¨<code>log</code>é‡Œé¢æ˜¯ï¼š</li>
</ul>
<pre><code>  [Service Thread]  StatusLogger.java:98 - Table                       Memtable        ops,data
  [Service Thread]  StatusLogger.java:106   
                &lt;table_name&gt;Â Â Â  6284,288376
</code></pre>
<ul>
<li><code>Cassandra</code>çš„<code>API</code>é‡Œé¢å¯¹äº<code>StatusLogger</code>ä¹Ÿæ²¡æœ‰è§£é‡Šã€‚ ORZï¼Œçœ‹æ¥æ˜¯ä¸ªå¾ˆç›´ç™½çš„æ–‡ä»¶å•Š<br>
-<code>org.apache.cassandra.utils.StatusLogger</code> åªæœ‰ä¸€ä¸ªå‡½æ•°<code>log()</code></li>
</ul>
<pre><code>logger.info(String.format(&quot;%-25s%20s&quot;, &quot;Table&quot;, &quot;Memtable ops,data&quot;));
logger.info(String.format(&quot;%-25s%20s&quot;,
                   cfs.keyspace.getName() 
				   + &quot;.&quot; + cfs.name,                                      cfs.metric.memtableColumnsCount.getValue() 
				   + &quot;,&quot; + cfs.metric.memtableLiveDataSize.getValue())); }
</code></pre>
<ul>
<li>æ‰€ä»¥ï¼Œç¬¬ä¸€ä¸ªæ•°å€¼æ˜¯<code>memTable</code>çš„<code>column</code>çš„ä¸ªæ•°ï¼Œç¬¬äºŒä¸ªæ˜¯<code>data</code>çš„<code>size</code></li>
<li>ä¸€ä¸ªé—®é¢˜æ˜¯ï¼š è¿™ä¸ª<code>column</code>ä¹Ÿå¤ªå¤šäº†å§ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</li>
<li>è¢«å¤§ç¥åŠæ‰“äº†ã€‚è¿™ä¸ªå€¼æ˜¯è¡¨è®¿é—®æ¬¡æ•°ã€‚</li>
</ul>
<h2 id="periodic-commit-log-syncer"><a class="header-anchor" href="#periodic-commit-log-syncer"></a>PERIODIC-COMMIT-LOG-SYNCER</h2>
<ul>
<li>åœ¨<code>log</code>é‡Œé¢æ˜¯ï¼š</li>
</ul>
<pre><code>WARN  [PERIODIC-COMMIT-LOG-SYNCER]  AbstractCommitLogService.java:117 - Out of 5 commit log syncs over the past 573s with average duration of 9734.40ms

WARNING [PERIODIC-COMMIT-LOG-SYNCER]  NoSpamLogger.java:94 - Out of 1 commit log syncs over the past 0.00s with average duration of 10508.31ms, 1 have exceeded the configured commit interval by an average of 508.31ms
</code></pre>
<ul>
<li>è¿™ä¸ªåº”è¯¥æ˜¯å°†<code>commit log</code>å†™åˆ°<code>disk</code>ä¸Šé¢çš„<code>task</code>ã€‚æ²¡æœ‰å†æŸ¥èµ„æ–™ã€‚å‚è€ƒæœ¬ç«™<code>cassandra</code>å†™è¿‡ç¨‹é‚£ç¯‡åšå®¢</li>
</ul>
<h2 id="indexsummarymanager"><a class="header-anchor" href="#indexsummarymanager"></a>IndexSummaryManager</h2>
<ul>
<li>åœ¨<code>log</code>é‡Œé¢æ˜¯ï¼š</li>
</ul>
<pre><code>INFO  [IndexSummaryManager:1] IndexSummaryRedistribution.java:74 - Redistributing index summaries
</code></pre>
<ul>
<li><strong>Manages the fixed-size memory pool for index summaries, periodically resizing them in order to give more memory to hot sstables and less memory to cold sstables.</strong></li>
<li>è¿˜ä¸æ˜¯å¾ˆç†è§£ï¼Œå°±æ˜¯è¯´<code>index summary</code>ä¸€å¼€å§‹ä¹Ÿæ˜¯å­˜åœ¨å†…å­˜ä¸­çš„å—ï¼Ÿç¡®å®åœ¨å‚æ•°é…ç½®é‡Œé¢æœ‰<code>index_summary_capacity_in_mb</code>å’Œ<code>index_summary_resize_interval_in_minutes</code></li>
</ul>
<h2 id="compactionexecutor"><a class="header-anchor" href="#compactionexecutor"></a>CompactionExecutor</h2>
<blockquote>
<p><a href="https://stackoverflow.com/questions/59324352/maximum-memory-usage-reached-4294967296-cannot-allocate-chunk-of-1048576" target="_blank" rel="noopener">cannot-allocate-chunk</a></p>
</blockquote>
<pre><code>[CompactionExecutor:290]  AutoSavingCache.java:395 - Saved CounterCache (55 items) in 47 ms

[CompactionExecutor:291]  AutoSavingCache.java:395 - Saved KeyCache (2979 items) in 55 ms

[CompactionExecutor:460]  BigTableWriter.java:211 - Writing large partition 

[CompactionExecutor:483]  NoSpamLogger.java:91 - Maximum memory usage reached (536870912), cannot allocate chunk of 1048576
</code></pre>
<ul>
<li>ä¸Šé¢æ˜¯<code>compactionExecutor</code>çš„æ—¥å¿—ï¼Œå¼€å§‹ä¸‰è¡Œéƒ½æ˜¯æ¯”è¾ƒå®¹æ˜“ç†è§£çš„ã€‚</li>
<li>æœ€åä¸€å¥æ˜¯å…³äºä¸€ä¸ª<code>File Cache</code>ï¼Œä¹Ÿå«<code>Buffer Tool</code>çš„ã€‚è¿™ä¸ªå«ä¹‰æ˜¯è¯´è¿™ä¸ª<code>Cache</code>å·²ç»æ»¡äº†ã€‚é»˜è®¤çš„é…ç½®å°±æ˜¯<code>512M</code></li>
<li>åœ¨ä¸‹é¢çš„è¿™ç¯‡é“¾æ¥é‡Œé¢æœ‰æè¿°ï¼Œ <code>File Cache</code>æ˜¯ä¸ºäº†è¯»æ•°æ®çš„æ—¶å€™åŠ é€Ÿç”¨çš„ã€‚å¦‚æœæœ‰å¤§æ‰¹é‡çš„è¯»æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ª<code>Cache</code>å°±ä¼šè¢«æ’‘æ»¡ã€‚</li>
<li>ç»“åˆä¸Šé¢<code>readStage</code>çš„<code>exception</code>ï¼Œ<code>Cassandra</code>çš„è¯»æ€§èƒ½åº”è¯¥æ˜¯ä¸‹é™äº†</li>
</ul>
<h2 id="stage-v2"><a class="header-anchor" href="#stage-v2"></a>Stage</h2>
<h3 id="mutationstage"><a class="header-anchor" href="#mutationstage"></a>MutationStage</h3>
<pre><code>[MutationStage-3]  ColumnFamilyStore.java:2187 - Truncating &lt;table_name&gt;
</code></pre>
<h3 id="migrationstage"><a class="header-anchor" href="#migrationstage"></a>MigrationStage</h3>
<pre><code>[MigrationStage:1]  ColumnFamilyStore.java:427 - Initializing &lt;table_name&gt;

[MigrationStage:1]  MigrationCoordinator.java:448 - Sending schema pull request to /xx.xx.xx.xx at 1621984266178 with timeout 10000
</code></pre>
<h3 id="readrepairstage"><a class="header-anchor" href="#readrepairstage"></a>ReadRepairStage</h3>
<blockquote>
<p><a href="https://stackoverflow.com/questions/50207323/cassandra3-exception-in-thread-threadreadrepairstage-operation-timed-out-r" target="_blank" rel="noopener">cassandra3-exception-in-thread-threadreadrepairstage</a></p>
</blockquote>
<pre><code>[ReadRepairStage:23]  CassandraDaemon.java:244 - Exception in thread Thread[ReadRepairStage:23,5,main]
</code></pre>
<ul>
<li>
<p>æˆ‘ä»¬è‡ªå·±çš„æ—¥å¿—é‡Œé¢åªæœ‰ä¸Šé¢ä¸€å¥è¯ã€‚<code>stackoverflow</code> ä¸Šé¢çš„æœ‰æ‰“å‡ºæ¥çš„æ˜¯<code>readtimeout</code>é”™è¯¯</p>
<pre><code>ERROR [ReadRepairStage:12] 2018-05-07 10:35:19,056 CassandraDaemon.java:228 - Exception in thread Thread[ReadRepairStage:12,5,main]
org.apache.cassandra.exceptions.ReadTimeoutException: Operation timed out - received only 0 responses.
</code></pre>
</li>
</ul>
<h3 id="contermutationstage"><a class="header-anchor" href="#contermutationstage"></a>ConterMutationStage</h3>
<blockquote>
<p><a href="https://stackoverflow.com/questions/45306061/cassandra-writetimeoutexception-exception-in-countermutationstage-node-dies-ev" target="_blank" rel="noopener">writetimeoutexception-exception-in-countermutationstage</a><br>
<a href="https://stackoverflow.com/questions/29667596/after-high-traffic-cassandra-writetimeoutexception" target="_blank" rel="noopener">Stack Overflow - writetimeoutexception</a></p>
</blockquote>
<pre><code>[CounterMutationStage-227]  AbstractLocalAwareExecutorService.java:166 - Uncaught exception on thread Thread[CounterMutationStage-227,5,main]
</code></pre>
<ul>
<li>ä¸çŸ¥é“ä¸ºå•¥ï¼Œä¸Šé¢çš„<code>log</code>æ²¡æœ‰æ‰“å‡ºå…·ä½“çš„ä¿¡æ¯ã€‚åœ¨æˆ‘è¿™é‡Œä¹Ÿå«çœ‹ä¸åˆ°åˆ°åº•æ˜¯ä»€ä¹ˆé”™è¯¯äº†</li>
<li>ä¸Šé¢çš„é“¾æ¥é‡Œé¢æ˜¯<code>WriteTimeoutException</code>ï¼Œæˆ‘ä»¬è‡ªå·±çš„ç³»ç»Ÿé‡Œé¢ä¹Ÿæ˜¯<code>timeout</code>çš„é”™è¯¯ã€‚æŒ‰ç…§åˆ†æï¼Œå¯èƒ½æ˜¯<code>I/O</code>æ’‘ä¸ä½äº†ã€‚è¿™ä¹ˆçœ‹æ¥ä¹Ÿå®Œå…¨æœ‰å¯èƒ½ï¼Œç›®å‰ä»æ—¥å¿—é‡Œé¢ï¼Œçœ‹ä¸å‡ºæ¥ç£ç›˜å’Œå†…å­˜çš„é”™è¯¯ã€‚</li>
<li>ç¬¬äºŒä¸ªé“¾æ¥ä¸­çš„<code>Cassandra</code>çš„ç‰ˆæœ¬æ¯”è¾ƒæ—§ï¼Œè¿˜æ˜¯<code>2.x</code>ï¼Œæ—¥å¿—çš„è¡¨å¤´æœ‰äº›ä¸åŒï¼Œä½†æ˜¯ä¹Ÿæ˜¯çŠ¹è±«<code>CounterMutationStage</code>å¯¼è‡´çš„å†™æ—¶å€™çš„<code>timeout</code>ï¼Œå…¶ä¸­æåˆ°é¢‘ç¹çš„<code>GC</code>ä¹Ÿä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™<br>
<strong>are your Cassandra nodes experiencing high GC pressure (check pauses in gc log - especially on the other nodes, at times correlating with the WriteTimeou</strong></li>
</ul>
<h2 id="hintsdispatcher"><a class="header-anchor" href="#hintsdispatcher"></a>HintsDispatcher</h2>
<pre><code>[HintsDispatcher:3]  HintsStore.java:133 - Deleted hint file 21869582-fb73-426c-827e-15a75b506223-1622088330901-1.hints
[HintsDispatcher:3]  HintsDispatchExecutor.java:282 - Finished hinted handoff of file 21869582-fb73-426c-827e-15a75b506223-1622088330901-1.hints to endpoint /192.168.94.54: 21869582-fb73-426c-827e-15a75b506223
</code></pre>
<ul>
<li>è¿™å›è·‘æµ‹è¯•çš„æ—¶å€™æœ‰ä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œç„¶åå°±å‡ºç°äº†<code>hint</code>ç›¸å…³çš„æ—¥å¿—</li>
<li>æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šé¢éƒ½æœ‰ä¸Šè¯‰æ—¥å¿—</li>
</ul>
<h2 id="scheduledtasks"><a class="header-anchor" href="#scheduledtasks"></a>ScheduledTasks</h2>
<pre><code>[ReadStage-12]  MonitoringTask.java:93 - Scheduling monitoring task with report interval of 5000 ms, max operations 50 

[ScheduledTasks:1]  NoSpamLogger.java:91 - Some operations were slow, details available at debug level (debug.log)
</code></pre>
<ul>
<li>
<p>è¿™ä¸¤å¥æ—¥å¿—åœ¨æºç é‡Œé¢æ˜¯åœ¨ä¸€å—çš„ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code>logger.info(&quot;Scheduling monitoring task with report interval of {} ms, max operations {}&quot;, reportIntervalMillis, maxOperations);
this.reportingTask = ScheduledExecutors.scheduledTasks.scheduleWithFixedDelay(() -&gt; logOperations(ApproximateTime.currentTimeMillis()),   reportIntervalMillis,                   reportIntervalMillis, TimeUnit.MILLISECONDS);
</code></pre>
</li>
<li>
<p>ç¬¬äºŒå¥å°±æ˜¯åœ¨<code>logOperations</code>é‡Œé¢æ‰“å°å‡ºæ¥çš„ã€‚çœ‹èµ·æ¥ï¼Œ<code>Cassandra</code>æ˜¯åœ¨åŠ è½½ç±»çš„æ—¶å€™èµ·æ¥çš„<code>MonitoringTask</code></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sallyslove.github.io/hexo_blog/2019/01/14/React%E5%85%A5%E9%97%A8-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hexo_blog/images/avatar.gif">
      <meta itemprop="name" content="Lynn Shen">
      <meta itemprop="description" content="35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è·¬æ­¥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo_blog/2019/01/14/React%E5%85%A5%E9%97%A8-1/" class="post-title-link" itemprop="url">Reactå…¥é—¨(1)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-01-14 16:35:28" itemprop="dateCreated datePublished" datetime="2019-01-14T16:35:28+08:00">2019-01-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-01-15 14:53:45" itemprop="dateModified" datetime="2019-01-15T14:53:45+08:00">2019-01-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hexo_blog/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
                </span>
            </span>

          
            <span id="/hexo_blog/2019/01/14/React%E5%85%A5%E9%97%A8-1/" class="post-meta-item leancloud_visitors" data-flag-title="Reactå…¥é—¨(1)" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/hexo_blog/2019/01/14/React%E5%85%A5%E9%97%A8-1/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/hexo_blog/2019/01/14/React%E5%85%A5%E9%97%A8-1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="reactå…¥é—¨"><a class="header-anchor" href="#reactå…¥é—¨"></a>Reactå…¥é—¨</h1>
<h2 id="å‚è€ƒæ–‡æ¡£"><a class="header-anchor" href="#å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2>
<p><a href="http://www.ruanyifeng.com/blog/2015/03/react.html" target="_blank" rel="noopener">é˜®ä¸€å³°çš„åšå®¢</a></p>
<h2 id="react-æ˜¯ä»€ä¹ˆ"><a class="header-anchor" href="#react-æ˜¯ä»€ä¹ˆ"></a>React æ˜¯ä»€ä¹ˆ</h2>
<p>Reactæ˜¯Facebookå‘å¸ƒçš„å‰ç«¯æ¡†æ¶</p>
<h2 id="reactçš„ä¼˜åŠ¿"><a class="header-anchor" href="#reactçš„ä¼˜åŠ¿"></a>Reactçš„ä¼˜åŠ¿</h2>
<p>ç°åœ¨è¿˜ä¸çŸ¥é“å“ªé‡Œæœ‰ä¼˜åŠ¿ã€‚æœ€å¤§çš„åº”è¯¥å°±æ˜¯JXSï¼Œç„¶åå¯ä»¥ç»„ä»¶åŒ–ã€‚</p>
<h2 id="reactçš„ä¸€äº›ç›¸å…³æ¦‚å¿µ"><a class="header-anchor" href="#reactçš„ä¸€äº›ç›¸å…³æ¦‚å¿µ"></a>Reactçš„ä¸€äº›ç›¸å…³æ¦‚å¿µ</h2>
<h3 id="dom"><a class="header-anchor" href="#dom"></a>DOM</h3>
<ul>
<li><code>DOM</code>: æ–‡æ¡£å¯¹è±¡æ¨¡å‹(Document Object Model). è¿™æ˜¯è¡¨ç¤ºå’Œå¤„ç†ä¸€ä¸ªHTMLæˆ–XMLæ–‡æ¡£çš„å¸¸ç”¨æ–¹æ³•ã€‚<br>
<a href="https://baike.baidu.com/item/DOM/50288#1_2" target="_blank" rel="noopener">DOM:ç™¾åº¦ç™¾ç§‘è§£é‡Š</a></li>
<li>ç›®å‰çš„ç†è§£æ˜¯ï¼šDOMå…¶å®å°±æ˜¯ä¸€å¥—æè¿°æ•°æ®ç»“æ„çš„æ–¹æ³•ã€‚ä¸€å¼€å§‹å¤§å®¶ä¸ç»Ÿä¸€ï¼Œåæ¥æœ‰W3Cç»™å‡ºäº†è§„èŒƒï¼Œå¯ä»¥åˆ†ä¸ºDOMæ ¸å¿ƒï¼ŒHTMLçš„DOMï¼ŒXMLçš„DOMè¿™å‡ ä¸ª</li>
<li>è¿›ä¸€æ­¥çš„ç†è§£ï¼šDOMæ˜¯å‰ç«¯åŸæ¥å°±æœ‰çš„ä¸€ä¸ªæ¦‚å¿µï¼Œç„¶åReactç»™è¿™ä¸ªæ¦‚å¿µèµ‹äºˆäº†ä¸€äº›æ–°çš„å†…æ¶µã€‚æ‰€æœ‰æœ‰React DOMè¿™ä¸ªè¯´æ³•ã€‚React DOMå…¶å®å°±æ˜¯ç»„ä»¶ã€‚</li>
</ul>
<h3 id="jsx"><a class="header-anchor" href="#jsx"></a>JSX</h3>
<p>JSX è¯­æ³•æ˜¯Reactç‹¬æœ‰çš„ã€‚ç›®å‰çš„ç†è§£æ˜¯ï¼š</p>
<ul>
<li>JSXè¯­æ³•åœ¨æ”¯æŒJSé‡Œé¢å¤„ç†HTMLã€‚</li>
<li>å¦‚æœè¿™æ ·çš„è„šæœ¬æ’åœ¨htmlé‡Œé¢ï¼Œè¦ç”¨<code>text/babel</code>æ¥æ ‡è®°ã€‚ babelå‘½ä»¤å¯ä»¥å°†JSXè¯­æ³•ç¼–è¯‘æˆä¸ºJSè¯­æ³•ã€‚</li>
<li>JSX çš„åŸºæœ¬è¯­æ³•è§„åˆ™ï¼šé‡åˆ° HTML æ ‡ç­¾ï¼ˆä»¥ <code>&lt;</code> å¼€å¤´ï¼‰ï¼Œå°±ç”¨ HTML è§„åˆ™è§£æï¼›é‡åˆ°ä»£ç å—ï¼ˆä»¥ <code>{</code> å¼€å¤´ï¼‰ï¼Œå°±ç”¨ JavaScript è§„åˆ™è§£æã€‚</li>
</ul>
<p><a href="https://reactjs.org/docs/rendering-elements.html#jsx-syntax" target="_blank" rel="noopener">JSXè¯­æ³•</a></p>
<h3 id="reactç»„ä»¶"><a class="header-anchor" href="#reactç»„ä»¶"></a>Reactç»„ä»¶</h3>
<ul>
<li>ä½¿ç”¨<code>React.createClass(</code> æ¥åˆ›å»ºä¸€ä¸ªç»„ä»¶ï¼Œç»„ä»¶å¯ä»¥è®¤ä¸ºå’ŒHTMLçš„æ ‡ç­¾ä¸€æ ·ä½¿ç”¨ã€‚e.gï¼šMyComponentsæ˜¯åˆ›å»ºå‡ºæ¥çš„ä¸€ä¸ªç»„ä»¶ã€‚</li>
</ul>
<pre><code>&lt;MyComponent
    &quot;Hello world!&quot;;
/MyComponent&gt;
</code></pre>
<ul>
<li>å‰é¢æåˆ°è¿‡React DOMï¼Œå…¶å®å°±æ˜¯ç»„ä»¶ã€‚ç»„ä»¶åœ¨å®šä¹‰æ—¶å€™ï¼Œåªæ˜¯å†…å­˜é‡Œé¢çš„ä¸€ä¸ªæ•°æ®ï¼Œä½†æ˜¯å› ä¸ºå¯ä»¥ä½œä¸ºHTMLæ ‡ç­¾ä½¿ç”¨ï¼Œç„¶årenderæˆä¸ºHTMLé‡Œé¢çš„DOMï¼Œæ‰€æœ‰è¢«ç§°ä¸ºvirtual DOM</li>
<li>ç»„ä»¶ç±»åªèƒ½åŒ…å«ä¸€ä¸ªé¡¶å±‚å…ƒç´ ã€‚</li>
<li>æ‰€æœ‰çš„ç»„ä»¶ç±»å¿…é¡»æœ‰è‡ªå·±çš„renderæ–¹æ³•ï¼Œæ¥</li>
<li>ç»„ä»¶çš„å±æ€§å¯ä»¥åœ¨ç»„ä»¶ç±»çš„ <code>this.props</code> å¯¹è±¡ä¸Šè·å–, å…¶ä¸­çš„<code>this.props.children</code>ä»£è¡¨æ‰€æœ‰çš„å­èŠ‚ç‚¹ã€‚</li>
<li><code>PropTypes</code> å¯ä»¥ç”¨æ¥é™å®šå‚æ•°çš„ç±»å‹ï¼Œ <code>getDefaultProps</code> æ–¹æ³•å¯ä»¥ç”¨æ¥è®¾ç½®ç»„ä»¶å±æ€§çš„é»˜è®¤å€¼</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/hexo_blog/page/3/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/hexo_blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/hexo_blog/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/hexo_blog/page/5/">5</a><a class="extend next" rel="next" href="/hexo_blog/page/5/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Lynn Shen</p>
  <div class="site-description" itemprop="description">35å²å¼€å§‹çš„åšå®¢ï¼Œæœ‰ç‚¹æ™šå“¦</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/hexo_blog/archives/">
        
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/hexo_blog/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lynn Shen</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> å¼ºåŠ›é©±åŠ¨
  </div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"ffyWzhHueqJEC5UEfPUhAWzF-MdYXbMMI","app_key":"vS7xTvT1vD1DxluERkmlkvme","server_url":"https://sallyslove.github.io/hexo_blog","security":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/hexo_blog/lib/anime.min.js"></script>
  <script src="/hexo_blog/lib/velocity/velocity.min.js"></script>
  <script src="/hexo_blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/hexo_blog/js/utils.js"></script>

<script src="/hexo_blog/js/motion.js"></script>


<script src="/hexo_blog/js/schemes/muse.js"></script>


<script src="/hexo_blog/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'ffyWzhHueqJEC5UEfPUhAWzF-MdYXbMMI',
      appKey     : 'vS7xTvT1vD1DxluERkmlkvme',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
